/*
 This program and the accompanying materials are
 made available under the terms of the Eclipse Public License v2.0 which accompanies
 this distribution, and is available at https://www.eclipse.org/legal/epl-v20.html

 SPDX-License-Identifier: EPL-2.0

 Copyright Contributors to the Zowe Project.
*/
!function(t){if(!window.COM_RS_COMMON_LOGGER){window.COM_RS_COMMON_LOGGER=function(){console.log("Fallback logger loaded because common logger not found.")};var e=function(t){arguments.length>1&&(t=arguments[1]),console.log(t)};window.COM_RS_COMMON_LOGGER.makeComponentLogger=function(){return{info:e,warn:e,log:e,debug:e,severe:e}}}var l=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore");const i="Lucida Console, Monaco, monospace",n=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~"],s={Copy:273,Paste:273},r=80,h=[88,32,91,93],o=0,a=0,u=1,c=[49],d=[50],p=[54],f=[55],g=[56],w=[27,91,63,54,99],b=[27,91,63,54,50,59,c,59,d,59,p,59,f,59,g,99],y=[27,91,63,54,51,59,c,59,d,59,p,59,f,59,g,99],m=[27,91,63,54,52,59,c,59,d,59,p,59,f,59,g,99],v=[27,91,62,49,59,50,48,59,48,99],C=[27,91,62,50,52,59,50,48,59,48,99],k=[27,91,62,52,49,59,50,48,59,48,99],A=[[27,91,91,65],[27,91,91,66],[27,91,91,67],[27,91,91,68],[27,91,91,69],[27,91,91,70],[27,91,49,56,126],[27,91,49,57,126],[27,91,50,48,126],[27,91,50,49,126],[27,91,50,51,126],[27,91,50,52,126],[27,91,50,53,126],[27,91,50,54,126],[27,91,50,56,126],[27,91,50,57,126],[27,91,51,49,126],[27,91,51,50,126],[27,91,51,51,126],[27,91,50,52,126]],T=[[27,91,49,49,126],[27,91,49,50,126],[27,91,49,51,126],[27,91,49,52,126],[27,91,49,53,126],[27,91,49,55,126],[27,91,49,56,126],[27,91,49,57,126],[27,91,50,48,126],[27,91,50,49,126],[27,91,50,51,126],[27,91,50,52,126],[27,91,50,53,126],[27,91,50,54,126],[27,91,50,56,126],[27,91,50,57,126],[27,91,51,49,126],[27,91,51,50,126],[27,91,51,51,126],[27,91,50,52,126]],E={"Cursor Up":[[27,91,65],[27,79,65],[27,65]],"Cursor Down":[[27,91,66],[27,79,66],[27,66]],"Cursor Right":[[27,91,67],[27,79,67],[27,67]],"Cursor Left":[[27,91,68],[27,79,68],[27,68]]},S={0:[[48],[27,79,112]],1:[[49],[27,79,113]],2:[[50],[27,79,114]],3:[[51],[27,79,115]],4:[[52],[27,79,116]],5:[[53],[27,79,117]],6:[[54],[27,79,118]],7:[[55],[27,79,119]],8:[[56],[27,79,120]],9:[[57],[27,79,121]],".":[[46],[27,79,110]],"+":[[43],[27,79,108]],"-":[[45],[27,79,83]],"*":[[42],[27,79,82]],"/":[[47],[27,79,81]],Enter:[[13],[27,79,77]]},P={"Alt+ ":[27,32],"Alt+!":[27,33],'Alt+"':[27,34],"Alt+#":[27,35],"Alt+$":[27,36],"Alt+%":[27,37],"Alt+&":[27,38],"Alt+'":[27,39],"Alt+(":[27,40],"Alt+)":[27,41],"Alt+*":[27,42],"Alt++":[27,43],"Alt+,":[27,44],"Alt+-":[27,45],"Alt+.":[27,46],"Alt+/":[27,47],"Alt+0":[27,48],"Alt+1":[27,49],"Alt+2":[27,50],"Alt+3":[27,51],"Alt+4":[27,52],"Alt+5":[27,53],"Alt+6":[27,54],"Alt+7":[27,55],"Alt+8":[27,56],"Alt+9":[27,57],"Alt+:":[27,58],"Alt+;":[27,59],"Alt+<":[27,60],"Alt+=":[27,61],"Alt+>":[27,62],"Alt+?":[27,63],"Alt+@":[27,64],"Alt+A":[27,65],"Alt+B":[27,66],"Alt+C":[27,67],"Alt+D":[27,68],"Alt+E":[27,69],"Alt+F":[27,70],"Alt+G":[27,71],"Alt+H":[27,72],"Alt+I":[27,73],"Alt+J":[27,74],"Alt+K":[27,75],"Alt+L":[27,76],"Alt+M":[27,77],"Alt+N":[27,78],"Alt+O":[27,79],"Alt+P":[27,80],"Alt+Q":[27,81],"Alt+R":[27,82],"Alt+S":[27,83],"Alt+T":[27,84],"Alt+U":[27,85],"Alt+V":[27,86],"Alt+W":[27,87],"Alt+X":[27,88],"Alt+Y":[27,89],"Alt+Z":[27,90],"Alt+`":[27,96],"Alt+a":[27,97],"Alt+b":[27,98],"Alt+c":[27,99],"Alt+d":[27,100],"Alt+e":[27,101],"Alt+f":[27,102],"Alt+g":[27,103],"Alt+h":[27,104],"Alt+i":[27,105],"Alt+j":[27,106],"Alt+k":[27,107],"Alt+l":[27,108],"Alt+m":[27,109],"Alt+n":[27,110],"Alt+o":[27,111],"Alt+p":[27,112],"Alt+q":[27,113],"Alt+r":[27,114],"Alt+s":[27,115],"Alt+t":[27,116],"Alt+u":[27,117],"Alt+v":[27,118],"Alt+w":[27,119],"Alt+x":[27,120],"Alt+y":[27,121],"Alt+z":[27,122],"Alt+{":[27,123],"Alt+|":[27,124],"Alt+}":[27,125],"Alt+~":[27,126],"Control+a":[1],"Control+b":[2],"Control+c":[3],"Control+d":[4],"Control+e":[5],"Control+f":[6],"Control+g":[7],"Control+h":[8],"Control+i":[9],"Control+j":[10],"Control+k":[11],"Control+l":[12],"Control+m":[13],"Control+n":[14],"Control+o":[15],"Control+p":[16],"Control+q":[17],"Control+r":[18],"Control+s":[19],"Control+t":[20],"Control+u":[21],"Control+v":[22],"Control+w":[23],"Control+x":[24],"Control+y":[25],"Control+z":[26],"Control+@":[0],"Control+3":[27],"Control+[":[27],"Control+\\":[28],"Control+]":[29],"Control+^":[30],"Control+_":[31],KP_PF01:[27,79,80],KP_PF02:[27,79,81],KP_PF03:[27,79,82],KP_PF04:[27,79,83],PF1:[27,79,80],F1:T[0],PF01:T[0],PF2:[27,79,81],F2:T[1],PF02:T[1],PF3:[27,79,82],F3:T[2],PF03:T[2],PF4:[27,79,83],F4:T[3],PF04:T[3],F5:T[4],PF05:T[4],F6:T[5],PF06:T[5],F7:T[6],PF07:T[6],F8:T[7],PF08:T[7],F9:T[8],PF09:T[8],F10:T[9],PF10:T[9],F11:T[10],PF11:T[10],F12:T[11],PF12:T[11],F13:T[12],PF13:T[12],F14:T[13],PF14:T[13],F15:T[14],PF15:T[14],F16:T[15],PF16:T[15],F17:T[16],PF17:T[16],F18:T[17],PF18:T[17],F19:T[18],PF19:T[18],F20:T[19],PF20:T[19],"Page Up":[21],"Page Down":[22],Backspace:[8],Tab:[9],Escape:[27],Enter:[13],"Cursor Next Line":[27,91,69],"Cursor Previous Line":[27,91,70],"Horizontal Pos Abs":[27,91,71],"Cursor Back Tab":[27,91,90],"Print Screen":[27,91,48,105],"Reset Mode":[27,91,108],Delete:[127],"Delete (Linux)":[27,91,51,126],Home:[1],End:[5],Insert:[27,91,50,126]},F={"Alt+ ":[27,32],"Alt+!":[27,33],'Alt+"':[27,34],"Alt+#":[27,35],"Alt+$":[27,36],"Alt+%":[27,37],"Alt+&":[27,38],"Alt+'":[27,39],"Alt+(":[27,40],"Alt+)":[27,41],"Alt+*":[27,42],"Alt++":[27,43],"Alt+,":[27,44],"Alt+-":[27,45],"Alt+.":[27,46],"Alt+/":[27,47],"Alt+0":[27,48],"Alt+1":[27,49],"Alt+2":[27,50],"Alt+3":[27,51],"Alt+4":[27,52],"Alt+5":[27,53],"Alt+6":[27,54],"Alt+7":[27,55],"Alt+8":[27,56],"Alt+9":[27,57],"Alt+:":[27,58],"Alt+;":[27,59],"Alt+<":[27,60],"Alt+=":[27,61],"Alt+>":[27,62],"Alt+?":[27,63],"Alt+@":[27,64],"Alt+A":[27,65],"Alt+B":[27,66],"Alt+C":[27,67],"Alt+D":[27,68],"Alt+E":[27,69],"Alt+F":[27,70],"Alt+G":[27,71],"Alt+H":[27,72],"Alt+I":[27,73],"Alt+J":[27,74],"Alt+K":[27,75],"Alt+L":[27,76],"Alt+M":[27,77],"Alt+N":[27,78],"Alt+O":[27,79],"Alt+P":[27,80],"Alt+Q":[27,81],"Alt+R":[27,82],"Alt+S":[27,83],"Alt+T":[27,84],"Alt+U":[27,85],"Alt+V":[27,86],"Alt+W":[27,87],"Alt+X":[27,88],"Alt+Y":[27,89],"Alt+Z":[27,90],"Alt+`":[27,96],"Alt+a":[27,97],"Alt+b":[27,98],"Alt+c":[27,99],"Alt+d":[27,100],"Alt+e":[27,101],"Alt+f":[27,102],"Alt+g":[27,103],"Alt+h":[27,104],"Alt+i":[27,105],"Alt+j":[27,106],"Alt+k":[27,107],"Alt+l":[27,108],"Alt+m":[27,109],"Alt+n":[27,110],"Alt+o":[27,111],"Alt+p":[27,112],"Alt+q":[27,113],"Alt+r":[27,114],"Alt+s":[27,115],"Alt+t":[27,116],"Alt+u":[27,117],"Alt+v":[27,118],"Alt+w":[27,119],"Alt+x":[27,120],"Alt+y":[27,121],"Alt+z":[27,122],"Alt+{":[27,123],"Alt+|":[27,124],"Alt+}":[27,125],"Alt+~":[27,126],"Control+a":[1],"Control+b":[2],"Control+c":[3],"Control+d":[4],"Control+e":[5],"Control+f":[6],"Control+g":[7],"Control+h":[8],"Control+i":[9],"Control+j":[10],"Control+k":[11],"Control+l":[12],"Control+m":[13],"Control+n":[14],"Control+o":[15],"Control+p":[16],"Control+q":[17],"Control+r":[18],"Control+s":[19],"Control+t":[20],"Control+u":[21],"Control+v":[22],"Control+w":[23],"Control+x":[24],"Control+y":[25],"Control+z":[26],"Control+@":[0],"Control+3":[27],"Control+[":[27],"Control+\\":[28],"Control+]":[29],"Control+^":[30],"Control+_":[31],PF1:[27,79,80],F1:A[0],PF01:A[0],PF2:[27,79,81],F2:A[1],PF02:A[1],PF3:[27,79,82],F3:A[2],PF03:A[2],PF4:[27,79,83],F4:A[3],PF04:A[3],F05:A[4],PF05:A[4],F06:A[5],PF06:A[5],F07:A[6],PF07:A[6],F08:A[7],PF08:A[7],F09:A[8],PF09:A[8],F10:A[9],PF10:A[9],F11:A[10],PF11:A[10],F12:A[11],PF12:A[11],F13:A[12],PF13:A[12],F14:A[13],PF14:A[13],F15:A[14],PF15:A[14],F16:A[15],PF16:A[15],F17:A[16],PF17:A[16],F18:A[17],PF18:A[17],F19:A[18],PF19:A[18],F20:A[19],PF20:A[19],"Page Up":[27,91,53,126],"Page Down":[27,91,54,126],Backspace:[8],Tab:[9],Escape:[27],Enter:[13],"Cursor Next Line":[27,91,69],"Cursor Previous Line":[27,91,70],"Horizontal Pos Abs":[27,91,71],"Cursor Back Tab":[27,91,90],"Print Screen":[27,91,48,105],"Reset Mode":[27,91,108],Delete:[127],"Delete (Linux)":[27,91,51,126],Home:[27,91,49,126],End:[27,91,52,126],Insert:[27,91,50,126]},M=0,x=0;var N=function(t){return t||0===t?t.toString(16):"<FAIL: Not A Number>"},D=function(t,e,i,n){var s,r=i||0,h=n||t.length,o="";for(s=0;s<h;s++)o+=N(t[r+s])+" ",s%16==15&&(e&&e.debug?e.debug(o):l.debug(o),o="");o.length>0&&(e&&e.debug?e.debug(o):l.debug(o))};const R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,0,0,63,52,53,54,55,56,57,58,59,60,61,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,0,0,0,0,0,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var L=function(t){for(var e=[],l=(t.length,t.length),i=Math.floor(l/3),n=l-3*i,s=0,r=0;r<i;r++){let l=255&t[s++],i=255&t[s++],n=255&t[s++];e.push(O[l>>2]),e.push(O[l<<4&63|i>>4]),e.push(O[i<<2&63|n>>6]),e.push(O[63&n])}if(0!=n){let l=255&t[s++];if(e.push(O[l>>2]),1==n)e.push(O[l<<4&63]),e.push(61),e.push(61);else{let i=255&t[s++];e.push(O[l<<4&63|i>>4]),e.push(O[i<<2&63]),e.push(61)}}return String.fromCharCode.apply(null,e)};const O=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47];var _=function(t,e,l){function i(){}for(var n in i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.A=e,t.C=e.prototype,l)t[n]=l[n]};const I={Esc:"Escape",Nonconvert:"NonConvert",Spacebar:" ",ArrowLeft:"Left",ArrowRight:"Right",ArrowDown:"Down",ArrowUp:"Up",Del:"Delete","U+001B":"Escape","U+007F":"Delete","U+0008":"Backspace","U+0009":"Tab",OS:"Win",Meta:"Win",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MediaTrackNext:"MediaNextTrack",MediaTrackPrevious:"MediaPreviousTrack",AudioVolumeMute:"VolumeMute",AudioVolumeDown:"VolumeDown",AudioVolumeUp:"VolumeUp",Caps:"CapsLock",Ctrl:"Control",Ins:"Insert",Space:" ",Ent:"Enter"},G=0,H=1,V=2,U=4,B=3,z=5,W=6,$=7;function X(t,e){this.type=t,this.value=e}function Y(t,e,l,i,n,s,r,h){var o=[];return o[G]=t,o[H]=e,o[V]=l,o[U]=i,o[W]=n,o[B]=s,o[z]=r,o[$]=h,o}const J={Accept:null,Again:null,AllCandidates:null,Alphanumeric:null,ContextMenu:null,Attn:null,BrowserBack:null,BrowserFavorites:null,BrowserForward:null,BrowserHome:null,BrowserRefresh:null,BrowserSearch:null,BrowserStop:null,CapsLock:null,Clear:null,CodeInput:null,Compose:null,Crsel:null,Convert:null,Copy:null,Cut:null,Down:new Y(new X(64,"Cursor Down"),null,null,null,null,null,null,null),End:new Y(new X(64,"End"),null,null,null,null,null,null,null),Enter:new Y(new X(64,"Enter"),null,null,null,null,null,null,null),EraseEof:null,Execute:null,Exsel:null,F1:new Y(new X(64,"F1"),new X(64,"F13"),null,null,null,null,null,null),F2:new Y(new X(64,"F2"),new X(64,"F14"),null,null,null,null,null,null),F3:new Y(new X(64,"F3"),new X(64,"F15"),null,null,null,null,null,null),F4:new Y(new X(64,"F4"),new X(64,"F16"),null,null,null,null,null,null),F5:new Y(new X(64,"F5"),new X(64,"F17"),null,null,null,null,null,null),F6:new Y(new X(64,"F6"),new X(64,"F18"),null,null,null,null,null,null),F7:new Y(new X(64,"F7"),new X(64,"F19"),null,null,null,null,null,null),F8:new Y(new X(64,"F8"),new X(64,"F20"),null,null,null,null,null,null),F9:new Y(new X(64,"F9"),new X(64,"F21"),null,null,null,null,null,null),F10:new Y(new X(64,"F10"),new X(64,"F22"),null,null,null,null,null,null),F11:new Y(new X(64,"F11"),new X(64,"F23"),null,null,null,null,null,null),F12:new Y(new X(64,"F12"),new X(64,"F24"),null,null,null,null,null,null),F13:new Y(new X(64,"F13"),null,null,null,null,null,null,null),F14:new Y(new X(64,"F14"),null,null,null,null,null,null,null),F15:new Y(new X(64,"F15"),null,null,null,null,null,null,null),F16:new Y(new X(64,"F16"),null,null,null,null,null,null,null),F17:new Y(new X(64,"F17"),null,null,null,null,null,null,null),F18:new Y(new X(64,"F18"),null,null,null,null,null,null,null),F19:new Y(new X(64,"F19"),null,null,null,null,null,null,null),F20:new Y(new X(64,"F20"),null,null,null,null,null,null,null),F21:new Y(new X(64,"F21"),null,null,null,null,null,null,null),F22:new Y(new X(64,"F22"),null,null,null,null,null,null,null),F23:new Y(new X(64,"F23"),null,null,null,null,null,null,null),F24:new Y(new X(64,"F24"),null,null,null,null,null,null,null),FinalMode:null,Find:null,FullWidth:null,HalfWidth:null,HangulMode:null,HanjaMode:null,Help:null,Hiragana:null,Home:new Y(new X(64,"Home"),null,null,null,null,null,null,null),Insert:new Y(new X(64,"Insert"),null,null,null,null,null,null,null),JapaneseHiragana:null,JapaneseKatakana:null,JapaneseRomaji:null,JunjaMode:null,KanaMode:null,KanjiMode:null,Katakana:null,LaunchApplication1:null,LaunchApplication2:null,LaunchMail:null,Left:new Y(new X(64,"Cursor Left"),null,null,null,null,null,null,null),MediaNextTrack:null,MediaPlayPause:null,MediaPreviousTrack:null,MediaStop:null,ModeChange:null,Nonconvert:null,NumLock:null,PageDown:new Y(new X(64,"Page Down"),null,null,null,null,null,null,null),PageUp:new Y(new X(64,"Page Up"),null,null,null,null,null,null,null),Paste:null,Pause:null,Play:null,PreviousCandidate:null,PrintScreen:null,Process:null,Props:null,Right:new Y(new X(64,"Cursor Right"),null,null,null,null,null,null,null),RomanCharacters:null,ScrollLock:null,Select:null,SelectMedia:null,Stop:null,Up:new Y(new X(64,"Cursor Up"),null,null,null,null,null,null,null),Undo:null,VolumeDown:null,VolumeMute:null,VolumeUp:null,Win:null,Zoom:null," ":new Y(new X(2," "),new X(2," "),new X(64,"Control+@"),null,null,null,null,null),"!":new Y(null,new X(2,"!"),null,null,null,null,null,null,null),'"':new Y(null,new X(2,'"'),null,null,null,null,null,null),"#":new Y(null,new X(2,"#"),null,null,null,null,null,null),$:new Y(null,new X(2,"$"),null,null,null,null,null,null),"%":new Y(null,new X(2,"%"),null,null,null,null,null,null),"&":new Y(null,new X(2,"&"),null,null,null,null,null,null),"'":new Y(new X(2,"'"),null,null,null,null,null,null,null),"(":new Y(null,new X(2,"("),null,null,null,null,null,null),")":new Y(null,new X(2,")"),null,null,null,null,null,null),"*":new Y(null,new X(2,"*"),null,null,null,null,null,null),"+":new Y(null,new X(2,"+"),null,null,null,null,null,null),",":new Y(new X(2,","),null,null,null,null,null,null,null),"-":new Y(new X(2,"-"),null,new X(64,"Control+_"),null,null,null,null,null),".":new Y(new X(2,"."),null,null,null,null,null,null,null),"/":new Y(new X(2,"/"),null,null,null,null,null,null,null),0:new Y(new X(2,"0"),null,null,null,null,null,null,null),1:new Y(new X(2,"1"),null,null,null,null,null,null,null),2:new Y(new X(2,"2"),null,new X(64,"Control+@"),null,null,null,null,null),3:new Y(new X(2,"3"),null,new X(64,"Control+3"),null,null,null,null,null),4:new Y(new X(2,"4"),null,null,null,null,null,null,null),5:new Y(new X(2,"5"),null,null,null,null,null,null,null),6:new Y(new X(2,"6"),null,new X(2,String.fromCharCode.apply(null,[172])),null,null,null,null,null),7:new Y(new X(2,"7"),null,null,null,null,null,null,null),8:new Y(new X(2,"8"),null,null,null,null,null,null,null),9:new Y(new X(2,"9"),null,null,null,null,null,null,null),Numpad0:new Y(new X(2,"0"),null,null,null,null,null,null,null),Numpad1:new Y(new X(2,"1"),null,null,null,null,null,null,null),Numpad2:new Y(new X(2,"2"),null,null,null,null,null,null,null),Numpad3:new Y(new X(2,"3"),null,null,null,null,null,null,null),Numpad4:new Y(new X(2,"4"),null,null,null,null,null,null,null),Numpad5:new Y(new X(2,"5"),null,null,null,null,null,null,null),Numpad6:new Y(new X(2,"6"),null,null,null,null,null,null,null),Numpad7:new Y(new X(2,"7"),null,null,null,null,null,null,null),Numpad8:new Y(new X(2,"8"),null,null,null,null,null,null,null),Numpad9:new Y(new X(2,"9"),null,null,null,null,null,null,null),"Numpad/":new Y(new X(2,"/"),null,null,null,null,null,null,null),"Numpad*":new Y(new X(2,"*"),null,null,null,null,null,null,null),"Numpad-":new Y(new X(2,"-"),null,null,null,null,null,null,null),"Numpad+":new Y(new X(2,"+"),null,null,null,null,null,null,null),NumpadEnter:new Y(new X(2,"Enter"),null,new X(64,"New Line"),null,null,null,null,null),"Numpad.":new Y(new X(2,"."),null,null,null,null,null,null,null),NumpadUp:new Y(new X(64,"Cursor Up"),null,null,null,null,null,null,null),NumpadDown:new Y(new X(64,"Cursor Down"),null,null,null,null,null,null,null),NumpadLeft:new Y(new X(64,"Cursor Left"),null,null,null,null,null,null,null),NumpadRight:new Y(new X(64,"Cursor Right"),null,null,null,null,null,null,null),NumpadHome:new Y(new X(64,"Home"),null,null,null,null,null,null,null),NumpadPageUp:new Y(new X(64,"PageUp"),null,null,null,null,null,null,null),NumpadPageDown:new Y(new X(64,"PageDown"),null,null,null,null,null,null,null),NumpadEnd:new Y(new X(64,"End"),null,null,null,null,null,null,null),NumpadInsert:new Y(new X(64,"Insert"),null,null,null,null,null,null,null),NumpadDelete:new Y(new X(64,"Delete"),null,null,null,null,null,null,null),":":new Y(null,new X(2,":"),null,null,null,null,null,null),";":new Y(new X(2,";"),null,null,null,null,null,null,null),"<":new Y(null,new X(2,"<"),null,null,null,null,null,null),"=":new Y(new X(2,"="),null,null,null,null,null,null,null),">":new Y(null,new X(2,">"),null,null,null,null,null,null),"?":new Y(null,new X(2,"?"),null,null,null,null,null,null),"@":new Y(null,new X(2,"@"),null,null,null,new X(64,"Control+@"),null,null),"[":new Y(new X(2,"["),null,new X(64,"Control+["),null,null,null,null,null),"\\":new Y(new X(2,"\\"),null,new X(64,"Control+\\"),null,null,null,null,null),"]":new Y(new X(2,"]"),null,new X(64,"Control+]"),null,null,null,null,null),"^":new Y(null,new X(2,"^"),null,new X(64,"Control+^"),null,new X(64,"Record Separator"),null,null),_:new Y(null,new X(2,"_"),null,new X(64,"Control+_"),null,new X(64,"Unit Separator"),null,null),"`":new Y(new X(2,"`"),null,null,null,null,null,null,null),a:new Y(new X(2,"a"),new X(2,"A"),new X(64,"Control+a"),null,null,null,null,null),b:new Y(new X(2,"b"),new X(2,"B"),new X(64,"Control+b"),null,null,null,null,null),c:new Y(new X(2,"c"),new X(2,"C"),new X(64,"Control+c"),null,null,null,null,null),d:new Y(new X(2,"d"),new X(2,"D"),new X(64,"Control+d"),null,null,null,null,null),e:new Y(new X(2,"e"),new X(2,"E"),new X(64,"Control+e"),null,null,null,null,null),f:new Y(new X(2,"f"),new X(2,"F"),new X(64,"Control+f"),null,null,null,null,null),g:new Y(new X(2,"g"),new X(2,"G"),new X(64,"Control+g"),null,null,null,null,null),h:new Y(new X(2,"h"),new X(2,"H"),new X(64,"Control+h"),null,null,null,null,null),i:new Y(new X(2,"i"),new X(2,"I"),new X(64,"Control+i"),null,null,null,null,null),j:new Y(new X(2,"j"),new X(2,"J"),new X(64,"Control+j"),null,null,null,null,null),k:new Y(new X(2,"k"),new X(2,"K"),new X(64,"Control+k"),null,null,null,null,null),l:new Y(new X(2,"l"),new X(2,"L"),new X(64,"Control+l"),null,null,null,null,null),m:new Y(new X(2,"m"),new X(2,"M"),new X(64,"Control+m"),null,null,null,null,null),n:new Y(new X(2,"n"),new X(2,"N"),new X(64,"Control+n"),null,null,null,null,null),o:new Y(new X(2,"o"),new X(2,"O"),new X(64,"Control+o"),null,null,null,null,null),p:new Y(new X(2,"p"),new X(2,"P"),new X(64,"Control+p"),null,null,null,null,null),q:new Y(new X(2,"q"),new X(2,"Q"),new X(64,"Control+q"),null,null,null,null,null),r:new Y(new X(2,"r"),new X(2,"R"),new X(64,"Control+r"),null,null,null,null,null),s:new Y(new X(2,"s"),new X(2,"S"),new X(64,"Control+s"),null,null,null,null,null),t:new Y(new X(2,"t"),new X(2,"T"),new X(64,"Control+t"),null,null,null,null,null),u:new Y(new X(2,"u"),new X(2,"U"),new X(64,"Control+u"),null,null,null,null,null),v:new Y(new X(2,"v"),new X(2,"V"),null,null,null,null,null,null),w:new Y(new X(2,"w"),new X(2,"W"),new X(64,"Control+w"),null,null,null,null,null),x:new Y(new X(2,"x"),new X(2,"X"),new X(64,"Control+x"),null,null,null,null,null),y:new Y(new X(2,"y"),new X(2,"Y"),new X(64,"Control+y"),null,null,null,null,null),z:new Y(new X(2,"z"),new X(2,"Z"),new X(64,"Control+z"),null,null,null,null,null),"{":new Y(null,new X(2,"{"),null,null,null,null,null,null),"|":new Y(null,new X(2,"|"),null,null,null,null,null,null),"}":new Y(null,new X(2,"}"),null,null,null,null,null,null),"~":new Y(null,new X(2,"~"),null,null,null,null,null,null),Backspace:new Y(new X(64,"Delete"),new X(64,"Erase Character"),new X(64,"Delete Character"),null,null,null,null,null),Tab:new Y(new X(64,"Tab"),null,null,null,null,null,null,null),"U+0018":null,Escape:new Y(new X(64,"Escape"),null,null,null,null,null,null,null),Delete:new Y(new X(64,"Delete"),null,null,null,null,null,null,null),"U+00A1":null,"U+0300":null,"U+0301":null,"U+0302":null,"U+0303":null,"U+0304":null,"U+0306":null,"U+0307":null,"U+0308":null,"U+030A":null,"U+030B":null,"U+030C":null,"U+0327":null,"U+0328":null,"U+0345":null,"U+20AC":null,"U+3099":null,"U+309A":null};var j=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.render"),Q=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.scaling"),Z=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.color");const K=3,q=100,tt=16777215,et=2281766656;const lt=0,it=16777215;var nt=function(t){if(t.match(/^#([a-fA-F0-9]){6}/)){var e=parseInt(t.substring(1,7),16);return"rgb("+(e>>16)+","+(e>>8&255)+","+(255&e)+")"}if(t.match(/^rgb\((?:\d{1,3},){2}\d{1,3}\)/))return t;j.warn("Webcolor: bad color value, "+t)},st=function(t,e,l,i,n){Z.log(Z.FINEST,"Setting fill color. Previous color="+t.fillStyle+". Args length="+arguments.length),5==arguments.length?t.fillStyle="rgba("+e+","+l+","+i+","+n+")":4==arguments.length?t.fillStyle="rgb("+e+","+l+","+i+")":2==arguments.length?t.fillStyle="rgb("+((16711680&e)>>16)+","+((65280&e)>>8)+","+(255&e)+")":t.fillStyle=nt(e),Z.log(Z.FINEST,"Set fill color. New color="+t.fillStyle)},rt=function(t,e,l,i,n){Z.log(Z.FINEST,"Setting stroke color. Previous color="+t.strokeStyle+". Args length="+arguments.length),5==arguments.length?t.strokeStyle="rgba("+e+","+l+","+i+","+n+")":4==arguments.length?t.strokeStyle="rgb("+e+","+l+","+i+")":2==arguments.length?t.strokeStyle="rgb("+((16711680&e)>>16)+","+((65280&e)>>8)+","+(255&e)+")":t.strokeStyle=nt(e),Z.log(Z.FINEST,"Set stroke color. New color="+t.strokeStyle)},ht=function(t,e,l,i,n,s){for(var r=new Array(i),h=0;h<i;h++)r[h]=e[l+h];var o=String.fromCharCode.apply(null,r);j.log(j.FINEST,"Draw chars at canvas px("+n+","+s+") runLength="+i+" lineBuffer start="+l+" text="+o),t.fillText(o,n,s)};function ot(t,e,l,i,n){j.debug("Draw line (2) from ("+e+","+l+") to ("+i+","+n+")"),t.beginPath();var s=t.fillStyle;t.fillStyle=t.strokeStyle;for(var r=Math.sqrt((i-e)*(i-e)+(n-l)*(n-l)),h=i-e,o=n-l,a=Math.atan(o/(0==h?.01:h))+(h<0?Math.PI:0),u=0;u<r;u++)t.fillRect(Math.round(e+Math.cos(a)*u),Math.round(l+Math.sin(a)*u),1,1);t.stroke(),t.fillStyle=s}function at(t,e){this.H=t.H,this.B=t,this.J=-1,this.W=-1,this.G=-1,this.X=-1,this.font=null,this.K=Number(at.K),this.Y=t.Q&&t.Q.Y?t.Q.Y:i,l.debug("virtualScreen = "+t),l.debug("cInfo="+t.Z),this.tt=!0,this.et=1,this.lt=1,this.nt=-1,this.it=-1,this.st=1,this.rt=1,this.ht=1,this.ut=0,this.ot=0,this.at=e,this.ct=0,this.ft=K,this.wt=500,this.dt=!0,this.pt=t.bt(),this.vt=0,this.kt=lt,this.mt=tt,this.At=it,this.scaleMethod=1,this.gt=null,this.Ct=null,this.ft==K&&this.wt>=q&&0!=q&&this.St()}function ut(t,e,n){this.B=t,t.Tt=this,this.J=-1,this.W=-1,this.G=-1,this.X=-1,this.font=null,this.K=at.K,this.Y=t.Q&&t.Q.Y?t.Q.Y:i,l.debug("virtualScreen = "+t),l.debug("cInfo="+t.Z),this.tt=!0,this.et=1,this.lt=1,this.nt=-1,this.it=-1,this.st=1,this.rt=1,this.ht=1,this.ut=0,this.ot=0,this.at=e,this.ct=0,this.ft=K,this.yt=K,this.wt=500,this.Et=500,this.pt=t.bt(),this.scaleMethod=n||1,this.Ft=16711680,this.xt=65280,this.Pt=lt,this.Mt=16777215,this.Nt=65280,this.Rt=this.Nt,this.Dt=this.Nt,this.It=this.Pt,this.Lt=[0,12255232,47872,12303104,187,12255419,48059,12303291],this._t=[this.Lt[0],this.Lt[1],this.Lt[2],this.Lt[3],this.Lt[4],this.Lt[5],this.Lt[6],this.Lt[7],8421504,33023,65408,8454143,16744576,16744703,16777088,12632256],this.Ot=[5592405,16733525,5635925,16777045,5592575,16733695,5636095,16777215],this.Ut=[this.Ot[0],this.Ot[1],this.Ot[2],this.Ot[3],this.Ot[4],this.Ot[5],this.Ot[6],this.Ot[7],8421504,33023,65408,8454143,16744576,16744703,16777088,16777215],this.At=it,this.mt=tt,this.Vt=!1,this.Ht=!0,this.gt=null,this.Ct=null,this.ft==K&&this.wt>=q&&0!=q&&this.St(),this.Et>=q&&0!=q&&this.Bt(),this.zt()}at.Jt=2,at.jt="normal",at.Wt="normal",at.K=10,at.Y=i,at.prototype.Gt=function(t){if(t){if(j.debug("Setting font properties="+JSON.stringify(t)),t.size&&null!==t.size){let e=Number(t.size);this.K=e,at.K=e}t.scaleMethod&&null!==t.scaleMethod&&(this.scaleMethod=t.scaleMethod,1==this.scaleMethod&&(at.K=10)),this.$t(),this.zt()}},at.prototype.Xt=function(t,e,l,i){t.font=at.Wt+" "+at.jt+" "+e+"px "+l;var n=t.measureText(i);this.ut=0,this.ht=.85*e,this.Kt=e-(this.ut+this.ht),this.ot=this.ht+this.ut;var s=e;return{width:n.width,height:s}},at.prototype.qt=function(){return this.B.oiaEnabled?this.B.height+at.Jt:this.B.height},at.prototype.Yt=function(t,e){var l,i=t.width,n=t.height,s=this.B;let r;if(this.tt=!0,this.it=0,this.nt=0,Q.debug("Calculate font for canvas w="+i+",h="+n),0==this.scaleMethod)for(Q.debug("Calculating for scaleMethod=ratio"),r=50;r>4;r--){var h=(l=this.Xt(e,r,this.Y,"M")).width*s.width,o=l.height*this.qt();if(Q.debug("At font size="+r+", need w="+h+",h="+o),h<=i&&o<=n){Q.debug("Found size match. Chose font size ="+r+" for canvas w="+i+",h="+n+" ascent="+this.ht+", descent="+this.Kt+" leading="+this.ut),this.tt=!1,this.st=l.width,this.rt=l.height,this.font=at.Wt+" "+at.jt+" "+r+"px "+this.Y,this.it=h,this.nt=o;break}}else if(1==this.scaleMethod){Q.debug("Calculating for scaleMethod=fit"),r=10,l=this.Xt(e,r,this.Y,"M"),this.tt=!1,this.st=l.width,this.rt=l.height,this.font=at.Wt+" "+at.jt+" "+r+"px "+this.Y;var a=t.width/(s.width*l.width),u=t.height/(this.qt()*l.height);a=(parseInt(10*a)/10).toFixed(1),u=(parseInt(10*u)/10).toFixed(1),this.et=1/a,this.lt=1/u,this.it=t.width*this.et,this.nt=t.height*this.lt,e.scale(a,u),this.Qt.setTransform(1,0,0,1,0,0),this.Qt.scale(a,u),Q.debug("Scaled for font size="+r+", canvas w="+i+",h="+n+" ascent="+this.ht+", descent="+this.Kt+" leading="+this.ut),Q.debug("Scale factors are: sfX="+this.et+", sfY="+this.lt+", aH="+this.nt+", aW="+this.it+", sW="+a+", sH="+u)}else Q.debug("Calculating for scaleMethod=no scale"),r=at.K,l=this.Xt(e,r,this.Y,"M"),this.tt=!1,this.st=l.width,this.rt=l.height,this.font=at.Wt+" "+at.jt+" "+r+"px "+this.Y,this.et=1,this.lt=1,this.it=t.width,this.nt=t.height,e.scale("1","1"),this.Qt.setTransform(1,0,0,1,0,0),this.Qt.scale("1","1"),Q.debug("Scaled for font size="+r+", canvas w="+i+",h="+n+" ascent="+this.ht+", descent="+this.Kt+" leading="+this.ut);if(this.Y!=this.Zt){Q.debug("Determining font size for DBCS="+this.Zt);var c=this.Xt(e,r,this.Zt,"M"),d=this.Xt(e,r,this.Zt,"ä­º");Q.debug("SBCS box="+JSON.stringify(l)+" dbcsBox="+JSON.stringify(c)+" testSymbolBox="+JSON.stringify(d))}},at.prototype.te=function(t,e,l,i){var n;for(n=0;n<i;n++)t[n]=32,e[n]=0,l[n]=0},at.prototype.ee=function(t,e,l){for(var i=e;i<l;i++)if(t[i]>32)return i;return-1},at.prototype.le=function(t,e,l,i,n,s){for(var r=i+1,h=t[i],o=s?s[i]:null,a=e[i];r<n&&(h==et?t[r]==et:h==t[r])&&a==e[r]&&(!s||o==s[r]);)r++;return r-i},at.prototype.clear=function(){let t=this.B;var e=t.H.getContext("2d"),l=t.H.width,i=t.H.height;j.debug("Renderer.clear pxWidth="+l+" pxHeight="+i+" inactive=4210752"),st(e,this.kt),e.fillRect(0,0,this.it,this.nt)},at.prototype.$t=function(){this.B.H.getContext("2d").setTransform(1,0,0,1,0,0),this.et=1,this.lt=1,this.J=-1},at.prototype.ne=function(t,e){return this.B.H,this.B,1==this.scaleMethod&&(t*=this.et,e*=this.lt),(t>=this.it||e>=this.nt)&&j.debug("canvasX or canvasY is greater than activeWidth or activeHeight"),{ie:Math.floor(e/this.rt),se:Math.floor(t/this.st)}},at.prototype.re=function(){var t=this.B;let e=t.H;var l=this.Qt;l.font=this.font,st(l,255,255,255,0),l.clearRect(0,0,e.width,e.height),l.clearRect(0,0,this.it,this.nt),!0===this.pt&&(this.ft!=K||0==this.wt||1==this.dt)&&this.ft>0&&this.he(l,t.ue),null!=t.oe&&null!=t.ae&&null!=t.ce&&null!=t.fe&&this.we(t.oe,t.ae,t.fe,t.ce),1==t.oiaEnabled&&this.de(l,t)},at.prototype.de=function(t,e){let l=e.H;var i=t.lineWidth;t.beginPath(),rt(t,this.mt),t.lineWidth=5*this.lt;var n=l.height*this.lt+-1.5*this.rt;t.moveTo(0,n),t.lineTo(this.it,n);var s=e.pe();st(t,this.mt);var r=l.height*this.lt+-.25*this.rt;ht(t,s,0,e.width,0,r),t.closePath(),t.stroke(),t.lineWidth=i},at.prototype.we=function(t,e,l,i){if(t!=l&&e!=i){var n=Math.min(t,l),s=Math.max(t,l),r=Math.min(e,i),h=Math.max(e,i),o=this.B,a=o.be.getContext("2d");a.beginPath(),this.ve(n,r,s,h,a,o.H.getContext("2d")),a.closePath()}},at.prototype.ke=function(){clearTimeout(this.gt),1!=this.dt&&(this.dt=!0,this.re()),this.ft==K&&this.wt>=q&&0!=q&&this.St()},at.prototype.St=function(){var t=this;this.gt=setInterval(function(){t.dt=!t.dt,!0===t.pt&&t.re()},this.wt)},at.prototype.me=function(){clearTimeout(this.Ct),1!=this.Ae&&(this.Ae=!0,this.zt()),this.Et>=q&&0!=q&&this.Bt()},at.prototype.Bt=function(){var t=this;this.Ct=setInterval(function(){t.Ht&&(t.Ae=!t.Ae,t.zt())},this.Et)},at.prototype.he=function(t,e){if(-1!==e){var i=this.B,n=this.rt,s=this.st,r=this.B.ge?.2:1;if(0!=i.width){var h=Math.floor(e/i.width)+1,o=e%i.width;j.debug("show cursor pos="+e+" at row="+h+" column="+o),t.beginPath(),st(t,this.At),1==this.ft?(rt(t,this.At),t.moveTo(o*s,(h-r)*n),t.lineTo((1+o)*s,(h-r)*n),t.lineTo((1+o)*s,h*n),t.lineTo(o*s,h*n),t.lineTo(o*s,(h-r)*n),t.closePath(),t.stroke()):(this.ve(o,h-r,1+o,h,t,i.H.getContext("2d")),t.closePath())}else l.info("CANNOT SHOW CURSOR screen.width==0\n")}},at.prototype.ve=function(t,e,l,i,n,s){for(var r=this.rt,h=this.st,o=t*h,a=e*r,u=l*h,c=i*r,d=1==this.scaleMethod?o/this.et:o,p=1==this.scaleMethod?a/this.lt:a,f=1==this.scaleMethod?u/this.et:u,g=1==this.scaleMethod?c/this.lt:c,w=Math.abs(d-f),b=Math.abs(p-g),y=s.getImageData(d,p,w,b),m=0;m<y.data.length;m+=4)y.data[m]=255-y.data[m],y.data[m+1]=255-y.data[m+1],y.data[m+2]=255-y.data[m+2],y.data[m+3]=255;n.putImageData(y,d,p)},at.prototype.zt=function(){Ct("fullPaint")},at.prototype.Ce=function(){l.debug("Renderer resize completed")},_(ut,at,[ut.zt]),ut.Se=32,ut.Te=32,ut.prototype.ye=function(t,e,l,i){var n=this.B,s=!1;j.debug("Determining which rows to redraw. Include neighbors="+i);var r=n.Ee;if(null==r)j.debug("Viewport top is null, not redrawing any rows"),e.fill(!0);else{for(let t=0;t<n.height;t++){if(!r){e.fill(!0,t);break}r.Fe&&(s=!0),l[t]==r.id&&!0!==r.xe||(e[t]=!0,i&&(t>0&&(e[t-1]=!0),t<n.height-1&&(e[t+1]=!0))),r.xe=!1,l[t]=r.id,r=r.P}r=n.Ee,j.debug("Row redraw calculation result="+JSON.stringify(e))}this.Ht!=s&&(this.Ae=!0,this.Ht=s,e.fill(!0))},ut.prototype.Pe=function(){null!=this.Me&&null!=this.Me||(this.yt=this.ft),this.ft=0},ut.prototype.Ne=function(){this.ft=this.yt},ut.prototype.Re=function(){null!=this.Me&&null!=this.Me||(this.Me=this.wt),this.wt=0},ut.prototype.De=function(){this.wt=this.Me,this.Me=null},ut.prototype.Ie=function(t,e){var l=this.B.height,i=null;let n=this.rt,s=this.it;st(t,this.Pt),j.debug("Clearing updated rows by drawing with color="+this.Pt);var r=e.entries();for(let e of r)!0===e[1]?null==i&&(i=e[0]):null!=i&&(t.fillRect(0,n*i,s,n*(e[0]-i)),i=null);null!=i&&t.fillRect(0,n*i,s,n*(l+1-i))},ut.Le=function(t,e,l){var i=t-l+33,n=t-l+161;switch(e){case _t._e:return i;case _t.Oe:switch(j.log(j.FINER,"Getting symbol in charset. code=0x"+N(t)+", charset=0x"+e+", codeShift=0x"+l+". shifted=0x"+N(i)+", iso8859-like=0x"+N(n)),n){case 164:case 166:return ut.Se;case 168:return 164;case 172:case 173:case 174:case 175:return ut.Se;case 180:case 184:case 190:case 208:return ut.Se;case 215:return 338;case 221:return 376;case 222:case 240:return ut.Se;case 247:return 339;case 253:return 255;case 254:case 255:return ut.Se;default:return n}case _t.Ue:if(j.log(j.FINER,"Getting symbol in charset. code=0x"+N(t)+", charset=0x"+e+", codeShift=0x"+l+". shifted=0x"+N(i)+", iso8859-like=0x"+N(n)),i<95)return i;switch(i){case 95:return" ";case 96:return 9670;case 97:return 9618;case 98:return 9225;case 99:return 9228;case 100:return 9229;case 101:return 9226;case 102:return 176;case 103:return 177;case 104:return 9252;case 105:return 9227;case 106:return 9496;case 107:return 9488;case 108:return 9484;case 109:return 9492;case 110:return 9532;case 111:case 112:return 8254;case 113:return 9472;case 114:case 115:return 95;case 116:return 9500;case 117:return 9508;case 118:return 9524;case 119:return 9516;case 120:return 9474;case 121:return 8804;case 122:return 8805;case 123:return 960;case 124:return 8800;case 125:return 163;case 126:return 183;default:return j.warn("No DEC graphic char for shifted code=0x"+N(i))," "}default:return j.warn("No lookup for gl.charset=0x"+N(e))," "}},ut.Ve=function(t,e){var l=t.He;return l<=32?32:l<127?ut.Le(l,t.Be,33):l<=161?32:l<255?ut.Le(l,t.ze,161):!0===e?l:(null!=l&&j.warn("Failed to get glyph for code=0x"+N(l)),32)};var ct=new Nt(32);ut.prototype.Je=function(t,e,l,i,n,s,r,h){null==h&&(h=ct,i[s]=this.Mt,n[s]=this.Pt),e[s]=ut.Ve(h,this.B.je);var o=h.We;if(0==(64&h.Ge)){switch(h.$e){case _t.Xe:0!=(16&h.Ge)?i[s]=this.Rt:i[s]=this.Mt;break;case _t.Ke:0!=(16&h.Ge)?i[s]=this.Ot[o]:i[s]=this.Lt[o];break;case _t.qe:0!=(16&h.Ge)?i[s]=this.Ut[o]:i[s]=this._t[o];break;case _t.Ye:i[s]=o}var a=h.Qe;switch(h.Ze){case _t.Xe:n[s]=this.Pt;break;case _t.Ke:n[s]=this.Lt[a];break;case _t.qe:n[s]=this._t[a];break;case _t.Ye:n[s]=a}}else Z.debug("Element is hidden, setting null color"),i[s]=null,n[s]=null;l[s]=h.Ge},ut.prototype.tl=function(){if(!this.el){this.el=!0;var t=this.Pt;this.Pt=this.Mt,this.Mt=t,this.zt()}},ut.prototype.ll=function(){if(this.el){this.el=!1;var t=this.Pt;this.Pt=this.Mt,this.Mt=t,this.zt()}},ut.prototype.zt=function(){j.debug("Full paint called, will clear entire screen");let t=this.B.H;this.B.parentDiv;var e=t.getContext("2d");st(e,this.Pt),e.fillRect(0,0,t.width,t.height),this.B.nl.fill(null),this.il()};ut.prototype.il=function(t){let e=this.B.H;var l=e.width,i=e.height,n=e.getContext("2d",{alpha:!1});if(this.Qt=this.B.be.getContext("2d"),-1!=this.J&&this.J==l&&this.W==i||(this.Yt(e,n),this.Yt(this.B.be,this.Qt),this.J=l,this.W=i),this.tt)return;n.font=this.font,n.textBaseline="top",st(n,this.Mt);var s=this.B,r=Number(s.width),h=new Array(r),o=new Array(r),a=new Array(r),u=new Array(r);let c=0;var d=0,p=s.nl,f=new Array(Number(t>0?t:s.height));this.ye(n,f,p,!0),window.requestAnimationFrame(()=>{this.Ie(n,f);for(var t=s.Ee,l=0,i=e.height/s.height,p=0;p<s.height;p++)if(f[p]){var g;for(l++,null!=t&&"function"==typeof this.sl&&this.sl(t,p,i),p<3&&j.debug("startLine, baseline = "+c+" screenOffset="+d+" size="+s.size),this.te(h,u,o,r),g=0;g<r;g++)this.Je(p,h,u,o,a,g,r,null!=t?t.rl[g]:null);var w=0;for(g=0;g<r;){var b=this.le(o,u,p,g,r,a);if(null!=o[g]){var y=u[g];if(st(n,o[g]),rt(n,o[g]),n.lineWidth=1.5,j.debug("Run starts at ("+g+","+p+"). Length="+b+", Attr=0x"+N(y)+", FG="+o[g]+", BG="+a[g]),0!=(128&y)?(j.debug("Transforming canvas for double width"),n.save(),n.hl(2,0,0,1,0,0)):0!=(256&y)&&(j.debug("Transforming canvas for double height (top)"),n.save(),n.hl(2,0,0,2,0,-Math.round(this.nt/this.B.height)*p)),0==(512&y)){var m=0!=(2&y);if(m?(1==this.Vt&&(0!=(16&y)?(st(n,this.Dt),rt(n,this.Dt)):(st(n,this.Ft),rt(n,this.Ft))),n.fillRect(w,c,b*this.st,this.rt),1==this.Vt?st(n,0!=(16&y)?this.It:this.xt):st(n,a[g])):a[g]!=this.Pt&&(st(n,a[g]),n.fillRect(w,c,b*this.st,this.rt),st(n,o[g])),0!=(1&y)?this.ul(n,h,g,b,w,c,m):(0==(8&y)||this.Ae)&&ht(n,h,g,b,w,c),0!=(4&y)){var v=c+(this.rt-1);ot(n,w,v,w+b*this.st,v)}m&&st(n,o[g])}0==(128&y)&&0==(256&y)&&0==(512&y)||n.restore()}else-1!=this.ee(h,g,b)&&j.debug("Skipping render for null/invisible color at ("+g+","+p+")");g+=b,w+=b*this.st}d+=s.width,c+=this.rt,null!=t&&(t=t.P)}else{if(j.debug("Skipping unmodified row="+p),d+=s.width,c+=this.rt,null==t)break;t=t.P}j.debug("Drew "+l+" rows");let C=s.ol();s.ue=-1==C?C:s.width*C+s.al,this.re()})},ut.prototype.cl=function(t){let e=this.B;if(e.fl<1||e.wl===e.height)return;let l=this.rt,i=e.fl*l,n=(e.height,1==this.scaleMethod?i/this.lt:i),s=t.getImageData(0,n,this.it,this.nt-n);t.putImageData(s,0,0),e.fl=0},ut.prototype.dl=function(t){for(var e=0,l=0;l<t.length;l++)e=e<<4|parseInt(t[l],16);return e};var dt=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.keyboard"),pt=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.message"),ft=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.protocol"),gt=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.telnet"),wt=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.event"),bt=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.parse");const yt=80,mt=24,vt={pl:0,bl:1};function Ct(t){alert(t+": You are in the superclass!")}var kt;function At(t,e){this.vl=new Array(e||r),this.vl.fill(32)}function Tt(t,e){this.H=null,this.be=null,this.parentDiv=null,this.oiaEnabled=1,this.width=t,this.height=e,this.kl=vt.pl,this.ml=new At(this),this.Al=new Array(this.height*this.width),this.Tt=null,this.gl=yt,this.Cl=mt,this.Sl=[],this.Tl=null,this.yl=0,this.ae=null,this.oe=null,this.ce=null,this.fe=null,this.El=!1,this.Fl=!1,this.xl="rgb(255,255,255)",this.Pl,this.Ml=null,this.Nl=null,this.Rl=new Array,this.Dl=!1,this.Il=!1,this.Ll=!1,this._l=o,this.Ol=0}function Et(t,e){this.Ul,this.Vl=t,this.Hl,this.Bl,this.zl,this.Jl=e}function St(t){this.message=t,this.name="RuntimeException",l.warn("Encountered exception:"+this.name+", msg:"+t)}Tt.jl=function(t,e,i,n,s){l.debug(`make canvas w/ id=${t}, parentDiv=${e}, w,h=${i},${n}`);var r=document.createElement("canvas");r.id=t,r.style.zIndex=s,r.style.position="absolute",r.style.left="0px",r.style.top="0px";var h=i,o=n;return r.width=h,r.height=o,r.innerHTML="If you see this message, rather than a real drawing canvas, please upgrade to FireFox 1.5, Safari, or some other modern browser",e.appendChild(r),r},Tt.Wl=new Array(n.length),Tt.Wl.fill(!1),Tt.prototype.Gl=function(){let t=Tt.Wl.length;for(var e=0;e<t;e++)if(!Tt.Wl[e]){Tt.Wl[e]=!0,this.$l=n[e];break}this.$l||(this.$l=" "),this.Xl=this.$l},Tt.prototype.Kl=function(t){this.ql(4999,t.data,"Connection to host closed due to error.\nHost: "+this.Yl.host+"\nPort: "+this.Yl.port+"\nError:"+t.data)},Tt.prototype.Ql=function(t){this.ql(t.code,t.reason,"Connection to host closed.\nHost: "+this.Yl.host+"\nPort: "+this.Yl.port+"\nCode: "+t.code+"\nReason: "+t.reason)},Tt.prototype.ql=function(t,e,l){t!=this.Zl&&(wt.warn(l),this.callbacks.wsErrorCallback?this.callbacks.wsErrorCallback(t,e,l):alert(l)),this.closeConnection(t,e),this.Tl=null,this.tn=!1},Tt.prototype.isConnected=function(){return 2===this._l},Tt.prototype.disconnect=function(){l.info("Disconnected terminal with ID="+this.id),this.tn=!0,this.Dl=!0,this.closeConnection(4e3,"Terminal Closed"),this.Tt.zt()},Tt.prototype.closeConnection=function(t,e){this.Zl=t;var l=this.Tl;if(l)try{l.close(t,e)}catch(t){}if(this.clear(),!this.tn){var i=this.parentDiv?this.parentDiv:document.getElementById(this.H.id).parentNode;try{this.en(i);var n=i.id;this.callbacks&&this.callbacks.closeCallback&&this.callbacks.closeCallback(n)}catch(t){}this.$l&&" "!=this.$l&&(Tt.Wl[this.$l.charCodeAt(0)-65]=!1,this.$l=null)}},Tt.prototype.pe=function(){Ct("getOIAArray")},Tt.prototype.ln=function(){Ct("initScreen")},Tt.prototype.connect=function(t,e){Ct("connect")},Tt.prototype.nn=function(t){Ct("paste")},Tt.prototype.in=function(t){Ct("copy")},Tt.prototype.sn=function(t,e,l,i,n,s){Ct("getScreenContents")},Tt.prototype.rn=function(t){Ct("setCursorPos")},Tt.prototype.hn=function(t){Ct("modifyCursorPos")},Tt.prototype.un=function(t){Ct("enterCharacterAtCursor")},Tt.prototype.clear=function(){Ct("clear")},Tt.prototype.handleContainerResizeFromUI=function(t,e,l,i){null!=e&&(this.Pl=e.Pl,this.Rl=e.Rl),this.handleContainerResize(t,l,i)},Tt.prototype.bt=function(){var t=document.activeElement;return document.getElementById(this.H.id)==t||document.getElementById(this.be.id)==t||document.getElementById(this.on.id)==t},Tt.prototype.en=function(t){t.removeChild(this.on),t.removeChild(this.H),t.removeChild(this.be)},Tt.an=function(t){let e=document.createElement("textarea");e.id=t+"Input";let l=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion),i=navigator.userAgent;return(l||-1!==i.indexOf("Android")||-1!==i.indexOf("iOS"))&&(e.readOnly=!0),e.style.position="relative",e.style.zIndex="3",e.style.bottom="0px",e.style.left="0px",e.style.opacity=0,e.style.width="100%",e.style.height="100%",e.style.cursor="default",e},Tt.prototype.handleContainerResize=function(t,e,i){l.info("handling resize"),clearTimeout(kt);var n=e||t.clientWidth,s=i||t.clientHeight;t.id,this.parentDiv=t,0!==s&&null!=s||(s=this.Pl.height),this.en(t),this.Tt&&this.Tt.clear(),l.info("resize w="+n+" h="+s),this.cn(t,{width:n,height:s}),this.fn(),this.Tt&&(this.Tt.H=this.H,this.Tt.$t(),this.wn(this.Pl),this.Tt.zt(),this.Tt.Ce());var r=this;kt=setTimeout(function(){r.dn()},200)},Tt.prototype.pn=function(t,e,i){this.width=t,this.height=e,this.size=t*this.height,this.ml.vl=new Array(t||r),this.ml.vl.fill(32),l.info("Resized canvas grid to r="+this.height+", c="+this.width+", size="+this.size),i||this.clear(),this.Tt&&(this.Tt.$t(),null!==this.Pl&&void 0!==this.Pl&&this.wn(this.Pl),this.Tt.zt())},Tt.prototype.bn=function(t){var e=t.keyCode,l=t.key?t.key:t.keyIdentifier;if(dt.debug("keyup "+t+" target="+t.target+" keyName='"+l+"' keyCode=0x"+N(e)),dt.debug("keyup, modifier state starts at "+this.yl.toString(2)),"AltLeft"==l?this.yl^=1:"AltRight"==l&&(this.yl^=2),"Alt"==l)this.yl^=1;else if("ControlLeft"==l)this.yl^=4;else if("ControlRight"==l)this.yl^=8;else if("Control"==l)this.yl^=4;else if("OSLeft"==l||"Win"==l)this.yl^=16;else if("OSRight"==l)this.yl^=32;else if("ShiftLeft"==l)this.yl^=64;else if("ShiftRight"==l)this.yl^=128;else{if("Shift"!=l)return;this.yl^=64}t.stopPropagation(),t.preventDefault(),dt.debug("keyup, modifier state is now "+this.yl.toString(2))},Tt.prototype.vn=function(t,e){Ct("handleKeyDown")},Tt.prototype.kn=function(t){-1===navigator.appName.indexOf("Safari")&&t.getModifierState&&(t.getModifierState("CapsLock")?this.yl|=256:this.yl&=-257)},Tt.prototype.mn=function(t,e){if(e.getModifierState)return this.yl=0,e.getModifierState("Control")&&(this.yl|=4),e.getModifierState("Alt")&&(this.yl|=1),e.getModifierState("Shift")&&(this.yl|=64),e.getModifierState("CapsLock")&&(this.yl|=256),(e.getModifierState("Meta")||e.getModifierState("OS")||e.getModifierState("Win"))&&(this.yl|=16),!0;if(2===t.type||8===t.type&&t.value.length>1){var l=t.value;if("CapsLock"==l)this.yl^=256;else if("AltLeft"==l)this.yl|=1;else if("AltRight"==l)this.yl|=2;else if("Alt"==l)this.yl|=1;else if("ControlLeft"==l)this.yl|=4;else if("ControlRight"==l)this.yl|=8;else if("Control"==l)this.yl|=4;else if("OSLeft"==l||"Win"==l)this.yl|=16;else if("OSRight"==l)this.yl|=32;else if("ShiftLeft"==l)this.yl|=64;else if("ShiftRight"==l)this.yl|=128;else{if("Shift"!=l)return!1;this.yl|=64}return!0}return!1},Tt.prototype.An=function(t){this.kn(t);var e=t.keyCode,l=t.key?t.key:t.keyIdentifier;if(this.mn(new X(8,l),t),dt.debug("keydown "+t+" target="+t.target+" keyName='"+l+"' keyCode=0x"+N(e)),dt.debug("keydown, modifier state starts at "+this.yl.toString(2)),l.startsWith("U+")&&6==l.length){if("U+0000"===l&&(this.Cn.gn||this.Cn.Sn))return;var i=parseInt(l.substring(2),16);i>=32&&i<127&&(l=String.fromCharCode(i))}var n=1==l.length&&function(t){return new RegExp("[a-zA-Z]").test(t.charAt(0))}(l);n&&(l=l.toLowerCase());var s=I[l];s&&(l=s),3!==t.location||"NumLock"==l||l.startsWith("Numpad")||(l="Numpad"+l);var r,h=this.Ml[l];if(h&&null!=h){var o=0;12&this.yl&&(o|=V),3&this.yl&&(o|=U),192&this.yl&&(o|=H),256==this.yl&&n?o=H:o==H&&256&this.yl&&n&&(o=0),dt.debug("keydown modifier="+o),0===o&&(o=G);var a=h[o];a&&(r=a)}r?4===r.type&&(r=new X(1,String.fromCharCode.apply(null,r.value))):r=new X(8,l),this.Il&&"Reset"!==r.value||(dt.debug("keydown mapping result: type="+r.type+" value="+r.value),this.vn(r,t),dt.debug("keydown, modifier state is now "+this.yl.toString(2)))},Tt.prototype.Tn=function(t){if(t&&"string"==typeof t){var e=t.toLowerCase();document.execCommand(e)}},Tt.prototype.yn=function(t){Ct("handleKeyCode")},Tt.prototype.En=function(t){t.keyCode,t.key?t.key:t.keyIdentifier;var e=t.charCode;this.Fn(e)},Tt.prototype.xn=function(t){var e=t.charCodeAt(0);this.Fn(e)},Tt.prototype.Fn=function(t){Ct("handleCharCodeInput")},Tt.prototype.Pn=function(t,e){Ct("autoType")},Tt.prototype.Mn=function(t){if(this.El){var e=this.Tt.ne(t.offsetX,t.offsetY);e.se+1<=this.width&&(this.fe=e.se+1),e.ie+1<=this.height&&(this.ce=e.ie+1),this.Tt.re()}},Tt.prototype.Nn=function(t){this.El=!1},Tt.prototype.Rn=function(t){if(!0===this.Fl)this.Fl=!1,clearTimeout(this.Dn);else{var e=this;if(this.Dn=setTimeout(function(){!0===e.El&&(e.Fl=!0)},200),(2==t.In||2==t.Ln)&&this._n)return;this.El=!0;var l=this.Tt.ne(t.offsetX,t.offsetY);this.oe=l.se,this.ae=l.ie}},Tt.prototype.On=function(t,e,l,i){Ct("handleClick")},Tt.prototype.Un=function(t,e,l,i){Ct("handleTripleClick")},Tt.prototype.Vn=function(t){var e=t.offsetX,l=t.offsetY;if(wt.debug("click "+t+", pos=("+e+","+l+")"),!1===this.Fl&&(this.oe=null,this.ae=null,this.fe=null,this.ce=null,this.Hn&&(this.Hn.style.display="none"),this.Tt)){var i=this.Tt.ne(e,l);if(wt.debug("click row,col = "+JSON.stringify(i)),null!=i){var n=i.ie*this.width+i.se;if("dblclick"==t.type){var s,r=this.Ml.Bn;if(r&&null!=r){var h=0;12&this.yl&&(h|=V),3&this.yl&&(h|=U),192&this.yl&&(h|=H),256==this.yl?h=H:h==H&&256&this.yl&&(h=0),dt.debug("keydown modifier="+h),0===h&&(h=G);var o=r[h];o&&(s=o)}this.zn(e,l,i,n,s)}else 3==t.Jn?this.Un(e,l,i,n):this.On(e,l,i,n)}else wt.warn("rejecting mouse event, type="+t.type+" because rowColumn == null")}},Tt.prototype.zn=function(t){Ct("handleDoubleClick"),wt.debug("dblclick "+t)},Tt.prototype.jn=function(t){l.debug("Received connected message from server"),this._l=2},Tt.prototype.Wn=function(t){this.Tl.close(4001,"server sent close/error/exception message"),this.Il=!0},Tt.prototype.dn=function(){Ct("handleResizeComplete")},Tt.prototype.Gn=function(t,e){return this.width*t+e},Tt.prototype.fn=function(){var t=this.be,e=this.on,l=this.$n,i=this;t.Xn=0,t.Kn=!0;let n=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion),s=navigator.userAgent;var r=!1,h=!1;n&&(-1!==s.indexOf("Android")?r=!0:-1!==s.indexOf("iOS")&&(h=!0)),this.Cn={gn:r,Sn:h};var o,a=!1;i.Al.fill(null),document.addEventListener("copy",function(t){if((document.activeElement==e||document.activeElement==l)&&!i.Dl){wt.debug("Copy, box region start=("+this.oe+","+this.ae+"), end=("+this.fe+","+this.ce+")"),t.stopPropagation();var n=i.in(!1,!0);null!=n&&t.clipboardData.setData("text/plain",n),t.preventDefault(),c()}}),document.addEventListener("paste",function(t){if((document.activeElement==e||document.activeElement==l)&&!i.Dl){wt.debug("Paste, box region start=("+this.oe+","+this.ae+"), end=("+this.fe+","+this.ce+")"),t.stopPropagation(),wt.debug("PASTE: Found types: "+JSON.stringify(t.clipboardData.types));let e=t.clipboardData.getData("text/plain");e&&1==i.nn(e)&&t.preventDefault(),c()}});var u=this;"Firefox"==navigator.appName&&parseInt(navigator.appVersion,10)<52?(e.addEventListener("blur",function(t){u.yl&=256,u.Tt&&(u.Tt.pt=!1,wt.info("Terminal focus lost"),u.Tt.re())}),e.addEventListener("focus",function(t){u.Tt&&(u.Tt.pt=!0,wt.info("Terminal gained focus"),u.Tt.re())})):(e.addEventListener("focusout",function(t){u.yl&=256,u.Tt&&(u.Tt.pt=!1,wt.info("Terminal focus lost"),u.Tt.re())}),e.addEventListener("focusin",function(t){u.Tt&&(u.Tt.pt=!0,wt.info("Terminal gained focus"),u.Tt.re())})),e.addEventListener("compositionstart",function(t){if(wt.debug("Compositionstart: "+JSON.stringify(t)),a=!0,!i.Dl){c();var l=Math.floor(i.ue/this.width),n=Math.floor(i.ue%this.width);e.style.top=l*(i.Tt.rt/i.Tt.lt)+"px",e.style.left=n*(i.Tt.st/i.Tt.et)+"px"}}),e.addEventListener("compositionupdate",function(t){wt.debug("Compositionupdate: data="+t.data),a=!0,i.Dl||(o=t.data,i.Al.fill(null),i.qn(o))}),e.addEventListener("compositionend",function(t){wt.debug("Compositionend seen"),wt.debug("Compositionend: "+JSON.stringify(t)+", data="+t.data),a=!1,i.Dl||(i.Al.fill(null),o&&(i.Pn(o),e.value="",e.style.top="0px",e.style.left="0px"))}),e.addEventListener("unload",function(t){i.closeConnection()});var c=function(){i.Fl=!1;let t=i.on;t.value="",t.selectionEnd=0,t.selectionStart=0,i.oe=null,i.ae=null,i.fe=null,i.ce=null,i.Tt&&i.Tt.re()};e.addEventListener("wheel",function(t){i.Dl?(wt.debug("Script in progress: rejecting keydown"),t.stopPropagation(),t.preventDefault()):i.Yn(t)}),e.addEventListener("keydown",function(t){i.Dl?(wt.debug("Script in progress: rejecting keydown"),t.stopPropagation(),t.preventDefault()):a||(e.value="",wt.debug("Keydown: "+JSON.stringify(t)),i.An(t))}),e.addEventListener("keyup",function(t){i.Dl?(wt.debug("Script in progress: rejecting keyup"),t.stopPropagation(),t.preventDefault()):i.Il?(wt.debug("Screen locked by error occurrence"),t.stopPropagation(),t.preventDefault()):(c(),a||i.bn(t))}),e.addEventListener("keypress",function(t){i.Dl?(wt.debug("Script in progress: rejecting keypress"),t.stopPropagation(),t.preventDefault()):i.Il?(wt.debug("Screen locked by error occurrence"),t.stopPropagation(),t.preventDefault()):a||(e.value="",wt.debug("Keypress: "+JSON.stringify(t)),i.An(t),t.stopPropagation(),t.preventDefault())}),(r||h)&&e.addEventListener("input",function(){if(wt.debug("Input event seen. value="+e.value+", textContent="+e.textContent),i.Dl)wt.debug("Script in progress: rejecting input");else if(i.Il)wt.debug("Screen locked by error occurrence: rejecting input");else{c();var t=e.value;if(t){e.value="",wt.debug("Input was "+t),wt.debug("Textcontent is now "+e.value);for(var l=0;l<t.length;l++)i.xn(t.charAt(l))}wt.debug("Empty input event ignored.")}}),e.addEventListener("mouseup",function(t){i.Dl?wt.debug("Script in progress: rejecting mouseup"):(wt.debug("mouse event "+t+" target="+t.target),t.target.focus(),i.Nn(t))}),e.addEventListener("mousedown",function(t){i.Dl?wt.debug("Script in progress: rejecting mousedown"):(wt.debug("mouse event "+t+" target="+t.target),t.target.focus(),i.Rn(t))}),e.addEventListener("mouseenter",function(t){wt.log(wt.FINER,"mouse event "+t+" target="+t.target);let e=i.on;!a&&e&&e.value.length>0&&(e.value="",e.selectionEnd=0,e.selectionStart=0)}),e.addEventListener("mousemove",function(t){i.Dl?wt.log(wt.FINER,"Script in progress: rejecting mousemove"):(wt.log(wt.FINER,"mouse event "+t+" target="+t.target),t.target.focus(),i.Mn(t))}),t.addEventListener("click",function(t){i.Dl?(wt.debug("Script in progress: rejecting click"),t.stopPropagation()):(t.stopPropagation(),wt.debug("click event "+t+" target="+t.target),t.target.focus(),i.Vn(t))}),e.addEventListener("click",function(t){i.Dl?(wt.warn("Script in progress: rejecting click"),t.stopPropagation()):(t.stopPropagation(),wt.debug("click event "+t+" target="+t.target),t.target.focus(),i.Vn(t))}),e.addEventListener("dblclick",function(t){i.Dl?(wt.warn("Script in progress: rejecting dblclick"),t.stopPropagation()):i.Il?(wt.warn("Screen locked by error occurrence: rejecting dblclick"),t.stopPropagation()):(t.stopPropagation(),wt.debug("dblclick event "+t+" target="+t.target),!0===i.Fl&&(wt.debug("dblclick set drag to false"),i.Fl=!1,clearTimeout(i.Dn)),t.target.focus(),i.Vn(t))}),e.addEventListener("contextmenu",function(t){if(i.Fl=!1,i.El=!1,i._n&&t.shiftKey||!i._n&&!t.shiftKey)i.Dl?(wt.debug("Script in progress: rejecting contextmenu"),t.stopPropagation()):(t.stopPropagation(),wt.debug("mouse event "+t+" target="+t.target),t.target.focus(),i.Qn(t));else if(null!=i.oe&&null!=i.fe){let t=i.on;t&&(0==t.value.length&&(t.value="c"),t.select())}})},Tt.prototype.toString=function(){return"<VirtualScreen size="+this.size+">"},Tt.prototype.Zn=function(t){Ct("processMessage")},Tt.prototype.ti=function(){Ct("getPos")},Tt.prototype.ei=function(){this.callbacks||(this.callbacks={}),this.callbacks.passwordPrompt||(this.callbacks.passwordPrompt=function(t){setTimeout(function(){let e=prompt("Script paused for password input. Enter password.");t(e)},100)})},Tt.prototype.cn=function(t,e){this.parentDiv=t;let l=t.id;var i=l+"Canvas";this.H=Tt.jl(i,t,e.width,e.height,1);var n=l+"SelectionCanvas";return this.be=Tt.jl(n,t,e.width,e.height,2),this.be.innerHTMLMessageLength=this.be.innerHTML.length,this.on=Tt.an(l),t.appendChild(this.on),{H:this.H,be:this.be,li:this.on}},Et.prototype.ni=function(){if(this.Jl&&this.Hl.length>0){var t=L(this.Hl),e={t:this.Jl,data:t};pt.debug("sending telnet options, dump follows"),D(this.Hl,pt),null!=this.Vl.Tl&&this.Vl.Tl.send(JSON.stringify(e)),this.Hl=[]}},_(_t,Tt,[_t.vn,_t.Fn,_t.yn,_t.On,_t.zn,_t.dn,_t.Pn,_t.pe,_t.ln,_t.ti,_t.connect,_t.in,_t.nn,_t.en,_t.handleContainerResize]);const Pt=/[`~!@#$%^&\*()+={}\[\];:\'<>?,]+/,Ft=/[0-9a-zA-Z-_.\/]+/;const Mt=2,xt=1;function Nt(t){this.ii=65533,this.$e=_t.Xe,this.We=0,this.Ze=_t.Xe,this.Qe=0,this.Be=_t._e,this.ze=_t.Oe,this.He=t}function Dt(t,e,l){this.scrollPos=0,this.si(t,e,l)}Nt.prototype.ri=function(){return 65533!=this.ii?65533:this.He},Dt.prototype.si=function(t,e,l){this.hi=document.createElement("div"),this.hi.id=t.id+"scrollingDiv",this.hi.style.ui=`position: absolute; top: 0px; left: 0px; opacity: 0; cursor: default;\n                                   overflow-y: scroll;\n                                   width: ${e}; height: ${l};`,this.hi.style.zIndex=1,this.hi.style.width=e+"px",this.hi.style.height=l+"px",this.oi=l,this.ai=l,this.ci=document.createElement("div"),this.ci.id=this.hi.id+"Inner",this.ci.style.ui="position: absolute; top: 0px; left: 0px; opacity: 0; cursor: default;\n                                   width: 90%;",this.ci.style.height=l+"px",this.ci.style.zIndex=1,this.hi.appendChild(this.ci)},Dt.prototype.fi=function(t){let e=this.hi.scrollHeight-this.hi.clientHeight;-1==t||t>e?(this.scrollPos=e,this.hi.scrollTop=e):(this.scrollPos=t,this.hi.scrollTop=t)},Dt.prototype.wi=function(){return this.hi},Dt.prototype.di=function(t){if(this.ci||this.hi)try{this.hi.removeChild(this.ci),t.removeChild(this.hi),this.ci=null,this.hi=null}catch(e){l.severe("Could not remove scrolling div from parent="+t)}},Dt.prototype.pn=function(t,e){this.hi.style.width=t,this.hi.style.height=e,this.hi.style["overflow-y"]="scroll",this.ci.style.width="90%";let l=this.ai/this.oi*e;this.ci.style.height=l,this.oi=e,this.ai=l},Dt.prototype.pi=function(){return this.scrollPos},Dt.prototype.ti=function(){return this.hi.scrollTop},Dt.prototype.bi=function(){this.scrollPos=this.hi.scrollTop},Dt.prototype.vi=function(t){return t/this.ki},Dt.prototype.mi=function(t,e){let l=t*e;this.ki=t,this.ci.style.height=l+"px",this.ai=l,this.bi()};var Rt=0;function Lt(t,e){this.rl=new Array(t),this.xe=!0,null==e&&(this.id=Rt++)}var Ot=function(t,e){var l=e;return t.length>0&&(l=Number(t)),l<e&&(l=e),l};function _t(t,e,i,n){this._l=o,this.H=null,this.be=null,this.parentDiv=null,this.oiaEnabled=0,this.width=t,this.height=e,this.kl=vt.pl,this.ml=new At(this,this.width),this.Al=new Array(this.height*t),this.Tt=null,this.gl=t,this.Cl=e,this.Sl=[],this.Tl=null,this.ci=n,this.yl=0,this.ae=null,this.oe=null,this.ce=null,this.fe=null,this.El=!1,this.Fl=!1,this.xl="rgb(255,255,255)",this.size=t*e,this.gi=new Array(this.size),this.clear(),this.ue=0,this.Ci=0,this.Z=_t.Q,l.debug("charsetInfo = "+this.Z),this.Si=i-e,this.wl=i,this.Ti=0,this.al=0,this.yi=[],this.Ee=null,this.Ei=null,this.Fi=null,this.xi=0,this.Pi=0,this.Mi=null,this.Ni=null,this.Ri=null,this.Di=!0,this.Ii=!1,this.Li=!1,this.Ml=J,this.Ge=0,this.$e=_t.Xe,this.We=0,this.Ze=_t.Xe,this.Qe=0,this._i=!1,this.Oi=!1,this.Ui=0,this.Vi=0,this.Hi=!1,this.Bi=[_t._e,_t.Oe,_t.Ue,_t.zi],this.Ji=0,this.ji=1,this.Wi=0,this.termType=u,this.Gi=!1,this.$i=null,this.Xi=null,this.Gl(),this.nl=new Array(this.height),this.fl=0,this.Ki=!1,this.qi=Mt,this.Yi=!1,this.Qi=!1,this.Zi=!1,this.ts=0,this.je=!0,this.es=a,this.ls=x,this.ns=0,this.ss=0,this.rs=_t.hs(),this.us=M,this.Il=!1,this.Ol=0,this.os=!1}_t.hs=function(){return[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]},_t.as=function(t,e,l){let i=document.createElement("div");return i.id=t.id+"innerScrolling",i.style.ui=`position: absolute; top: 0px; left: 0px; opacity: 255; cursor: default;\n                             width: ${e}; height: ${l};`,i.style.zIndex=2,i.style.width=e+"px",i.style.height=l+"px",i},_t.Xe=0,_t.Ke=1,_t.qe=2,_t.Ye=3,_t._e=66,_t.Oe=60,_t.Ue=48,_t.zi=65,_t.cs=function(t){if(t)return{t:"VT_INPUT",data:L(t)}},_t.fs=function(t,e,l){for(var i,n=t,s=e;s<l.rl.length;s++)i=l.rl[s],l.rl[s]=n,n=i},_t.ws=function(t){return t.push(27),t.push(91),t.push(56),t.push(109),t},_t.ds=function(t){return t.push(27),t.push(91),t.push(48),t.push(109),t},_t.ps=function(t){switch(t.termType){case u:t.bs=F;break;default:t.bs=P}},_t.vs=function(t){switch(t.termType){case u:t.termTypeString="linux";break;case 2:t.termTypeString="vt220";break;case 0:t.termTypeString="vt320";break;case 3:t.termTypeString="vt420"}},_t.ks=function(t,e,l,i){var n=t.fontProperties.size?t.fontProperties.size:at.K,s=t.fontProperties.Ai?t.fontProperties.Ai:at.jt,r=t.fontProperties.style?t.fontProperties.style:at.Wt,h=t.fontProperties.name?t.fontProperties.name:at.Y;let o=Tt.jl(e.id+"tempSizeCalc",e,l,i,0);var a=o.getContext("2d");a.font=r+" "+s+" "+n+"px "+h;var u=n,c=a.measureText("M").width;let d=Math.floor(o.width/c),p=Math.floor(o.height/u);return e.removeChild(o),{width:d,height:p}},_t.prototype.en=function(t){this.ms?(this.ms.di(t),this.ci.removeChild(this.on),this.ci.removeChild(this.H),this.ci.removeChild(this.be),t.removeChild(this.ci)):(t.removeChild(this.on),t.removeChild(this.H),t.removeChild(this.be))},_t.prototype.As=function(){var t=0,e=!1;this.ms.wi().addEventListener("wheel",t=>{this.Yn(t)}),this.ms.wi().addEventListener("scroll",i=>{if(this.Tt)if(e)i.preventDefault();else{this.gs=-1,e=!0;try{let n=i.target,s=this.ms,r=n.scrollHeight,h=n.scrollTop,o=s.pi(),a=o-h;if(a>0&&this.Ee.id===this.Mi.id)return l.warn("Could not scroll; already at top."),void(n.scrollTop=o);let u=s.vi(a),c=u%1;t*c<0&&(t=0);let d=(t+=c)>0?Math.floor(t):Math.ceil(t),p=(u>0?Math.floor(u):Math.ceil(u))+d;t-=d,wt.debug(`Scroll Info: scrollDivHeight=${r}, topOfScrollViewport=${h}, lastPos=${o}, rawDiff=${a}, lineDiff=${u}, remainder =${c}, scrollLeftover= ${t}, scrollRollover =${d}, scrollTotal= ${p}`),p&&(p>0?(h<s.ki&&(p=-1),this.Cs(p)):(r-n.clientHeight-h<2*s.ki&&(p=1),this.Ss(p)),s.bi())}catch(i){console.log(i.stack?i.stack:i.message)}finally{e=!1}}})},_t.prototype.handleContainerResize=function(t,e,i){l.info("handling resize"),clearTimeout(kt);var n=e||t.clientWidth,s=i||t.clientHeight;if(0!==s&&null!=s||(s=this.Pl.height),null==this.Ts&&(this.Ts=this.ms?this.ms.ti():0),this.en(t),this.Tt&&this.Tt.clear(),l.info("resize w="+n+" h="+s),this.ys){let e=this.ms;e.si(t,n,s),n-=20;let l=_t.as(t,n,s);this.ci=l,t.appendChild(e.wi()),t.appendChild(l),this.cn(l,{width:n,height:s}),this.parentDiv=t,l.style.position="absolute",this.As()}else this.cn(t,{width:n,height:s});this.fn(),this.Tt&&(this.Tt.H=this.H,this.Tt.$t(),this.wn(this.Pl),this.Tt.zt(),this.Tt.Ce()),this.ys&&(this.ms.wi().style.opacity="255"),this.ms&&(this.ms.mi(this.Es(),this.wl),this.ms.fi(this.Ts),this.Ts=null);var r=this;kt=setTimeout(function(){r.dn()},200)},_t.prototype.Qn=function(t){t.preventDefault()},_t.prototype.ol=function(){if(!this.Ee||!this.Fi)return-1;let t=this.height,e=this.Ee,l=this.Fi.id;for(let i=0;i<t;i++){if(!e)return-1;if(e.id===l)return i;e=e.P}return-1},_t.prototype.Fs=function(){return 1},_t.prototype.connect=function(t,e){if(this._l===o){this._l=1;let n=this;var l=new WebSocket(t),i=!1;let s=0;n.Tl=l,l.onopen=function(){if(e.host&&e.port){var t={t:"CONFIG",host:e.host,port:Number(e.port)};1===e.security?t.security={t:"ssh",termt:n.termTypeString,termr:n.height,termc:n.width,badCert:e.xs}:2===e.security?(pt.warn("We dont support TLS yet. Try SSH!"),l.close()):0!=e.security&&(pt.info("Unknown security type requested!"),l.close()),l.send(JSON.stringify(t)),pt.debug("Sent "+JSON.stringify(t)),setTimeout(()=>{!i&&s<40?(s++,l.onopen()):s>=40&&pt.warn("Maximum connection attempts exceeded, terminal could not connect to host="+e.host)},250)}},l.onmessage=function(t){var e=JSON.parse(t.data);if(pt.log(pt.FINER,"ws.onMessage "+JSON.stringify(e)),null!=n.Tt){var l=9;n.ml.vl[l++]=88,n.ml.vl[l++]=h[0],n.ml.vl[l++]=h[1],n.ml.vl[l++]=h[2],n.Tt.re()}n.Zn(e),i||(i=!0,n.callbacks&&n.callbacks.readyCallback&&n.callbacks.readyCallback.apply(this,null))},l.onerror=function(t){n.Kl(t),l=null},l.onclose=function(t){n.callbacks&&n.callbacks.unexpectedCloseConnectionHook?n.callbacks.unexpectedCloseConnectionHook(n,t):(n.Ql(t),l=null)}}},_t.prototype.pe=function(){var t,e=this.ml.vl,l=this.al+1,i=(this.Ps()+1).toString(),n=l.toString(),s=76;e[s--]=47;for(let l=2;l>-1;l--)i.length<l?e[s--]=32:(t=i.charAt(l))&&(e[s--]=t.charCodeAt(0));s=79;for(let l=2;l>-1;l--)n.length<l+1?e[s--]=32:(t=n.charAt(l))&&(e[s--]=t.charCodeAt(0));return this.kl==vt.pl&&0!=this.Yl.security&&(e[3]=43),e},_t.prototype.Yn=function(t){if(t.deltaY&&this.ms){let e=this.ms,i=e.wi().scrollHeight,n=e.wi().scrollTop,s=e.pi(),r=-t.deltaY;if(r>0&&(this.Ee.id===this.Mi.id||0==n))return l.warn("Could not scroll; already at top."),void(e.wi().scrollTop=s);let h=e.vi(r);wt.debug(`Wheel Info: scrollDivHeight=${i}, topOfScrollViewport=${n}, lastPos=${s}, rawDiff=${r}, lineDiff=${h}`),h&&(h>0?this.Cs(h):this.Ss(h)),e.fi(e.ti()-r)}},_t.prototype.Un=function(t,e,l,i){var n=l.ie,s=l.se;let r=this.Ee;if(n<0||n>this.height||s<0||s>this.width)wt.Ms("clicking out of bound "+l);else{for(let t=0;t<n;t++){if(!r)return void wt.Ms("clicking out of bound "+l);r=r.P}r&&(this.ae=n,this.ce=n+1,this.oe=0,this.fe=this.width,this.Tt&&this.Tt.re())}},_t.prototype.zn=function(t,e,l,i){var n=l.ie,s=l.se;let r=this.Ee;if(n<0||n>this.height||s<0||s>this.width)wt.Ms("clicking out of bound "+l);else{for(let t=0;t<n;t++){if(!r)return void wt.Ms("clicking out of bound "+l);r=r.P}if(r){this.ae=n,this.ce=n+1;var h=this.Ns(r),o=h.charAt(s),a=s,u=s;if(" "==o){for(;" "==h.charAt(a--););for(;" "==h.charAt(u++););}else if(null!=o.match(Pt)){for(;null!=h.charAt(a--).match(Pt););for(;null!=h.charAt(u++).match(Pt););}else if(null!=o.match(Ft)){for(;null!=h.charAt(a--).match(Ft););for(;null!=h.charAt(u++).match(Ft););}a++,u--,this.oe=a+1,this.fe=u,this.Tt&&this.Tt.re()}}},_t.prototype.Rs=function(t){let e=t.Ds;e&&(e.P=t.P),t.P.Ds=e,t.id==this.Mi.id&&(this.Mi=this.Mi.P),t.id==this.Ei.id&&(this.Ei=this.Ei.P)},_t.prototype.Is=function(t,e,l,i,n){let s=null!=this.$i?this.Ls(this.$i):null;for(var r=t+l>this.height?this.height-1-l:t,h=this.Ls(i),o=0;o<r;o++){if(null!=h){var a=new Lt(this.width);h.P?h.P.Ds=a:h.id===this.Ni.id&&(this.Ni=a),a.Ds=h,a.P=h.P,h.P=a,h=a}var u;e.P?u=e.P:(u=new Lt(this.width),e.P=u,u.Ds=e,this._s(!0)),e.id!=this.Ei.id||s&&e.id==this.Ei.id&&s.id==this.Ei.id?this.Rs(e):e.id==this.Ei.id&&(this.wl<=this.height||this.Pi>=this.wl?this.Ei.id==this.Mi.id?this.Rs(this.Ei):(this.Rs(this.Mi),this.Ei=this.Ei.P):(this.Ei=this.Ei.P,this._s(!1))),e=u,n&&(this.Fi=e)}},_t.prototype.Os=function(t){this.Pi--,t&&this.xi--},_t.prototype._s=function(t){this.Pi++,t&&this.xi++},_t.prototype.Us=function(t,e,l,i,n){for(var s=t+l>this.height?this.height-1-l:t,r=this.Ls(i),h=0;h<s;h++){r.id===this.Ni.id&&(this.Ni=r.Ds),r.Ds.P=r.P,r=r.Ds;var o=new Lt(this.width);e.Ds?e.Ds.P=o:this.Mi=o,this.Ei.id==e.id&&(this.Ei=o,this.Ee=this.Ei),o.Ds=e.Ds,o.P=e,e.Ds=o,e=o,n&&(this.Fi=o)}},_t.prototype.sn=function(t,e,l,i,n,s,r,h){var o=[],a=this.Ee;let u=-1!==navigator.userAgent.indexOf("Windows");if(l>=0)for(var c=0;c<l;c++){if(!a)return"";a=a.P}else for(c=0;c>l;c--){if(!a)return"";a=a.Ds}for(var d=l;d<i;d++){r||d==l||(u&&o.push(13),o.push(10));var p=e,f=t;h&&d!=i-1&&(p=this.width),h&&d!=l&&(f=0);for(var g=f;g<p;g++)if(null!=a){var w=a.rl[g];if(w&&0!=(64&w.Ge))o.push(32);else if(w||!0!==s){var b=w.He;(!b||b<32)&&!0===s?o.push(32):o.push(b)}else o.push(32)}else o.push(32);a&&(a=a.P)}return String.fromCharCode.apply(null,o)},_t.prototype.in=function(t,e,l){if(null!=this.oe&&null!=this.fe){var i=Math.min(this.oe,this.fe),n=Math.max(this.oe,this.fe),s=Math.min(this.ae,this.ce),r=Math.max(this.ae,this.ce);return this.sn(i,n,s,r,t,e,l)}return null},_t.prototype.nn=function(t){if(this.Fi&&t){for(var e=[],l=0;l<t.length;l++)e.push(t.charCodeAt(l));return this.Vs(e),!0}return!1},_t.prototype.Hs=function(){var t=(65280&this.width)>>8,e=255&this.width,l=(65280&this.height)>>8,i=255&this.height;this.Bs(31,[t,e,l,i])},_t.prototype.zs=function(){var t={t:"SSH_CH_REQ",reqt:"window-change",reply:!1,data:[this.width,this.height,this.H.width,this.H.height]};1===this.Tl.readyState&&this.Tl.send(JSON.stringify(t))},_t.prototype.dn=function(){if(wt.debug("Resize completed"),this.Gi){var t=function(t,e){t||(t={fontProperties:{scaleMethod:2}});var l=t.fontProperties.size?t.fontProperties.size:at.K,i=t.fontProperties.Ai?t.fontProperties.Ai:at.jt,n=t.fontProperties.style?t.fontProperties.style:at.Wt,s=t.fontProperties.name?t.fontProperties.name:at.Y,r=e.getContext("2d");r.font=n+" "+i+" "+l+"px "+s;var h=l,o=r.measureText("M").width,a=Math.floor(e.width/o);return{ie:Math.floor(e.height/h),se:a}}(this.Pl,this.be),e=!1;t.ie<this.height&&(wt.debug("Resizing, old height was "+this.height+", new height will be "+t.ie),e=!0),this.ys?this.wl=this.Si+t.ie:this.wl=t.ie,this.pn(t.se,t.ie,!0),this.Ei&&wt.debug("After resize, scrolling viewport to bottom. Top ID="+this.Ei.id),this.Ss(1),this.Ee=this.Ei,this.Ei&&wt.debug("Scroll complete. Top ID="+this.Ei.id),this.ys&&(this.ms.wi().scrollTop=this.ms.wi().scrollHeight,this.ms.scrollPos=this.ms.wi().scrollTop),1!=this.Yl.security?this.Hs():this.zs(),e&&this.Ee&&(wt.debug("After resize, scrolling viewport to bottom. Top ID="+this.Ee.id),this.Ss(1),wt.debug("Scroll complete. Top ID="+this.Ee.id))}},_t.prototype.On=function(t,e,l,i){wt.debug("VT click encountered")},_t.prototype.wn=function(t){null!=t&&this.Tt.Gt(this.Pl.fontProperties),this.Tt.zt()},_t.prototype.Js=function(t){return!this.Mi||(null==t&&(t=this.Ps()),this.Fi.id==this.Ni.id||this.js&&t==this.Xi)},_t.prototype.Ws=function(){return!this.Mi||this.Fi.id==this.Mi.id},_t.prototype.Gs=function(t){ft.log(ft.FINEST,"Addline entry. IL ID="+(null==this.Fi?null:this.Fi.id)+", TT ID="+(null==this.Ei?null:this.Ei.id)+", Buff lines="+this.Pi);var e=new Lt(this.width);return null==this.Mi?(this.Mi=e,this.Ni=e,this.Ei=e,this.Ee=e,this.Fi=null,this.ts=0,this._s(!0)):(this.Pi>=this.wl&&!t&&this.xi>this.height?1===this.wl?(this.Mi=e,this.Ni=e,this.Ei=e,this.Ee=this.Ei):2===this.wl?(this.Mi=this.Mi.P,this.Mi.Ds=null,this.Mi.P=e,e.Ds=this.Mi,this.Ei=this.Mi,this.Ee=this.Ei,this.Ni=e):this.wl<=this.height?(this.Mi=this.Mi.P,this.Ei=this.Mi,this.Ee=this.Ei,this.Mi.Ds=null,this.Ni.P=e,e.Ds=this.Ni,this.Ni=e):(this.Mi=this.Mi.P,this.Mi.Ds=null,this.Ni.P=e,e.Ds=this.Ni,this.Ni=e,this.Ei=this.Ei.P,this.Ee=this.Ee.P):(e.Ds=this.Ni,this.Ni.P=e,this.Ni=e,this.xi>=this.height?(this.Ei=this.Ei.P,this.Ee=this.Ei,this._s(!1)):this._s(!0)),this.ts++,this.ts++),this.Fi=e,this.al=0,ft.log(ft.FINEST,"-- Addline exit. IL ID="+this.Fi.id+", TT ID="+this.Ei.id+", Buff lines="+this.Pi),e},_t.prototype.Ns=function(t){var e="";if(void 0!==t.rl)for(var l=0;l<t.rl.length;l++)if(null!==t.rl[l]&&void 0!==t.rl[l]){var i=String.fromCharCode(t.rl[l].He);e+=null===i||" "===i?" ":i}else e+=" ";return e},_t.prototype.ln=function(t){this.al=0,t?(this.Ei=null,this.Ee=null,this.Fi=null,this.xi=0,this.Pi=0,this.Mi=null,this.Ni=null,this.fl=0):(this.Gs(),this.Fi=this.Ni,this.Ei=this.Fi,this.Ee=this.Ei,this.xi=1)},_t.prototype.yn=function(t){wt.debug("Handlekeycode hit")},_t.prototype.Fn=function(t){dt.debug("keypress, charCode="+t),160==t&&(t=32),t>=32&&t<127?(dt.debug("normal press code=0x"+N(t)),this.Vs([t])):dt.debug("Unhandled key press 0x"+N(t))},_t.prototype.clear=function(){this.ms?this.ln(!1):this.ln(!0),ft.debug("Clear: should have cleared screen")},_t.prototype.Vs=function(t){if(this.Yi&&t){var e={t:"TELNET_DATA",B64:L(t)};pt.debug("Sending local echo message"),this.Zn(e)}this.ls===x&&this.$s(t)},_t.prototype.Pn=function(t,e){var i=e?t.substring(0,e):t,n=[];for(let t=0;t<i.length;t++){var s=i.charCodeAt(t);if(!(s>=32&&s<127))return l.info("Invaid ASCII input="+i.charAt(t)),!1;n.push(s)}return n.length>0?(this.Vs(n),!0):(l.info("0 length bufer found for autotype"),!0)},_t.prototype.Xs=function(t){dt.debug("keypress, name="+t);var e=S[t][!0===this.os?1:0];e?this.Vs(e):dt.debug("Unhandled key press for "+t)},_t.prototype.vn=function(t,e){if(this.Ki)dt.warn("Keyboard Locked: Cannot accept input at this time");else{if(e.keyCode,8===t.type&&3&this.yl&&1===t.value.length){var l=t.value.charCodeAt(0);dt.debug("Executing alt keypress for keycode="+l);var i=[27,l];this.Vs(i)}else if(2===t.type||8===t.type){let l=t.value;if(3===e.location)this.Xs(l);else{if(1!=l.length)return;this.Fn(l.charCodeAt(0))}}else{if(64!==t.type)return;this.Ks(t.value,e.location)}e.stopPropagation(),e.preventDefault()}},_t.prototype.qs=function(t){return{Ys:Math.floor(t/this.width),Qs:Math.floor(t%this.width)}},_t.prototype.Zs=function(t){pt.debug("---------------TELNET_DATA hex dump----------------"),D(t,pt),pt.debug("---------------TELNET_DATA ascii dump--------------"),pt.debug(String.fromCharCode.apply(null,t)),pt.debug("---------------TELNET_DATA dump end----------------"),this.Ri||(this.Ri=new It(this,"VT_INPUT"));var e=this.Ri,l=t.entries();this.Ee&&this.Ei&&this.Ee.id!=this.Ei.id&&(this.ys&&(this.ms.wi().scrollTop=this.ms.wi().scrollHeight),this.Ss(1),this.Ee=this.Ei);for(let t of l){let l=t[1];e.tr(l)}e.ni();let i=Date.now(),n=0;this.er&&i-this.er<5&&(n=5,this.er&&this.er-i<3&&(n=3),clearTimeout(this.lr)),this.er=i,this.lr=setTimeout(()=>{this.nr()},n)},_t.prototype.Zn=function(t){pt.debug("Processing websocket message. Type="+t.t);let e=this;switch(t.t){case"CONNECTED":this.jn(t);break;case"IP_RES":e.clientIP=t.data;break;case"TELNET_DATA":var i=function(t){var e=t.length,i=e/4,n=0,s=i,r=0,h=0;if(4*i!=e)return l.warn("Base64 decode failed, encountered 4-mult"),null;0!=e&&"="==t[e-1]&&(n++,s--,"="==t[e-2]&&n++);var o=3*s;0!=n&&(1==n?o+=2:o++);var a=new Uint8Array(o);let u=4*s;for(;r<u;){let e=R[t.charCodeAt(r++)],l=R[t.charCodeAt(r++)],i=R[t.charCodeAt(r++)],n=R[t.charCodeAt(r++)];a[h++]=e<<2|l>>4,a[h++]=l<<4|i>>2,a[h++]=i<<6|n}if(0!=n){let e=R[t.charCodeAt(r++)],l=R[t.charCodeAt(r++)];if(a[h++]=e<<2|l>>4,1==n){let e=R[t.charCodeAt(r++)];a[h++]=l<<4|e>>2}}return a}(t.B64);this.Zs(i);break;case"CERT_PROMPT":this.callbacks&&this.callbacks.ir?this.callbacks.ir(this.Yl.host,t.fp,(t,e)=>{this.Tl.send(JSON.stringify({t:"CERT_RES",a:t})),t||l.info("Rejecting TLS certificate and closing connection. Reason="+e)}):this.Tl.send(JSON.stringify({t:"CERT_RES",a:!0}));break;case"SSH_USER_AUTH_INFO_REQ":this.ls=3,this.Qi=this.Yi,this.Yi=!0,this.sr=t.prompts,this.rr=0;var n=[];for(let e=0;e<t.name.length;e++)n.push(t.name.charCodeAt(e));n.push(13);for(let e=0;e<t.inst.length;e++)n.push(t.inst.charCodeAt(e));if(n.push(13),t.prompts.length>0){var s=t.prompts[0];s.e&&_t.ws(n);var r=s.s;for(let t=0;t<r.length;t++)n.push(r.charCodeAt(t));s.e&&_t.ds(n),this.rr=1,this.hr=[]}var h=L(n);this.Zn({t:"TELNET_DATA",B64:h});break;case"SSH_USER_AUTH_REQ":this.Fi||this.Gs(),this.al=0,this.Qi=this.Yi,this.Yi=!0,void 0===this.ur||null===this.ur?(this.ls=1,this.Pn("login as: "),this.ss=this.al):(this.Pn("Password rejected by host"),this.or());break;case"CERT_REJECT":this.Tl.close(4001,"server sent close/error/exception message");break;case"ERR":this.Wn(t);default:pt.warn("Unhandled websocket message. Type="+t.t)}},_t.prototype.Bs=function(t,e){for(var l=[255,250,t],i=0;i<e.length;i++)l.push(e[i]);l.push(255),l.push(240);var n={t:"VT_INPUT",data:L(l)};pt.debug("Sending telnet sub, dump follows"),D(l,pt),null!=this.Tl&&this.Tl.send(JSON.stringify(n))},_t.prototype.nr=function(){let t=!1;null==this.Tt&&(t=!0,l.debug("showScreen"),this.Tt=new ut(this,null,this.Gi?2:1),null!==this.Pl&&void 0!==this.Pl&&this.wn(this.Pl));for(var e=9;e<18;e++)this.ml.vl[e]=32;this.Tt.il(),t&&this.ms&&(this.ms.wi().style.opacity="255")},_t.prototype.ar=function(t,e){var l=this.Ps()+t,i=this.al+e;this.cr(l,i)},_t.prototype.fr=function(t){var e=this.qs(t);this.cr(e.Ys,e.Qs)},_t.prototype.wr=function(t){var e=Math.max(this.ss,Math.min(t,this.width));t!=e&&ft.warn("Column for setcursor abnormal. column="+t+". Set to "+e),this.al=e,this.Tt&&this.Tt.gt&&this.Tt.ke()},_t.prototype.cr=function(t,e){this.js&&this.$i&&(t=this.$i+t);var l=null!=this.Xi&&this.js?this.Xi:this.height-1,i=Math.max(0,Math.min(t,l)),n=Math.max(this.ss,Math.min(e,this.width-1));t==i&&e==n||ft.warn("Column and row given for setcursor abnormal. column="+e+", row="+t+". Set to column="+n+", row="+i),this.Fi=this.dr(i),this.ts=i,this.al=n,this.Tt&&this.Tt.gt&&this.Tt.ke()},_t.prototype.or=function(){if(this.ur){for(var t=this.ur+"@"+this.Yl.host+"'s password: ",e=[13,10],l=0;l<t.length;l++)e.push(t.charCodeAt(l));_t.ws(e);var i=L(e);this.ns=t.length,this.ss=t.length,this.ls=2,this.Zn({t:"TELNET_DATA",B64:i})}},_t.prototype.Ks=function(t,e){var l,i;if(("Delete"===t||"Backspace"===t)&&this.ls!=x)return this.pr(),this.Tt.il(),!0;if("Enter"===t){if(ft.debug("Handling enter, input state=0x"+N(this.ls)),1===this.ls){var n=[];for(let t=10;t<this.al;t++){let e=this.Fi.rl[t];if(!e||!e.He)break;n.push(e.He)}return this.ur=String.fromCharCode.apply(null,n),this.or(),!0}if(2===this.ls){var r=[];for(let t=this.ns;t<this.width;t++){let e=this.Fi.rl[t];if(!e||!e.He)break;r.push(e.He)}var h=String.fromCharCode.apply(null,r),o=L([13,10,27,91,48,109]);return this.Zn({t:"TELNET_DATA",B64:o}),this.Yi=this.Qi,this.ls=x,this.ss=0,this.Tl.send(JSON.stringify({t:"SSH_USER_AUTH_RES",m:"password",u:this.ur,p:h})),!0}if(3===this.ls){var a=this.sr[this.rr-1].length,u=[],c=this.Fi;let t;for(let e=a;e<this.width&&(t=c.rl[e])&&t.He;e++)u.push(t.He);if(this.hr.push(String.fromCharCode.apply(null,u)),this.rr>=this.sr.length)this.ls=x,this.Yi=this.Qi,this.Tl.send(JSON.stringify({t:"SSH_USER_AUTH_INFO_RES",res:this.hr}));else{var d=this.sr[this.rr++],p=[13];d.e&&_t.ws(p);var f=d.s;for(let t=0;t<f.length;t++)p.push(f.charCodeAt(t));d.e&&_t.ds(p)}return!0}if(this.ls===x)return this.os&&3==e?this.Vs([27,79,77]):this.Zi?this.Vs([13,10]):this.Vs([13]),!0}else{var g;if(l=E[t])return!!(g=this.br?l[2]:this.Vi?l[1]:l[0])&&(this.Vs(g),!0);if(null!=(i=s[t])&&16&i)return this.Tn(t),!0;if(this.bs){"Backspace"==t&&this.vr&&(t="Delete");var w=this.bs[t];if(null!=w)return this.Vs(w),!0}}return dt.warn("Unhandled VT function="+t),!1},_t.prototype.Cs=function(t){if(this.Ee){let e,l=0;-1==t?(e=0,t=1):e=1;for(let i=0;i<t&&this.Ee.Ds;i+=e)this.Ee=this.Ee.Ds,l++;this.ae+=l,this.ce+=l,this.Tt.il(l)}},_t.prototype.Ss=function(t){let e,l=this.Ee;for(let t=0;t<this.height+1;t++){if(!l)return;l=l.P}1==t?(e=0,t=-1):e=1,t=0-t;let i=0;for(let n=0;n<t&&(this.Ee=this.Ee.P,i--,l&&l.P);n+=e)l=l.P;this.ae+=i,this.ce+=i,this.Tt.il(i)},_t.prototype.kr=function(){for(var t=this.Ee,e=0,l=0;l<this.height&&t.P;l++)t=t.P,e++;if(e<this.height-1)return this.xi=e,!0;for(;t;)this.Ee=this.Ee.P,t.xe=!0,this.Ni=t,t=t.P;return this.xi=this.height,!0},_t.prototype.mr=function(t){if(ft.log(ft.FINEST,"insertChar: "+t+" - posInLine="+this.al+"  width="+this.width+"glidx=0x"+N(this.Ji)+" gridx=0x"+N(this.ji)),null==this.Fi)this.ln(!0),this.Gs();else if(this.al>=this.width){if(!this.Li)return void ft.debug("No implicit wrap, maybe overwrite if not in INSERT mode");if(this.Gs(),this.Zi)this.wr(0);else for(var e=0;e<this.al;e++)this.mr(32)}var l=new Nt(t);return this._i?(l.Be=this.Bi[2],this._i=!1):this.Oi?(l.Be=this.Bi[3],this.Oi=!1):(l.Be=this.Bi[this.Ji],l.ze=this.Bi[this.ji]),l.Ge=this.Ge,0!=(8&l.Ge)&&(this.Fi.Fe=!0),this.Ar&&(l.Ar=!0),l.$e=this.$e,l.We=this.We,l.Ze=this.Ze,l.Qe=this.Qe,this.qi===Mt?this.Fi.rl[this.al++]=l:_t.fs(l,this.al,this.Fi),this.Fi.xe=!0,l},_t.prototype.Ls=function(t){this.dr(t);for(var e=0,l=this.Ei;e!=t;)l=l.P,e++;return l},_t.prototype.ti=function(){return this.Gn(this.Ps(),this.al)},_t.prototype.Ps=function(){{if(null==this.Fi||null==this.Ei)return 0;let l=this.Fi.id;for(var t=this.Ei,e=0;t.id!=l;)t=t.P,e++;return this.ts=e,e}},_t.prototype.dr=function(t){let e=this.Ei;var l=e;t>=this.height&&(ft.warn("ensureLine requested to check row "+t+" greater than height:"+this.height),t=this.height-1);for(var i=0;i<t&&null!=l;)e=l,l=l.P,i++;if(ft.log(ft.FINER,"After ensureline loop, line="+l+", y="+i+", terminalLineNumber="+t),null==l||!l)for(var n=i;n<t+1;n++)l=this.Gs(!0);return l},_t.prototype.gr=function(t,e,l){ft.debug("eraseInLine startColumn="+e+" endColumn="+l);for(var i=e;i<=l;i++)t.rl[i]=null;t.xe=!0},_t.prototype.Cr=function(t,e,l,i){if(null!=this.Fi&&null!=this.Ei){var n=this.al;-1==e&&(e=n),-1==i&&(i=n),t=Math.max(0,Math.min(t,this.height-1)),e=Math.max(0,Math.min(e,this.width-1)),l=Math.max(0,Math.min(l,this.height-1)),i=Math.max(0,Math.min(i,this.width-1));for(var s=this.Ei,r=0;r<t;){if(null==(s=s.P))return;r++}do{this.gr(s,r==t?e:0,r==l?i:this.width-1),s=s.P,r++}while(r<=l&&s)}},_t.prototype.Sr=function(){var t=this.Ps();ft.debug("cursor row="+t+" cursor="+this.al)},_t.prototype.Tr=function(t,e){return 0},_t.prototype.yr=function(t,e){return 0},_t.prototype.Er=function(){this.ar(0,-1)},_t.prototype.pr=function(){var t=this.Fi;if(this.al>0){var e=this.al-1;this.Fr(1,t,e),this.wr(e)}},_t.prototype.Es=function(){this.H.height,this.height;let t=this.H.height%this.height;return(this.H.height-t)/this.height};function It(t,e){this.Jl=e,this.Vl=t,this.Ul=xt,this.data=[],this.Pr=new Array(1e3),this.Mr=0,this.Nr=[],this.Rr=[],this.Bl=null,this.Hl=[],this.Dr=!0,this.Ir=!0,this.Lr=!0,this.zl=[],this._r=!1,this.Or=[],this.Ur=[]}function Gt(t){this.message=t,this.name="VTParseException",bt.warn("Encountered exception:"+this.name+", msg:"+t)}_(It,Et),It.Vr=function(t){let e=t.length,l=0;switch(e){case 2:l=31&t[0];break;case 3:l=15&t[0];break;case 4:l=7&t[0];break;case 5:l=3&t[0];break;case 6:l=1&t[0];break;default:throw new St("Invalid length ("+e+") of UTF8 buffer")}for(var i=1;i<t.length;i++)l<<=6,l|=63&t[i];return l},_t.prototype.Fr=function(t,e,l){if(e&&e.rl){var i=0;for(let n=l+t;n<screen.width;n++)e.rl[l+i]=e.rl[n],i++;for(let t=l+i+1;t<screen.width;t++)e.rl[t]=void 0;e.xe=!0}},_t.prototype.$s=function(t){var e=_t.cs(t);e&&(pt.debug("Sending VT message, dump follows"),D(t,pt),null!=this.Tl&&this.Tl.send(JSON.stringify(e)))},_t.prototype.Hr=function(){this.Ge=0;var t=null!=this.$i?this.$i:0,e=null!=this.Xi?this.Xi:this.height-1,l=this.Ps();if(this.Js(l)){if(this.Gs(),this.Zi)this.wr(0);else for(let t=0;t<this.al;t++)this.mr(32);this.ms&&this.ms.fi(-1)}else if(l==e&&null!=this.Xi){if(this.Is(1,this.Ls(t),t,e,!1),this.ar(1,0),!this.Zi)for(let t=0;t<this.al;t++)this.mr(32);this.Zi&&this.wr(0)}else this.ar(1,0),this.Zi&&this.wr(0)},It.prototype.Br=function(){var t=this.Vl,e=this.zr();if(0==e.length)t.cr(0,0);else if(1==e.length)t.cr(e[0]-1,0);else{if(2!=e.length)throw new Gt("wrong number of params to CSIxf/H -'"+this.Jr()+"'");t.cr(e[0]-1,e[1]-1)}},It.prototype.jr=function(){let t,e=this.Vl;switch(e.termTypeString){case"vt102":t=w;break;case"vt220":t=b;break;case"vt320":t=y;break;case"linux":case"xterm":case"vt420":t=m;break;default:t=w,ft.warn("Unknown term type specified:"+e.termTypeString+", sending VT102 string instead.")}e.$s(t)},It.prototype.Wr=function(){let t,e=this.Vl;switch(e.termTypeString){case"vt220":t=v;break;case"vt320":t=C;break;case"linux":case"xterm":case"vt420":t=k;break;default:t=v,ft.debug("Unknown term type="+e.termTypeString+", sending VT220 string")}t&&(pt.debug("Sending VT identifier"),e.$s(t))},It.prototype.Gr=function(t,e){this.Hl.push(255),this.Hl.push(t),this.Hl.push(e)},It.prototype.$r=function(){var t=this.Vl,e=this.zl[0];switch(gt.debug("Handling telnet sub type b=0x"+N(e)),e){case 31:gt.debug("-- Telnet Sub=WINDOW_SIZE"),t.Hs();break;case 24:gt.debug("-- Telnet Sub=TERMINAL_TYPE");let l=[0];for(let e=0;e<t.termTypeString.length;e++)l.push(t.termTypeString.charCodeAt(e));t.Bs(24,l);break;default:gt.warn("Request for telnet sub of type 0x"+N(e)+", but is unhandled")}},It.prototype.Xr=function(t){switch(gt.debug("Handling telnet option"),gt.debug("-- b=0x"+N(t)),this.Bl){case 253:switch(gt.debug("-- Verb=DO"),t){case 0:this.Gr(252,0);break;case 1:l.info("Server requested telnet echo"),this.Vl.Yi=!0,this.Gr(251,1);break;case 5:this.Gr(254,5);break;case 31:this.Gr(251,31),this.Kr=!0,this.Vl.Hs();break;case 32:this.Gr(252,32);break;case 24:this.Gr(251,24);break;case 3:this.Gr(251,3),this.Ir=!0;break;default:gt.warn("Defaulted on DO, sending WONT for b=0x"+N(t)),this.Gr(252,t)}break;case 254:switch(gt.debug("-- Verb=DONT"),t){case 1:this.Gr(252,1),this.Vl.Yi=!1,this.Dr=!0;break;case 31:break;default:this.Gr(252,t),gt.warn("Ignoring DONT for b=0x"+N(t))}break;case 252:switch(gt.debug("-- Verb=WONT"),t){case 1:gt.warn("HOST WONT ECHO BUT WE DO NOT SUPPORT ECHO YET"),this.Vl.Yi=!0,this.Gr(251,1);break;default:gt.warn("Ignoring WONT for b=0x"+N(t))}break;case 251:switch(gt.debug("-- Verb=WILL"),t){case 0:this.Gr(254,0);break;case 1:this.Lr&&this.Gr(253,1);break;case 5:this.Gr(254,5);break;case 38:this.Gr(254,38);break;default:gt.warn("Ignoring WILL for b=0x"+N(t))}}!1===this._r&&(this.Gr(251,31),this._r=!0)},It.prototype.clear=function(){this.Nr=[],this.Rr=[],this.qr=0,this.Yr=0,this.Or=[],this.Ur=[]},It.prototype.Qr=function(t){this.Vl&&(this.Vl.mr(t),ft.log(ft.FINER,"Insert to Screen: b=0x"+N(t)+", char="+String.fromCharCode(t)+", newRow="+this.Vl.Ps()+", newCol="+this.Vl.al))},It.prototype.Zr=function(t){var e=this.Vl;ft.debug("Execute b=0x"+N(t));var l=!1;if(null!=e)switch(t){case 0:break;case 5:e.answerback&&Array.isArray(e.answerback)&&e.Vs(e.answerback);break;case 8:e.Er();break;case 9:var i=e.Fi.rl;for(let t=e.al+1;t<e.width;t++)if(i[t]||(i[t]=new Nt(32)),e.rs[t]){e.wr(t);break}break;case 10:case 11:case 12:e.Hr();break;case 13:e.wr(0);break;case 14:e.Ji=1;break;case 15:e.Ji=0;break;case 127:e.pr();break;case 24:case 26:l=!0;break;default:ft.warn("Unhandled execute b=0x"+N(t))}return l},It.prototype.th=function(t){if(t<48)this.Rr.push(t);else{if(t<58)throw bt.warn("Collect given low value byte, b=0x"+N(t)),new Gt("collect should not get digits");t<64&&(this.qr=t)}},It.prototype.eh=function(t){this.Nr.push(t)},It.prototype.Jr=function(){try{var t=this.Nr;return 0===t.length?"":(bt.debug("Param string as hex="),D(t,bt),String.fromCharCode.apply(null,t))}catch(t){return"<OOPS>"}},It.prototype.lh=function(){try{var t=this.Rr;return bt.debug("Intermediate string as hex="),D(t,bt),String.fromCharCode.apply(null,t)}catch(t){return"<OOPS>"}},It.prototype.nh=function(t){ft.warn("Unimplemented: "+t)},It.prototype.zr=function(){var t,e=this.Nr,l=[],i=0,n=!1;for(t=0;t<e.length;t++){var s=e[t];if(59==s)l.push(i),n=!1,i=0;else{if(!(s>=48&&s<=57))throw new Gt("unexpected numerical parms "+this.Jr());i=10*i+(s-48),n=!0}}n&&l.push(i);var r=new Array(l.length);for(t=0;t<r.length;t++)r[t]=l[t];return bt.debug("Numerical params="+JSON.stringify(r)),r},It.prototype.ih=function(t){this.nh("unhandled CSI dispatch character:0x"+N(t))},It.prototype.sh=function(t){var e=this.Vl,l=this.Jr();switch(ft.debug("CSI Dispatch Start:"),ft.debug("-- b=0x"+N(t)+", parms="+l+", intermediate="+this.lh()),t){case 64:ft.debug("-- type=Insert characters"),ft.debug("IC start, line elements="+JSON.stringify(e.Fi.rl));for(var i=Ot(l,1),n=e.al+i,s=e.Fi,r=e.al;r<n;){for(var h=new Nt(32),o=s.rl[r],a=r+1;a<e.width-1;a++){var c=s.rl[a];s.rl[a]=o,o=c}s.rl[r++]=h}s.xe=!0,ft.debug("IC end, line elements="+JSON.stringify(e.Fi.rl));break;case 65:{ft.debug("-- type=(CUU) Cursor Up");let t=Ot(l,1);e.ar(-t,0)}break;case 66:{ft.debug("-- type=(CUD) Cursor Down");let t=Ot(l,1);e.ar(t,0)}break;case 67:{ft.debug("-- type=(CUF) Cursor Right");let t=Ot(l,1);e.ar(0,t)}break;case 68:{ft.debug("-- type=(CUB) Cursor Left");let t=Ot(l,1);e.ar(0,-t)}break;case 69:ft.debug("-- type=(CNL) Cursor Next Line"),this.ih(t);break;case 70:ft.debug("-- type=(CPL) Cursor Previous Line"),this.ih(t);break;case 71:{ft.debug("-- type=(CHA) Cursor Character Absolute");let t=this.zr(),l=e.Ps();0==t.length?e.cr(l,0):e.cr(l,t[0]-1)}break;case 72:ft.debug("-- type=(CUP) Position Cursor"),this.Br();break;case 73:ft.debug("-- type=(CHT) Cursor Forward Tab"),this.ih(t);break;case 74:if(ft.debug("-- type=(ED) Erase in display"),e.Fi)if(63==this.qr)this.nh("should perform DECSED");else{if(e.ms&&""==l)return void e.ln(!1);if(""==l||"0"==l){ft.debug("-- subtype=Erase to End of screen");var d=e.al;let t=e.Fi.rl;for(var p=d;p<e.width;p++)t[p]=null;let l=e.Fi.P;e.Fi.xe=!0;let i=e.Ps();if(i<e.height-1)for(let t=i+1;t<e.height&&l;t++)l.rl=new Array(e.width),l.xe=!0,l=l.P;e.Ge=0}else if("1"==l){ft.debug("-- subtype=Erase from beginning");let t=e.Ei,l=e.Ps();for(let i=0;i<l;i++)t.xe=!0,t.rl=new Array(e.width),t=t.P;let i=e.Fi.rl;for(let t=0;t<e.al+1;t++)i[t]=null;e.Fi.xe=!0}else"2"==l?e.ms?e.ln(!1):e.ln(!0):"3"==l?(ft.debug("-- subtype=Erase saved lines"),this.nh("Erase saved lines (xterm)")):ft.warn("CSI J / ED / Erase display had unexpected param string="+l)}break;case 75:if(ft.debug("-- type=(EL) Erase in line"),63==this.qr)this.nh("should perform DECSEL");else{let t=e.Ps();ft.debug("before eraseRange insertionLine="+t),""==l||"0"==l?(ft.debug("-- subtype=Erase right"),e.Cr(t,-1,t,e.width-1)):"1"==l?(ft.debug("-- subtype=Erase left"),e.Cr(t,0,t,-1)):"2"==l?(ft.debug("-- subtype=Erase all"),e.Cr(t,0,t,e.width-1)):ft.warn("CSI L / EL / Erase line had unexpected param string="+l)}break;case 76:{ft.debug("-- type=(IL) Insert lines");let t=e.Xi?e.Xi:e.height-1,i=e.$i?e.$i:0,n=Ot(l,1);0===n&&(n=1);let s=e.Ps();if(s>t||s<i){ft.warn("Insert line: requested but current row outside scrolling region, rejecting");break}e.Us(n,e.Fi,s,t,!0),e.wr(0)}break;case 77:{ft.debug("-- type=(DL) Delete lines");let t=e.Xi?e.Xi:e.height-1,i=e.$i?e.$i:0,n=Ot(l,1);0===n&&(n=1);let s=e.Ps();if(s>t||s<i){ft.warn("Delete line: requested but current row outside scrolling region, rejecting");break}let r=e.Fi;e.Is(n,r,s,t,!0),e.wr(0)}break;case 80:ft.debug("-- type=(DCH) Delete characters");var f=Ot(l,1);0===f&&(f=1);var g=e.al,w=f+g<e.width?f:e.width-1-g,b=e.Fi;e.Fr(w,b,g);break;case 83:ft.debug("-- type=(SU) Scroll up"),ft.warn("PANIC: scroll up not implemented."),e.termType===u?this.nh("Scroll up # lines"):this.nh("0x53, unknown");break;case 84:ft.debug("-- type=(SD) Scroll down"),ft.warn("PANIC: scroll down not implemented."),e.termType===u?this.nh("Scroll down # lines"):this.nh("0x54, unknown");break;case 88:{ft.debug("-- type=(ECH) Erase characters"),ft.debug("Erase characters: WARNING, concern about if allowed to erase characters with erase lock attribute");let t=Ot(l,1);0===t&&(t=1);let i=e.al,n=t+i<e.width?t:e.width-1-i,s=e.Fi;var y=n+i;for(let t=i;t<y;t++)s.rl[t]=null;s.xe=!0}break;case 89:ft.debug("-- type=(CVT) Character vertical tab"),this.ih(t);break;case 90:{ft.debug("-- type=(CBT) Character backward tab"),Ot(l,1);let t=e.al;if(0!=t)for(let l=t-1;l=0;l--)if(e.rs[l],1===l){e.wr(l);break}}break;case 96:ft.debug("-- type=(HPA) Horizontal position absolute"),e.us!=M?(ft.warn("Cannot handle HPA in decipoint mode"),this.ih(t)):e.wr(Ot(l,1)-1);break;case 97:ft.debug("-- type=(HPR) Horizontal position relative"),this.ih(t);break;case 98:{let i;if(ft.debug("-- type=(REP) Repeat previous character"),0==e.al){let t=e.Fi.Ds;t&&(i=t.rl[t.rl.length-1])}else i=e.Fi.rl[e.al-1];if(i&&i.He){let e=i.He;var m=Ot(l,1);ft.warn("Should print char=0x"+N(e)+", "+m+" times"),this.ih(t)}else{var v=e.Ps();let t=e.rh;var C=v*e.width+t;ft.warn("No previous element found for REP, currentpos: r="+v+", c="+t+", pos="+C)}}break;case 99:ft.debug("-- type=(DA) Device attributes"),63==this.qr?this.nh("Send Device Attributes Secondary DA"):this.qr&&0!=this.qr?62==this.qr?""==l||"0"==l?this.Wr():ft.warn("Unhandled device attribute command, privateChar = >, paramString="+l):this.nh("0x63 with privateChar="+N(this.qr)):this.jr();break;case 100:if(ft.debug("-- type=(VPA) Line position absolute"),e.us!=M)this.nh("VPA with decipoint");else{var k=Ot(l,1);e.dr(k-1),e.cr(k-1,this.Vl.al)}break;case 101:ft.debug("-- type=(VPR) Line position relative"),this.ih(t);break;case 102:ft.debug("-- type=(HVP) Horizontal vertical position"),this.Br();break;case 103:if(ft.debug("-- type=(TBC) Tab clear"),""==l||"0"==l)e.rs[e.al]=0;else if("1"==l)ft.warn("Not implemented: Tab clear of vertical tab stop");else if("2"==l)e.rs=_t.hs();else{if("3"!=l)throw new Gt("Unexpected parameter for tab clear -'"+l+"'");e.rs=_t.hs()}break;case 104:ft.debug("-- type=(SET) mode set");var A=this.zr();if(63==this.qr)for(let t=0;t<A.length;t++){let l=A[t];switch(l){case 1:e.Vi=1;break;case 2:e.br=!1;break;case 3:e.wr(0),e.pn(132,24);break;case 5:e.Tt.tl();break;case 6:e.js=!0,e.cr(0,0);break;case 7:e.Li=!0;break;case 12:e.Tt.De();break;case 25:e.Tt.Ne();break;case 11:ft.warn("Not implemented: decipoints instead of row/column");case 64:break;case 67:e.vr=!1;break;case 69:e.hh=!1;break;default:this.nh("mode setting case=?"+l)}}else{if(0===A.length){this.nh("Mode setting default case");break}for(let t=0;t<A.length;t++){let e=A[t];switch(e){case 2:ft.debug("Mode setting: lock keyboard"),this.Vl.Ki=!0;break;case 4:ft.debug("Mode setting: insert mode"),this.Vl.qi=1;break;case 12:ft.debug("Mode setting: send/receive mode (SRM), local echo off"),this.Vl.Yi=!1;break;case 20:ft.debug("Setting LNM true"),this.Vl.Zi=!0;default:this.nh("Mode setting case="+e)}}}break;case 105:ft.debug("-- type=(MC) media copy"),this.nh("various printing options");break;case 108:{ft.debug("-- type=(RM) mode reset");let t=this.zr();if(63==this.qr)for(let l=0;l<t.length;l++){let i=t[l];switch(i){case 1:e.Vi=0;break;case 2:e.br=!0;break;case 3:e.wr(0),e.pn(80,24);break;case 5:e.Tt.ll();break;case 6:e.js=!1,e.cr(0,0);break;case 7:e.Li=!1;break;case 12:e.Tt.Re();break;case 25:e.Tt.Pe();break;case 34:case 64:break;case 67:e.vr=!0;break;case 69:e.hh=!1;break;case 1e3:this.nh("Xterm mode resetting: dont send mouse x&y on button press & release");break;case 1001:this.nh("Xterm mode resetting: dont use hilite mouse tracking");break;case 1002:this.nh("Xterm mode resetting: dont use cell motion mouse tracking");break;case 1003:this.nh("Xterm mode resetting: dont use all motion mouse tracking");break;case 1004:this.nh("Xterm mode resetting: dont send focusin/focusout events");break;case 1005:this.nh("Xterm mode resetting: disable utf-8 mouse mode");break;case 1006:this.nh("Xterm mode resetting: disable sgr mouse mode");break;case 1007:this.nh("Xterm mode resetting: disable alternate scroll mode");break;case 1010:this.nh("Xterm mode resetting: dont scroll to bottom on tty output (rxvt)");break;case 1011:this.nh("Xterm mode resetting: dont scroll to bottom on key press (rxvt)");break;case 1015:this.nh("Xterm mode resetting: disable urxvt mouse mode");break;case 1034:this.nh("Xterm mode resetting: dont interpret meta key");break;case 11:ft.warn("Not implemented: decipoints instead of row/column");default:this.nh("Suspected Xterm mode resetting, b="+i)}}else{if(0===t.length){this.nh("Mode resetting default case");break}for(let e=0;e<t.length;e++){let l=t[e];switch(l){case 2:ft.debug("Mode resetting: lock keyboard"),this.Vl.Ki=!1,ft.debug("Mode resetting warning: not supposed to unlock if locked by DC3");break;case 4:ft.debug("Mode resetting: replace mode"),this.Vl.qi=Mt;break;case 12:ft.debug("Mode setting: send/receive mode (SRM), local echo on"),this.Vl.Yi=!0;break;case 20:ft.debug("Resetting LNM false"),this.Vl.Zi=!1;default:this.nh("Mode resetting case="+l)}}}}break;case 109:{ft.debug("-- type=(SGR) set graphics rendition");let t=this.zr();0==t.length&&(t=[0]);let i=0;for(;i<t.length;){let n=t[i];switch(n){case 0:e.Ge=0,e.$e=_t.Xe,e.We=0,e.Ze=_t.Xe,e.Qe=0,i++;break;case 1:e.Ge|=16,e.Ge&=-33,i++;break;case 2:e.Ge&=-17,e.Ge|=32,i++;break;case 4:e.Ge|=4,i++;break;case 5:e.Ge|=8,i++;break;case 7:e.Ge|=2,i++;break;case 8:e.Ge|=64,i++;break;case 21:e.Ge&=-17;break;case 22:e.Ge&=-17,e.Ge&=-33,i++;break;case 24:e.Ge&=-5,i++;break;case 25:e.Ge&=-9,i++;break;case 27:e.Ge&=-3,i++;break;case 28:e.Ge&=-65,i++;break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:e.$e=_t.Ke,e.We=n-30,ft.debug("Set color mode=STANDARD, value=0x"+N(e.We)),i++;break;case 38:if(i+1<t.length&&5==t[i+1])i+2<t.length?(e.$e=_t.qe,e.We=t[i+2],ft.debug("Set color mode=TABLE, value=0x"+N(e.We)),i+=2):(ft.warn("Could not set color mode, bad TABLE color parameter="+l),i++);else if(i+1<t.length&&2==t[i+1])if(i+4<t.length){let l=Math.max(0,Math.min(255,t[2])),n=Math.max(0,Math.min(255,t[3])),s=Math.max(0,Math.min(255,t[4]));e.$e=_t.Ye,e.We=l<<16|n<<8|s,ft.debug("Set color mode=RGB, value=0x"+N(e.We)),i+=4}else ft.warn("Could not set color mode, bad RGB color parameter="+l),i++;else ft.warn("Unexpected parameter for SGM="+l),i++;break;case 39:e.$e=_t.Xe,e.We=0,e.Ge&=-17,e.Ge&=-33,ft.debug("Set color mode=DEFAULT"),i++;break;case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:e.Ze=_t.Ke,e.Qe=n-40,ft.debug("Set bg color mode=STANDARD, value=0x"+N(e.We)),i++;break;case 48:if(i+1<t.length&&5==t[i+1])i+2<t.length?(e.Ze=_t.qe,e.Qe=t[i+2],ft.debug("Set bg color mode=TABLE, value=0x"+N(e.Qe)),i+=2):(ft.warn("Could not set bg color mode, bad TABLE color parameter="+l),i++);else if(i+1<t.length&&2==t[i+1])if(i+4<t.length){let l=Math.max(0,Math.min(255,t[2])),n=Math.max(0,Math.min(255,t[3])),s=Math.max(0,Math.min(255,t[4]));e.Ze=_t.Ye,e.Qe=l<<16|n<<8|s,ft.debug("Set bg color mode=RGB, value=0x"+N(e.Qe)),i+=4}else ft.warn("Could not set bg color mode, bad RGB color parameter="+l),i++;else ft.warn("Unexpected parameter for bg SGM="+l),i++;break;case 49:e.Ze=_t.Xe,e.Qe=0,ft.debug("Set bg color mode=DEFAULT"),i++;break;case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:e.$e=_t.Ke,e.We=n-90,e.Ge|=16,e.Ge&=-33,ft.debug("Set color mode=STANDARD BOLD, value=0x"+N(e.We)),i++;break;default:ft.warn("Unexpected graphic rendering value="+t[i]+" in parameters="+l),i++}}}break;case 110:{ft.debug("-- type=(DSR) device status report");let t=this.zr();if(63==this.qr)this.nh("DSR with ? mark");else if(t&&void 0!==t[0])switch(t[0]){case 5:{let t=[27,91,48,110];e.$s(t)}break;case 6:{var T=String(e.Ps()+1),E=String(e.al+1);let t=[27,91];for(let e=0;e<T.length;e++)t.push(T.charCodeAt(e));t.push(59);for(let e=0;e<T.length;e++)t.push(E.charCodeAt(e));t.push(82),e.$s(t)}break;default:this.nh("Device Status Report (DSR) case"+t)}}break;case 112:{let t=this.zr();if(this.Rr&&34==this.Rr[0]&&(ft.debug("-- type=(STR) Soft terminal reset"),t.length>0))switch(t[0]){case 61:this.uh=!0;break;case 62:if(t.length>1)switch(t[1]){case 0:this.uh=!1;break;case 1:case 2:this.uh=!1}else this.uh=!1}}break;case 113:ft.debug("-- type=(SCA) set character protection attributes"),1==(A=this.zr()).length&&(1==A[0]?e.Ar=!0:0!=A[0]&&2!=A[0]||(e.Ar=!1));break;case 114:if(A=this.zr(),this.Rr&&36==this.Rr[0]){if(ft.debug("-- type=(DECCARA) change attributes of rect area"),A.length>4){var S=A[0],P=A[1],F=A[2],x=A[3];(S>=e.height||F>=e.height||P>=e.width||x>=e.width)&&(S=1,P=1,F=e.height,x=e.width);var D=e.Ee;for(p=0;p<S-1&&D;p++)D=D.P;for(let t=S;t<F;t++){for(let t=P;t<x;t++)if(D&&D.rl[t])for(let e=4;e<A.length;e++)switch(A[e]){case 0:D.rl[t].Ge=0;break;case 1:D.rl[t].Ge|=16;break;case 4:D.rl[t].Ge|=4;break;case 5:D.rl[t].Ge|=8;break;case 7:D.rl[t].Ge|=2;break;case 22:D.rl[t].Ge&=-17;break;case 24:D.rl[t].Ge&=-5;break;case 25:D.rl[t].Ge&=-9;break;case 27:D.rl[t].Ge&=-3}D=D.P}}else ft.warn("wrong params for change attributes of rect area "+A);return}ft.debug("-- type=(STBM) set top and bottom margins"),2!=(A=this.zr()).length?(e.$i=0,e.Xi=e.height-1):(e.$i=null,e.Xi=null,e.dr(A[1]-1),e.$i=A[0]-1,e.Xi=A[1]-1),e.cr(0,0);break;case 115:ft.debug("-- type=(DECSLRM) set left & right margins (if enabled) ELSE (SCP) save cursor position"),e.hh&&(0==(A=this.zr()).length?e.cr(0,0):2==A.length&&(P=A[0])<(x=A[1])&&ft.warn("set left and right margin is not supported yet."));break;case 116:if(ft.debug("-- type=(RARA) Reverse attributes in rectangle"),A=this.zr(),this.Rr&&36==this.Rr[0]){if(A.length>4){for(S=A[0],P=A[1],F=A[2],x=A[3],(S>=e.height||F>=e.height||P>=e.width||x>=e.width)&&(S=1,P=1,F=e.height,x=e.width),D=e.Ee,p=0;p<S-1&&D;p++)D=D.P;for(let t=S;t<F;t++)if(D){for(let t=P;t<x;t++)if(D.rl[t])for(let e=4;e<A.length;e++)switch(A[e]){case 0:D.rl[t].Ge&=~D.rl[t].Ge;break;case 1:16&D.rl[t].Ge?D.rl[t].Ge&=-17:D.rl[t].Ge|=16;break;case 4:4&D.rl[t].Ge?D.rl[t].Ge&=-5:D.rl[t].Ge|=4;break;case 5:8&D.rl[t].Ge?D.rl[t].Ge&=-9:D.rl[t].Ge|=8;break;case 7:2&D.rl[t].Ge?D.rl[t].Ge&=-3:D.rl[t].Ge|=2}D=D.P}}else ft.warn("wrong params for change attributes of rect area "+A);return void e.Tt.zt()}break;case 118:if(ft.debug("-- type=(CRA) Copy rectangle"),8==(A=this.zr()).length){if(0==A[2]&&(A[2]=e.height),0==A[3]&&(A[3]=e.width),A[1]>A[3])break;if(A[0]>A[2])break;var R=A[7]-A[4],L=A[6]-A[1],O=A[2]-A[0];for(D=e.Ee,p=0;p<A[0]-1&&D;p++)D=D.P;if(R>0)for(let t=0;t<R*e.height;t++)e.Gs();var _=e.Ee;if(R>=0)for(p=0;p<A[5]-1&&_;p++)_=_.P;else ft.warn("copy to previous page, not handled");var I=_,G=new Lt(e.width,!0);G.id=_.id;var H=G;for(p=O;O>=0;O--){for(var V=0;V<e.width;V++)_.rl[V]&&(G.rl[V]=_.rl[V]);if(!D)break;let t=0;if(L>0)for(t=A[1]-1;t<A[3];t++)D&&D.rl[t]&&t+L<D.rl.length&&(G.rl[t+L]=D.rl[t]);else for(t=-L,t=A[1]-1;t<A[3];t++)D&&D.rl[t+L]&&t<D.rl.length&&(G.rl[t]=D.rl[t+L]);if(G.P||(G.P=new Lt(e.width,!0),G.P.id=G.id+1),G.P.Ds=G,!_.P||!D.P)break;G=G.P,_=_.P,D=D.P}for(p=O=A[2]-A[0];O>=0;O--){for(a=0;a<e.width;a++)H.rl[a]&&(I.rl[a]=H.rl[a]);if(!I.P||!H.P)break;I=I.P,H=H.P}e.Tt.zt()}break;case 119:ft.debug("-- type=(EFR) Enable filter rectangle"),this.ih(t);break;case 120:if(ft.debug("-- type=(REQTPARM) Request terminal parameters OR (FRA) Fill rectangular"),5==(A=this.zr()).length){if(A[3]>e.height&&(A[3]=e.height),A[4]>e.width&&(A[4]=e.width),numCol=A[4]-A[2],O=A[3]-A[1],numCol||(numCol=A[4]),O||(O=A[3]),e.xi<A[3])for(var U=0;U<A[3];U++)e.Gs();if(numCol>0&&O>0){for(D=e.Ee,p=0;p<A[1]-1&&D;p++)D=D.P;for(p=0;p<O;p++)if(D){for(a=A[2]-1;a<A[4];a++)D.rl[a]?D.rl[a].He=A[0]:D.rl[a]=new Nt(A[0]),e.Ar?D.rl[a].Ar=!0:D.rl[a].Ar=!1;if(!D||!D.P)break;D=D.P}}else ft.warn("wrong params of fill the rectangle area "+A);e.Tt.zt()}break;case 121:ft.debug("-- type=(SACE) Select attribute change extent"),this.ih(t);break;case 122:case 123:if(ft.debug("-- type=(DECERA)  (ERA) Erase rectangular"),4==(A=this.zr()).length){if(A[2]>e.height&&(A[2]=e.height),A[3]>e.width&&(A[3]=e.width),numCol=A[3]-A[1],O=A[2]-A[0],numCol||(numCol=A[3]),O||(O=A[2]),numCol>0&&O>0){for(D=e.Ee,p=0;p<A[0]-1&&D;p++)D=D.P;for(p=0;p<O;p++)if(D){for(a=A[1]-1;a<A[3];a++)123==t?D.rl[a]&&D.rl[a].Ar||(D.rl[a].He=32):D.rl[a]&&(D.rl[a].He=32);if(!D||!D.P)break;D=D.P}}else ft.warn("wrong params of erasing the rectangle area "+A);e.Tt.zt()}break;default:this.nh("unhandled CSI dispatch character:0x"+N(t))}},It.prototype.oh=function(){let t=this.Vl,e=this.Ur,l=Number(String.fromCharCode.apply(null,this.Or));switch(ft.debug("OSC dispatch: type="+l+", params="+e),l){case 0:let i=String.fromCharCode.apply(null,e);t.callbacks.titleCallback&&t.callbacks.titleCallback(i);break;case 4:this.nh("OSC change color");break;case 5:this.nh("OSC change special color");break;case 10:this.nh("Change text color w/ OSC4 spec");break;case 11:this.nh("Change backkground color w/ OSC4 spec");break;case 15:this.nh("Change TEK text color w/ OSC4 spec");break;case 16:this.nh("Change TEK background color w/ OSC4 spec");break;case 52:this.nh("OSC clipboard access");break;case 104:this.nh("Reset color number");break;case 105:this.nh("Reset special color number");break;case 110:this.nh("Reset window text color");break;case 111:this.nh("Reset window background color");break;case 115:this.nh("Reset TEK window text color");break;case 116:this.nh("Reset TEK window background color");break;default:ft.warn("Unknown OSC type "+l+" encountered with params="+e)}},It.prototype.ah=function(t){let e=this.Vl;ft.debug("Escape Dispatch Start:"),ft.debug("-- b=0x"+N(t)),this.Pr[this.Mr++]=t,D(this.Pr,ft,0,this.Mr);var l=255&this.Pr[1];switch(l){case 32:var i=255&this.Pr[2];if(e.uh||e.br)e.Hi=!1;else switch(i){case 70:e.Hi=!1;break;case 71:e.Hi=!0}break;case 35:if(this.Pr.length<2)throw new St("Encountered escape # without following byte to determine action");{let t=255&this.Pr[2];switch(t){case 51:if(e.Ge|=256,e.Ge&=-129,e.Ge&=-513,e.Fi&&e.Fi.rl)for(let t=0;t<e.Fi.rl.length;t++)e.Fi.rl[t]&&(e.Fi.rl[t].Ge=e.Ge);break;case 52:if(e.Ge|=512,e.Ge&=-257,e.Ge&=-129,e.Fi&&e.Fi.rl)for(let t=0;t<e.Fi.rl.length;t++)e.Fi.rl[t]&&(e.Fi.rl[t].Ge=e.Ge);break;case 53:if(e.Ge&=-129,e.Ge&=-257,e.Ge&=-513,e.Fi&&e.Fi.rl)for(let t=0;t<e.Fi.rl.length;t++)e.Fi.rl[t]&&(e.Fi.rl[t].Ge=e.Ge);break;case 54:if(e.Ge|=128,e.Ge&=-257,e.Ge&=-513,e.Fi&&e.Fi.rl)for(let t=0;t<e.Fi.rl.length;t++)e.Fi.rl[t]&&(e.Fi.rl[t].Ge=e.Ge);break;case 56:var n=e.Ei;n||(e.Gs(),n=e.Ei);for(var s=0;s<e.height;s++){for(var r=0;r<e.width;r++)n.rl[r]?n.rl[r].ii=69:n.rl[r]=new Nt(69);n.P||e.Gs(),n=n.P}break;default:this.nh("escape dispatch byte 0x23, modifier "+t)}}break;case 37:if(this.Pr.length<2)this.ch("Escape % seen with no following char");else{let t=255&this.Pr[2];switch(t){case 64:e.je=!1;break;case 71:e.je=!0;break;default:ft.warn("Unhandled ESC % byte=0x"+N(t)+" assumed to be used for UTF8")}}break;case 40:case 41:case 42:case 43:if(3==this.Mr){var h=255&this.Pr[2];ft.debug("should set Gx x=0x"+N(l-40)+" to 0x"+h),e.Bi[l-40]=t}else ft.warn("unhandled set G0-G3 case");break;case 55:e.fh={Fi:e.Fi,ts:e.ts,al:e.al,Ge:e.Ge,$e:e.$e,We:e.We,Bi:e.Bi};break;case 56:e.fh?(e.Fi=e.fh.Fi,e.ts=e.fh.ts,e.al=e.fh.al,e.Ge=e.fh.Ge,e.$e=e.fh.$e,e.We=e.fh.We,e.Bi=e.fh.Bi):ft.warn("Dont have saved attributes to restore from for escape 0x38");break;case 60:e.br=!1;break;case 61:e.os=!0;break;case 62:e.os=!1;break;case 65:ft.debug("-- type=VT52 Cursor Up"),e.ar(-1,0);break;case 66:ft.debug("-- type=VT52 Cursor Down"),e.ar(1,0);break;case 67:ft.debug("-- type=VT52 Cursor Right"),e.ar(0,1);break;case 68:if(e.br)ft.debug("-- type=VT52 Cursor Left"),e.ar(0,-1);else{ft.debug("-- type=(IND) Index down");var o=null!=e.$i?e.$i:0,a=null!=e.Xi?e.Xi:e.height-1;e.Ps()==a&&e.Is(1,e.Ls(o),o,a,!1),e.ar(1,0)}break;case 69:e.ar(1,0),e.wr(0);break;case 72:if(e.br){ft.debug("-- type=Move cursor home");var u=e.Ps();e.cr(u,0)}else ft.debug("-- type=(HTS) Horizontal Tab set"),e.rs[e.al]=1;break;case 73:break;case 77:{ft.debug("-- type=(RI) Reverse Index");let t=null!=e.$i?e.$i:0,l=null!=e.Xi?e.Xi:e.height-1;e.Ps()==t&&e.Us(1,e.Ls(t),t,l,!1),e.ar(-1,0)}break;case 78:e._i=!0;break;case 79:e.Oi=!0;break;case 80:this.nh("P!");break;case 90:break;case 92:ft.debug("escapeDispatch 0x5C string terminator ");break;case 95:ft.debug("unimplemented escape code 0x5F");break;case 99:this.nh("Hard Terminal Reset");break;case 125:ft.warn("need to set G2 ");break;default:this.nh("unhandled ESCAPE dispatch character=0x"+N(l))}this.qr=0},It.prototype.wh=function(t){return t<=23||25==t||t>=28&&t<32},It.prototype.dh=function(t){return t<=23||25==t||t>=28&&t<32||127==t},It.prototype.ph=function(t){if(t<192)throw new St("UTF8 cannot have first byte below C0");var e=255&~t;if(e>=32)this.bh=1;else if(e>=16)this.bh=2;else if(e>=8)this.bh=3;else if(e>=4)this.bh=4;else{if(!(e>=2))throw new St("Unexpectedly high first byte value for UTF8");this.bh=5}},It.prototype.tr=function(t){bt.debug("Parser Loop Top: b=0x"+N(t)+" state="+It.vh[this.Ul]);var e=0;switch(this.Ul){case xt:this.dh(t)?(this.Zr(t),e=xt):t<32||(255===t?e=12:!0===this.Vl.je&&t>=192&&t<=253?(this.kh=[],this.kh.push(t),this.ph(t),e=17):94==t?e=18:t>127||this.Qr(t)),12!=e&&(this.Vl.Ll=!0);break;case 18:if(this.dh(t))this.Qr(94),this.Zr(t),e=xt;else if(t<32)this.Qr(94),this.Ul=xt;else if(255===t)this.Qr(94),e=12;else if(t>=192&&t<=253)this.Qr(94),this.kh=[],this.kh.push(t),this.ph(t),e=17;else{switch(t){case 72:case 63:2===this.Vl.es?this.Vl.pr():1===this.Vl.es?this.Vl.Er():this.Vl.es!=a&&(this.Qr(94),this.Qr(t));break;default:this.Qr(94),this.Qr(t)}e=xt}break;case 17:if(this.kh.push(t),this.bh--,0===this.bh){var l=It.Vr(this.kh);this.Qr(l),e=xt}break;case 12:switch(this.Bl=t,this.Bl){case 255:e=xt,this.Qr(t);break;case 250:e=14;break;case 251:case 252:case 253:case 254:e=13;break;case 247:this.Zr(127);break;case 240:case 242:case 241:case 249:default:e=xt}break;case 13:this.Xr(t),e=xt;break;case 14:if(255===t){this.$r(),e=12;break}this.zl.push(t),e=14;break;case 10:t>=32&&t<48?(this.th(t),e=19):t>=48&&t<64||59==t?(this.eh(t),e=20):t>=60&&t<64?(this.th(t),e=20):58==t?e=22:t>=64&&t<127&&(e=21);break;case 19:t>=32&&t<48?(this.th(t),e=19):t>=48&&t<64?e=22:t>=64&&t<127&&(e=21);break;case 20:t>=48&&t<64||59==t?(this.eh(t),e=20):58==t||t>=60&&t<64?e=22:t>=32&&t<48?(this.th(t),e=19):t>=64&&t<127&&(e=21);break;case 22:this.mh?(92==t&&(e=xt),this.mh=!1):156==t?e=xt:27==t&&(this.mh=!0,e=22);break;case 21:this.mh?(92==t&&(e=xt),this.mh=!1):27==t?(this.mh=!0,e=21):(ft.warn("DCS Passthrough unimplemented"),e=21);break;case 7:if(this.wh(t))e=this.Zr(t)?xt:7;else{if(this.Mr=0,this.Pr[this.Mr++]=27,this.Pr[this.Mr++]=t,t<32)throw new Gt("VT_ESCAPE_START sees b<0x20");if(t>=32&&t<48)e=8;else switch(bt.debug("escape dispatch main switch"),t){case 80:e=10;break;case 91:e=2;break;case 93:e=6;break;default:if(!(t<127))throw new Gt("VT_ESCAPE_START sees b>=0x7f");this.ah(t),e=xt}}break;case 8:if(this.wh(t))e=this.Zr(t)?xt:8;else{if(t<32)throw new Gt("unhandled byte=0x"+N(t)+" in VT_ESCAPE_INTERMEDIATE");t<48?(this.th(t),e=8):t<127?(this.ah(t),e=xt):127==t&&(e=8)}break;case 6:t>=32&&t<=127&&(this.Or.push(t),e=15);break;case 15:59===t?e=16:this.Or.push(t);break;case 16:7===t||156===t?(this.oh(),e=xt):this.Ur.push(t);break;case 2:this.wh(t)?e=this.Zr(t)?xt:2:t>=32&&t<48?(this.th(t),e=3):t<58?(this.eh(t),e=5):t<60?58==t?e=4:(e=5,this.eh(t)):t<64?(this.th(t),e=5):t<127?(this.sh(t),e=xt):t<2&&(e=2);break;case 5:if(this.wh(t))e=this.Zr(t)?xt:5;else if(t>=32&&t<48)this.th(t),e=3;else if(t>=48&&t<58||59==t)this.eh(t),e=5;else if(58==t||t>=60&&t<64)e=4;else{if(!(t<127))throw new Gt("unhandled byte "+t+" in VT_CSI_PARAM");this.sh(t),e=xt}break;case 4:if(this.wh(t))e=this.Zr(t)?xt:4;else{if(t<32)throw new Gt("unhandled byte "+t+" in VT_CSI_IGNORE");if(t<64||127==t)e=4;else{if(!(t<127))throw new Gt("unhandled byte "+t+" in VT_CSI_IGNORE");e=xt}}break;case 3:if(this.wh(t))e=this.Zr(t)?xt:3;else{if(t<32)throw new Gt("unhandled byte "+t+" in VT_CSI_INTERMEDIATE");if(t<48)this.th(t),e=3;else if(t<64)e=4;else if(t<127)this.sh(t),e=xt;else{if(127!=t)throw new Gt("unhandled byte "+t+" in VT_CSI_INTERMEDIATE");e=3}}}if(12!==e&&14!==e&&13!==e&&(this.Vl._l=2),0==e)switch(t){case 27:this.Ul=7;break;case 155:this.Ul=2,this.clear(),this.Mr=0,this.Pr[this.Mr++]=27,this.Pr[this.Mr++]=91;break;case 157:this.Ul=6}else{if(this.Ul!=e)switch(e){case 6:case 2:case 7:case 10:this.clear()}this.Ul=e}},It.vh=["NO_STATE","VT_BASE","VT_CSI_START","VT_CSI_INTERMEDIATE","VT_CSI_IGNORE","VT_CSI_PARAM","VT_OSC_STRING","VT_ESCAPE_START","VT_ESCAPE_INTERMEDIATE","VT_SOS_PM_APC","VT_DCS_START","VTF","VT_TELNET_VERB","VT_TELNET_OPTION","VT_TELNET_SUB","VT_OSC_INTERMEDIATE","VT_OSC_PARAM","VT_UTF8","VT_CONTROL_CHAR","VT_DSC_INTERMEDIATE","VT_DCS_PARAM","VT_DCS_PASSTHROUGH","VT_DCS_IGNORE"],t.startVT=function(t,e,i,n,s){let r=t.parentDiv;r.id;let h,o=t.height,a=t.width,u=!1,c=null,d=r;if(i&&i.screenBufferLines){let l=Number(i.screenBufferLines),n=Number(e.screenHeight);if("MAX"==e.screenWidth||"MAX"==e.screenHeight?n=_t.ks(i,d,a,o).height:(e.screenHeight=Number(e.screenHeight),e.screenWidth=Number(e.screenWidth)),l>n){h=l+n,u=!0;let e=o%n;(c=new Dt(r,a,o)).mi((o-e)/n,h),a=t.width=a-20,d=_t.as(r,a,o),r.appendChild(c.wi()),c.fi(-1),r.appendChild(d)}}var p=!1;if("MAX"==e.screenWidth||"MAX"==e.screenHeight){p=!0;let t=_t.ks(i,d,a,o);e.screenHeight=t.height,e.screenWidth=t.width}else e.screenHeight=Number(e.screenHeight),e.screenWidth=Number(e.screenWidth);let f=e.screenWidth?e.screenWidth:yt,g=e.screenHeight?e.screenHeight:mt;u||(h=g);var w=0,b=1,y=new _t(f,g,h,d);if(y.callbacks=n,s&&(y=Object.assign(y,s)),y.cn(d,t),y.parentDiv=r,y.ei(),y.ys=u,e&&(e.termTypeString&&"string"==typeof e.termTypeString&&(y.termTypeString=e.termTypeString),void 0!==e.termType&&"number"==typeof e.termType&&(y.termType=e.termType),void 0!==e.oiaEnabled&&"boolean"==typeof e.oiaEnabled&&(y.oiaEnabled=e.oiaEnabled?1:0),e.security&&"object"==typeof e.security&&(e.security.type&&"number"==typeof e.security.type&&(w=e.security.type),e.security.badCert&&"number"==typeof e.security.badCert&&(b=e.security.badCert)),e.answerback&&"string"==typeof e.answerback)){for(var m=[],v=0;v<e.answerback.length;v++)m.push(e.answerback.charCodeAt(v));y.answerback=m}return y.termTypeString||_t.vs(y),_t.ps(y),c&&(y.ms=c,y.As()),null!=i&&(y.Pl=i,null!==i.xr&&void 0!==i.xr&&(y.Ml=i.xr),y._n=i._n),y.Gi=p,y.ln(!0),l.debug("connect = "+e.connect),y.Yl={host:e.host,port:Number(e.port),security:w,xs:b},e.connect?y.connect(e.url,y.Yl):y.Dl=!0,y.fn(),y.H.focus(),y.callbacks&&"function"==typeof y.callbacks.onInit&&y.callbacks.onInit(),y}}("undefined"==typeof org_zowe_terminal_vt?org_zowe_terminal_vt={}:org_zowe_terminal_vt);

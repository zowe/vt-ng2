/*
 This program and the accompanying materials are
 made available under the terms of the Eclipse Public License v2.0 which accompanies
 this distribution, and is available at https://www.eclipse.org/legal/epl-v20.html

 SPDX-License-Identifier: EPL-2.0

 Copyright Contributors to the Zowe Project.
*/
! function(exports) {if(!window.COM_RS_COMMON_LOGGER){window.COM_RS_COMMON_LOGGER=function(){console.log("Fallback logger loaded because common logger not found.")};var t=function(t){arguments.length>1&&(t=arguments[1]),console.log(t)};window.COM_RS_COMMON_LOGGER.makeComponentLogger=function(){return{info:t,warn:t,log:t,debug:t,severe:t}}}var e=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core");const s=1011,n=1001,l=4999,h=4001,r="Lucida Console, Monaco, monospace",u=240,o=241,a=243,c=244,f=245,d=242,w=247,A=249,p=250,b=251,k=252,C=253,m=254,v=255,S=0,g=1,E=3,y=5,D=6,R=24,T=25,M=29,P=31,F=32,x=33,I=34,N=35,L=36,U=38,B=39,O=40,V=46,H=1,Q=2,_=4,K=8,W=15,z=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~"],G=3,q=[11,1,0],j=2,Z=[4,5],J=["Cursor Up","Cursor Right","Rapid Right","Cursor Down","Cursor Left","Rapid Left","Tab","Home","End","New Line","Backspace","Back Tab"],X=1,Y=2,$=3,tt=4,it=5,et=6,st=7,nt=8,lt=273,ht={Copy:273,Paste:273},rt=1,ut=0,ot=0,at=1,ct=2,ft=80,dt=77,wt=66,At=65,pt=42,bt=112,kt=63,Ct=43,mt=9,vt=88,St=[88,32,91,93],gt=1,Et=[88,32,60,45,111,45,62],yt=2,Dt=3,Rt=[88,32,45,102],Tt=94,Mt=53,Pt=[43,67,82],Ft=74,xt=47,It=4,Nt=[88,32,80,114,111,103,32],Lt=[55,53,48],Ut=[55,53,50],Bt=[55,53,51],Ot=[55,54,51],Vt=["750","752","753","763"],Ht=1,Qt=2,_t=4,Kt=8,Wt=16,zt=32,Gt=64,qt=128,jt=256,Zt=0,Jt=1,Xt=2,Yt=16,$t=64,ti=1,ii=0,ei=1,si=2,ni=3,li={A:[27,80],C:[27,91],S:[27,92]},hi={A:[144],C:[155],S:[156]},ri=0,ui=1,oi=2,ai=3,ci=59,fi=49,di=50,wi=54,Ai=55,pi=56,bi=57,ki=[49,53],Ci=[49,56],mi=[49,57],vi=[50,49],Si=[63,54,99],gi=[63,54,50,59,49,59,50,59,54,59,55,59,56,59,57,99],Ei=[63,54,51,59,49,59,50,59,54,59,55,59,56,59,57,99],yi=[63,54,52,59,49,59,50,59,54,59,55,59,56,59,57,59,ki,59,Ci,59,...ki,59,...Ci,59,...mi,59,...vi,99],Di=[62,49,59,50,48,59,48,99],Ri=[62,50,52,59,50,48,59,48,99],Ti=[62,52,49,59,50,48,59,48,99],Mi=[[27,91,91,65],[27,91,91,66],[27,91,91,67],[27,91,91,68],[27,91,91,69],[27,91,91,70],[27,91,49,56,126],[27,91,49,57,126],[27,91,50,48,126],[27,91,50,49,126],[27,91,50,51,126],[27,91,50,52,126],[27,91,50,53,126],[27,91,50,54,126],[27,91,50,56,126],[27,91,50,57,126],[27,91,51,49,126],[27,91,51,50,126],[27,91,51,51,126],[27,91,51,52,126]],Pi=[[27,91,49,49,126],[27,91,49,50,126],[27,91,49,51,126],[27,91,49,52,126],[27,91,49,53,126],[27,91,49,55,126],[27,91,49,56,126],[27,91,49,57,126],[27,91,50,48,126],[27,91,50,49,126],[27,91,50,51,126],[27,91,50,52,126],[27,91,50,53,126],[27,91,50,54,126],[27,91,50,56,126],[27,91,50,57,126],[27,91,51,49,126],[27,91,51,50,126],[27,91,51,51,126],[27,91,51,52,126]],Fi={"Cursor Up":[[27,91,65],[27,79,65],[27,65]],"Cursor Down":[[27,91,66],[27,79,66],[27,66]],"Cursor Right":[[27,91,67],[27,79,67],[27,67]],"Cursor Left":[[27,91,68],[27,79,68],[27,68]]},xi={0:[27,79,112],1:[27,79,113],2:[27,79,114],3:[27,79,115],4:[27,79,116],5:[27,79,117],6:[27,79,118],7:[27,79,119],8:[27,79,120],9:[27,79,121],"+":[27,79,108],".":[27,79,110]},Ii={"Alt+ ":[27,32],"Alt+!":[27,33],'Alt+"':[27,34],"Alt+#":[27,35],"Alt+$":[27,36],"Alt+%":[27,37],"Alt+&":[27,38],"Alt+'":[27,39],"Alt+(":[27,40],"Alt+)":[27,41],"Alt+*":[27,42],"Alt++":[27,43],"Alt+,":[27,44],"Alt+-":[27,45],"Alt+.":[27,46],"Alt+/":[27,47],"Alt+0":[27,48],"Alt+1":[27,49],"Alt+2":[27,50],"Alt+3":[27,51],"Alt+4":[27,52],"Alt+5":[27,53],"Alt+6":[27,54],"Alt+7":[27,55],"Alt+8":[27,56],"Alt+9":[27,57],"Alt+:":[27,58],"Alt+;":[27,59],"Alt+<":[27,60],"Alt+=":[27,61],"Alt+>":[27,62],"Alt+?":[27,63],"Alt+@":[27,64],"Alt+A":[27,65],"Alt+B":[27,66],"Alt+C":[27,67],"Alt+D":[27,68],"Alt+E":[27,69],"Alt+F":[27,70],"Alt+G":[27,71],"Alt+H":[27,72],"Alt+I":[27,73],"Alt+J":[27,74],"Alt+K":[27,75],"Alt+L":[27,76],"Alt+M":[27,77],"Alt+N":[27,78],"Alt+O":[27,79],"Alt+P":[27,80],"Alt+Q":[27,81],"Alt+R":[27,82],"Alt+S":[27,83],"Alt+T":[27,84],"Alt+U":[27,85],"Alt+V":[27,86],"Alt+W":[27,87],"Alt+X":[27,88],"Alt+Y":[27,89],"Alt+Z":[27,90],"Alt+`":[27,96],"Alt+a":[27,97],"Alt+b":[27,98],"Alt+c":[27,99],"Alt+d":[27,100],"Alt+e":[27,101],"Alt+f":[27,102],"Alt+g":[27,103],"Alt+h":[27,104],"Alt+i":[27,105],"Alt+j":[27,106],"Alt+k":[27,107],"Alt+l":[27,108],"Alt+m":[27,109],"Alt+n":[27,110],"Alt+o":[27,111],"Alt+p":[27,112],"Alt+q":[27,113],"Alt+r":[27,114],"Alt+s":[27,115],"Alt+t":[27,116],"Alt+u":[27,117],"Alt+v":[27,118],"Alt+w":[27,119],"Alt+x":[27,120],"Alt+y":[27,121],"Alt+z":[27,122],"Alt+{":[27,123],"Alt+|":[27,124],"Alt+}":[27,125],"Alt+~":[27,126],"Control+a":[1],"Control+b":[2],"Control+c":[3],"Control+d":[4],"Control+e":[5],"Control+f":[6],"Control+g":[7],"Control+h":[8],"Control+i":[9],"Control+j":[10],"Control+k":[11],"Control+l":[12],"Control+m":[13],"Control+n":[14],"Control+o":[15],"Control+p":[16],"Control+q":[17],"Control+r":[18],"Control+s":[19],"Control+t":[20],"Control+u":[21],"Control+v":[22],"Control+w":[23],"Control+x":[24],"Control+y":[25],"Control+z":[26],"Control+@":[0],"Control+3":[27],"Control+[":[27],"Control+\\":[28],"Control+]":[29],"Control+^":[30],"Control+_":[31],KP_PF01:[27,79,80],KP_PF02:[27,79,81],KP_PF03:[27,79,82],KP_PF04:[27,79,83],PF1:[27,79,80],F1:Pi[0],PF01:Pi[0],PF2:[27,79,81],F2:Pi[1],PF02:Pi[1],PF3:[27,79,82],F3:Pi[2],PF03:Pi[2],PF4:[27,79,83],F4:Pi[3],PF04:Pi[3],F5:Pi[4],PF05:Pi[4],F6:Pi[5],PF06:Pi[5],F7:Pi[6],PF07:Pi[6],F8:Pi[7],PF08:Pi[7],F9:Pi[8],PF09:Pi[8],F10:Pi[9],PF10:Pi[9],F11:Pi[10],PF11:Pi[10],F12:Pi[11],PF12:Pi[11],F13:Pi[12],PF13:Pi[12],F14:Pi[13],PF14:Pi[13],F15:Pi[14],PF15:Pi[14],F16:Pi[15],PF16:Pi[15],F17:Pi[16],PF17:Pi[16],F18:Pi[17],PF18:Pi[17],F19:Pi[18],PF19:Pi[18],F20:Pi[19],PF20:Pi[19],"Page Up":[21],"Page Down":[22],Backspace:[8],Tab:[9],Escape:[27],Enter:[13],"Cursor Next Line":[27,91,69],"Cursor Previous Line":[27,91,70],"Horizontal Pos Abs":[27,91,71],"Cursor Back Tab":[27,91,90],"Print Screen":[27,91,48,105],"Reset Mode":[27,91,108],Delete:[127],"Delete (Linux)":[27,91,51,126],Home:[1],End:[5],Insert:[27,91,50,126],Find:[27,91,49,126],"Insert Here":[27,91,50,126],Remove:[27,91,51,126],Select:[27,91,52,126],Prev:[27,91,53,126],Next:[27,91,54,126]},Ni={"Alt+ ":[27,32],"Alt+!":[27,33],'Alt+"':[27,34],"Alt+#":[27,35],"Alt+$":[27,36],"Alt+%":[27,37],"Alt+&":[27,38],"Alt+'":[27,39],"Alt+(":[27,40],"Alt+)":[27,41],"Alt+*":[27,42],"Alt++":[27,43],"Alt+,":[27,44],"Alt+-":[27,45],"Alt+.":[27,46],"Alt+/":[27,47],"Alt+0":[27,48],"Alt+1":[27,49],"Alt+2":[27,50],"Alt+3":[27,51],"Alt+4":[27,52],"Alt+5":[27,53],"Alt+6":[27,54],"Alt+7":[27,55],"Alt+8":[27,56],"Alt+9":[27,57],"Alt+:":[27,58],"Alt+;":[27,59],"Alt+<":[27,60],"Alt+=":[27,61],"Alt+>":[27,62],"Alt+?":[27,63],"Alt+@":[27,64],"Alt+A":[27,65],"Alt+B":[27,66],"Alt+C":[27,67],"Alt+D":[27,68],"Alt+E":[27,69],"Alt+F":[27,70],"Alt+G":[27,71],"Alt+H":[27,72],"Alt+I":[27,73],"Alt+J":[27,74],"Alt+K":[27,75],"Alt+L":[27,76],"Alt+M":[27,77],"Alt+N":[27,78],"Alt+O":[27,79],"Alt+P":[27,80],"Alt+Q":[27,81],"Alt+R":[27,82],"Alt+S":[27,83],"Alt+T":[27,84],"Alt+U":[27,85],"Alt+V":[27,86],"Alt+W":[27,87],"Alt+X":[27,88],"Alt+Y":[27,89],"Alt+Z":[27,90],"Alt+`":[27,96],"Alt+a":[27,97],"Alt+b":[27,98],"Alt+c":[27,99],"Alt+d":[27,100],"Alt+e":[27,101],"Alt+f":[27,102],"Alt+g":[27,103],"Alt+h":[27,104],"Alt+i":[27,105],"Alt+j":[27,106],"Alt+k":[27,107],"Alt+l":[27,108],"Alt+m":[27,109],"Alt+n":[27,110],"Alt+o":[27,111],"Alt+p":[27,112],"Alt+q":[27,113],"Alt+r":[27,114],"Alt+s":[27,115],"Alt+t":[27,116],"Alt+u":[27,117],"Alt+v":[27,118],"Alt+w":[27,119],"Alt+x":[27,120],"Alt+y":[27,121],"Alt+z":[27,122],"Alt+{":[27,123],"Alt+|":[27,124],"Alt+}":[27,125],"Alt+~":[27,126],"Control+a":[1],"Control+b":[2],"Control+c":[3],"Control+d":[4],"Control+e":[5],"Control+f":[6],"Control+g":[7],"Control+h":[8],"Control+i":[9],"Control+j":[10],"Control+k":[11],"Control+l":[12],"Control+m":[13],"Control+n":[14],"Control+o":[15],"Control+p":[16],"Control+q":[17],"Control+r":[18],"Control+s":[19],"Control+t":[20],"Control+u":[21],"Control+v":[22],"Control+w":[23],"Control+x":[24],"Control+y":[25],"Control+z":[26],"Control+@":[0],"Control+3":[27],"Control+[":[27],"Control+\\":[28],"Control+]":[29],"Control+^":[30],"Control+_":[31],KP_PF01:[27,79,80],KP_PF02:[27,79,81],KP_PF03:[27,79,82],KP_PF04:[27,79,83],PF1:[27,79,80],F1:Mi[0],PF01:Mi[0],PF2:[27,79,81],F2:Mi[1],PF02:Mi[1],PF3:[27,79,82],F3:Mi[2],PF03:Mi[2],PF4:[27,79,83],F4:Mi[3],PF04:Mi[3],F05:Mi[4],PF05:Mi[4],F06:Mi[5],PF06:Mi[5],F07:Mi[6],PF07:Mi[6],F08:Mi[7],PF08:Mi[7],F09:Mi[8],PF09:Mi[8],F10:Mi[9],PF10:Mi[9],F11:Mi[10],PF11:Mi[10],F12:Mi[11],PF12:Mi[11],F13:Mi[12],PF13:Mi[12],F14:Mi[13],PF14:Mi[13],F15:Mi[14],PF15:Mi[14],F16:Mi[15],PF16:Mi[15],F17:Mi[16],PF17:Mi[16],F18:Mi[17],PF18:Mi[17],F19:Mi[18],PF19:Mi[18],F20:Mi[19],PF20:Mi[19],"Page Up":[27,91,53,126],"Page Down":[27,91,54,126],Backspace:[8],Tab:[9],Escape:[27],Enter:[13],"Cursor Next Line":[27,91,69],"Cursor Previous Line":[27,91,70],"Horizontal Pos Abs":[27,91,71],"Cursor Back Tab":[27,91,90],"Print Screen":[27,91,48,105],"Reset Mode":[27,91,108],Delete:[127],"Delete (Linux)":[27,91,51,126],Home:[27,91,49,126],End:[27,91,52,126],Insert:[27,91,50,126]},Li={"Set Mode 7800":[27,91,49,113],"Set Mode 7700":[27,91,50,113],"Set Mode 7300":[27,91,51,113],"Set Mode 8300":[27,91,52,113],"Set Mode Ansi":[27,91,53,113],"Save Cursor":[27,91,115],"Restore Cursor":[27,91,117],"Device Status":[27,91,110],"Scrolling Region":[27,91,114],"Set Graphic Rendition":[27,91,109],"End Host Print":[27,91,52,105],"Start Host Print":[27,91,53,105],"Cursor Position":[27,91,72],"Erase Data":[27,91,74],"Erase Line":[27,91,75],"Insert Line":[27,91,76],"Delete Line":[27,91,77],"Erase Area":[27,91,79],"Scroll Up":[27,91,83],"Scroll Down":[27,91,84],"Insert Character":[27,91,64],"Device Attributes":[27,91,99],"Hor/Vertical Position":[27,91,102],"Tab Clear":[27,91,103],"Set Mode":[27,91,104]},Ui=0,Bi=1,Oi=0,Vi=1,Hi=2,Qi=3,_i=15,Ki="innerScrolling",Wi="scrollingDiv",zi="Inner",Gi="exit-signal",qi=[27,80,49,36,114,54,51,59,49,34,112,27,92],ji=[0,95,135,175,215,255,24320,24415,24455,24495,24535,24575,34560,34655,34695,34735,34775,34815,44800,44895,44935,44975,45015,45055,55040,55135,55175,55215,55255,55295,65280,65375,65415,65455,65495,65535,6225920,6226015,6226055,6226095,6226135,6226175,6250240,6250335,6250375,6250415,6250455,6250495,6260480,6260575,6260615,6260655,6260695,6260735,6270720,6270815,6270855,6270895,6270935,6270975,6280960,6281055,6281095,6281135,6281175,6281215,6291200,6291295,6291335,6291375,6291415,6291455,8847360,8847455,8847495,8847535,8847575,8847615,8871680,8871775,8871815,8871855,8871895,8871935,8881920,8882015,8882055,8882095,8882135,8882175,8892160,8892255,8892295,8892335,8892375,8892415,8902400,8902495,8902535,8902575,8902615,8902655,8912640,8912735,8912775,8912815,8912855,8912895,11468800,11468895,11468935,11468975,11469015,11469055,11493120,11493215,11493255,11493295,11493335,11493375,11503360,11503455,11503495,11503535,11503575,11503615,11513600,11513695,11513735,11513775,11513815,11513855,11523840,11523935,11523975,11524015,11524055,11524095,11534080,11534175,11534215,11534255,11534295,11534335,14090240,14090335,14090375,14090415,14090455,14090495,14114560,14114655,14114695,14114735,14114775,14114815,14124800,14124895,14124935,14124975,14125015,14125055,14135040,14135135,14135175,14135215,14135255,14135295,14145280,14145375,14145415,14145455,14145495,14145535,14155520,14155615,14155655,14155695,14155735,14155775,16711680,16711775,16711815,16711855,16711895,16711935,16736e3,16736095,16736135,16736175,16736215,16736255,16746240,16746335,16746375,16746415,16746455,16746495,16756480,16756575,16756615,16756655,16756695,16756735,16766720,16766815,16766855,16766895,16766935,16766975,16776960,16777055,16777095,16777135,16777175,16777215],Zi=[526344,1184274,1842204,2500134,3158064,3815994,4473924,5131854,5789784,6447714,7105644,7763574,8421504,9079434,9737364,10395294,11053224,11711154,12369084,13027014,13684944,14342874,15000804,15658734];var Ji=function(t){return t||0===t?t.toString(16):"<FAIL: Not A Number>"},Xi=function(t,i,s,n){var l,h=s||0,r=n||t.length,u="";for(l=0;l<r;l++)u+=Ji(t[h+l])+" ",l%16==15&&(i&&i.debug?i.debug(u):e.debug(u),u="");u.length>0&&(i&&i.debug?i.debug(u):e.debug(u))},Yi=function(t,i,e){return t<<16|i<<8|e};const $i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,0,0,63,52,53,54,55,56,57,58,59,60,61,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,0,0,0,0,0,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],te=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];var ie=function(t){for(var i=[],e=t.length,s=Math.floor(e/3),n=e-3*s,l=0,h=0;h<s;h++){let e=255&t[l++],s=255&t[l++],n=255&t[l++];i.push(se[e>>2]),i.push(se[e<<4&63|s>>4]),i.push(se[s<<2&63|n>>6]),i.push(se[63&n])}if(0!=n){let e=255&t[l++];if(i.push(se[e>>2]),1==n)i.push(se[e<<4&63]),i.push(61),i.push(61);else{let s=255&t[l++];i.push(se[e<<4&63|s>>4]),i.push(se[s<<2&63]),i.push(61)}}return String.fromCharCode.apply(null,i)},ee=function(t){var i=t.length,s=i/4,n=0,l=s,h=0,r=0;if(4*s!=i)return e.warn("Base64 decode failed, encountered 4-mult"),null;0!=i&&"="==t[i-1]&&(n++,l--,"="==t[i-2]&&n++);var u=3*l;0!=n&&(1==n?u+=2:u++);var o=new Uint8Array(u);let a=4*l;for(;h<a;){let i=$i[t.charCodeAt(h++)],e=$i[t.charCodeAt(h++)],s=$i[t.charCodeAt(h++)],n=$i[t.charCodeAt(h++)];o[r++]=i<<2|e>>4,o[r++]=e<<4|s>>2,o[r++]=s<<6|n}if(0!=n){let i=$i[t.charCodeAt(h++)],e=$i[t.charCodeAt(h++)];if(o[r++]=i<<2|e>>4,1==n){let i=$i[t.charCodeAt(h++)];o[r++]=e<<4|i>>2}}return o};const se=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47];var ne=function(t){},le=function(t,i){switch(192&t){case 0:return(63&t)<<8|i;case 64:case 192:return(63&t)<<6|63&i;default:return Vs.warn("Bad SBA position, b1=0x"+Ji(t)+", b2=0x"+Ji(i)),0}},he=function(t,i){var e=(255&t[i])<<8;return 255&t[i+1]|e},re=function(t,i){var e=(255&t[i])<<16,s=(255&t[i+1])<<8;return 255&t[i+2]|s|e},ue=function(t,i){var e=(255&t[i])<<8|255&t[i+1];return e>=32768?e-65536:e},oe=function(t,i){var e=(255&t[i])<<24|(255&t[i+1])<<16|(255&t[i+2])<<8|255&t[i+3];return e>=2147483648?e-4294967296:e},ae=function(t,i,e,s,n){var l;for(l=0;l<e;l++)s[l]=ue(t,i),n[l]=ue(t,i+2),i+=4;return i},ce=function(t,i,e,s,n){var l;for(l=0;l<e;l++)s[l]=t[i+0],n[l]=t[i+1],i+=2;return i},fe=function(t,i,e,s,n){var l;for(l=0;l<n;l++)e[s+l]=t[i+l]},de=function(t,i){var e;for(e=0;e<t.length;e++)if(t[e]==i)return!0;return!1},we=function(t,i,e){function s(){}for(var n in s.prototype=i.prototype,t.prototype=new s,t.prototype.constructor=t,t.D=i,t.R=i.prototype,e)t[n]=e[n]},Ae=function(){this.size=0,this.T=null,this.M=null};Ae.prototype={clear:function(){let t=this.size,i=this.T;for(let e=0;e<t-1;e++){i.next.P=void 0;let t=i.next;i.next=void 0,i=t}this.T=null,this.M=null,this.size=0},F:function(){let t=[],i=this.size;if(0==i)return t;let e=this.T;for(let s=0;s<i&&(t.push(e.data),e.next);s++){e.next.P=void 0;let t=e.next;e.next=void 0,e=t}return this.T=null,this.M=null,this.size=0,t},I:function(){return this.T},N:function(){return this.M},L:function(){return this.size},U:function(t){let i=new pe(t);0==this.size?this.T=i:(i.P=this.M,this.M.next=i),this.M=i,this.size++},B:function(t){let i=new pe(t);0==this.size?this.M=i:(i.next=this.T,this.T.P=i),this.T=i,this.size++},O:function(){if(0==this.size)return null;if(1==this.size){let t=this.M;return this.T=null,this.M=null,this.size=0,t.P=void 0,t.next=void 0,t}{this.size--;let t=this.M;return t.P.next=null,this.M=t.P,t.P=void 0,t.next=void 0,t}},V:function(){if(0==this.size)return null;if(1==this.size){let t=this.T;return this.T=null,this.M=null,this.size=0,t.P=void 0,t.next=void 0,t}{this.size--;let t=this.T;return t.next.P=null,this.T=t.next,t.P=void 0,t.next=void 0,t}},add:function(t,i){if(t<0||t>this.size)return-1;if(t==this.size)this.U(i);else if(0==t)this.B(i);else{let e=new pe(i),s=this.size-1,n=this.T;for(let i=1;i<s;i++){if(i==t)return e.P=n,e.next=n.next,n.next.P=e,n.next=e,++this.size;n=n.next}}},remove:function(t){if(t<0||t>=this.size)return null;if(t==this.size-1)return this.O();if(0==t)return this.V();{let i=this.size-1,e=this.T;for(let s=1;s<i;s++){if(s==t)return e.next.P=e.P,e.P.next=e.next,this.size--,e.P=void 0,e.next=void 0,e;e=e.next}}},get:function(t){if(t>=this.size||t<0)return null;if(0==t)return this.I();if(t==this.size-1)return this.N();{let i=this.size-1,e=this.T;for(let s=1;s<i;s++){if(s==t)return e;e=e.next}}}};var pe=function(t){this.data=t,this.P,this.next};const be={Esc:"Escape",Nonconvert:"NonConvert",Spacebar:" ",ArrowLeft:"Left",ArrowRight:"Right",ArrowDown:"Down",ArrowUp:"Up",Del:"Delete","U+001B":"Escape","U+007F":"Delete","U+0008":"Backspace","U+0009":"Tab",OS:"Win",Meta:"Win",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MediaTrackNext:"MediaNextTrack",MediaTrackPrevious:"MediaPreviousTrack",AudioVolumeMute:"VolumeMute",AudioVolumeDown:"VolumeDown",AudioVolumeUp:"VolumeUp",Caps:"CapsLock",Ctrl:"Control",Ins:"Insert",Space:" ",Ent:"Enter"},ke=0,Ce=1,me=2,ve=4,Se=3,ge=5,Ee=6,ye=7,De=1,Re=2,Te=4,Me=8;function Pe(t,i){this.type=t,this.value=i}function Fe(t,i,e,s,n,l,h,r){var u=[];return u[0]=t,u[1]=i,u[2]=e,u[4]=s,u[6]=n,u[3]=l,u[5]=h,u[7]=r,u}const xe={Accept:null,Again:null,AllCandidates:null,Alphanumeric:null,ContextMenu:null,Attn:null,BrowserBack:null,BrowserFavorites:null,BrowserForward:null,BrowserHome:null,BrowserRefresh:null,BrowserSearch:null,BrowserStop:null,CapsLock:null,Clear:null,CodeInput:null,Compose:null,Crsel:null,Convert:null,Copy:null,Cut:null,Down:new Fe(new Pe(64,"Cursor Down"),null,null,null,null,null,null,null),End:new Fe(new Pe(64,"End"),null,null,null,null,null,null,null),Enter:new Fe(new Pe(64,"Enter"),null,null,null,null,null,null,null),EraseEof:null,Execute:null,Exsel:null,F1:new Fe(new Pe(64,"F1"),new Pe(64,"F13"),null,null,null,null,null,null),F2:new Fe(new Pe(64,"F2"),new Pe(64,"F14"),null,null,null,null,null,null),F3:new Fe(new Pe(64,"F3"),new Pe(64,"F15"),null,null,null,null,null,null),F4:new Fe(new Pe(64,"F4"),new Pe(64,"F16"),null,null,null,null,null,null),F5:new Fe(new Pe(64,"F5"),new Pe(64,"F17"),null,null,null,null,null,null),F6:new Fe(new Pe(64,"F6"),new Pe(64,"F18"),null,null,null,null,null,null),F7:new Fe(new Pe(64,"F7"),new Pe(64,"F19"),null,null,null,null,null,null),F8:new Fe(new Pe(64,"F8"),new Pe(64,"F20"),null,null,null,null,null,null),F9:new Fe(new Pe(64,"F9"),new Pe(64,"F21"),null,null,null,null,null,null),F10:new Fe(new Pe(64,"F10"),new Pe(64,"F22"),null,null,null,null,null,null),F11:new Fe(new Pe(64,"F11"),new Pe(64,"F23"),null,null,null,null,null,null),F12:new Fe(new Pe(64,"F12"),new Pe(64,"F24"),null,null,null,null,null,null),F13:new Fe(new Pe(64,"F13"),null,null,null,null,null,null,null),F14:new Fe(new Pe(64,"F14"),null,null,null,null,null,null,null),F15:new Fe(new Pe(64,"F15"),null,null,null,null,null,null,null),F16:new Fe(new Pe(64,"F16"),null,null,null,null,null,null,null),F17:new Fe(new Pe(64,"F17"),null,null,null,null,null,null,null),F18:new Fe(new Pe(64,"F18"),null,null,null,null,null,null,null),F19:new Fe(new Pe(64,"F19"),null,null,null,null,null,null,null),F20:new Fe(new Pe(64,"F20"),null,null,null,null,null,null,null),F21:new Fe(new Pe(64,"F21"),null,null,null,null,null,null,null),F22:new Fe(new Pe(64,"F22"),null,null,null,null,null,null,null),F23:new Fe(new Pe(64,"F23"),null,null,null,null,null,null,null),F24:new Fe(new Pe(64,"F24"),null,null,null,null,null,null,null),FinalMode:null,Find:null,FullWidth:null,HalfWidth:null,HangulMode:null,HanjaMode:null,Help:null,Hiragana:null,Home:new Fe(new Pe(64,"Home"),null,null,null,null,null,null,null),Insert:new Fe(new Pe(64,"Insert"),null,null,null,null,null,null,null),JapaneseHiragana:null,JapaneseKatakana:null,JapaneseRomaji:null,JunjaMode:null,KanaMode:null,KanjiMode:null,Katakana:null,LaunchApplication1:null,LaunchApplication2:null,LaunchMail:null,Left:new Fe(new Pe(64,"Cursor Left"),null,null,null,null,null,null,null),MediaNextTrack:null,MediaPlayPause:null,MediaPreviousTrack:null,MediaStop:null,ModeChange:null,Nonconvert:null,NumLock:new Fe(new Pe(64,"KP_PF01"),null,null,null,null,null,null,null),PageDown:new Fe(new Pe(64,"Page Down"),null,null,null,null,null,null,null),PageUp:new Fe(new Pe(64,"Page Up"),null,null,null,null,null,null,null),Paste:null,Pause:null,Play:null,PreviousCandidate:null,PrintScreen:null,Process:null,Props:null,Right:new Fe(new Pe(64,"Cursor Right"),null,null,null,null,null,null,null),RomanCharacters:null,ScrollLock:null,Select:null,SelectMedia:null,Stop:null,Up:new Fe(new Pe(64,"Cursor Up"),null,null,null,null,null,null,null),Undo:null,VolumeDown:null,VolumeMute:null,VolumeUp:null,Win:null,Zoom:null," ":new Fe(new Pe(2," "),new Pe(2," "),new Pe(64,"Control+@"),null,null,null,null,null),"!":new Fe(null,new Pe(2,"!"),null,null,null,null,null,null,null),'"':new Fe(null,new Pe(2,'"'),null,null,null,null,null,null),"#":new Fe(null,new Pe(2,"#"),null,null,null,null,null,null),$:new Fe(null,new Pe(2,"$"),null,null,null,null,null,null),"%":new Fe(null,new Pe(2,"%"),null,null,null,null,null,null),"&":new Fe(null,new Pe(2,"&"),null,null,null,null,null,null),"'":new Fe(new Pe(2,"'"),null,null,null,null,null,null,null),"(":new Fe(null,new Pe(2,"("),null,null,null,null,null,null),")":new Fe(null,new Pe(2,")"),null,null,null,null,null,null),"*":new Fe(null,new Pe(2,"*"),null,null,null,null,null,null),"+":new Fe(null,new Pe(2,"+"),null,null,null,null,null,null),",":new Fe(new Pe(2,","),null,null,null,null,null,null,null),"-":new Fe(new Pe(2,"-"),null,new Pe(64,"Control+_"),null,null,null,null,null),".":new Fe(new Pe(2,"."),null,null,null,null,null,null,null),"/":new Fe(new Pe(2,"/"),null,null,null,null,null,null,null),0:new Fe(new Pe(2,"0"),null,null,null,null,null,null,null),1:new Fe(new Pe(2,"1"),null,null,null,null,null,null,null),2:new Fe(new Pe(2,"2"),null,new Pe(64,"Control+@"),null,null,null,null,null),3:new Fe(new Pe(2,"3"),null,new Pe(64,"Control+3"),null,null,null,null,null),4:new Fe(new Pe(2,"4"),null,null,null,null,null,null,null),5:new Fe(new Pe(2,"5"),null,null,null,null,null,null,null),6:new Fe(new Pe(2,"6"),null,new Pe(2,String.fromCharCode.apply(null,[172])),null,null,null,null,null),7:new Fe(new Pe(2,"7"),null,null,null,null,null,null,null),8:new Fe(new Pe(2,"8"),null,null,null,null,null,null,null),9:new Fe(new Pe(2,"9"),null,null,null,null,null,null,null),Numpad0:new Fe(new Pe(2,"0"),null,null,null,null,null,null,null),Numpad1:new Fe(new Pe(2,"1"),null,null,null,null,null,null,null),Numpad2:new Fe(new Pe(2,"2"),null,null,null,null,null,null,null),Numpad3:new Fe(new Pe(2,"3"),null,null,null,null,null,null,null),Numpad4:new Fe(new Pe(2,"4"),null,null,null,null,null,null,null),Numpad5:new Fe(new Pe(2,"5"),null,null,null,null,null,null,null),Numpad6:new Fe(new Pe(2,"6"),null,null,null,null,null,null,null),Numpad7:new Fe(new Pe(2,"7"),null,null,null,null,null,null,null),Numpad8:new Fe(new Pe(2,"8"),null,null,null,null,null,null,null),Numpad9:new Fe(new Pe(2,"9"),null,null,null,null,null,null,null),"Numpad/":new Fe(new Pe(64,"KP_PF02"),null,null,null,null,null,null,null),"Numpad*":new Fe(new Pe(64,"KP_PF03"),null,null,null,null,null,null,null),"Numpad-":new Fe(new Pe(64,"KP_PF04"),null,null,null,null,null,null,null),"Numpad+":new Fe(new Pe(2,"+"),null,null,null,null,null,null,null),NumpadEnter:new Fe(new Pe(64,"Enter"),null,new Pe(64,"New Line"),null,null,null,null,null),"Numpad.":new Fe(new Pe(2,"."),null,null,null,null,null,null,null),NumpadUp:new Fe(new Pe(64,"Cursor Up"),null,null,null,null,null,null,null),NumpadDown:new Fe(new Pe(64,"Cursor Down"),null,null,null,null,null,null,null),NumpadLeft:new Fe(new Pe(64,"Cursor Left"),null,null,null,null,null,null,null),NumpadRight:new Fe(new Pe(64,"Cursor Right"),null,null,null,null,null,null,null),NumpadHome:new Fe(new Pe(64,"Home"),null,null,null,null,null,null,null),NumpadPageUp:new Fe(new Pe(64,"PageUp"),null,null,null,null,null,null,null),NumpadPageDown:new Fe(new Pe(64,"PageDown"),null,null,null,null,null,null,null),NumpadEnd:new Fe(new Pe(64,"End"),null,null,null,null,null,null,null),NumpadInsert:new Fe(new Pe(64,"Insert"),null,null,null,null,null,null,null),NumpadDelete:new Fe(new Pe(64,"Delete"),null,null,null,null,null,null,null),":":new Fe(null,new Pe(2,":"),null,null,null,null,null,null),";":new Fe(new Pe(2,";"),null,null,null,null,null,null,null),"<":new Fe(null,new Pe(2,"<"),null,null,null,null,null,null),"=":new Fe(new Pe(2,"="),null,null,null,null,null,null,null),">":new Fe(null,new Pe(2,">"),null,null,null,null,null,null),"?":new Fe(null,new Pe(2,"?"),null,null,null,null,null,null),"@":new Fe(null,new Pe(2,"@"),null,null,null,new Pe(64,"Control+@"),null,null),"[":new Fe(new Pe(2,"["),null,new Pe(64,"Control+["),null,null,null,null,null),"\\":new Fe(new Pe(2,"\\"),null,new Pe(64,"Control+\\"),null,null,null,null,null),"]":new Fe(new Pe(2,"]"),null,new Pe(64,"Control+]"),null,null,null,null,null),"^":new Fe(null,new Pe(2,"^"),null,new Pe(64,"Control+^"),null,new Pe(64,"Record Separator"),null,null),_:new Fe(null,new Pe(2,"_"),null,new Pe(64,"Control+_"),null,new Pe(64,"Unit Separator"),null,null),"`":new Fe(new Pe(2,"`"),null,null,null,null,null,null,null),a:new Fe(new Pe(2,"a"),new Pe(2,"A"),new Pe(64,"Control+a"),null,null,null,null,null),b:new Fe(new Pe(2,"b"),new Pe(2,"B"),new Pe(64,"Control+b"),null,null,null,null,null),c:new Fe(new Pe(2,"c"),new Pe(2,"C"),new Pe(64,"Control+c"),null,null,null,null,null),d:new Fe(new Pe(2,"d"),new Pe(2,"D"),new Pe(64,"Control+d"),null,null,null,null,null),e:new Fe(new Pe(2,"e"),new Pe(2,"E"),new Pe(64,"Control+e"),null,null,null,null,null),f:new Fe(new Pe(2,"f"),new Pe(2,"F"),new Pe(64,"Control+f"),null,null,null,null,null),g:new Fe(new Pe(2,"g"),new Pe(2,"G"),new Pe(64,"Control+g"),null,null,null,null,null),h:new Fe(new Pe(2,"h"),new Pe(2,"H"),new Pe(64,"Control+h"),null,null,null,null,null),i:new Fe(new Pe(2,"i"),new Pe(2,"I"),new Pe(64,"Control+i"),null,null,null,null,null),j:new Fe(new Pe(2,"j"),new Pe(2,"J"),new Pe(64,"Control+j"),null,null,null,null,null),k:new Fe(new Pe(2,"k"),new Pe(2,"K"),new Pe(64,"Control+k"),null,null,null,null,null),l:new Fe(new Pe(2,"l"),new Pe(2,"L"),new Pe(64,"Control+l"),null,null,null,null,null),m:new Fe(new Pe(2,"m"),new Pe(2,"M"),new Pe(64,"Control+m"),null,null,null,null,null),n:new Fe(new Pe(2,"n"),new Pe(2,"N"),new Pe(64,"Control+n"),null,null,null,null,null),o:new Fe(new Pe(2,"o"),new Pe(2,"O"),new Pe(64,"Control+o"),null,null,null,null,null),p:new Fe(new Pe(2,"p"),new Pe(2,"P"),new Pe(64,"Control+p"),null,null,null,null,null),q:new Fe(new Pe(2,"q"),new Pe(2,"Q"),new Pe(64,"Control+q"),null,null,null,null,null),r:new Fe(new Pe(2,"r"),new Pe(2,"R"),new Pe(64,"Control+r"),null,null,null,null,null),s:new Fe(new Pe(2,"s"),new Pe(2,"S"),new Pe(64,"Control+s"),null,null,null,null,null),t:new Fe(new Pe(2,"t"),new Pe(2,"T"),new Pe(64,"Control+t"),null,null,null,null,null),u:new Fe(new Pe(2,"u"),new Pe(2,"U"),new Pe(64,"Control+u"),null,null,null,null,null),v:new Fe(new Pe(2,"v"),new Pe(2,"V"),null,null,null,null,null,null),w:new Fe(new Pe(2,"w"),new Pe(2,"W"),new Pe(64,"Control+w"),null,null,null,null,null),x:new Fe(new Pe(2,"x"),new Pe(2,"X"),new Pe(64,"Control+x"),null,null,null,null,null),y:new Fe(new Pe(2,"y"),new Pe(2,"Y"),new Pe(64,"Control+y"),null,null,null,null,null),z:new Fe(new Pe(2,"z"),new Pe(2,"Z"),new Pe(64,"Control+z"),null,null,null,null,null),"{":new Fe(null,new Pe(2,"{"),null,null,null,null,null,null),"|":new Fe(null,new Pe(2,"|"),null,null,null,null,null,null),"}":new Fe(null,new Pe(2,"}"),null,null,null,null,null,null),"~":new Fe(null,new Pe(2,"~"),null,null,null,null,null,null),Backspace:new Fe(new Pe(64,"Backspace"),new Pe(64,"Erase Character"),new Pe(64,"Delete Character"),null,null,null,null,null),Tab:new Fe(new Pe(64,"Tab"),null,null,null,null,null,null,null),"U+0018":null,Escape:new Fe(new Pe(64,"Escape"),null,null,null,null,null,null,null),Delete:new Fe(new Pe(64,"Delete"),null,null,null,null,null,null,null),"U+00A1":null,"U+0300":null,"U+0301":null,"U+0302":null,"U+0303":null,"U+0304":null,"U+0306":null,"U+0307":null,"U+0308":null,"U+030A":null,"U+030B":null,"U+030C":null,"U+0327":null,"U+0328":null,"U+0345":null,"U+20AC":null,"U+3099":null,"U+309A":null};var Ie=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.render"),Ne=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.scaling"),Le=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.color");const Ue=1,Be=2,Oe=3,Ve=100,He=-1.5,Qe=-.25,_e=5,Ke=1,We=2,ze=4,Ge=6,qe=8,je=10,Ze=12,Je=14,Xe=16,Ye=18,$e=22,ts=24,is=26,es=28,ss=30,ns=32,ls=64,hs=128,rs=256,us=512,os=4096,as=8192,cs=16777215,fs=16711680,ds=65280,ws=2281766656,As=1,ps=2;var bs=0;const ks=0,Cs=4210752,ms=61440,vs=16777215;var Ss=function(t){if(t.match(/^#([a-fA-F0-9]){6}/)){var i=parseInt(t.substring(1,7),16);return"rgb("+(i>>16)+","+(i>>8&255)+","+(255&i)+")"}if(t.match(/^rgb\((?:\d{1,3},){2}\d{1,3}\)/))return t;Ie.warn("Webcolor: bad color value, "+t)},gs=function(t,i,e,s,n){Le.log(Le.FINEST,"Setting fill color. Previous color="+t.fillStyle+". Args length="+arguments.length),t.fillStyle=5==arguments.length?"rgba("+i+","+e+","+s+","+n+")":4==arguments.length?"rgb("+i+","+e+","+s+")":2==arguments.length?"rgb("+((16711680&i)>>16)+","+((65280&i)>>8)+","+(255&i)+")":Ss(i),Le.log(Le.FINEST,"Set fill color. New color="+t.fillStyle)},Es=function(t,i,e,s,n){Le.log(Le.FINEST,"Setting stroke color. Previous color="+t.strokeStyle+". Args length="+arguments.length),t.strokeStyle=5==arguments.length?"rgba("+i+","+e+","+s+","+n+")":4==arguments.length?"rgb("+i+","+e+","+s+")":2==arguments.length?"rgb("+((16711680&i)>>16)+","+((65280&i)>>8)+","+(255&i)+")":Ss(i),Le.log(Le.FINEST,"Set stroke color. New color="+t.strokeStyle)},ys=function(t,i){t.globalAlpha=i},Ds=function(t,i,e,s){t.beginPath(),t.arc(i,e,s,0,6.29,!1),t.closePath(),t.fill()},Rs=function(t,i,e,s,n,l){t.beginPath(),t.moveTo(i,e),t.arc(i,e,s,n,l,!1),t.closePath(),t.fill()},Ts=function(t,i,e,s,n,l){for(var h=new Array(s),r=0;r<s;r++)h[r]=i[e+r];var u=String.fromCharCode.apply(null,h);Ie.log(Ie.FINEST,"Draw chars at canvas px("+n+","+l+") runLength="+s+" lineBuffer start="+e+" text="+u),t.fillText(u,n,l)};function Ms(t,i,e,s,n){Ie.debug("Draw line (2) from ("+i+","+e+") to ("+s+","+n+")"),t.beginPath();var l=t.fillStyle;t.fillStyle=t.strokeStyle;for(var h=Math.sqrt((s-i)*(s-i)+(n-e)*(n-e)),r=s-i,u=n-e,o=Math.atan(u/(0==r?.01:r))+(r<0?Math.PI:0),a=0;a<h;a++)t.fillRect(Math.round(i+Math.cos(o)*a),Math.round(e+Math.sin(o)*a),1,1);t.stroke(),t.fillStyle=l}var Ps=function(t,i,e,s,n){Ie.debug("Draw line from ("+i+","+e+") to ("+s+","+n+")"),t.beginPath(),t.moveTo(i,e),t.lineTo(s,n),t.stroke()};function Fs(t,i){this.canvas=t.canvas,this.H=t,this.K=-1,this.W=-1,this.G=-1,this.Z=-1,this.font=null,this.fontSize=Number(Fs.fontSize),this.J=t.X&&t.X.J?t.X.J:r,e.debug("virtualScreen = "+t),e.debug("cInfo="+t.Y),this.tt=!0,this.it=1,this.et=1,this.st=-1,this.nt=-1,this.lt=1,this.ht=1,this.rt=1,this.ut=0,this.ot=0,this.at=i,this.ct=0,this.ft=3,this.dt=500,this.wt=!0,this.hasFocus=t.At(),this.pt=0,this.background=0,this.bt=16777215,this.kt=16777215,this.Ct=16777215,this.vt=16777215,this.scaleMethod=1,this.St=null,this.gt=null,3==this.ft&&this.dt>=100&&this.Et()}Fs.yt=2,Fs.fontWeight="normal",Fs.fontStyle="normal",Fs.fontSize=10,Fs.J=r,Fs.prototype.Dt=function(t){if(t){if(Ie.debug("Setting font properties=",t),t.size&&null!==t.size){let i=Number(t.size);this.fontSize=i,Fs.fontSize=i}t.scaleMethod&&null!==t.scaleMethod&&(this.scaleMethod=t.scaleMethod,1==this.scaleMethod&&(Fs.fontSize=10)),this.Rt(),this.Tt()}},Fs.prototype.Mt=function(t,i,e,s){t.font=Fs.fontStyle+" "+Fs.fontWeight+" "+i+"px "+e;var n=t.measureText(s);this.ut=bs,this.rt=.85*i,this.Pt=i-(this.ut+this.rt),this.ot=this.rt+this.ut;var l=i;return{width:n.width,height:l}},Fs.prototype.Ft=function(){return this.H.oiaEnabled?this.H.height+Fs.yt:this.H.height},Fs.prototype.xt=function(t,i){var e,s=t.width,n=t.height,l=this.H;if(this.tt=!0,this.nt=0,this.st=0,this.It="1",this.Nt="1",Ne.debug("Calculate font for canvas w="+s+",h="+n),0==this.scaleMethod)for(Ne.debug("Calculating for scaleMethod=ratio"),u=50;u>4;u--){var h=(e=this.Mt(i,u,this.J,"M")).width*l.width,r=e.height*this.Ft();if(Ne.debug("At font size="+u+", need w="+h+",h="+r),h<=s&&r<=n){Ne.debug("Found size match. Chose font size ="+u+" for canvas w="+s+",h="+n+" ascent="+this.rt+", descent="+this.Pt+" leading="+this.ut),this.tt=!1,this.lt=e.width,this.ht=e.height,this.font=Fs.fontStyle+" "+Fs.fontWeight+" "+u+"px "+this.J,this.nt=h,this.st=r;break}}else if(1==this.scaleMethod){Ne.debug("Calculating for scaleMethod=fit");var u=10;e=this.Mt(i,u,this.J,"M"),this.tt=!1,this.lt=e.width,this.ht=e.height,this.font=Fs.fontStyle+" "+Fs.fontWeight+" "+u+"px "+this.J;var o=t.width/(l.width*e.width),a=t.height/(this.Ft()*e.height);o=(parseInt(10*o)/10).toFixed(1),a=(parseInt(10*a)/10).toFixed(1),this.it=1/o,this.et=1/a,this.nt=t.width*this.it,this.st=t.height*this.et,i.scale(o,a),this.It=o,this.Nt=a,this.Lt.setTransform(1,0,0,1,0,0),this.Lt.scale(o,a),Ne.debug("Scaled for font size="+u+", canvas w="+s+",h="+n+" ascent="+this.rt+", descent="+this.Pt+" leading="+this.ut),Ne.debug("Scale factors are: sfX="+this.it+", sfY="+this.et+", aH="+this.st+", aW="+this.nt+", sW="+o+", sH="+a)}else Ne.debug("Calculating for scaleMethod=no scale"),u=Fs.fontSize,e=this.Mt(i,u,this.J,"M"),this.tt=!1,this.lt=e.width,this.ht=e.height,this.font=Fs.fontStyle+" "+Fs.fontWeight+" "+u+"px "+this.J,this.it=1,this.et=1,this.nt=t.width,this.st=t.height,i.scale("1","1"),this.Lt.setTransform(1,0,0,1,0,0),this.Lt.scale("1","1"),Ne.debug("Scaled for font size="+u+", canvas w="+s+",h="+n+" ascent="+this.rt+", descent="+this.Pt+" leading="+this.ut);if(this.J!=this.Ut){Ne.debug("Determining font size for DBCS="+this.Ut);var c=this.Mt(i,u,this.Ut,"M"),f=this.Mt(i,u,this.Ut,"䭺");Ne.debug("SBCS box="+JSON.stringify(e)+" dbcsBox="+JSON.stringify(c)+" testSymbolBox="+JSON.stringify(f))}},Fs.prototype.Bt=function(t,i,e,s,n,l){let h=[];const r=this.bt;let u=charPosColor=r,o=0;for(let a=0;a<s;a++){let c=i[e+a];switch(a){case 0:charPosColor=r;break;case 8:7===c&&(charPosColor=this.kt,c=32);break;case 25:charPosColor=r;break;case 50:charPosColor=this.Ct;break;case 52:case 79:charPosColor=r}if(h.push(c),u!=charPosColor){let i=String.fromCharCode.apply(null,h);gs(t,u),t.fillText(i,n+o,l),Ie.log(Ie.FINEST,"Draw chars at canvas px("+n+","+l+") runLength="+s+" lineBuffer start="+e+" text="+i),o=(a+1)*this.lt,h=[],u=charPosColor}}if(h.length>0){let i=String.fromCharCode.apply(null,h);gs(t,u),t.fillText(i,n+o,l),Ie.log(Ie.FINEST,"Draw chars at canvas px("+n+","+l+") runLength="+s+" lineBuffer start="+e+" text="+i)}},Fs.prototype.Ot=function(t,i,e,s){var n;for(n=0;n<s;n++)t[n]=32,i[n]=0,e[n]=0},Fs.prototype.Vt=function(t,i,e){for(var s=i;s<e;s++)if(t[s]>32)return s;return-1},Fs.prototype.Ht=function(t,i,e,s,n,l){for(var h=s+1,r=t[s],u=l?l[s]:null,o=i[s];h<n&&(r==ws?t[h]==ws:r==t[h])&&o==i[h]&&(!l||u==l[h]);)h++;return h-s},Fs.prototype.clear=function(){let t=this.H;var i=t.canvas.getContext("2d"),e=t.canvas.width,s=t.canvas.height;if(Ie.debug("Renderer.clear pxWidth="+e+" pxHeight="+s+" inactive=4210752"),gs(i,4210752),i.fillRect(0,0,e,s),gs(i,this.background),i.fillRect(0,0,this.nt,this.st),t.Qt){let i=t.Qt.getContext("2d");gs(i,this.background),i.fillRect(0,0,t.Qt.width,t.Qt.height)}},Fs.prototype.Rt=function(){this.H.canvas.getContext("2d").setTransform(1,0,0,1,0,0),this.H.Qt&&this.H.Qt.getContext("2d").setTransform(1,0,0,1,0,0),this.it=1,this.et=1,this.K=-1},Fs.prototype._t=function(t,i){return this.H.canvas,this.H,1==this.scaleMethod&&(t*=this.it,i*=this.et),(t>=this.nt||i>=this.st)&&Ie.debug("canvasX or canvasY is greater than activeWidth or activeHeight"),{rows:Math.floor(i/this.ht),columns:Math.floor(t/this.lt)}},Fs.prototype.Kt=function(){var t=this.H;let i=t.canvas;var e=this.Lt;e.font=this.font,gs(e,255,255,255,0),e.clearRect(0,0,i.width,i.height),e.clearRect(0,0,this.nt,this.st),!0===this.hasFocus&&(3!=this.ft||0==this.dt||1==this.wt)&&this.ft>0&&this.Wt(e,t.zt),null!=t.Gt&&null!=t.qt&&null!=t.jt&&null!=t.Zt&&this.Jt(t.Gt,t.qt,t.Zt,t.jt),1==t.oiaEnabled&&this.Xt(e,t,(function(){"function"==typeof t.Yt&&t.Yt()}))},Fs.prototype.Xt=function(t,i,e){let s=i.canvas;var n=t.lineWidth;t.beginPath(),Es(t,this.bt),t.lineWidth=5*this.et;var l=s.height*this.et+-1.5*this.ht;t.moveTo(0,l),t.lineTo(this.nt-12,l);var h=i.$t(),r=s.height*this.et+-.25*this.ht;this.Bt(t,h,0,i.width,0,r),t.closePath(),t.stroke(),t.lineWidth=n,e&&e.call(this)},Fs.prototype.Jt=function(t,i,e,s){if(t!=e&&i!==s){i=i>s?i+1:i,t=t>e?t+1:t;var n=Math.min(t,e),l=Math.max(t,e),h=Math.min(i,s),r=Math.max(i,s);Ie.debug("drawSelectionBox selectionStartColumn="+t+" selectionStartRow="+i+" selectionEndColumn="+e+" selectionEndRow="+s);var u=this.H,o=u.ti.getContext("2d");o.beginPath(),this.ii(n,h,l,r,o,u.canvas.getContext("2d")),o.closePath()}},Fs.prototype.ei=function(){clearTimeout(this.St),1!=this.wt&&(this.wt=!0,this.Kt()),3==this.ft&&this.dt>=100&&this.Et()},Fs.prototype.Et=function(){var t=this;this.St=setInterval((function(){t.wt=!t.wt,!0===t.hasFocus&&t.Kt()}),this.dt)},Fs.prototype.si=function(){clearTimeout(this.gt),1!=this.ni&&(this.ni=!0,this.Tt()),this.li>=100&&this.hi()},Fs.prototype.hi=function(){var t=this;this.gt=setInterval((function(){t.ri&&(t.ni=!t.ni,t.Tt())}),this.li)},Fs.prototype.Wt=function(t,i){if(-1!==i){var s=this.H,n=this.ht,l=this.lt,h=this.H.ui?.2:1;if(0!=s.width){var r=Math.floor(i/s.width)+1,u=i%s.width;Ie.debug("show cursor pos="+i+" at row="+r+" column="+u),t.beginPath(),gs(t,this.vt),1==this.ft?(Es(t,this.vt),t.moveTo(u*l,(r-h)*n),t.lineTo((1+u)*l,(r-h)*n),t.lineTo((1+u)*l,r*n),t.lineTo(u*l,r*n),t.lineTo(u*l,(r-h)*n),t.closePath(),t.stroke()):(this.ii(u,r-h,1+u,r,t,s.canvas.getContext("2d")),t.closePath())}else e.info("CANNOT SHOW CURSOR screen.width==0\n")}},Fs.prototype.ii=function(t,i,e,s,n,l){var h=this.ht,r=this.lt,u=t*r,o=i*h,a=e*r,c=s*h,f=1==this.scaleMethod?u/this.it:u,d=1==this.scaleMethod?o/this.et:o,w=1==this.scaleMethod?a/this.it:a,A=1==this.scaleMethod?c/this.et:c,p=Math.abs(f-w),b=Math.abs(d-A);Ie.debug("scaledX="+f+"scaledY="+d+"width="+p+"height="+b);for(var k=l.getImageData(f,d,p,b),C=0;C<k.data.length;C+=4)k.data[C]=255-k.data[C],k.data[C+1]=255-k.data[C+1],k.data[C+2]=255-k.data[C+2],k.data[C+3]=255;n.putImageData(k,f,d)},Fs.prototype.Tt=function(){hn("fullPaint")},Fs.prototype.oi=function(){e.debug("Renderer resize completed")},we(Is,Fs,[Is.Tt]);const xs=16777215;function Is(t,i,s){this.H=t,t.ai=this,this.K=-1,this.W=-1,this.G=-1,this.Z=-1,this.font=null,this.fontSize=Fs.fontSize,this.J=t.X&&t.X.J?t.X.J:r,e.debug("virtualScreen = "+t),e.debug("cInfo="+t.Y),this.tt=!0,this.it=1,this.et=1,this.st=-1,this.nt=-1,this.lt=1,this.ht=1,this.rt=1,this.ut=0,this.ot=0,this.at=i,this.ct=0,this.ft=3,this.ci=3,this.dt=500,this.li=500,this.hasFocus=t.At(),this.scaleMethod=s||1,this.fi=16711680,this.di=65280,this.backgroundColor=0,this.wi=16777215,this.Ai=65280,this.pi=this.Ai,this.bi=this.backgroundColor,this.ki=0,this.Ci=16777215,this.mi=0,this.vi=16777215,this.Si=0,this.gi=this.Ai,this.Ei=0,this.yi=this.Ai,this.Di=0,this.Ri=[0,12255232,47872,12303104,187,12255419,48059,12303291],this.Ti=[this.Ri[0],this.Ri[1],this.Ri[2],this.Ri[3],this.Ri[4],this.Ri[5],this.Ri[6],this.Ri[7],8421504,33023,65408,8454143,16744576,16744703,16777088,12632256],this.Mi=[5592405,16733525,5635925,16777045,5592575,16733695,5636095,16777215],this.Pi=[this.Mi[0],this.Mi[1],this.Mi[2],this.Mi[3],this.Mi[4],this.Mi[5],this.Mi[6],this.Mi[7],8421504,33023,65408,8454143,16744576,16744703,16777088,16777215],this.vt=16777215,this.bt=16777215,this.Fi=!1,this.ri=!0,this.St=null,this.gt=null,3==this.ft&&this.dt>=100&&this.Et(),this.li>=100&&this.hi(),this.Tt()}Is.xi=32,Is.Ii=32,Is.prototype.Ni=function(t,i,e,s){var n=this.H,l=!1;if(Ie.debug("Determining which rows to redraw. Include neighbors="+s),null==(r=n.Li))Ie.debug("Viewport top is null, not redrawing any rows"),i.fill(!0);else{for(var h=0;h<n.height;h++){if(!r){i.fill(!0,h);break}r.Ui&&(l=!0),e[h]==r.id&&!0!==r.updated||(i[h]=!0,s&&(h>0&&(i[h-1]=!0),h<n.height-1&&(i[h+1]=!0))),r.updated=!1,e[h]=r.id,r=r.next}var r=n.Li;Ie.debug("Row redraw calculation result=",i)}this.ri!=l&&(this.ni=!0,this.ri=l,i.fill(!0))},Is.prototype.Bi=function(){null!=this.Oi&&null!=this.Oi||(this.ci=this.ft),this.ft=0},Is.prototype.Vi=function(){this.ft=3,this.ei()},Is.prototype.Hi=function(){null!=this.Oi&&null!=this.Oi||(this.Oi=this.dt),this.dt=0},Is.prototype.Qi=function(){this.dt=this.Oi,this.Oi=null},Is.prototype._i=function(t,i){var e=this.H.height,s=null;let n=this.ht,l=this.nt;gs(t,this.backgroundColor),Ie.debug("Clearing updated rows by drawing with color="+this.backgroundColor);var h=i.entries();for(let i of h)!0===i[1]?null==s&&(s=i[0]):null!=s&&(t.fillRect(0,n*s,l,n*(i[0]-s)),s=null);null!=s&&t.fillRect(0,n*s,l,n*(e+1-s))},Is.Ki=function(t,i,e){var s=t-e+33,n=t-e+161;switch(i){case Mn.Wi:return s;case Mn.zi:switch(Ie.log(Ie.FINER,"Getting symbol in charset. code=0x"+Ji(t)+", charset=0x"+i+", codeShift=0x"+e+". shifted=0x"+Ji(s)+", iso8859-like=0x"+Ji(n)),n){case 164:case 166:return Is.xi;case 168:return 164;case 172:case 173:case 174:case 175:return Is.xi;case 180:case 184:case 190:case 208:return Is.xi;case 215:return 338;case 221:return 376;case 222:case 240:return Is.xi;case 247:return 339;case 253:return 255;case 254:case 255:return Is.xi;default:return n}case Mn.Gi:if(Ie.log(Ie.FINER,"Getting symbol in charset. code=0x"+Ji(t)+", charset=0x"+i+", codeShift=0x"+e+". shifted=0x"+Ji(s)+", iso8859-like=0x"+Ji(n)),s<95)return s;switch(s){case 95:return" ";case 96:return 9674;case 97:return 9618;case 98:return 9225;case 99:return 9228;case 100:return 9229;case 101:return 9226;case 102:return 176;case 103:return 177;case 104:return 9252;case 105:return 9227;case 106:return 9496;case 107:return 9488;case 108:return 9484;case 109:return 9492;case 110:return 9532;case 111:case 112:return 8254;case 113:return 9472;case 114:case 115:return 95;case 116:return 9500;case 117:return 9508;case 118:return 9524;case 119:return 9516;case 120:return 9474;case 121:return 8804;case 122:return 8805;case 123:return 960;case 124:return 8800;case 125:return 163;case 126:return 183;default:return Ie.warn("No DEC graphic char for shifted code=0x"+Ji(s))," "}default:return Ie.warn("No lookup for gl.charset=0x"+Ji(i)),s}},Is.qi=function(t,i){var e=t.ji;return e<=32?32:e<127?Is.Ki(e,t.Zi,33):e<=161?32:e<255?Is.Ki(e,t.Ji,161):!0===i?e:(null!=e&&Ie.warn("Failed to get glyph for code=0x"+Ji(e)),32)};var Ns=new Sn(32);Is.prototype.Xi=function(t,i,e,s,n,l,h,r){null==r&&(r=Ns,s[l]=this.wi,n[l]=this.backgroundColor),i[l]=Is.qi(r,this.H.Yi);var u=r.$i;if(0==(64&r.te)){switch(r.ie){case Mn.ee:0!=(16&r.te)?0==(24^r.te)||0==(28^r.te)?s[l]=this.vi:0==(26^r.te)||0==(30^r.te)?s[l]=this.Fi?this.Di:this.Si:0==(18^r.te)||0==(22^r.te)?s[l]=this.Fi?this.bi:this.ki:s[l]=this.Ai:0==(8^r.te)||0==(12^r.te)?s[l]=this.Ci:0==(10^r.te)||0==(14^r.te)?s[l]=this.Fi?this.Ei:this.mi:0==(2^r.te)||0==(6^r.te)?s[l]=this.Fi?this.di:this.backgroundColor:s[l]=this.wi;break;case Mn.se:0!=(16&r.te)?s[l]=this.Mi[u]:s[l]=this.Ri[u];break;case Mn.ne:u<=15?0!=(16&r.te)?s[l]=this.Pi[u]:s[l]=this.Ti[u]:u<=231?s[l]=ji[u-16]:u<=256&&(s[l]=Zi[u-232]);break;case Mn.le:s[l]=u}var o=r.he;switch(r.re){case Mn.ee:0!=(16&r.te)?0==(24^r.te)||0==(28^r.te)?n[l]=this.Si:0==(26^r.te)||0==(30^r.te)?n[l]=this.Fi?this.yi:this.vi:0==(18^r.te)||0==(22^r.te)?n[l]=this.Fi?this.pi:this.Ai:n[l]=this.ki:0==(8^r.te)||0==(12^r.te)?n[l]=this.mi:0==(10^r.te)||0==(14^r.te)?n[l]=this.Fi?this.gi:this.Ci:0==(2^r.te)||0==(6^r.te)?n[l]=this.Fi?this.fi:this.wi:n[l]=this.backgroundColor;break;case Mn.se:n[l]=this.Ri[o];break;case Mn.ne:n[l]=this.Ti[o];break;case Mn.le:n[l]=o}}else Le.debug("Element is hidden, setting null color"),s[l]=null,n[l]=null;e[l]=r.te},Is.prototype.ue=function(){this.oe||(this.oe=!0,this.ae(),this.Tt())},Is.prototype.ce=function(){this.oe&&(this.oe=!1,this.ae(),this.Tt())},Is.prototype.ae=function(){let t=this.backgroundColor;this.backgroundColor=this.wi,this.wi=t;let i=this.Ai;this.Ai=this.ki,this.ki=i;let e=this.Ci;this.Ci=this.mi,this.mi=e;let s=this.vi;this.vi=this.Si,this.Si=s;let n=this.di;this.di=this.fi,this.fi=n;let l=this.bi;this.bi=this.pi,this.pi=l;let h=this.Ei;this.Ei=this.gi,this.gi=h;let r=this.Di;this.Di=this.yi,this.yi=r},Is.prototype.Tt=function(){Ie.debug("Full paint called, will clear entire screen");let t=this.H.canvas;this.H.parentDiv;var i=t.getContext("2d");if(gs(i,this.backgroundColor),i.fillRect(0,0,t.width,t.height),this.H.Qt){let t=this.H.Qt;var e=t.getContext("2d");gs(e,this.backgroundColor),e.fillRect(0,0,t.width,t.height)}this.H.fe.fill(null),this.de()};var Ls=!0,Us=!0;Is.prototype.de=function(t){let i=this.H.canvas;var e=i.width,s=i.height,n=i.getContext("2d",{alpha:!1});if(this.Lt=this.H.ti.getContext("2d"),-1!=this.K&&this.K==e&&this.W==s||(this.xt(i,n),this.xt(this.H.ti,this.Lt),this.K=e,this.W=s,!this.H.Qt)||this.H.Qt.getContext("2d").scale(this.It,this.Nt),this.tt)return;n.font=this.font,n.textBaseline="top",gs(n,this.wi);var l=this.H,h=Number(l.width),r=new Array(h),u=new Array(h),o=new Array(h),a=new Array(h);let c=0;var f=0,d=l.fe,w=new Array(Number(t>0?t:l.height));Us?this.Ni(n,w,d,Ls):w.fill(!0),window.requestAnimationFrame(()=>{this._i(n,w);for(var t=l.Li,e=0,s=i.height/l.height,d=0;d<l.height;d++){if(!w[d]){if(Ie.debug("Skipping unmodified row="+d),f+=l.width,c+=this.ht,null==t)break;t=t.next;continue}var A;for(e++,null!=t&&"function"==typeof this.we&&this.we(t,d,s),d<3&&Ie.debug("startLine, baseline = "+c+" screenOffset="+f+" size="+l.size),this.Ot(r,a,u,h),A=0;A<h;A++)this.Xi(d,r,a,u,o,A,h,null!=t?t.elements[A]:null);var p=0;A=0;let i=this.H.Ae(t)?Math.floor(h/2):h;for(;A<i;){var b=this.Ht(u,a,d,A,i,o);if(null!=u[A]){var k=a[A];if(gs(n,u[A]),Es(n,u[A]),n.lineWidth=.8,Ie.debug("Run starts at ("+A+","+d+"). Length="+b+", Attr=0x"+Ji(k)+", FG="+u[A]+", BG="+o[A]),0!=(128&k)?(Ie.debug("Transforming canvas for double width"),n.save(),n.transform(2,0,0,1,0,0)):0!=(256&k)&&(Ie.debug("Transforming canvas for double height (top)"),n.save(),n.transform(2,0,0,2,0,-Math.round(this.st/this.H.height)*d)),0==(512&k)){var C=0!=(2&k);if(o[A]==this.backgroundColor&&u[A]==this.wi||(gs(n,o[A]),C&&this.Fi&&Es(n,o[A]),n.fillRect(p,c,b*this.lt,this.ht),gs(n,u[A])),0!=(1&k)?this.pe(n,r,A,b,p,c,C):(0==(8&k)||this.ni)&&Ts(n,r,A,b,p,c),0!=(4&k)){var m=c+(this.ht-1);Ms(n,p,m,p+b*this.lt,m)}}0==(128&k)&&0==(256&k)&&0==(512&k)||n.restore()}else-1!=this.Vt(r,A,b)&&Ie.debug("Skipping render for null/invisible color at ("+A+","+d+")");A+=b,p+=b*this.lt}f+=l.width,c+=this.ht,null!=t&&(t=t.next)}this.H.Qt&&this.be(),Ie.debug("Drew rows=",e),l.zt=this.ke(),this.Kt()})},Is.prototype.ke=function(){let t=this.H,i=t.Ce();if(-1===i)return i;let e=t.Ae()?2*t.me:t.me;return t.width*i+Math.min(e,t.width-1)},Is.prototype.be=function(){let t=this.H,i=t.Qt;if(i&&t.ve){let e=i.getContext("2d",{alpha:!1});gs(e,this.backgroundColor),e.fillRect(0,0,i.width,i.height),e.font=this.font,gs(e,this.wi);let s=t.ve,n=t.width,l=new Array(n),h=new Array(n),r=new Array(n),u=new Array(n);for(let t=0;t<n;t++)this.Xi(0,l,u,h,r,t,n,s.elements&&s.elements[t]?s.elements[t]:null);let o=0,a=0;for(;a<n;){let t=this.Ht(h,u,0,a,n,r);if(null!=h[a]){let i=u[a];if(gs(e,h[a]),Es(e,h[a]),e.lineWidth=.8,Ie.debug("Statusline: Run starts at "+a+". Length="+t+", Attr=0x"+Ji(i)+", FG="+h[a]+", BG="+r[a]),0!=(128&i)?(Ie.debug("Transforming status canvas for double width"),e.save(),e.transform(2,0,0,1,0,0)):0!=(256&i)&&(Ie.debug("Transforming status canvas for double height (top)"),e.save(),e.transform(2,0,0,2,0,0)),0==(512&i)){let s=0!=(2&i);if(r[a]!=this.backgroundColor||h[a]!=this.wi){gs(e,r[a]),s&&this.Fi&&Es(e,r[a]);const i=Xs/2/(this.Nt||"1");e.fillRect(o,i,t*this.lt,this.ht),gs(e,h[a])}if(0!=(1&i)?this.pe(e,l,a,t,o,this.ht,s):(0==(8&i)||this.ni)&&Ts(e,l,a,t,o,this.ht),0!=(4&i)){let i=this.ht-1;Ms(e,o,i,o+t*this.lt,i)}}0==(128&i)&&0==(256&i)&&0==(512&i)||e.restore()}else-1!=this.Vt(l,a,t)&&Ie.debug("Statusline: skipping render for null/invisible color at "+a);a+=t,o+=t*this.lt}}},Is.prototype.Se=function(t){let i=this.H;if(i.ge<1||i.Ee===i.height)return;let e=this.ht,s=i.ge*e,n=(i.height,1==this.scaleMethod?s/this.et:s),l=t.getImageData(0,n,this.nt,this.st-n);t.putImageData(l,0,0),i.ge=0},Is.prototype.ye=function(t){for(var i=0,e=0;e<t.length;e++)i=i<<4|parseInt(t[e],16);return i};var Bs=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.keyboard"),Os=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.message"),Vs=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.protocol"),Hs=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.telnet"),Qs=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.event"),_s=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.parse");const Ks=0,Ws=1,zs=2,Gs=3,qs=80,js=24,Zs="Statusline",Js="statusline_id_0",Xs=10,Ys=896,$s={De:0,Re:1},tn="Input",en="Hotspots",sn="hotspotButton",nn=200,ln=200;function hn(t){alert(t+": You are in the superclass!")}var rn,un=function(t){return new RegExp("[a-zA-Z]").test(t.charAt(0))};function on(t,i){this.Te=new Array(i||80),this.Te.fill(32)}function an(t,i){this.canvas=null,this.ti=null,this.parentDiv=null,this.oiaEnabled=1,this.width=t,this.height=i,this.Me=$s.De,this.Pe=new on(this),this.Fe=new Array(this.height*this.width),this.ai=null,this.xe=80,this.Ie=24,this.Ne=[],this.Le=null,this.Ue=0,this.qt=null,this.Gt=null,this.jt=null,this.Zt=null,this.Be=!1,this.Oe=!1,this.Ve="rgb(255,255,255)",this.He,this.Qe=null,this._e=!0,this.Ke=null,this.We=!1,this.ze=new Array,this.Ge=!1,this.qe=!1,this.je=!1,this.Ze=0,this.Je=0,this.Xe=!1,this.Ye=["Reset"],this.$e=new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH\n3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfH\noSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAEx\nBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576\nv////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS\n4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQ\nRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDA\nmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAU\nABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM\n7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ\n+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGt\njLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDA\nAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveE\nAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTI\nnzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dz\nNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkw\ndxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eD\nvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU\n8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAo\nRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImN\ng3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzr\nO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUd\nU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHp\nMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb//////////////////////////\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n/////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3ku\nZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=")}function cn(t,i){this.state,this.screen=t,this.ts,this.es,this.ss,this.ns=i}function fn(t){this.message=t,this.name="RuntimeException",e.warn("Encountered exception:"+this.name+", msg:"+t)}function dn(t){this.message=t,this.name="Exception",e.warn("Encountered exception:"+this.name+", msg:"+t)}function wn(t){this.message=t,this.name="TerminalInputException",e.warn("Encountered exception:"+this.name+", msg:"+t)}function An(t){this.message=t,this.name="UnsupportedOperationException",e.warn("Encountered exception:"+this.name+", msg:"+t)}an.prototype.ls=function(){this.$e&&this.$e.play()},an.hs=function(t,parentDiv,i,s,n){e.debug(`make canvas w/ id=${t}, parentDiv=${parentDiv}, w,h=${i},${s}`);var l=document.createElement("canvas");l.id=t,l.style.zIndex=n,l.style.position="absolute",l.style.left="0px",l.style.top="0px";var h=i,r=s;return l.width=h,l.height=r,l.innerHTML="If you see this message, rather than a real drawing canvas, please upgrade to FireFox 1.5, Safari, or some other modern browser",parentDiv.appendChild(l),l},an.rs=new Array(z.length),an.rs.fill(!1),an.prototype.us=function(){let t=an.rs.length;for(var i=0;i<t;i++)if(!an.rs[i]){an.rs[i]=!0,this.os=z[i];break}this.os||(this.os=" "),this.as=this.os},an.prototype.cs=function(t){this.fs(4999,t.data,"Connection to host closed due to error.\nHost: "+this.ds.host+"\nPort: "+this.ds.port+"\nError:"+t.data)},an.prototype.ws=function(t){this.fs(t.code,t.reason,"Connection to host closed.\nHost: "+this.ds.host+"\nPort: "+this.ds.port+"\nCode: "+t.code+"\nReason: "+t.reason)},an.prototype.fs=function(t,i,e){if(t!=this.As){if(Qs.warn(e),!this.callbacks.wsErrorCallback)return void setTimeout(()=>{alert(e),this.closeConnection(t,i),this.Le=null,this.ps=!1},500);this.callbacks.wsErrorCallback(t,i,e)}this.closeConnection(t,i),this.Le=null,this.ps=!1},an.prototype.isConnected=function(){return 2===this.Ze},an.prototype.disconnect=function(){e.info("Disconnected terminal with ID="+this.id),this.ps=!0,this.Ge=!0,this.closeConnection(4e3,"Terminal Closed"),this.ai.Tt()},an.prototype.closeConnection=function(t,i){this.As=t;var e=this.Le;if(e)try{e.close(t,i)}catch(t){}if(this.bs(),this.clear(),!this.ps){var parentDiv=this.parentDiv?this.parentDiv:document.getElementById(this.canvas.id).parentNode;try{this.ks(parentDiv);var s=parentDiv.id;this.callbacks&&this.callbacks.closeCallback&&this.callbacks.closeCallback(s)}catch(t){}this.os&&" "!=this.os&&(an.rs[this.os.charCodeAt(0)-65]=!1,this.os=null)}this.ps=!1},an.prototype.$t=function(){hn("getOIAArray")},an.prototype.Cs=function(){hn("initScreen")},an.prototype.connect=function(t,i){hn("connect")},an.prototype.ms=function(t){hn("paste")},an.prototype.vs=function(t){hn("copy")},an.prototype.Ss=function(t,i,e,s,n,l){hn("getScreenContents")},an.prototype.gs=function(t){hn("setCursorPos")},an.prototype.Es=function(t){hn("modifyCursorPos")},an.prototype.ys=function(t){hn("enterCharacterAtCursor")},an.prototype.clear=function(){hn("clear")},an.prototype.bs=function(){e.info("handle unbind function")},an.prototype.handleContainerResizeFromUI=function(parentDiv,t,i,e){null!=t&&(this.He=t.He,this.ze=t.ze),this.handleContainerResize(parentDiv,i,e)},an.prototype.At=function(){var t=document.activeElement;return document.getElementById(this.canvas.id)==t||document.getElementById(this.ti.id)==t||document.getElementById(this.Ds.id)==t},an.prototype.ks=function(parentDiv){parentDiv.removeChild(this.Ds),parentDiv.removeChild(this.canvas),parentDiv.removeChild(this.ti)},an.Rs=function(parentDiv,t,i,s){let n=document.createElement("div");n.id=parentDiv.id+"Statusline",n.style.zIndex="1",n.style.position="absolute",n.style.top=s+"px",n.style.left="0px",n.style.opacity="255",n.style.width=t+"px",n.style.height=i+"px";let l=n.id+"Canvas";e.debug("make canvas "+l+" parentDiv="+n);let h=document.createElement("canvas");return h.id=n.id+"Canvas",h.width=t,h.height=i,h.innerHTML="If you see this message, rather than a real drawing canvas, please upgrade to FireFox 1.5, Safari, or some other modern browser",n.appendChild(h),parentDiv.appendChild(n),h},an.Ts=function(t){let i=document.createElement("textarea");i.id=t+"Input";let e=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion),s=navigator.userAgent;return(e||-1!==s.indexOf("Android")||-1!==s.indexOf("iOS"))&&(i.readOnly=!0),i.style.position="relative",i.style.zIndex="3",i.style.bottom="0px",i.style.left="0px",i.style.opacity=0,i.style.width="100%",i.style.height="100%",i.style.cursor="default",i},an.prototype.handleContainerResize=function(parentDiv,t,i){e.info("handling resize"),clearTimeout(rn);var s=t||parentDiv.clientWidth,n=i||parentDiv.clientHeight;this.parentDiv=parentDiv,0!==n&&null!=n||(n=this.He.height),this.ks(parentDiv),this.ai&&this.ai.clear(),e.info("resize w="+s+" h="+n),this.Ms(parentDiv,{width:s,height:n}),this.Ps(),this.ai&&(this.ai.canvas=this.canvas,this.ai.Rt(),this.Fs(this.He),this.ai.Tt(),this.ai.oi());var l=this;rn=setTimeout((function(){l.xs()}),200)},an.prototype.resize=function(t,i,s){this.width=t,this.height=i,this.size=t*this.height,this.Pe.Te=new Array(t||80),this.Pe.Te.fill(32),e.info("Resized canvas grid to r="+this.height+", c="+this.width+", size="+this.size),s||this.clear(),this.ai&&(this.ai.Rt(),null!==this.He&&void 0!==this.He&&this.Fs(this.He),this.ai.Tt())},an.prototype.Is=function(t){console.log("VirtualScreen.handleKeyUp")},an.prototype.Ns=function(t){var i=t.keyCode,e=t.key?t.key:t.keyIdentifier;if(Bs.debug("keyup "+t+" target="+t.target+" keyName='"+e+"' keyCode=0x"+Ji(i)),this.qe&&!["Shift","Control","Alt"].includes(e))return Qs.debug("Screen locked by error occurrence"),t.stopPropagation(),void t.preventDefault();if(this.Is(),Bs.debug("keyup, modifier state starts at "+this.Ue.toString(2)),0!==this.Ue&&256!==this.Ue){if("AltLeft"==e?this.Ue&=-2:"AltRight"==e&&(this.Ue&=-3),"Alt"==e)this.Ue&=-2;else if("ControlLeft"==e)this.Ue&=-5;else if("ControlRight"==e)this.Ue&=-9;else if("Control"==e)this.Ue&=-5;else if("OSLeft"==e||"Win"==e)this.Ue&=-17;else if("OSRight"==e)this.Ue&=-33;else if("ShiftLeft"==e)this.Ue&=-65;else if("ShiftRight"==e)this.Ue&=-129;else{if("Shift"!=e)return;this.Ue&=-65}if(0===this.Ue||256===this.Ue){if(!this.Xe&&["Shift","Control","Alt"].includes(e)){e=t.code;var s=this.Qe[e];s&&s[0]&&s[0].type&&(!this.qe||this.Ye&&this.Ye.includes(s[0].value))&&this.Ls(s[0],t)}this.Xe=!1}t.stopPropagation(),t.preventDefault(),Bs.debug("keyup, modifier state is now "+this.Ue.toString(2))}},an.prototype.Ls=function(t,i){hn("handleKeyDown")},an.prototype.Us=function(t){-1===navigator.appName.indexOf("Safari")&&t.getModifierState&&(t.getModifierState("CapsLock")?this.Ue|=256:this.Ue&=-257)},an.prototype.Bs=function(t,i){if(i.getModifierState)return this.Ue=0,i.getModifierState("Control")&&(this.Ue|=4),i.getModifierState("Alt")&&(this.Ue|=1),i.getModifierState("Shift")&&(this.Ue|=64),i.getModifierState("CapsLock")&&(this.Ue|=256),(i.getModifierState("Meta")||i.getModifierState("OS")||i.getModifierState("Win"))&&(this.Ue|=16),!0;if(2===t.type||8===t.type&&t.value.length>1){var e=t.value;if("CapsLock"==e)this.Ue^=256;else if("AltLeft"==e)this.Ue|=1;else if("AltRight"==e)this.Ue|=2;else if("Alt"==e)this.Ue|=1;else if("ControlLeft"==e)this.Ue|=4;else if("ControlRight"==e)this.Ue|=8;else if("Control"==e)this.Ue|=4;else if("OSLeft"==e||"Win"==e)this.Ue|=16;else if("OSRight"==e)this.Ue|=32;else if("ShiftLeft"==e)this.Ue|=64;else if("ShiftRight"==e)this.Ue|=128;else{if("Shift"!=e)return!1;this.Ue|=64}return!0}return!1},an.prototype.Os=function(t){const i={Add:"+",Subtract:"-",Multiply:"*",Divide:"/",Decimal:"."};this.Us(t);var e=t.keyCode,s=i[t.key]?i[t.key]:"Cancel"===t.key&&3===t.charCode&&void 0===t.code?"Pause":"Cancel"===t.key||t.key?t.key:t.keyIdentifier;if(this.Bs(new Pe(8,s),t),(t.ctrlKey||t.shiftKey||t.altKey)&&!["Control","Alt","Shift"].includes(s)&&(this.Xe=!0),Bs.debug("keydown "+t+" target="+t.target+" keyName='"+s+"' keyCode=0x"+Ji(e)),Bs.debug("keydown, modifier state starts at "+this.Ue.toString(2)),s.startsWith("U+")&&6==s.length){if("U+0000"===s&&(this.Hs.Vs||this.Hs.Qs))return;var n=parseInt(s.substring(2),16);n>=32&&n<127&&(s=String.fromCharCode(n))}var l=1==s.length&&un(s);l&&(s=s.toLowerCase());var h=be[s];h&&(s=h),3!==t.location||"NumLock"==s||s.startsWith("Numpad")||(s="Numpad"+s);var r,u=this.Qe[s];if(u&&null!=u){var o=0;12&this.Ue&&(o|=2),3&this.Ue&&(o|=4),192&this.Ue&&(o|=1),256==this.Ue&&l?o=1:1==o&&256&this.Ue&&l&&(o=0),Bs.debug("keydown modifier="+o),0===o&&(o=0);var a=u[o];a&&a.type&&a.value&&(r=a)}r?4===r.type&&(r=new Pe(1,String.fromCharCode.apply(null,r.value))):r=new Pe(8,s),(!this.qe||this.Ye&&this.Ye.includes(r.value))&&(Bs.debug("keydown mapping result: type="+r.type+" value="+r.value),this.Ls(r,t),Bs.debug("keydown, modifier state is now "+this.Ue.toString(2)))},an.prototype._s=function(t){if(t&&"string"==typeof t){var i=t.toLowerCase();document.execCommand(i)}},an.prototype.Ks=function(t){hn("handleKeyCode")},an.prototype.Ws=function(t){var i=t.charCode;this.zs(i)},an.prototype.Gs=function(t){var i=t.charCodeAt(0);this.zs(i)},an.prototype.zs=function(t){hn("handleCharCodeInput")},an.prototype.qs=function(t){if(!this._e)return t;let i=t.trim().replace(/ {2,}/g,"\t");return i=i.replace(/ ([\+\-\.\d])/g,"\t$1"),i},an.prototype.js=function(t){return this._e?t.trim().replace(/\t/g," "):t},an.prototype.Zs=function(t,i){hn("autoType")},an.prototype.Js=function(t){if(this.Be&&this.ai){var i=this.ai._t(t.offsetX,t.offsetY);i.columns+1<=this.width&&(this.Zt=i.columns+1),i.rows+1<=this.height&&(this.jt=i.rows+1),this.ai.Kt()}},an.prototype.Xs=function(t){this.Be=!1},an.prototype.Ys=function(t){if(!0===this.Oe)this.Oe=!1,clearTimeout(this.$s);else{var i=this;if(this.$s=setTimeout((function(){!0===i.Be&&(i.Oe=!0)}),200),(2==t.button||2==t.buttons)&&this.tn||!this.ai)return;this.Be=!0;var e=this.ai._t(t.offsetX,t.offsetY);this.Gt=e.columns,this.qt=e.rows}},an.prototype.in=function(t,i,e,s){hn("handleClick")},an.prototype.en=function(t,i,e,s){hn("handleTripleClick")},an.prototype.sn=function(t){var i=t.offsetX,e=t.offsetY;if(Qs.debug("click "+t+", pos=("+i+","+e+")"),!1===this.Oe&&(this.Gt=null,this.qt=null,this.Zt=null,this.jt=null,this.nn&&(this.nn.style.display="none"),this.ai)){var s=this.ai._t(i,e);if(Qs.debug("click row,col = ",s),null!=s){var n=s.rows*this.width+s.columns;if("dblclick"==t.type){var l,h=this.Qe.ln;if(h&&null!=h){var r=0;12&this.Ue&&(r|=2),3&this.Ue&&(r|=4),192&this.Ue&&(r|=1),256==this.Ue?r=1:1==r&&256&this.Ue&&(r=0),Bs.debug("keydown modifier="+r),0===r&&(r=0);var u=h[r];u&&(l=u)}this.hn(i,e,s,n,l)}else 3==t.detail?this.en(i,e,s,n):this.in(i,e,s,n)}else Qs.warn("rejecting mouse event, type="+t.type+" because rowColumn == null")}},an.prototype.hn=function(t){hn("handleDoubleClick"),Qs.debug("dblclick "+t)},an.prototype.rn=function(t){e.debug("Received connected message from server"),this.Ze=2},an.prototype.un=function(t){this.Le.close(4001,"server sent close/error/exception message"),this.qe=!0},an.prototype.xs=function(){hn("handleResizeComplete")},an.prototype.on=function(t,i){return this.width*t+i},an.prototype.Ps=function(){var t=this.ti,i=this.Ds,e=this.an,s=this;t.tabIndex=0,t.contentEditable=!0;let n=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion),l=navigator.userAgent;var h,r=!1,u=!1;n&&(-1!==l.indexOf("Android")?r=!0:-1!==l.indexOf("iOS")&&(u=!0)),this.Hs={Vs:r,Qs:u},s.Fe.fill(null),document.addEventListener("copy",(function(t){if((document.activeElement==i||document.activeElement==e)&&!s.Ge){Qs.debug("Copy, box region start=("+this.Gt+","+this.qt+"), end=("+this.Zt+","+this.jt+")"),t.stopPropagation();let i=s.vs(!1,!0);i=s.qs(i),null!=i&&t.clipboardData.setData("text/plain",i),t.preventDefault(),a()}})),document.addEventListener("paste",(function(t){if((document.activeElement==i||document.activeElement==e)&&!s.Ge){Qs.debug("Paste, box region start=("+this.Gt+","+this.qt+"), end=("+this.Zt+","+this.jt+")"),t.stopPropagation(),Qs.debug("PASTE: Found types: ",t.clipboardData.types);let i=t.clipboardData.getData("text/plain");i=s.js(i),i&&!0===s.ms(i)&&t.preventDefault(),a()}}));var o=this;("Firefox"==navigator.appName||"Netscape"==navigator.appName)&&parseInt(navigator.appVersion,10)<52?(i.addEventListener("blur",(function(t){o.Ue&=256,o.ai&&(o.ai.hasFocus=!1,Qs.info("Terminal focus lost"),o.ai.Kt())})),i.addEventListener("focus",(function(t){o.ai&&(o.ai.hasFocus=!0,Qs.info("Terminal gained focus"),o.ai.Kt())}))):(i.addEventListener("focusout",(function(t){o.Ue&=256,o.ai&&(o.ai.hasFocus=!1,Qs.info("Terminal focus lost"),o.ai.Kt())})),i.addEventListener("focusin",(function(t){o.ai&&(o.ai.hasFocus=!0,Qs.info("Terminal gained focus"),o.ai.Kt())}))),i.addEventListener("compositionstart",(function(t){if(Qs.debug("Compositionstart: ",t),s.We=!0,!s.Ge){a();var e=Math.floor(s.zt/this.width),n=Math.floor(s.zt%this.width);i.style.top=e*(s.ai.ht/s.ai.et)+"px",i.style.left=n*(s.ai.lt/s.ai.it)+"px"}})),i.addEventListener("compositionupdate",(function(t){Qs.debug("Compositionupdate: data="+t.data),s.We=!0,s.Ge||(h=t.data,s.Fe.fill(null),s.cn(h))})),i.addEventListener("compositionend",(function(t){Qs.debug("Compositionend seen"),Qs.debug("Compositionend: "+JSON.stringify(t)+", data="+t.data),s.We=!1,s.Ge||(s.Fe.fill(null),h&&(s.Zs(h),i.value="",i.style.top="0px",i.style.left="0px"))})),i.addEventListener("unload",(function(t){s.closeConnection()}));var a=function(){s.Oe=!1;let t=s.Ds;t.value="",t.selectionEnd=0,t.selectionStart=0,s.Gt=null,s.qt=null,s.Zt=null,s.jt=null,s.ai&&s.ai.Kt()};i.addEventListener("wheel",(function(t){s.Ge?(Qs.debug("Script in progress: rejecting keydown"),t.stopPropagation(),t.preventDefault()):s.fn(t)})),i.addEventListener("keydown",(function(t){s.Ge?(Qs.debug("Script in progress: rejecting keydown"),t.stopPropagation(),t.preventDefault()):s.We||(i.value="",Qs.debug("Keydown: ",t),s.Os(t))})),i.addEventListener("keyup",(function(t){s.Ge?(Qs.debug("Script in progress: rejecting keyup"),t.stopPropagation(),t.preventDefault()):(a(),s.We||s.Ns(t))})),i.addEventListener("keypress",(function(t){s.Ge?(Qs.debug("Script in progress: rejecting keypress"),t.stopPropagation(),t.preventDefault()):s.qe?(Qs.debug("Screen locked by error occurrence"),t.stopPropagation(),t.preventDefault()):s.We||(i.value="",Qs.debug("Keypress: ",t),s.Os(t),t.stopPropagation(),t.preventDefault())})),(r||u)&&i.addEventListener("input",(function(){if(Qs.debug("Input event seen. value="+i.value+", textContent="+i.textContent),s.Ge)Qs.debug("Script in progress: rejecting input");else if(s.qe)Qs.debug("Screen locked by error occurrence: rejecting input");else{a();var t=i.value;if(t){i.value="",Qs.debug("Input was "+t),Qs.debug("Textcontent is now "+i.value);for(var e=0;e<t.length;e++)s.Gs(t.charAt(e))}Qs.debug("Empty input event ignored.")}})),i.addEventListener("mouseup",(function(t){s.Ge?Qs.debug("Script in progress: rejecting mouseup"):(Qs.debug("mouse event "+t+" target="+t.target),t.target.focus(),s.Xs(t))})),i.addEventListener("mousedown",(function(t){s.Ge?Qs.debug("Script in progress: rejecting mousedown"):(Qs.debug("mouse event "+t+" target="+t.target),t.target.focus(),s.Ys(t))})),i.addEventListener("mouseenter",(function(t){Qs.log(Qs.FINER,"mouse event "+t+" target="+t.target);let i=s.Ds;!s.We&&i&&i.value.length>0&&(i.value="",i.selectionEnd=0,i.selectionStart=0)})),i.addEventListener("mousemove",(function(t){s.Ge?Qs.log(Qs.FINER,"Script in progress: rejecting mousemove"):(Qs.log(Qs.FINER,"mouse event "+t+" target="+t.target),t.target.focus(),s.Js(t))})),t.addEventListener("click",(function(t){s.Ge?(Qs.debug("Script in progress: rejecting click"),t.stopPropagation()):(t.stopPropagation(),Qs.debug("click event "+t+" target="+t.target),t.target.focus(),s.sn(t))})),i.addEventListener("click",(function(t){s.Ge?(Qs.warn("Script in progress: rejecting click"),t.stopPropagation()):(Qs.debug("click event "+t+" target="+t.target),t.target.focus(),s.sn(t))})),i.addEventListener("dblclick",(function(t){s.Ge?(Qs.warn("Script in progress: rejecting dblclick"),t.stopPropagation()):s.qe?(Qs.warn("Screen locked by error occurrence: rejecting dblclick"),t.stopPropagation()):(t.stopPropagation(),Qs.debug("dblclick event "+t+" target="+t.target),!0===s.Oe&&(Qs.debug("dblclick set drag to false"),s.Oe=!1,clearTimeout(s.$s)),t.target.focus(),s.sn(t))})),i.addEventListener("contextmenu",(function(t){if(s.Oe=!1,s.Be=!1,s.tn&&t.shiftKey||!s.tn&&!t.shiftKey)s.Ge?(Qs.debug("Script in progress: rejecting contextmenu"),t.stopPropagation()):(Qs.debug("mouse event "+t+" target="+t.target),t.target.focus(),s.dn(t));else if(null!=s.Gt&&null!=s.Zt){let t=s.Ds;t&&(0==t.value.length&&(t.value="c"),t.select())}}))},an.prototype.toString=function(){return"<VirtualScreen size="+this.size+">"},an.prototype.wn=function(t){hn("processMessage")},an.prototype.An=function(){hn("getPos")},an.prototype.pn=function(t){return{row:Math.floor(t/(this.width+1))+1,column:Math.floor((t-1)%this.width)+1}},an.prototype.bn=function(t,i){return this.width*(t-1)+i},an.prototype.kn=function(t){return{row:Math.floor(t/(this.width+1)),column:Math.floor((t-1)%this.width)}},an.prototype.Cn=function(t,i){return this.width*(t-1)+(i-1)},an.prototype.mn=function(t){return{row:Math.floor(t/this.width)+1,column:Math.floor(t%this.width)+1}},an.prototype.vn=function(t,i){return this.width*t+(i+1)},an.prototype.Sn=function(t){return{row:Math.floor(t/this.width),column:Math.floor(t%this.width)}},an.prototype.gn=function(t,i){return this.width*t+i},an.prototype.En=function(){this.callbacks||(this.callbacks={}),this.callbacks.passwordPrompt||(this.callbacks.passwordPrompt=function(t){setTimeout((function(){let i=prompt("Script paused for password input. Enter password.");t(i)}),100)})},an.prototype.Ms=function(parentDiv,t){this.parentDiv=parentDiv;let i=parentDiv.id;var e=i+"Canvas";this.canvas=an.hs(e,parentDiv,t.width,t.height,1);var s=i+"SelectionCanvas";return this.ti=an.hs(s,parentDiv,t.width,t.height,2),this.ti.innerHTMLMessageLength=this.ti.innerHTML.length,this.Ds=an.Ts(i),parentDiv.appendChild(this.Ds),{canvas:this.canvas,ti:this.ti,yn:this.Ds}},cn.prototype.Dn=function(){if(this.ns&&this.ts.length>0){var t=ie(this.ts),i={t:this.ns,data:t};Os.debug("sending telnet options, dump follows"),Xi(this.ts,Os),null!=this.screen.Le&&this.screen.Le.send(JSON.stringify(i)),this.ts=[]}},we(Mn,an,[Mn.Ls,Mn.Ns,Mn.zs,Mn.Ks,Mn.in,Mn.hn,Mn.xs,Mn.Zs,Mn.$t,Mn.Cs,Mn.An,Mn.connect,Mn.vs,Mn.ms,Mn.ks,Mn.handleContainerResize]),Mn.ee=0,Mn.se=1,Mn.ne=2,Mn.le=3;const pn=/[`~!@#$%^&\*()+={}\[\];:\'<>?,]+/,bn=/[0-9a-zA-Z-_.\/]+/;Mn.Wi=66,Mn.zi=60,Mn.Gi=48,Mn.Rn=65;var kn=!1;const Cn=1,mn=2,vn=-1;function Sn(t){this.ji,this.Tn=65533,this.Mn,this.ie=Mn.ee,this.$i=0,this.re=Mn.ee,this.he=0,this.te,this.Zi=Mn.Wi,this.Ji=Mn.zi,this.ji=t}Mn.Pn=144,Mn.Fn="insert",Mn.xn="delete",Sn.prototype.In=function(){return 65533!=this.Tn?65533:this.ji};var gn=0;function En(t,i){this.elements=new Array(t),this.updated=!0,this.Nn,this.next,null==i&&(this.id=gn++)}const yn=function(t,i){var e=i;return t.length>0&&(e=Number(t)),e<i&&(e=i),e},Dn=function(t,i,e){let s=!1;for(let n=i;n>=0;n--)if(1===e[n]&&0==--t)return s=!0,n;if(!s)return 0},Rn=function(t,i,e){const s=t+i;return Math.max(Math.min(s,e-1),0)},Tn=function(t,i,e){const s=t+i;return Math.max(Math.min(s,e-1),0)};function Mn(t,i,s,n){this.Ze=0,this.canvas=null,this.ti=null,this.parentDiv=null,this.oiaEnabled=0,this.width=t,this.height=i,this.Me=$s.De,this.Pe=new on(this,this.width),this.Fe=new Array(this.height*t),this.ai=null,this.xe=t,this.Ie=i,this.Ne=[],this.Le=null,this.Ln=n,this.Ue=0,this.qt=null,this.Gt=null,this.jt=null,this.Zt=null,this.Be=!1,this.Oe=!1,this.Ve="rgb(255,255,255)",this.ds,this.He,this.Un,this.size=t*i,this.Bn=new Array(this.size),this.clear(),this.zt=0,this.On=0,this.Y=Mn.X,e.debug("charsetInfo = "+this.Y),this.Vn=s-i,this.Ee=s,this.Hn=0,this.me=0,this.Qn=[],this._n,this.Li=null,this.Kn=null,this.Wn=null,this.zn=0,this.Gn=!1,this.qn=0,this.jn=0,this.Zn=null,this.Jn=null,this.Xn=[],this.Yn=null,this.$n=!0,this.tl=!1,this.il=!1,this.el=!1,this.sl=0,this.nl=80,this.ll=24,this.hl=24,this.Qe=xe,this.rl=!1,this.ul=!1,this.te=0,this.ie=Mn.ee,this.$i=0,this.re=Mn.ee,this.he=0,this.ol=!1,this.al=!1,this.cl=0,this.fl=0,this.dl=!1,this.wl=Mn.Al(),this.pl=0,this.bl=1,this.kl=!1,this.Cl=0,this.termTypeString,this.termType=1,this.ml,this.vl=!1,this.Sl=!0,this.gl={status:!1,key:""},this._e=!0,this.El=!1,this.yl=null,this.Dl=null,this.Rl=!1,this.us(),this.fe=new Array(this.height),this.ge=0,this.Tl=!1,this.Ml=2,this.Pl=!1,this.Fl=!1,this.xl=!1,this.lineNumber=0,this.Yi=!0,this.Il=0,this.Nl=0,this.Ll=50,this.Ul=0,this.Bl=0,this.Ol=0,this.Vl=Mn.Hl(),this.Ql=0,this.Je=0,this._l=1,this.Kl=this.Wl(),this.zl=!1,this.Gl=!1,this.Wt=!0,this.Qt=null,this.ql=0,this.jl=0,this.ve=null,this.Zl=0,this.Jl=this.Jl.bind(this),this.Xl=!0,this.Yl=!0}function Pn(parentDiv,t,i){this.scrollPos=0,this.$l(parentDiv,t,i)}Mn.Hl=function(){return[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]},Mn.Al=function(){return[Mn.Wi,Mn.zi,Mn.Gi,Mn.Rn]},Mn.th=function(parentDiv,t,i){let e=document.createElement("div");return e.id=parentDiv.id+"innerScrolling",e.style.cssText=`position: absolute; top: 0px; left: 0px; opacity: 255; cursor: default;\n                             width: ${t}; height: ${i};`,e.style.zIndex=2,e.style.width=t+"px",e.style.height=i+"px",e},Pn.prototype.ih=function(t){let i=this.eh.scrollHeight-this.eh.clientHeight;-1==t||t>i?(this.scrollPos=i,this.eh.scrollTop=i):(this.scrollPos=t,this.eh.scrollTop=t)},Pn.prototype.sh=function(){return this.eh},Pn.prototype.nh=function(parentDiv){if(this.Ln||this.eh)try{this.eh.removeChild(this.Ln),parentDiv.removeChild(this.eh),this.Ln=null,this.eh=null}catch(t){e.severe("Could not remove scrolling div from parent="+parentDiv)}},Pn.prototype.$l=function(parentDiv,t,i){this.eh=document.createElement("div"),this.eh.id=parentDiv.id+"scrollingDiv",this.eh.style.cssText=`position: absolute; top: 0px; left: 0px; opacity: 0; cursor: default;\n                                   overflow-y: scroll;\n                                   width: ${t}; height: ${i};`,this.eh.style.zIndex=1,this.eh.style["background-color"]="white",this.eh.style.width=t+"px",this.eh.style.height=i+"px",this.lh=i,this.hh=i,this.Ln=document.createElement("div"),this.Ln.id=this.eh.id+"Inner",this.Ln.style.cssText="position: absolute; top: 0px; left: 0px; opacity: 0; cursor: default;\n                                   width: 90%;",this.Ln.style.height=i+"px",this.Ln.style.zIndex=1,this.eh.appendChild(this.Ln)},Pn.prototype.resize=function(t,i){this.eh.style.width=t,this.eh.style.height=i,this.eh.style["overflow-y"]="scroll",this.Ln.style.width="90%";let e=this.hh/this.lh*i;this.Ln.style.height=e,this.lh=i,this.hh=e},Pn.prototype.rh=function(){return this.scrollPos},Pn.prototype.An=function(){return this.eh.scrollTop},Pn.prototype.uh=function(){this.scrollPos=this.eh.scrollTop},Pn.prototype.oh=function(t){return t/this.ah},Pn.prototype.fh=function(t,i){let e=t*i;this.ah=t,this.Ln&&(this.Ln.style.height=e+"px",this.hh=e,this.uh())},Mn.prototype.Wl=function(){let t=new Array(Mn.Pn);for(let i=0;i<Mn.Pn;i++)t[i]={elements:new Array};return t},Mn.prototype.dh=function(t){const i=parseInt(Mn.Pn/this.height);return Math.min(Math.max(1,t),i)},Mn.prototype.wh=function(){return(this.dh(this._l)-1)*this.height},Mn.prototype.Ah=function(){let t=this.wh(),e=this.Li;for(i=0;i<this.height&&e;i++)e.elements&&(this.Kl[t+i].elements=JSON.parse(JSON.stringify(e.elements))),e=e.next},Mn.prototype.ph=function(t){let i=this.wh();var e=this.Li;for(let t=0;t<this.height;t++){e||(this.bh(),e=this.Jn);let s=this.Kl[i+t].elements||[];e.elements=s,e.updated=!0,e.kh=!1,e=e.next}},Mn.prototype.Ch=function(){(null!==this.yl&&null!==this.Dl&&this.yl>=this.Dl||this.yl>=this.height||this.Dl>this.height)&&(this.yl=0,this.Dl=this.height-1)},Mn.prototype.mh=function(t){const i=t||this.height;this.Ee=this.vh?this.Vn+i:i},Mn.prototype.Sh=function(t,i,e){let s=this.Kn&&this.Kn.Nn?this.Kn.Nn:null;const n=i?this.gh():0,l=i?this.me:0;if((t=this.dh(t))!==this._l||e){if(e){this.hl=e;const i=this.height;let s=this.gh();if(this.Eh(i-1),e<=i){let t=i-e;for(;t>0;)this.Jn=this.Jn.Nn,this.qn--,this.jn--,t--;s>e&&(this.zn=e)}this.mh(e),this.resize(this.width,e,!0),this.Ch(),e>i&&this.Eh(e-1),t=this.dh(t)}this._l=t}this.ph(s),this.yh(n,l)},Mn.prototype.Dh=function(t,e,s,n,l,h,r,u){let o=(this.dh(l)-1)*this.height,a=(this.dh(u)-1)*this.height;var c=new Array(Mn.Pn);for(let t=0;t<Mn.Pn;t++)c[t]={elements:new Array(this.width)};var f=s-t+1;for(h+f>this.height&&(f=this.height-h+1),i=0;i<f&&this.Kl[o+t-1+i].elements;i++)c[a+h-1+i].elements.splice(r-1,n-e+1,...this.Kl[o+t-1+i].elements.slice(e-1,n)),c[a+h-1+i].elements.length=this.width;for(i=0;i<f&&c[a+h-1+i].elements;i++)this.Kl[a+h-1+i].elements.length<this.width&&(this.Kl[a+h-1+i].elements.length=this.width),this.Kl[a+h-1+i].elements.splice(r-1,n-e+1,...c[a+h-1+i].elements.slice(r-1,r+n-e)),this.Kl[a+h-1+i].elements.length=this.width},Mn.prototype.Rh=function(parentDiv){if(this.Qt){let t=this.Qt.parentNode;t.removeChild(this.Qt),parentDiv.removeChild(t)}},Mn.prototype.ks=function(parentDiv){this.Th?(this.Th.nh(parentDiv),parentDiv.removeChild(this.Ds),this.Ln.removeChild(this.canvas),this.Ln.removeChild(this.ti),this.Rh(this.Ln),parentDiv.removeChild(this.Ln)):(parentDiv.removeChild(this.Ds),parentDiv.removeChild(this.canvas),parentDiv.removeChild(this.ti),this.Rh(parentDiv))},Mn.prototype.Jl=function(t){var i=!1;if(this.ai)if(i)t.preventDefault();else{this.Mh=-1,i=!0;try{this.Ph(t.target.scrollTop)}catch(t){console.log(t.stack?t.stack:t.message)}finally{i=!1}}},Mn.prototype.Fh=function(){this.Th.sh().addEventListener("scroll",this.Jl)},Mn.prototype.Ph=function(t){const i=this.Th,e=i.hh-i.lh,s=Math.max(this.qn,this.jn)-this.height;let n=Math.max(0,Math.round(t*s/e)),l=this.Zn;for(;n>=0;)this.Li=l,l=l.next,n--;this.rl&&(this.rl=!1,this.Kn=this.Li),this.qt=n,this.jt=n+this.height,this.ai.de(n),i.uh()},Mn.xh=function(t,i){clearTimeout(Mn.Ih),Mn.Ih=setTimeout(t,i)},Mn.Nh=function(t,i){clearTimeout(Mn.Lh),Mn.Lh=setTimeout(t,i)},Mn.Uh=function(t,i){clearTimeout(Mn.Bh),Mn.Bh=setTimeout(t,i)},Mn.prototype.handleContainerResize=function(parentDiv,t,i){Mn.Uh(()=>{this.Oh(parentDiv,t,i)},10)},Mn.prototype.Oh=function(parentDiv,t,i){let s,n,l;e.info("handling resize"),clearTimeout(rn),this.kl?(n=parentDiv.clientHeight||this.He.height,s=parentDiv.clientWidth||this.He.width,l=Mn.Vh(this.He,parentDiv,s,n)):(s=t||parentDiv.clientWidth,n=i||parentDiv.clientHeight),0!==n&&null!=n||(n=this.He.height),null==this.Hh&&(this.Hh=this.Th?this.Th.An():0);const h=parentDiv.style.zIndex||0;this.ks(parentDiv),this.ai&&this.ai.clear(),e.info("resize w="+s+" h="+n);let r=this.Qh(n,this.height,this.ql);if(this.vh){let t=this.Th;t.$l(parentDiv,s,n),s-=15;let i=Mn.th(parentDiv,s,n);this.Ln=i,parentDiv.appendChild(t.sh()),parentDiv.appendChild(i),this.Ms(i,{width:s,height:r}),this.parentDiv=parentDiv,i.style.position="absolute",this.Fh(),0!==this.ql&&this._h(r,this.ql),"-1"===h&&(this.parentDiv.style.zIndex=h,this.Ln.style.zIndex=h,this.ti.style.zIndex=h,t.eh.style.zIndex=h)}else this.Ms(parentDiv,{width:s,height:r}),0!==this.ql&&this._h(r,this.ql);this.Ps(),this.ai&&(this.ai.canvas=this.canvas,this.kl?(this.width=l.width,Mn.xh(()=>{this.Rt(l.height)},10)):this.ai.Rt(),this.Fs(this.He),this.ai.Tt()),this.vh&&(this.Th.sh().style.opacity="255"),this.Th&&!this.kl&&Mn.Nh(()=>{this.rl=!0,this.Kh()},10);var u=this;rn=setTimeout(()=>{u.xs()},200)},Mn.prototype.dn=function(t){t.preventDefault()},Mn.prototype.Ce=function(){if(!this.Li||!this.Wn)return-1;let t=this.height,i=this.Li,e=this.Wn.id;for(let s=0;s<t;s++){if(!i)return-1;if(i.id===e)return s;i=i.next}return-1},Mn.prototype.Wh=function(){return 1},Mn.prototype.connect=function(t,i){if(0===this.Ze){this.Ze=1;let n=this;var e=new WebSocket(t);Os.debug("websocket url: "+t),n.Le=e,e.onopen=function(){if(i.host&&i.port){var t={t:"CONFIG",host:i.host,port:Number(i.port)};1===i.security?t.security={t:"ssh",termt:n.termTypeString,termr:n.height,termc:n.width,badCert:i.zh}:2===i.security?(Os.warn("We dont support TLS yet. Try SSH!"),e.close()):0!=i.security&&(Os.info("Unknown security type requested!"),e.close()),e.send(JSON.stringify(t)),Os.debug("Sent ",t)}};var s=!1;e.onmessage=function(t){var i=JSON.parse(t.data);if(Os.log(Os.FINER,"ws.onMessage ",i),null!=n.ai){var e=9;n.Pe.Te[e++]=88,n.Pe.Te[e++]=St[0],n.Pe.Te[e++]=St[1],n.Pe.Te[e++]=St[2],n.ai.Kt()}n.wn(i),s||(s=!0,n.callbacks&&n.callbacks.readyCallback&&n.callbacks.readyCallback.apply(this,null))},e.onerror=function(t){n.callbacks&&n.callbacks.unexpectedErrorConnectionHook?n.callbacks.unexpectedErrorConnectionHook(n,t):(n.cs(t),e=null)},e.onclose=function(t){n.callbacks&&n.callbacks.unexpectedCloseConnectionHook?n.callbacks.unexpectedCloseConnectionHook(n,t):(n.ws(t),e=null)}}},Mn.Gh=function(t){switch(t.termType){case 1:t.qh=Ni;break;default:t.qh=Ii}},Mn.jh=function(t){switch(t.termType){case 1:t.termTypeString="xterm";break;case 2:t.termTypeString="vt220";break;case 0:t.termTypeString="vt320";break;case 3:t.termTypeString="vt420"}},Mn.prototype.$t=function(){var t,i=this.Pe.Te,e=this.me+1,s=(this.gh()+1).toString(),n=e.toString(),l=76;i[l--]=47;for(var h=2;h>-1;h--)s.length<h?i[l--]=32:(t=s.charAt(h))&&(i[l--]=t.charCodeAt(0));for(l=79,h=2;h>-1;h--)n.length<h+1?i[l--]=32:(t=n.charAt(h))&&(i[l--]=t.charCodeAt(0));return this.Me==$s.De&&0!=this.ds.security&&(i[3]=43),i},Mn.prototype.fn=function(t){const i=this.Th;if(!i)return;const e=0===t.deltaMode?t.deltaY:t.deltaY*i.ah,s=Math.max(i.An()+e,0);i.ih(s)},Mn.prototype.en=function(t,i,e,s){var n=e.rows,l=e.columns;let h=this.Li;if(n<0||n>this.height||l<0||l>this.width)Qs.warn("clicking out of bound "+e);else{for(let t=0;t<n;t++){if(!h)return void Qs.warn("clicking out of bound "+e);h=h.next}h&&(this.qt=n,this.jt=n+1,this.Gt=0,this.Zt=this.width,this.ai&&this.ai.Kt())}},Mn.prototype.hn=function(t,i,e,s){var n=e.rows,l=e.columns;let h=this.Li;if(n<0||n>this.height||l<0||l>this.width)Qs.warn("clicking out of bound "+e);else{for(let t=0;t<n;t++){if(!h)return void Qs.warn("clicking out of bound "+e);h=h.next}if(h){this.qt=n,this.jt=n+1;var r=this.Zh(h),u=r.charAt(l),o=l,a=l;if(" "==u){for(;" "==r.charAt(o--););for(;" "==r.charAt(a++););}else if(null!=u.match(pn)){for(;null!=r.charAt(o--).match(pn););for(;null!=r.charAt(a++).match(pn););}else if(null!=u.match(bn)){for(;null!=r.charAt(o--).match(bn););for(;null!=r.charAt(a++).match(bn););}o++,a--,this.Gt=o+1,this.Zt=a,this.ai&&this.ai.Kt()}}};var Fn=function(t,i){t||(t={fontProperties:{scaleMethod:2}});var e=t.fontProperties.size?t.fontProperties.size:Fs.fontSize,s=t.fontProperties.weight?t.fontProperties.weight:Fs.fontWeight,n=t.fontProperties.style?t.fontProperties.style:Fs.fontStyle,l=t.fontProperties.name?t.fontProperties.name:Fs.J,h=i.getContext("2d");h.font=n+" "+s+" "+e+"px "+l;var r=e,u=h.measureText("M").width,o=Math.floor(i.width/u);return{rows:Math.floor(i.height/r),columns:o}};Mn.prototype.Jh=function(t){let i=t.Nn;i&&(i.next=t.next),t.next&&(t.next.Nn=i),t.id==this.Zn.id&&(this.Zn=this.Zn.next),t.id==this.Kn.id&&(this.Kn=this.Kn.next)},Mn.prototype.Xh=function(t,i,e,s,n){let l=null!=this.yl?this.Yh(this.yl):null;for(var h=t+e>this.height?this.height-1-e:t,r=this.Yh(s),u=0;u<h;u++){if(null!=r){var o=new En(this.width);r.next?r.next.Nn=o:r.id===this.Jn.id&&(this.Jn=o),o.Nn=r,o.next=r.next,r.next=o,r=o}var a;i.next?a=i.next:(a=new En(this.width),i.next=a,a.Nn=i,this.$h(!0)),i.id!=this.Kn.id||l&&i.id==this.Kn.id&&l.id==this.Kn.id?this.Jh(i):i.id==this.Kn.id&&(this.Ee<=this.height||this.jn>=this.Ee?this.Kn.id==this.Zn.id?this.Jh(this.Kn):(this.Jh(this.Zn),this.Kn=this.Kn.next):(this.Kn=this.Kn.next,this.$h(!1))),i=a,n&&(this.Wn=i)}},Mn.prototype.tr=function(t){this.jn--,this.qn--,t&&this.zn--},Mn.prototype.$h=function(t){this.jn++,this.qn++,t&&this.zn++},Mn.prototype.ir=function(t,i,e,s,n){for(var l=t+e>this.height?this.height-1-e:t,h=this.Yh(s),r=0;r<l;r++){h.id===this.Jn.id&&(this.Jn=h.Nn),h.Nn.next=h.next,h=h.Nn;var u=new En(this.width);i.Nn?i.Nn.next=u:this.Zn=u,this.Kn.id==i.id&&(this.Kn=u,this.Li=this.Kn),u.Nn=i.Nn,u.next=i,i.Nn=u,i=u,n&&(this.Wn=u)}},Mn.prototype.Ss=function(t,i,e,s,n,l,h,r){var u=[],o=this.Li;let a=-1!==navigator.userAgent.indexOf("Windows");if(e>=0)for(var c=0;c<e;c++){if(!o)return"";o=o.next}else for(c=0;c>e;c--){if(!o)return"";o=o.Nn}for(var f=e;f<s;f++){h||f==e||(a&&u.push(13),u.push(10));var d=i,w=t;r&&f!=s-1&&(d=this.width),r&&f!=e&&(w=0);for(var A=w;A<d;A++)if(null!=o){var p=o.elements[A];if(p&&0!=(64&p.te))u.push(32);else if(p||!0!==l){var b=p.ji;(!b||b<32)&&!0===l?u.push(32):u.push(b)}else u.push(32)}else u.push(32);o&&(o=o.next)}return String.fromCharCode.apply(null,u)},Mn.prototype.er=function(t,i,e,s){let n=[],l=this.ve;const h=void 0===i?this.Zl||0:Math.max(0,t-1),r=void 0===i?h+t:Math.max(t,Math.min(i,this.width));for(let t=h;t<r;t++){if(null==l){n.push(32);continue}let i=l.elements[t];if(i&&0!=(64&i.te))n.push(32);else if(i||!0!==s){let t=i.ji;(!t||t<32)&&!0===s?n.push(32):n.push(t)}else n.push(32)}return String.fromCharCode.apply(null,n)},Mn.prototype.vs=function(t,i,e){if(null!=this.Gt&&null!=this.Zt){this.qt=this.qt>this.jt?this.qt+1:this.qt,this.Gt=this.Gt>this.Zt?this.Gt+1:this.Gt;var s=Math.min(this.Gt,this.Zt),n=Math.max(this.Gt,this.Zt),l=Math.min(this.qt,this.jt),h=Math.max(this.qt,this.jt);return this.Ss(s,n,l,h,t,i,e)}return null},Mn.prototype.ms=function(t){if(this.Wn&&t){for(var i=[],e=0;e<t.length;e++)i.push(t.charCodeAt(e));return this.sr(i),!0}return!1},Mn.prototype.nr=function(){var t=(65280&this.width)>>8,i=255&this.width,e=(65280&this.height)>>8,s=255&this.height;this.lr(31,[t,i,e,s])},Mn.prototype.hr=function(){var t={t:"SSH_CH_REQ",reqt:"window-change",reply:!1,data:[this.width,this.height,this.canvas.width,this.canvas.height]};1===this.Le.readyState&&this.Le.send(JSON.stringify(t))},Mn.prototype.Rt=function(t){const i=this.height,e=this.gh(),s=this.rr(),n=this.Jn,l=this.qn,h=null!=this.Dl&&this.Dl!==this.height-1,r=!h&&(l<i||!this.Th)||h&&(e<this.Dl||0===e),u=(t,i)=>{for(;t>0;)this.ur(i),t--},o=(()=>!this.or&&this.Dl||this.or&&this.Dl&&e<=this.Dl?Math.min(t-1,this.Dl):t-1)();if(this.mh(t),this.Zn=this.Zn||this.Kn,t>i&&t>e)u(t-s,!0),this.Jn=r?n:this.Yh(o);else if(t<i&t>e)u(t-s,!1),this.qn-=i-t,this.jn=this.qn,this.zn=Math.max(e,Math.min(t,s)),this.Jn=r?n:this.Yh(o);else if(t<i&t<e){let s=e-t;for(;s>=0;)this.Kn=this.Kn.next,this.Li=this.Kn,s--;this.zn=t,this.qn-=i-e-1,this.jn=this.qn,this.Jn=r?n:this.Yh(o)}if(this.qn<e&&(this.qn=e+1,this.jn=this.qn),this.Th&&this.qn>this.Ee){let t=this.qn-this.Ee;for(this.qn=this.Ee,this.jn=this.qn;t>0;)this.Zn=this.Zn.next,t--}this.Jn&&this.Jn.next&&(this.Jn.next=null),this.rl=!0,this.resize(this.width,t,!0),this.Ch(),this.height=t,this.Kh()},Mn.prototype.xs=function(){if(Qs.debug("Resize completed"),this.vl){var t=Fn(this.He,this.ti),i=!1;t.rows<this.height&&(Qs.debug("Resizing, old height was "+this.height+", new height will be "+t.rows),i=!0),this.vh?this.Ee=this.Vn+t.rows:this.Ee=t.rows,this.resize(t.columns,t.rows,!0),this.Kn&&Qs.debug("After resize, scrolling viewport to bottom. Top ID="+this.Kn.id),this.ar(1),this.Li=this.Kn,this.Kn&&Qs.debug("Scroll complete. Top ID="+this.Kn.id),this.vh&&(this.Th.sh().scrollTop=this.Th.sh().scrollHeight,this.Th.scrollPos=this.Th.sh().scrollTop),1!=this.ds.security?this.nr():this.hr(),i&&this.Li&&(Qs.debug("After resize, scrolling viewport to bottom. Top ID="+this.Li.id),this.ar(1),Qs.debug("Scroll complete. Top ID="+this.Li.id))}},Mn.prototype.in=function(t,i,e,s){Qs.debug("VT click encountered")},Mn.prototype.Fs=function(t){null!=t&&this.ai.Dt(this.He.fontProperties),this.ai.Tt()},Mn.prototype.cr=function(t){return!this.Zn||(null==t&&(t=this.gh()),this.Wn.id==this.Jn.id||this.or&&t==this.Dl)},Mn.prototype.dr=function(){return!this.Zn||this.Wn.id==this.Zn.id},Mn.prototype.bh=function(t){if(Vs.log(Vs.FINEST,"Addline entry. IL ID="+(null==this.Wn?null:this.Wn.id)+", TT ID="+(null==this.Kn?null:this.Kn.id)+", Buff lines="+this.jn),this.wr())return;var i=new En(this.width);const e=this.gh();return this.Rl=this.Ar(e),null==this.Zn?(this.Zn=i,this.Jn=i,this.Kn=i,this.Li=i,this.Wn=null,this.lineNumber=0,this.$h(!0)):(this.Th&&this.jn>=this.Ee&&!t&&this.zn>this.height?1===this.Ee?(this.Zn=i,this.Jn=i,this.Kn=i,this.Li=this.Kn):2===this.Ee?(this.Zn=this.Zn.next,this.Zn.Nn=null,this.Zn.next=i,i.Nn=this.Zn,this.Kn=this.Zn,this.Li=this.Kn,this.Jn=i):this.Ee<=this.height?(this.Zn=this.Zn.next,this.Kn=this.Zn,this.Li=this.Kn,this.Zn.Nn=null,this.Jn.next=i,i.Nn=this.Jn,this.Jn=i):(this.Zn=this.Zn.next,this.Zn.Nn=null,!t&&(this.zn>=this.height||this.Rl&&e===this.Dl)?(this.pr(i,e===this.Dl),this.br()):(this.Jn.next=i,i.Nn=this.Jn,this.Jn=i,this.Kn=this.Kn.next,this.Li=this.Li.next)):!t&&(this.zn>=this.height||this.Rl&&e===this.Dl)?(this.pr(i,e===this.Dl),this.br()):(i.Nn=this.Jn,this.Jn.next=i,this.Jn=i,this.$h(!0)),this.lineNumber++,this.lineNumber++),this.Th&&(this.Ee<this.jn||this.Ee<this.qn)&&(this.Zn=this.Zn.next,this.qn=Math.min(this.Ee,this.qn),this.jn=Math.min(this.Ee,this.jn)),this.Wn=i,this.me=0,this.Kh(),Vs.log(Vs.FINEST,"-- Addline exit. IL ID="+(this.Wn||{}).id+", TT ID="+(this.Kn||{}).id+", Buff lines="+this.jn),i},Mn.prototype.pr=function(t,i){if(i&&this.Dl<this.height-1&&this.Wn){let i=this.Wn;t.Nn=i,t.next=i.next,i.next=t,this.Jn&&this.Jn.id===i.id&&(this.Jn.next=t,this.Jn=t)}else t.Nn=this.Jn,this.Jn.next=t,this.Jn=t},Mn.prototype.kr=function(){if(!this.Kn)return null;let t=this.Kn;for(let i=0;i<this.yl;i++){if(!t.next){t=null;break}t=t.next}return t},Mn.prototype.br=function(){if(this.Rl&&this.yl>0&&this.kr()){let t=this.Kn.Nn,i=this.kr();t&&(t.next=i),this.Kn.Nn=i;let e=i.Nn;e.next=i.next,i.next.Nn=e,i.Nn=t,i.next=this.Kn,this.Zn.id===this.Kn.id&&(this.Zn=i),this.qn<this.height&&this.Eh(this.height-1)}else this.Kn=this.Kn.next,this.Li=this.Kn;this.$h(!1)},Mn.prototype.Cr=function(t){return!this.Dl||(void 0===t&&(t=this.gh()),t>=this.yl&&t<=this.Dl)},Mn.prototype.Ar=function(t){return!!this.Dl&&(void 0===t&&(t=this.gh()),t>=this.yl&&t<=this.Dl)},Mn.prototype.Zh=function(t){var i="";if(void 0!==t.elements)for(var e=0;e<t.elements.length;e++)if(null!==t.elements[e]&&void 0!==t.elements[e]){var s=String.fromCharCode(t.elements[e].ji);i+=null===s||" "===s?" ":s}else i+=" ";return i},Mn.prototype.cn=function(t){this.We=!1,"Delete"!==this.mr&&"Backspace"!==this.mr&&this.zs(t.charCodeAt(t.length-1))},Mn.prototype.Cs=function(t){this.me=0,t?(this.Kn=null,this.Li=null,this.Wn=null,this.zn=0,this.jn=0,this.Zn=null,this.Jn=null,this.ge=0):this.vr()},Mn.prototype.Sr=function(){return null!=this.yl?this.Yh(this.yl):this.Kn},Mn.prototype.gr=function(){return null!=this.Dl?this.Yh(this.Dl):this.Yh(this.height-1)},Mn.prototype.Er=function(t){let i=t;const e=this.gh();for(;i>0;)this.yr(),i--;this.Wn=this.Yh(e)},Mn.prototype.Dr=function(t){let i=t;const e=this.gh();for(;i>0;)this.Rr(),i--;this.Wn=this.Yh(e)},Mn.prototype.Rr=function(t){const i=null!=this.Dl,e=this.Zn.id===this.Kn.id,s=this.me,n=new En(this.width),l=t||this.Sr(),h=l.Nn,r=this.gr(),u=!t||t.id===this.Kn.id,o=!i&&u||i&&(t?u:0===this.yl);h?(n.Nn=h,h.next=n,n.next=l,l.Nn=n):(n.next=l,l.Nn=n),this.me=s,this.Jh(r),o&&(this.Kn=n,this.Li=n,this.Zn=e?n:this.Zn),this.Jn.id===r.id&&(this.Jn=r.Nn)},Mn.prototype.yr=function(t){const i=null!=this.Dl,e=this.Zn.id===this.Kn.id,s=this.me,n=new En(this.width),l=t||this.Sr(),h=this.gr(),r=!t||t.id===this.Kn.id;n.Nn=h,n.next=h.next,h.next=n,this.me=s,this.Jh(l),(!i&&r||0===this.yl)&&(this.Li=this.Kn,this.Zn=e?this.Kn:this.Zn),this.Jn.id===h.id&&(this.Jn=n)},Mn.prototype.Tr=function(t,i){let e=this.lineNumber;const s=this.gh();for(let s=0;s<t;s++){if(i&&null!=this.yl&&(e<this.yl||e>this.Dl)){Vs.debug("-- DL: deleteLine range is out of current cursor position");break}this.yr(i),i=i.next,e++}this.Wn=this.Yh(s)},Mn.prototype.Mr=function(t,i){let e=this.lineNumber;const s=this.gh();for(let s=0;s<t;s++){if(i&&null!=this.yl&&(e<this.yl||e>this.Dl)){Vs.debug("-- DL: deleteLine range is out of current cursor position");break}let t=i||this.Eh(e);this.Rr(t),i=i.Nn,e++}this.Wn=this.Yh(s)},Mn.prototype.Ks=function(t){Qs.debug("Handlekeycode hit")},Mn.prototype.zs=function(t){if(Bs.debug("keypress, charCode="+t),160==t&&(t=32),t>=32&&t<127){if(Bs.debug("normal press code=0x"+Ji(t)),this.Ul===Hi)return void this.Xn.push(t);this.sr([t])}else Bs.debug("Unhandled key press 0x"+Ji(t)),this.ls()},Mn.prototype.clear=function(){this.Th?this.Cs(!1):this.Cs(!0),Vs.debug("Clear: should have cleared screen")},Mn.prototype.bs=function(){this.Th&&this.Th.eh&&this.Th.eh.removeEventListener("scroll",this.Jl),Vs.debug("unbind: should unbind event")},Mn.prototype.sr=function(t){if(this.Pl&&t){var i={t:"TELNET_DATA",B64:ie(t)};Os.debug("Sending local echo message"),this.wn(i)}0===this.Ul&&this.Pr(t)},Mn.prototype.Zs=function(t,i){var s=i?t.substring(0,i):t,n=[];for(let t=0;t<s.length;t++){var l=s.charCodeAt(t);if(!(l>=32&&l<127))return e.info("Invaid ASCII input="+s.charAt(t)),!1;n.push(l)}return this.Ul===Hi&&(this.Xn=n),n.length>0?(this.sr(n),!0):(e.info("0 length bufer found for autotype"),!0)},Mn.prototype.Fr=function(){let t=this.xr()-1,i=this.Ir();t<0&&(i.elements.splice(0,0,null),i.elements.pop(),t=0),this.wr()?this.Zl=t:this.me=t,this.Nr(t)},Mn.prototype.Lr=function(t){Bs.debug("keypress, charCode="+t);var i=xi[t];i?this.sr(i):(Bs.debug("Unhandled key press 0x"+Ji(t)),this.ls())},Mn.prototype.Ur=function(t,i){if(this.Tl)Bs.warn("Keyboard Locked: Cannot accept input at this time");else{if(this.mr="Process"===t.value?i.code:t.value,8===t.type&&3&this.Ue&&1===t.value.length){var e=t.value.charCodeAt(0);Bs.debug("Executing alt keypress for keycode="+e);var s=[27,e];this.sr(s)}else if(2===t.type||8===t.type){let e=t.value;if(1!=e.length)return;3===i.location&&this.Br?this.Lr(e):this.zs(e.charCodeAt(0))}else{if(64!==t.type)return;this.Or(t.value,i.location)}i.stopPropagation(),i.preventDefault()}},Mn.prototype.Ls=function(t,i){[Vi,Hi].indexOf(this.Ul)>-1&&["Cursor Down","Cursor Up"].indexOf(t.value)>-1?console.log("don't handle cursor up and cursor down when input username/password"):(this.gl.key!==i.code&&(this.gl.key=i.code,this.gl.status=!1),this.Sl||!this.El||"virtualKey"===i.code?this.Ur(t,i):this.gl.status||(this.gl.status=!0,this.Ur(t,i)))},Mn.prototype.Is=function(t){this.gl.status=!1},Mn.Vr=function(t){return t.push(27),t.push(91),t.push(56),t.push(109),t},Mn.prototype.Hr=function(){let t=this.xr()+1,i=this.Ir();t>this.width-1&&(i.elements.push(null),i.elements.shift(),t=this.width-1),this.wr()?this.Zl=t:this.me=t,this.Nr(t)},Mn.Qr=function(t){return t.push(27),t.push(91),t.push(48),t.push(109),t},Mn.prototype._r=function(){if(this.username){for(var t=this.username+"@"+this.ds.host+"'s password: ",i=[13,10],e=0;e<t.length;e++)i.push(t.charCodeAt(e));Mn.Vr(i);var s=ie(i);this.Bl=t.length,this.Ol=t.length,this.Ul=Hi,this.wn({t:"TELNET_DATA",B64:s})}},Mn.prototype.Or=function(t,i){var e,s;if(("Delete"===t||"Backspace"===t)&&0!=this.Ul)return this.Ul===Hi?void this.Xn.pop():(this.Kr(),this.ai.de(),!0);if("Enter"===t){if(Vs.debug("Handling enter, input state=0x"+Ji(this.Ul)),this.Ul===Vi){var n=[];for(let t=10;t<this.me;t++){let i=this.Wn.elements[t];i&&i.ji&&n.push(i.ji)}return this.Xn=[],this.username=String.fromCharCode.apply(null,n),this._r(),!0}if(this.Ul===Hi){const t=String.fromCharCode(...this.Xn);var l=ie([13,10,27,91,48,109]);return this.wn({t:"TELNET_DATA",B64:l}),this.Pl=this.Fl,this.Ul=0,this.Ol=0,this.Le.send(JSON.stringify({t:"SSH_USER_AUTH_RES",m:"password",u:this.username,p:t})),!0}if(3===this.Ul){var h=this.Wr[this.zr-1].length,r=[],u=this.Wn;let t;for(let i=h;i<this.width&&(t=u.elements[i],t&&t.ji);i++)r.push(t.ji);if(this.Gr.push(String.fromCharCode.apply(null,r)),this.zr>=this.Wr.length)this.Ul=0,this.Pl=this.Fl,this.Le.send(JSON.stringify({t:"SSH_USER_AUTH_INFO_RES",res:this.Gr}));else{var o=this.Wr[this.zr++],a=[13];o.e&&Mn.Vr(a);var c=o.s;for(let t=0;t<c.length;t++)a.push(c.charCodeAt(t));o.e&&Mn.Qr(a)}return!0}if(0===this.Ul)return this.Br&&3==i?this.sr([27,79,77]):this.xl?this.sr([13,10]):this.sr([13]),!0}else{var f;if(e=Fi[t])return!!(f=this.qr?e[2]:this.fl?e[1]:e[0])&&(this.sr(f),!0);if(null!=(s=ht[t])&&16&s)return this._s(t),!0;if(this.qh){"Backspace"==t&&this.Yl&&(t="Delete");var d=this.qh[t];if(null!=d)return this.sr(d),!0}}return Bs.warn("Unhandled VT function="+t),!1},Mn.prototype.jr=function(t){if(this.Li){let i,e=0;-1==t?(i=0,t=1):i=1;for(let s=0;s<t&&this.Li.Nn;s+=i)this.Li=this.Li.Nn,e++;this.qt+=e,this.jt+=e,this.ai&&this.ai.de(e)}},Mn.prototype.ar=function(t){let i,e=Math.min(Math.abs(t)),s=this.Li;for(let t=0;t<this.height&&s;t++)s.next&&(s=s.next);1==e?(i=0,e=-1):i=1;let n=0;for(let t=0;t<e;t+=i){if(this.Li.id===this.Kn.id)return;if(this.Li=this.Li.next,n--,!s||!s.next)break;s=s.next}this.qt+=n,this.jt+=n,this.ai&&this.ai.de(n)},Mn.prototype.Zr=function(){for(var t=this.Li,i=0,e=0;e<this.height&&t.next;e++)t=t.next,i++;if(i<this.height-1)return this.zn=i,!0;for(;t;)this.Li=this.Li.next,t.updated=!0,this.Jn=t,t=t.next;return this.zn=this.height,!0},Mn.Jr=function(t,i,e){for(var s,n=t,l=i;l<e.elements.length;l++)s=e.elements[l],e.elements[l]=n,n=s},Mn.prototype.Xr=function(){return this.yl?this.yl+1:1},Mn.prototype.Yr=function(t){const i=this.wr(),e=this.xr();if(Vs.log(Vs.FINEST,"insertChar: "+t+" - posInLine="+e+"  width="+this.width+"glidx=0x"+Ji(this.pl)+" gridx=0x"+Ji(this.bl)),null==this.Ir())this.wr()||this.Cs(!0),this.bh();else if(e>=this.width){if(!this.il)return void Vs.debug("No implicit wrap, maybe overwrite if not in INSERT mode");if(this.Wn.next)this.Wn=this.Wn.next,this.Nr(0);else if(this.bh(),this.xl)this.Nr(0);else for(var s=0;s<this.xr();s++)this.Yr(32)}const n=this.$r(t);return 2===this.Ml?(i?this.ve.elements[this.Zl++]=n:this.Wn.elements[this.me++]=n,1===this.ql&&this.tu()):i?(Mn.Jr(n,this.Zl,this.ve),this.Zl++):(Mn.Jr(n,this.me,this.Wn),this.me++),this.Wn.updated=!i||this.Wn.updated,n},Mn.prototype.wr=function(){return 1===this.jl&&2===this.ql},Mn.prototype.Ir=function(){return this.wr()?this.ve:this.Wn},Mn.prototype.xr=function(){return this.wr()?this.Zl:this.me},Mn.prototype.$r=function(t,i){var e=new Sn(t);return this.ol?(e.Zi=this.wl[2],this.ol=!1):this.al?(e.Zi=this.wl[3],this.al=!1):(e.Zi=this.wl[this.pl],e.Ji=this.wl[this.bl]),e.te=this.iu(i),this.eu(e,this.Wn),e.ie=this.ie,e.$i=this.$i,e.re=this.re,e.he=this.he,e.el=this.el,e},Mn.prototype.eu=function(t,i){let e=i||this.Ir();0!=(8&t.te)&&(e.Ui=!0)},Mn.prototype.Ae=function(t){let i=t||this.Wn;if(i&&i.elements&&i.elements[0]&&i.elements[0].te){const t=i.elements[0].te;return 0!=(128&t)||0!=(256&t)}return!1},Mn.prototype.su=function(){return this.Ae()?this.width/2:this.width},Mn.prototype.iu=function(t){if((t||1===this.jl)&&1===this.ql)return 0;let i=0,e=this.xr(),s=this.Ir();return s.elements[e]&&s.elements[e].te&&(i=s.elements[e].te,i&=896),i|=this.te,i},Mn.prototype.ur=function(t){if(this.qn<this.height||!this.Th)return;let i=new En(this.width);i.kh=!0,this.Jn=this.Jn||this.Mr,i.Nn=this.Jn,this.Jn.next=i,this.Jn=i,t&&(this.qn++,this.zn++)},Mn.prototype.nu=function(t){return[0,1,2].indexOf(t)>-1},Mn.prototype.Qh=function(t,i,e){return e&&1===e||2===e?Math.round((t-Xs)*i/(i+1)):t},Mn.prototype.lu=function(t){this.canvas.height=t,this.ti.height=t},Mn.prototype._h=function(t,i){if(i&&1===i||2===i){let i=this.Ln.clientHeight-t;this.Qt=an.Rs(this.Ln,this.Ln.clientWidth,i,t)}else this.Qt=null},Mn.prototype.hu=function(){return{elements:new Array(this.width),id:Js}},Mn.prototype.tu=function(){if(1!==this.ql||!this.ve||!this.ve.elements)return;let t=[32,...ul(this._l),32,40,...ul(this.gh()+1),44,32,...ul(this.me+1),41];for(let i=0;i<13;i++){let e=t[i]?t[i]:32;this.ve.elements[i]?this.ve.elements[i].ji=e:this.ve.elements[i]=this.$r(e,!0)}},Mn.prototype.ru=function(t){this._h(t,this.ql),this.ve=this.hu(),this.Zl=0,1===this.ql&&this.tu()},Mn.prototype.uu=function(){this.Rh(this.Ln),this.Qt=null,this.ve=null,this.Zl=0,this.jl=0,this.Wt=!0,this.ai.Vi()},Mn.prototype.ou=function(t){let i=this.Qh(this.Ln.clientHeight||this.He.height,this.height,this.ql);this.lu(i),0===t?this.ru(i):0===this.ql&&this.uu(),this.resize(this.width,this.height,!0)},Mn.prototype.au=function(){this.ve=this.hu(),this.Zl=0,1===this.ql&&(this.tu(),1===this.jl&&(this.jl=0,this.Wt=!0,this.ai.Vi()))},Mn.prototype.cu=function(t){if(!this.nu(t)||this.ql===t)return;const i=this.ql;this.ql=t,0===i||0===t?this.ou(i):this.au()},Mn.prototype.fu=function(){let t=this.height-this.gh();for(;t>=0;)this.bh(),t--},Mn.prototype.vr=function(){const t=this.Th,i=this.rr(),e=this.gh();if(t){((t,i)=>{for(;t>0;)this.ur(void 0),t--})(this.height-Math.max(i,e)),this.bh();const t=this.Jn;this.Kn=t,this.Li=this.Kn,this.zn=1,this.Eh(this.height-1),this.yh(0,0),this.Kh()}else this.Cs(!0)},Mn.prototype.Kh=function(){const t=this.Th;if(!t||!t.eh)return;const i=this.Ln.clientHeight/this.height;t.fh(i,Math.min(Math.max(this.height,this.jn,this.qn),this.Ee)),this.Hh=Math.floor(t.hh),t.eh.scrollTop=this.Hh,t.ih(this.Hh)},Mn.prototype.du=function(t,i,e,s,n){const l=n>=0?n:0;if(0===l)return;const h=Array(l).fill(null);let r=e;for(let e=0;e<s;e++)if(r&&r.elements){const e=r.elements.length;t===Mn.Fn?(r.elements.splice(i,0,...h),r.elements.splice(e)):t===Mn.xn&&(r.elements.splice(e,0,...h),r.elements.splice(i,l)),r.updated=!0,r=r.next}},Mn.prototype.Yh=function(t){this.Eh(t);for(var i=0,e=this.Kn;e&&e.next&&i!=t;)e=e.next,i++;return e},Mn.prototype.rr=function(){let t=this.Kn,i=0;for(;t&&i<this.height;)t=t.next,i++;return i},Mn.prototype.An=function(){return this.gn(this.gh(),this.me)},Mn.prototype.gh=function(){if(!0===kn)return this.lineNumber;{if(null==this.Wn||null==this.Kn)return 0;let e=this.Wn.id;for(var t=this.Kn,i=0;t&&t.id!=e;)t=t.next,i++;return this.lineNumber=i,i}},Mn.prototype.Eh=function(t){let i=this.Kn;var e=i;t>=this.height&&(Vs.warn("ensureLine requested to check row "+t+" greater than height:"+this.height),t=this.height-1);for(var s=0;s<t&&null!=e;)i=e,e=e.next,s++;if(Vs.log(Vs.FINER,"After ensureline loop, line="+e+", y="+s+", terminalLineNumber="+t),null==e||!e)for(var n=s;n<t+1;n++)e=this.bh(!0);return e},Mn.prototype.wu=function(t,i,e){Vs.debug("eraseInLine startColumn="+i+" endColumn="+e);for(var s=i;s<=e;s++)t.elements[s]&&this.Au(t.elements[s]);t.updated=!0},Mn.prototype.pu=function(t,i,e,s){if(null!=this.Wn&&null!=this.Kn){var n=this.me;-1==i&&(i=n),-1==s&&(s=n),t=Math.max(0,Math.min(t,this.height-1)),i=Math.max(0,Math.min(i,this.width-1)),e=Math.max(0,Math.min(e,this.height-1)),s=Math.max(0,Math.min(s,this.width-1));for(var l=this.Kn,h=0;h<t;){if(null==(l=l.next))return;h++}do{this.wu(l,h==t?i:0,h==e?s:this.width-1),l=l.next,h++}while(h<=e&&l)}},Mn.prototype.bu=function(t){return["","0","1","2"].indexOf(t)>-1},Mn.prototype.ku=function(t,i,e){if(!this.bu(t))return;let s=""===t||"0"===t?this.Zl:0,n="1"===t?this.Zl:this.width-1;s=Math.max(0,s),n=Math.min(n,this.width-1);let l=this.ve;Vs.debug("eraseInLine startColumn="+s+" endColumn="+n);for(var h=s;h<=n;h++)i&&l.elements[h]&&l.elements[h].el||(e?l.elements[h]=null:this.Au(l.elements[h]));l.updated=!0},Mn.prototype.Cu=function(){var t=this.gh();Vs.debug("cursor row="+t+" cursor="+this.me)},Mn.prototype.mu=function(t,i){return 0},Mn.prototype.vu=function(t,i){return 0},Mn.prototype.Su=function(){this.gu(0,-1)},Mn.prototype.Kr=function(){var t=this.Wn;if(this.me>0){var i=this.me-1;this.Eu(1,t,i),this.Nr(i)}},Mn.prototype.yu=function(){this.canvas.height,this.height;let t=this.canvas.height%this.height;return(this.canvas.height-t)/this.height},Mn.Vh=function(t,i,e,s){var n=t.fontProperties.size?t.fontProperties.size:Fs.fontSize,l=t.fontProperties.weight?t.fontProperties.weight:Fs.fontWeight,h=t.fontProperties.style?t.fontProperties.style:Fs.fontStyle,r=t.fontProperties.name?t.fontProperties.name:Fs.J;let u=an.hs(i.id+"tempSizeCalc",i,e,s,0);var o=u.getContext("2d");o.font=h+" "+l+" "+n+"px "+r;var a=n,c=o.measureText("M").width;let f=Math.floor(u.width/c),d=Math.floor(u.height/a);return i.removeChild(u),{width:f,height:d}},Mn.Du=function(t){if(t)return{t:"VT_INPUT",data:ie(t)}},Mn.prototype.Ru=function(parentDiv){if(!this.kl||!this.zn)return;const t=parentDiv.clientHeight||this.He.height,i=parentDiv.clientWidth||this.He.width,e=Mn.Vh(this.He,parentDiv,i,t),s=this.gh();let n=this.height-e.height;if(s>=e.height){for(;n>0;)this.Kn=this.Kn.next,n--;for(;n<0;)this.Kn=this.Kn.Nn,n++}else{let t=e.height-Math.min(this.height,this.zn);for(;t>0;)this.ur(),t--;this.Jn=this.Yh(e.height-1)}this.Th&&(this.qn-=n,this.jn-=n),this.width=e.width,this.height=e.height},Mn.prototype.Tu=function(t){return{row:Math.floor(t/this.width),column:Math.floor(t%this.width)}},Mn.prototype.Mu=function(t){Os.debug("---------------TELNET_DATA hex dump----------------"),Xi(t,Os),Os.debug("---------------TELNET_DATA ascii dump--------------"),Os.debug(String.fromCharCode.apply(null,t)),Os.debug("---------------TELNET_DATA dump end----------------"),this.Yn||(this.Yn=new il(this,"VT_INPUT"));var i=this.Yn,e=t.entries();this.Li&&this.Kn&&this.Li.id!=this.Kn.id&&(this.vh&&(this.Th.sh().scrollTop=this.Th.sh().scrollHeight),this.ar(1),this.Li=this.Kn),this.Pu={Fu:0,xu:void 0};for(let t of e){let e=t[1];i.process(e)}i.Dn();let s=Date.now(),n=0;this.Iu&&s-this.Iu<5&&(n=5,this.Iu&&this.Iu-s<3&&(n=3),clearTimeout(this.Nu)),this.Iu=s,this.Nu=setTimeout(()=>{this.Lu()},n)},Mn.prototype.wn=function(t){Os.debug("Processing websocket message. Type="+t.t);let i=this;switch(t.t){case"CONNECTED":this.rn(t);break;case"IP_RES":i.clientIP=t.data;break;case"TELNET_DATA":var s=ee(t.B64);this.Mu(s);break;case"CERT_PROMPT":this.callbacks&&this.callbacks.Uu?this.callbacks.Uu(this.ds.host,t.fp,(t,i)=>{this.Le.send(JSON.stringify({t:"CERT_RES",a:t})),t||e.info("Rejecting TLS certificate and closing connection. Reason="+i)}):this.Le.send(JSON.stringify({t:"CERT_RES",a:!0}));break;case"SSH_USER_AUTH_INFO_REQ":this.Ul=3,this.Fl=this.Pl,this.Pl=!0,this.Wr=t.prompts,this.zr=0;var n=[];for(let i=0;i<t.name.length;i++)n.push(t.name.charCodeAt(i));n.push(13);for(let i=0;i<t.inst.length;i++)n.push(t.inst.charCodeAt(i));if(n.push(13),t.prompts.length>0){var l=t.prompts[0];l.e&&Mn.Vr(n);var h=l.s;for(let t=0;t<h.length;t++)n.push(h.charCodeAt(t));l.e&&Mn.Qr(n),this.zr=1,this.Gr=[]}var r=ie(n);this.wn({t:"TELNET_DATA",B64:r});break;case"SSH_USER_AUTH_REQ":this.Wn||this.bh(),this.me=0,this.Fl=this.Pl,this.Pl=!0,void 0===this.username||null===this.username?(this.Ul=Vi,this.Zs("login as: "),this.Ol=this.me):(this.Zs("Password rejected by host"),this.Xn=[],this._r());break;case"CERT_REJECT":this.Le.close(4001,"server sent close/error/exception message");break;case"SSH_CH_REQ":let u=t.reqt.data,o="";u instanceof Array&&(o=String.fromCharCode.apply(null,u)),"exit-signal"===o?this.Le.close(4001,"server sent close/error/exception message"):Os.warn("Unhandled websocket message. Type="+o);break;case"ERR":this.un(t);default:Os.warn("Unhandled websocket message. Type="+t.t)}},Mn.prototype.lr=function(t,i){for(var e=[255,250,t],s=0;s<i.length;s++)e.push(i[s]);e.push(255),e.push(240);var n={t:"VT_INPUT",data:ie(e)};Os.debug("Sending telnet sub, dump follows"),Xi(e,Os),null!=this.Le&&this.Le.send(JSON.stringify(n))},Mn.prototype.Bu=function(){this.yl=null,this.Dl=null},Mn.prototype.Lu=function(){let t=!1;null==this.ai&&(t=!0,e.debug("showScreen"),this.ai=new Is(this,null,this.vl?2:1),null!==this.He&&void 0!==this.He&&this.Fs(this.He));for(var i=9;i<18;i++)this.Pe.Te[i]=32;this.ai.de(),t&&this.Th&&(this.Th.sh().style.opacity="255")},Mn.prototype.gu=function(t,i){if(this.wr())this.Nr(this.Zl+i);else{var e=this.gh()+t,s=this.me+i;this.yh(e,s)}},Mn.prototype.Ou=function(t){var i=this.Tu(t);this.yh(i.row,i.column)},Mn.prototype.Nr=function(t){var i=Math.max(this.Ol,Math.min(t,this.width));t!=i&&Vs.warn("Column for setcursor abnormal. column="+t+". Set to "+i),this.wr()?this.Zl=i:(this.me=i,1===this.ql&&this.tu()),this.ai&&this.ai.St&&this.ai.ei()},Mn.prototype.yh=function(t,i){if(this.wr())this.Nr(i);else{this.or&&this.yl&&(t=this.yl+t);var e=null!=this.Dl&&this.or?this.Dl:this.height-1,s=Math.max(0,Math.min(t,e)),n=Math.max(this.Ol,Math.min(i,this.width-1));t==s&&i==n||Vs.warn("Column and row given for setcursor abnormal. column="+i+", row="+t+". Set to column="+n+", row="+s),this.Wn=this.Eh(s),this.Wn.kh=!1,this.lineNumber=s,this.me=n,this.ai&&this.ai.St&&this.ai.ei(),1===this.ql&&this.tu()}};var startVT=function(t,i,s,callbacks,n){let l,h,r=t.parentDiv,u=t.height,o=t.width,a=!1,c=null,f=r;if(s&&s.screenBufferLines){let e=Number(s.screenBufferLines),n=Number(i.screenHeight);if(h="MAX"==i.screenWidth||"MAX"==i.screenHeight,h?n=Mn.Vh(s,f,o,u).height:(i.screenHeight=Number(i.screenHeight),i.screenWidth=Number(i.screenWidth)),e>n){l=e+n,a=!0,c=new Pn(r,o,u);let i=u%n;c.fh((u-i)/n,l),o=t.width=o-15,f=Mn.th(r,o,u),r.appendChild(c.sh()),c.ih(-1),r.appendChild(f)}}var d=!1;if(h="MAX"==i.screenWidth||"MAX"==i.screenHeight,h){d=!0;let t=Mn.Vh(s,f,o,u);i.screenHeight=t.height,i.screenWidth=t.width}else i.screenHeight=Number(i.screenHeight),i.screenWidth=Number(i.screenWidth);let w=i.screenWidth?i.screenWidth:80,A=i.screenHeight?i.screenHeight:24;a||(l=A);var p=0,b=1,k=new Mn(w,A,l,f);if(k.callbacks=callbacks,n&&(k=Object.assign(k,n)),k.Ms(f,t),k.parentDiv=r,k.En(),k.vh=a,i&&(i.termTypeString&&"string"==typeof i.termTypeString&&(k.termTypeString=i.termTypeString),void 0!==i.termType&&"number"==typeof i.termType&&(k.termType=i.termType),void 0!==i.oiaEnabled&&"boolean"==typeof i.oiaEnabled&&(k.oiaEnabled=i.oiaEnabled?1:0),i.security&&"object"==typeof i.security&&(i.security.type&&"number"==typeof i.security.type&&(p=i.security.type),i.security.badCert&&"number"==typeof i.security.badCert&&(b=i.security.badCert)),i.answerback&&"string"==typeof i.answerback)){for(var C=[],m=0;m<i.answerback.length;m++)C.push(i.answerback.charCodeAt(m));k.answerback=C}return k.termTypeString||Mn.jh(k),Mn.Gh(k),void 0!==s.El&&(k.El=s.El),k.kl=h,c&&(k.Th=c,k.Fh()),null!=s&&(k.He=s,null!==s.Vu&&void 0!==s.Vu&&(k.Qe=s.Vu),void 0!==s.tn&&(k.tn=s.tn)),k.vl=d,k.Cs(!0),e.debug("connect = "+i.connect),k.ds={host:i.host,port:Number(i.port),security:p,zh:b},i.connect?k.connect(i.url,k.ds):k.Ge=!0,k.Ps(),k.canvas.focus(),k.callbacks&&"function"==typeof k.callbacks.onInit&&k.callbacks.onInit(),k};const xn=0,In=1,Nn=2,Ln=3,Un=4,Bn=5,On=6,Vn=7,Hn=8,Qn=9,_n=10,Kn=11,Wn=12,zn=13,Gn=14,qn=15,jn=16,Zn=17,Jn=18,Xn=19,Yn=20,$n=21,tl=22;function il(t,i){this.ns=i,this.screen=t,this.state=1,this.Hu,this.data=[],this.Qu=0,this._u=new Array(1e3),this.Ku=0,this.Wu=[],this.zu,this.Gu,this.qu=[],this.ju,this.es=null,this.ts=[],this.Zu=!0,this.Ju=!0,this.Xu=!0,this.ss=[],this.Yu=!1,this.$u=[],this.to=[]}we(il,cn),il.io=function(t){var i=t.length,e=0;switch(i){case 2:e=31&t[0];break;case 3:e=15&t[0];break;case 4:e=7&t[0];break;case 5:e=3&t[0];break;case 6:e=1&t[0];break;default:throw new fn("Invalid length ("+i+") of UTF8 buffer")}for(var s=1;s<t.length;s++)e<<=6,e|=63&t[s];return e},Mn.prototype.Eu=function(t,i,e){if(i&&i.elements){var s=0;for(let n=e+t;n<screen.width;n++)i.elements[e+s]=i.elements[n],s++;for(let t=e+s+1;t<screen.width;t++)i.elements[t]=void 0;i.updated=!0}},Mn.prototype.Au=function(t){t&&(t.ji=null,t.te=896&t.te,t.$i=this.$i,t.he=this.he)},Mn.prototype.eo=function(t=!0,i,e){const s=i||this.Wn;for(let i=0;i<=this.me;i++)t&&s.elements[i]&&s.elements[i].el||s.elements[i]&&(e?s.elements[i]=null:this.Au(s.elements[i]))},Mn.prototype.so=function(t=!0,i,e,s,n){const l=e||this.Wn,h=i?0:this.me,r=s||this.width;for(let i=h;i<r;i++)t&&l.elements[i]&&l.elements[i].el||(n?l.elements[i]=null:this.Au(l.elements[i]));l.updated=!0},Mn.prototype.no=function(t=!0){let i=this.Kn;for(let e=0;e<=this.lineNumber&&i;e++)i.id===this.Wn.id?this.eo(t,this.Wn,!0):this.so(t,!0,i,this.width,!0),i.updated=!0,i=i.next},Mn.prototype.lo=function(t=!0,i){let e=i?this.Kn:this.Wn;for(let s=i?0:this.gh();s<this.height&&e;s++)i||e.id!==this.Wn.id?this.so(t,!0,e,this.width,!0):this.so(t,!1,this.Wn,this.width,!0),e.updated=!0,e=e.next},Mn.prototype.ho=function(){this.ml={lineNumber:this.gh(),me:this.me,te:this.te,ie:this.ie,$i:this.$i,wl:[].concat(this.wl),pl:this.pl,bl:this.bl,ol:this.ol,al:this.al,or:this.or,il:this.il,el:this.el}},Mn.prototype.ro=function(){this.ml?(this.yh(this.ml.lineNumber,this.ml.me),this.te=this.ml.te,this.ie=this.ml.ie,this.$i=this.ml.$i,this.wl=[].concat(this.ml.wl),this.pl=this.ml.pl,this.bl=this.ml.bl,this.ol=this.ml.ol,this.al=this.ml.al,this.or=this.ml.or,this.il=this.ml.il,this.el=this.ml.el):(Vs.warn("Dont have saved attributes to restore from for escape 0x38"),this.yh(0,0),this.te=0,this.ie=Mn.ee,this.$i=0,this.wl=Mn.Al(),this.pl=0,this.bl=1,this.or=!1,this.il=!1,this.el=!1)},Mn.prototype.Pr=function(t){var i=Mn.Du(t);i&&(Os.debug("Sending VT message, dump follows"),Xi(t,Os),null!=this.Le&&this.Le.send(JSON.stringify(i)))},Mn.prototype.uo=function(){if(this.wr())if(this.xl)this.Nr(0);else for(var t=0;t<this.Zl;t++)this.Yr(32);else{null!=this.yl&&this.yl;var i=null!=this.Dl?this.Dl:this.height-1,e=this.gh();if(this.cr(e)){if(!this.oo(e)){if(this.bh(),this.xl)this.Nr(0);else for(t=0;t<this.me;t++)this.Yr(32);this.Th&&this.Th.ih(-1)}}else if(e==i&&null!=this.Dl){if(this.bh(),!this.xl)for(t=0;t<this.me;t++)this.Yr(32);this.xl&&this.Nr(0)}else this.gu(1,0),this.xl&&this.Nr(0)}},Mn.prototype.oo=function(t){return!(!this.Dl||this.Dl===this.height-1)&&(t||this.gh())>=this.height-1},il.prototype.ao=function(){var t=this.screen,i=this.co();if(0==i.length)t.yh(0,0);else if(1==i.length)t.yh(i[0]-1,0);else{if(2!=i.length)throw new ll("wrong number of params to CSIxf/H -'"+this.fo()+"'");t.yh(i[0]-1,i[1]-1)}},il.prototype.do=function(t,i){if(t.wr())return void(i&&t.Nr(0));const e=t.gh(),s=t.me,n=null!=t.Dl?t.Dl:t.height-1;e>=n&&!t.oo(e)&&t.bh();const l=e===n?n:e+1,h=i?s:0;t.yh(l,h)},il.prototype.wo=function(t){Vs.debug("-- type=(RI) Reverse Index");const i=null!=t.yl?t.yl:0,e=null!=t.Dl?t.Dl:t.height-1,s=t.gh(),n=t.me;s==i&&t.ir(1,t.Yh(i),i,e,!0);const l=s<=i?i:s-1;t.yh(l,n)},il.prototype.Ao=function(){const t=this.qu;switch(this.zu){case 113:36===t[0]&&(Vs.debug("-- type=(DECRQSS) Request Selection or Setting"),this.po(t));break;default:this.bo("unhandle des sequences: "+this.zu)}},il.prototype.po=function(t){const i=this.screen;if(0===t.length)return;const e=this.ko("DCS"),s=this.ko("ST");let n=[],l=!0,h=[...e,49,36,114,...s];switch(t[1]){case 34:113===t[2]?(Vs.debug("-- type=(DECRQSS) -> DECSCA: Set Character Attribute"),n=[i.sl.toString().charCodeAt(0),34,113]):112===t[2]&&(h=BZ_SET_CONFORMANCE_LEVEL);break;case 36:124===t[2]?(Vs.debug("-- type=(DECRQSS) -> DECSCPP: Set Columns Per Page"),n=[...this.Co(i.nl),36,124]):126===t[2]?(Vs.debug("-- type=(DECRQSS) -> DECSSDT: Select Status Display (Line) Type"),n=[...this.Co(this.ql),36,126]):125===t[2]&&(n=[...this.Co(i.jl),36,125]);break;case 39:115===t[2]&&(h=[...e,...s],this.bo("need to do DECTLTC - Transmission line termination characte"));break;case 42:124===t[2]&&(Vs.debug("-- type=(DECRQSS) -> DECSNLS: Select number of lines per screen"),n=[...this.Co(i.hl),42,124]);break;case 109:Vs.debug("-- type=(DECRQSS) -> SGR: Select Graphic Rendition");const r=rl(i.te);let u=[];r.forEach(t=>{u.push(...this.Co(t)),u.push(59)}),u.pop(),n=[...u,109];break;case 114:Vs.debug("-- type=(DECRQSS) -> DECSTBM: Set Top and Bottom Margins"),n=[...this.Co(null==i.yl?1:i.yl+1),59,...this.Co(null==i.Dl?i.height:i.Dl+1),114];break;case 116:Vs.debug("-- type=(DECRQSS) -> DECSLPP: Set Lines Per Page"),n=[...this.Co(i.ll),116];break;case 124:h=[...e,...s],this.bo("need to do DECTTC - Set transmit termination character");break;default:l=!1,this.bo("need to do DECRQSS Request Selection or Setting")}if(!l)return;const r=this.screen.dl?4:5;h.splice(r,0,...n),i.Pr(h)},il.prototype.mo=function(){const t=this.screen;let i=[];switch(t.termTypeString){case"vt102":i=[...Si];break;case"vt220":i=[...gi,...Di];break;case"vt320":i=[...Ei,...Ri];break;case"linux":case"xterm":case"vt420":i=[...yi,...Ti];break;default:i=[...Si],Vs.warn("Unknown term type specified:"+t.termTypeString+", sending VT102 string instead.")}return i},il.prototype.ko=function(t){return this.screen.dl?[...hi[t]]:[...li[t]]},il.prototype.vo=function(t){const i=this.screen;let e;switch(t){case 1:e=52;break;case 2:e=i.Tl?49:50;break;case 3:e=48;break;case 4:e=1===i.Ml?49:50;break;case 5:case 7:case 10:case 11:e=52;break;case 12:e=i.Pl?50:49;break;case 13:case 14:case 15:case 16:case 17:case 18:case 19:e=52;break;case 20:e=i.xl?49:50;break;default:e=50,Vs.warn("Unknown ANSI mode specified:"+t+", sending the setting of the mode with '2: reset'.")}let s=this.Co(t);return[...this.ko("CSI"),...s,59,e,36,121]},il.prototype.So=function(t){const i=this.screen;let e;const s={18:"DECPFF",19:"DECPEX",34:"DECRLM",35:"DECHEBM",36:"DECHEM",42:"DECNRCM",57:"DECNAKB",61:"DECVCCM",64:"DECPCCM",68:"DECKBUM",73:"DECXRLM",81:"DECKPM",95:"DECNCSM",96:"DECRLCM",97:"DECCRTSM",98:"DECARSM",99:"DECMCM",100:"DECAAM",101:"DECNULM",102:"DECNULM",103:"DECHDPXM",104:"DECESKM",106:"DECOSCNM"};switch(s[t]&&this.bo(`DEC mode ${t} -- ${s[t]} unimplemented, sending the setting of the mode with '2: reset'.`),t){case 1:e=1===i.fl?49:50;break;case 2:e=i.qr?50:49;break;case 3:e=132===i.width?49:50;break;case 4:e=i.zl?49:50;break;case 5:e=i.Gl?49:50;break;case 6:e=i.or?49:50;break;case 7:e=i.il?49:50;break;case 8:e=i.Sl?49:50;break;case 18:case 19:e=50;break;case 25:e=i.Wt?49:50;break;case 34:case 35:case 36:case 42:case 57:e=50;break;case 60:e=52;break;case 61:case 64:e=50;break;case 66:e=i.Br?49:50;break;case 67:e=i.Yl?50:49;break;case 68:e=50;break;case 69:e=i.Eo?49:50;break;case 73:case 81:case 95:case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 106:e=50;break;default:e=50,Vs.warn("Unknown DEC mode specified:"+t+", sending the setting of the mode with '2: reset'.")}const n=this.Co(t);return[...this.ko("CSI"),63,...n,59,e,36,121]},il.prototype.yo=function(){const t=this.screen;let i,e=this.ko("CSI");switch(t.termTypeString){case"vt102":i=Si;break;case"vt220":i=gi;break;case"vt320":i=Ei;break;case"linux":case"xterm":case"vt420":i=yi;break;default:i=Si,Vs.warn("Unknown term type specified:"+t.termTypeString+", sending VT102 string instead.")}e.push(...i),Vs.debug(`Sending response for device primary attributes for ${t.termTypeString}: ${e}`),t.Pr(e)},il.prototype.Do=function(){let t,i=this.screen,e=this.ko("CSI");switch(i.termTypeString){case"vt220":t=Di;break;case"vt320":t=Ri;break;case"linux":case"xterm":case"vt420":t=Ti;break;default:t=Di,Vs.debug("Unknown term type="+i.termTypeString+", sending VT220 string")}t&&(e.push(...t),Vs.debug(`Sending response for device secondary attributes for ${i.termTypeString}: ${e}`),i.Pr(e))},il.prototype.Ro=function(t,i){this.ts.push(255),this.ts.push(t),this.ts.push(i)},il.prototype.To=function(){var t=this.screen,i=this.ss[0];switch(Hs.debug("Handling telnet sub type b=0x"+Ji(i)),i){case 31:Hs.debug("-- Telnet Sub=WINDOW_SIZE"),t.nr();break;case 24:Hs.debug("-- Telnet Sub=TERMINAL_TYPE");let e=[0];for(let i=0;i<t.termTypeString.length;i++)e.push(t.termTypeString.charCodeAt(i));t.lr(24,e);break;default:Hs.warn("Request for telnet sub of type 0x"+Ji(i)+", but is unhandled")}},il.prototype.Mo=function(t){switch(Hs.debug("Handling telnet option"),Hs.debug("-- b=0x"+Ji(t)),this.es){case 253:switch(Hs.debug("-- Verb=DO"),t){case 0:this.Ro(252,0);break;case 1:e.info("Server requested telnet echo"),this.screen.Pl=!0,this.Ro(251,1);break;case 5:this.Ro(254,5);break;case 31:this.Ro(251,31),this.Po=!0,this.screen.nr();break;case 32:this.Ro(252,32);break;case 24:this.Ro(251,24);break;case 3:this.Ro(251,3),this.Ju=!0;break;default:Hs.warn("Defaulted on DO, sending WONT for b=0x"+Ji(t)),this.Ro(252,t)}break;case 254:switch(Hs.debug("-- Verb=DONT"),t){case 1:this.Ro(252,1),this.screen.Pl=!1,this.Zu=!0;break;case 31:break;default:this.Ro(252,t),Hs.warn("Ignoring DONT for b=0x"+Ji(t))}break;case 252:switch(Hs.debug("-- Verb=WONT"),t){case 1:Hs.warn("HOST WONT ECHO BUT WE DO NOT SUPPORT ECHO YET"),this.screen.Pl=!0,this.Ro(251,1);break;default:Hs.warn("Ignoring WONT for b=0x"+Ji(t))}break;case 251:switch(Hs.debug("-- Verb=WILL"),t){case 0:this.Ro(254,0);break;case 1:this.Xu&&this.Ro(253,1);break;case 5:this.Ro(254,5);break;case 38:this.Ro(254,38);break;default:Hs.warn("Ignoring WILL for b=0x"+Ji(t))}}!1===this.Yu&&(this.Ro(251,31),this.Yu=!0)},il.prototype.clear=function(){this.Wu=[],this.qu=[],this.Gu=0,this.Fo=0,this.$u=[],this.to=[]},il.prototype.xo=function(t){if(this.screen){const i=this.screen.Pu;i.xu=this.screen.Yr(t),i.Fu=0,Vs.log(Vs.FINER,"Insert to Screen: b=0x"+Ji(t)+", char="+String.fromCharCode(t)+", newRow="+this.screen.gh()+", newCol="+this.screen.me)}};const el=function(t,i,e,s){let n=!1;if(0===t)return i;for(let l=i;l<e;l++)if(1===s[l]&&0==--t)return n=!0,l;return n?void 0:e-1};il.prototype.Io=function(t){var i=this.screen;Vs.debug("Execute b=0x"+Ji(t));var e=!1;if(null!=i)switch(t){case 0:break;case 5:i.answerback&&Array.isArray(i.answerback)&&i.sr(i.answerback);break;case 7:i.Xl&&i.ls();break;case 8:i.Su();break;case 9:const s=el(1,i.xr()+1,i.su(),i.Vl);i.Nr(s);break;case 10:case 11:case 12:i.uo();break;case 13:i.Nr(0);break;case 14:i.pl=1;break;case 15:i.pl=0;break;case 24:case 26:e=!0;break;case 127:0!=i.Il&&i.Kr();break;case 132:Vs.debug("-- type=(8bit --IND) Next line"),this.do(i,!0);break;case 133:Vs.debug("-- type=(8bit --NEL) Next line"),this.do(i);break;case 136:Vs.debug("-- type=(8bit --HTS) Horizontal tab set"),i.Vl[i.xr()]=1;break;case 141:if(i.wr())break;this.wo(i);break;case 142:Vs.debug("-- type=(8bit --SS2) Single shift 2"),i.ol=!0;break;case 143:Vs.debug("-- type=(8bit --SS3) Next line"),i.al=!0;break;default:Vs.warn("Unhandled execute b=0x"+Ji(t))}return e},il.prototype.collect=function(t){if(t<48)this.qu.push(t);else{if(t<58)throw _s.warn("Collect given low value byte, b=0x"+Ji(t)),new ll("collect should not get digits");t<64&&(this.Gu=t)}},il.prototype.No=function(t){this.Wu.push(t)},il.prototype.fo=function(){try{var t=this.Wu;return 0===t.length?"":(_s.debug("Param string as hex="),Xi(t,_s),String.fromCharCode.apply(null,t))}catch(t){return"<OOPS>"}},il.prototype.Lo=function(){try{var t=this.qu;return _s.debug("Intermediate string as hex="),Xi(t,_s),String.fromCharCode.apply(null,t)}catch(t){return"<OOPS>"}},il.prototype.bo=function(t){Vs.warn("Unimplemented: "+t)},il.prototype.Uo=function(t,i){let e=`Unhandled intermediates: ${this.qu} and parameters: ${i} for CSI dispatch character: 0x${Ji(t)}`;e+=this.Gu?" with private char "+this.Gu:"",Vs.warn(e)},il.prototype.Bo=function(t,i){if(!t||t.length<4)return;if(t[0]>t[2]||t[1]>t[3])return void Vs.warn("top-line/left-column border must be less than or equal to bottom-line/right-column border!");const e=this.screen,s=e.gh(),n=e.me;let l=0===t[0]?0:Math.min(Math.max(t[0]-1,0),e.height-1),h=0===t[1]?0:Math.min(Math.max(t[1]-1,0),e.width-1),r=0===t[2]?e.height-1:Math.min(Math.max(t[2]-1,0),e.height-1),u=0===t[3]?e.width-1:Math.min(Math.max(t[3]-1,0),e.width-1),o=e.Yh(l);const a={Oo:!1,Vo:!1},c={Ho:l,Qo:h,_o:r,Ko:u};for(let e=l;e<=r&&o;e++)a.Oo=e===l,a.Vo=e===r,i?this.Wo(o,t,a,c):this.zo(o,t,a,c),o=o.next;e.yh(s,n)},il.prototype.zo=function(t,i,e,s){let n=s.Qo,l=s.Ko;if(2!==this.Qu&&(n=e.Oo?n:0,l=e.Vo?l:this.screen.width-1),t){for(let e=n;e<=l;e++)if(t&&t.elements[e])for(let s=4;s<i.length;s++)switch(i[s]){case 0:t.elements[e].te=0;break;case 1:t.elements[e].te|=16;break;case 4:t.elements[e].te|=4;break;case 5:t.elements[e].te|=8,this.screen.eu(t.elements[e],t);break;case 7:t.elements[e].te|=2;break;case 22:t.elements[e].te&=-17;break;case 24:t.elements[e].te&=-5;break;case 25:t.elements[e].te&=-9,this.screen.eu(t.elements[e],t);break;case 27:t.elements[e].te&=-3}t.updated=!0}},il.prototype.Wo=function(t,i,e,s){let n=s.Qo,l=s.Ko;if(2!==this.Qu&&(n=e.Oo?n:0,l=e.Vo?l:this.screen.width-1),t){for(let e=n;e<=l;e++)if(t.elements[e])for(let s=4;s<i.length;s++)switch(i[s]){case 0:t.elements[e].te&=~t.elements[e].te;break;case 1:16&t.elements[e].te?t.elements[e].te&=-17:t.elements[e].te|=16;break;case 4:4&t.elements[e].te?t.elements[e].te&=-5:t.elements[e].te|=4;break;case 5:8&t.elements[e].te?t.elements[e].te&=-9:t.elements[e].te|=8,this.screen.eu(t.elements[e],t);break;case 7:2&t.elements[e].te?t.elements[e].te&=-3:t.elements[e].te|=2}t.updated=!0}},il.prototype.co=function(){var t,i=this.Wu,e=[],s=0,n=!1;for(t=0;t<i.length;t++){var l=i[t];if(59==l)e.push(s),n=!1,s=0;else if(l>=48&&l<=57)s=10*s+(l-48),n=!0;else{if(this.ul)throw new ll("unexpected numerical parms "+this.fo());_s.debug("Numerical params=",h),console.log("unexpected numerical parms "+this.fo())}}n&&e.push(s);var h=new Array(e.length);for(t=0;t<h.length;t++)h[t]=e[t];return _s.debug("Numerical params=",h),h};var sl=function(t){var i="--------------------------------------------------------------------------------";t&&t.debug?t.debug(i):e.debug(i)};function nl(){return[48,48,48,48]}function ll(t){this.message=t,this.name="VTParseException",_s.warn("Encountered exception:"+this.name+", msg:"+t)}function hl(t){let i=0;return 16&t&&(i+=8),2&t&&(i+=1),4&t&&(i+=2),8&t&&(i+=4),i}function rl(t){let i=[];return 0===t&&i.push(0),16&t&&i.push(1),4&t&&i.push(4),8&t&&i.push(5),2&t&&i.push(7),i}function ul(t){let i=[];t=(t||0).toString();for(var e=0;e<t.length;e++)i.push(t.charCodeAt(e));return i}il.prototype.Go=function(t){this.bo("unhandled CSI dispatch character:0x"+Ji(t))},il.prototype.qo=function(){return!this.qu||0===this.qu.length},il.prototype.jo=function(t){return typeof this.qu==typeof t&&Array.isArray(t)&&t.join()===this.qu.join()},il.prototype.Zo=function(t){var i=this.screen,e=this.fo();Vs.debug("CSI Dispatch Start:"),Vs.debug("-- b=0x"+Ji(t)+", parms="+e+", intermediate="+this.Lo());const s=this.co();switch(t){case 64:if(this.qo()){Vs.debug("-- type=Insert characters"),Vs.debug("IC start, line elements=",i.Wn.elements);for(var n=yn(e,1),l=i.me+n,h=i.Wn,r=i.me;r<l;){for(var u=new Sn(32),o=h.elements[r],a=r+1;a<i.width-1;a++){var c=h.elements[a];h.elements[a]=o,o=c}h.elements[r++]=u}h.updated=!0,Vs.debug("IC end, line elements=",i.Wn.elements)}else if(!this.jo([parseInt("0x20",16)])||0!==s.length&&1!==s.length)this.Uo(t,s);else{Vs.debug("-- type=(SL) Scroll Left");const t=0===s.length?1:s[0];i.du(Mn.xn,0,i.Kn,i.zn,t)}break;case 65:if(this.qo()){if(Vs.debug("-- type=(CUU) Cursor Up"),i.wr())break;const t=yn(e,1),s=i.gh(),n=null!==i.yl?i.yl:0,l=s<n?Math.max(0,s-t):Math.max(n,s-t);i.yh(l,i.me)}else if(!this.jo([parseInt("0x20",16)])||0!==s.length&&1!==s.length)this.Uo(t,s);else{Vs.debug("-- type=(SR) Scroll Right");const t=0===s.length?1:s[0];i.du(Mn.Fn,0,i.Kn,i.zn,t)}break;case 66:if(Vs.debug("-- type=(CUD) Cursor Down"),i.wr())break;const M=yn(e,1),P=i.gh(),F=null!==i.Dl?i.Dl:i.height-1,x=P>F?Math.min(i.height-1,P+M):Math.min(F,P+M);i.yh(x,i.me);break;case 67:Vs.debug("-- type=(CUF) Cursor Right");var f=yn(e,1);i.gu(0,f);break;case 68:Vs.debug("-- type=(CUB) Cursor Left"),f=yn(e,1),i.gu(0,-f);break;case 69:if(Vs.debug("-- type=(CNL) Cursor Next Line"),i.wr()){i.Nr(0);break}const I=yn(e,1),N=i.gh(),L=Tn(N,I,i.height);i.Nr(0),i.yh(L,i.me);break;case 70:if(Vs.debug("-- type=(CPL) Cursor Previous Line"),i.wr()){i.Nr(0);break}const U=yn(e,1),B=i.gh(),O=Tn(B,-U,i.height);i.Nr(0),i.yh(O,i.me);break;case 71:Vs.debug("-- type=(CHA) Cursor Character Absolute");var d=this.co(),w=i.gh();0==d.length?i.yh(w,0):i.yh(w,d[0]-1);break;case 72:Vs.debug("-- type=(CUP) Position Cursor"),this.ao();break;case 73:Vs.debug("-- type=(CHT) Cursor Forward Tab");const V=this.co(),H=V.length?V[0]:1,Q=el(H,i.xr(),i.su(),i.Vl);i.Nr(Q);break;case 74:const _=s.length?s[0]:0;if(i.bu(e)){if(i.wr()){const t=63==this.Gu;i.ku(e,t,!0)}else if(i.Wn)if(63==this.Gu)if(Vs.debug("-- type=(DECSED) Selective Erase in Display"),0===_){if(i.me===i.Ol&&0===i.gh()){i.Bu(),i.vr();break}i.lo()}else 1===_?i.no():i.lo(!0,!0);else if(Vs.debug("-- type=(ED) Erase in display"),0===_){if(Vs.debug("-- subtype=Erase to End of screen"),i.me===i.Ol&&0===i.gh()){i.Bu(),i.vr();break}i.lo(!1)}else 1===_?(Vs.debug("-- subtype=Erase from beginning"),i.no(!1)):2==_?(i.Bu(),i.vr()):3===_&&(Vs.debug("-- subtype=Erase saved lines"),this.bo("Erase saved lines (xterm)"))}else Vs.warn("Erase in Display had unexpected param string="+e);break;case 75:if(Vs.debug("-- type=(EL) Erase in line"),i.bu(e))if(i.wr()){const t=63==this.Gu;i.ku(e,t)}else if(63==this.Gu){this.bo("should perform DECSEL");const t=s.length?s[0]:0;0===t?i.so():1===t?i.eo():i.so(!0,!0)}else h=i.gh(),Vs.debug("before eraseRange insertionLine="+h),""==e||"0"==e?(Vs.debug("-- subtype=Erase right"),i.pu(h,-1,h,i.width-1)):"1"==e?(Vs.debug("-- subtype=Erase left"),i.pu(h,0,h,-1)):"2"==e&&(Vs.debug("-- subtype=Erase all"),i.pu(h,0,h,i.width-1));else Vs.warn("Erase in line had unexpected param string="+e);break;case 76:if(Vs.debug("-- type=(IL) Insert lines"),i.wr())break;const K=s.length?s[0]:1;i.Cr(i.lineNumber)?(i.Mr(K,i.Wn),i.Nr(0)):Vs.debug("IL has no effect since cursor is outside the page margins.");break;case 77:if(Vs.debug("-- type=(DL) Delete lines"),i.wr())break;const W=s.length?s[0]:1;i.Cr(i.lineNumber)?(i.Tr(W,i.Wn),i.Nr(0)):Vs.debug("DL has no effect since cursor is outside the page margins.");break;case 80:if(!this.qo()||0!==s.length&&1!==s.length)if(!this.jo([parseInt("0x20",16)])||0!==s.length&&1!==s.length)this.Uo(t,s);else{if(Vs.debug("-- type=(PPA) Page memory function: Page Position Absolute"),i.wr())break;const t=s[0]?s[0]:1;i.Ah(),i.Sh(t,!0)}else{Vs.debug("-- type=(DCH) Delete characters");var A=yn(e,1);0===A&&(A=1);var p=i.xr(),b=A+p<i.width?A:i.width-1-p,k=i.Ir();i.Eu(b,k,p)}break;case 81:if(!this.jo([parseInt("0x20",16)])||0!==s.length&&1!==s.length)this.Uo(t,s);else{if(Vs.debug("-- type=(PPA) Page memory function: Page Position Relative"),i.wr())break;const t=s[0]?s[0]:1,e=i._l+t;i.Ah(),i.Sh(e,!0)}break;case 82:if(!this.jo([parseInt("0x20",16)])||0!==s.length&&1!==s.length)this.Uo(t,s);else{if(Vs.debug("-- type=(PPA) Page memory function: Page Position Backward"),i.wr())break;const t=s[0]?s[0]:1,e=i._l-t;i.Ah(),i.Sh(e,!0)}break;case 83:if(Vs.debug("-- type=(SU) Scroll up"),s.length>0){if(i.wr())break;i.Er(s[0])}else this.bo("0x53, unknown");break;case 84:if(Vs.debug("-- type=(SD) Scroll down"),s.length>0){if(i.wr())break;i.Dr(s[0])}else this.bo("0x54, unknown");break;case 85:if(!this.qo()||0!==s.length&&1!==s.length)this.Uo(t,s);else{if(Vs.debug("-- type=(NP) Page memory function: Next Page"),i.wr())break;const t=s[0]?s[0]:1,e=i._l+t;i.Ah(),i.Sh(e),i.ai.Tt()}break;case 86:if(!this.qo()||0!==s.length&&1!==s.length)this.Uo(t,s);else{if(Vs.debug("-- type=(PP) Page memory function: Preceding Page"),i.wr())break;const t=s[0]?s[0]:1,e=i._l-t;i.Ah(),i.Sh(e),i.ai.Tt()}break;case 88:Vs.debug("-- type=(ECH) Erase characters"),Vs.debug("Erase characters: WARNING, concern about if allowed to erase characters with erase lock attribute");const z=Math.max(s.length?s[0]:1,1),G=Math.min(i.me+z,i.width);i.so(!1,!1,i.Ir(),G);break;case 89:Vs.debug("-- type=(CVT) Character vertical tab"),this.Go(t);break;case 90:Vs.debug("-- type=(CBT) Character backward tab");const q=this.co(),j=q.length?q[0]:1,Z=i.xr(),J=Dn(j,Z,i.Vl);i.Nr(J);break;case 96:Vs.debug("-- type=(HPA) Horizontal position absolute"),0!=i.Ql?(Vs.warn("Cannot handle HPA in decipoint mode"),this.Go(t)):i.Nr(yn(e,1)-1);break;case 97:const X=this.co();if(1!==X.length)Vs.warn("Cannot handle HPR if there is not only one Pn");else{Vs.debug("-- type=(HPR) Horizontal position relative");const t=Rn(i.xr(),X[0],i.width);i.Nr(t)}break;case 98:Vs.debug("-- type=(REP) Repeat previous character in data stream");const Y=s.length?s[0]:1,$=i.Pu;if(1===$.Fu&&void 0!==$.xu){let t=i.Ir();if(t){const e=$.xu;let s=t.elements,n=i.xr();for(let t=0;t<Y;t++)if(n<=i.width-1){if(s[n]=e,n===i.width-1)break;n++}i.wr()?i.Zl=n:i.me=n}else Vs.warn("No insertion line for REP")}else Vs.warn(`No previous element found for REP, current position r=${i.gh()}, c=${i.me}`);break;case 99:Vs.debug("-- type=(DA) Device attributes"),63==this.Gu?this.bo("Send Device Attributes Secondary DA"):this.Gu&&0!=this.Gu?62==this.Gu?""==e||"0"==e?this.Do():Vs.warn("Unhandled device attribute command, privateChar = >, paramString="+e):this.bo("0x63 with privateChar="+Ji(this.Gu)):this.yo();break;case 100:const tt=this.co();if(0!=i.Ql)this.bo("VPA with decipoint");else if(1!==tt.length)Vs.warn("when process: CSI Pn e, there is not only one pn");else{Vs.debug("-- type=(VPA) Line position absolute");const t=Math.max(tt[0]-1,0);i.yh(t,i.xr())}break;case 101:const it=this.co(),et=i.gh();if(1!==it.length)Vs.warn("Cannot handle VPR if there is not only one Pn");else{Vs.debug("-- type=(VPR) Line position relative");const t=Tn(et,it[0],i.height);i.yh(t,i.xr())}break;case 102:Vs.debug("-- type=(HVP) Horizontal vertical position"),this.ao();break;case 103:Vs.debug("-- type=(TBC) Tab clear");const st=s.length?s[0]:0;0===st?i.Vl[i.xr()]=0:3===st?i.Vl=new Array(i.Vl.length).fill(0):Vs.warn("Unexpected parameter for tab clear -'"+e+"'");break;case 104:if(Vs.debug("-- type=(SET) mode set"),d=this.co(),63==this.Gu)for(var C=0;C<d.length;C++)switch(g=d[C]){case 1:i.fl=1;break;case 2:i.qr=!1;break;case 3:i.Bu(),i.Kl=i.Wl(),i._l=1,2===i.ql&&(i.ve=i.hu(),i.Zl=0),i.Nr(0),i.mh(24),i.resize(132,24),i.width=132,i.height=24;break;case 4:i.zl=!0;break;case 5:i.Gl=!0,i.ai.ue();break;case 6:i.or=!0,i.yh(0,0);break;case 7:i.il=!0;break;case 8:i.Sl=!0;break;case 12:i.ai.Qi();break;case 25:i.Wt=!0,i.ai.Vi();break;case 42:this.bo("unhandled DECNRCM: National Replacement Character Set Mode.");break;case 11:Vs.warn("Not implemented: decipoints instead of row/column");case 64:break;case 66:i.Br=!0;break;case 67:i.Yl=!1;break;case 69:i.Eo=!0;break;case 81:this.bo("unhandled DECKPM Key Position Mode");break;default:this.bo("mode setting case=?"+g)}else{if(0===d.length){this.bo("Mode setting default case");break}for(C=0;C<d.length;C++)switch(g=d[C]){case 2:Vs.debug("Mode setting: lock keyboard"),this.screen.Tl=!0;break;case 4:Vs.debug("Mode setting: insert mode"),this.screen.Ml=1;break;case 12:Vs.debug("Mode setting: send/receive mode (SRM), local echo off"),this.screen.Pl=!1;break;case 20:Vs.debug("Setting LNM true"),this.screen.xl=!0;default:this.bo("Mode setting case="+g)}}break;case 105:Vs.debug("-- type=(MC) media copy"),this.bo("various printing options");break;case 108:if(Vs.debug("-- type=(RM) mode reset"),d=this.co(),63==this.Gu)for(C=0;C<d.length;C++)switch(g=d[C]){case 1:i.fl=0;break;case 2:i.qr=!0;break;case 3:i.Bu(),i.Kl=i.Wl(),i._l=1,2===i.ql&&(i.ve=i.hu(),i.Zl=0),i.Nr(0),i.mh(24),i.resize(80,24),i.width=80,i.height=24;break;case 4:i.zl=!1;break;case 5:i.Gl=!1,i.ai.ce();break;case 6:i.or=!1,i.yh(0,0);break;case 7:i.il=!1;break;case 8:i.Sl=!1;break;case 12:i.ai.Hi();break;case 25:i.Wt=!1,i.ai.Bi();break;case 42:this.bo("unhandled DECNRCM: National Replacement Character Set Mode.");break;case 34:case 64:break;case 66:i.Br=!1;break;case 67:i.Yl=!0;break;case 69:i.Eo=!1;break;case 1e3:this.bo("Xterm mode resetting: dont send mouse x&y on button press & release");break;case 1001:this.bo("Xterm mode resetting: dont use hilite mouse tracking");break;case 1002:this.bo("Xterm mode resetting: dont use cell motion mouse tracking");break;case 1003:this.bo("Xterm mode resetting: dont use all motion mouse tracking");break;case 1004:this.bo("Xterm mode resetting: dont send focusin/focusout events");break;case 1005:this.bo("Xterm mode resetting: disable utf-8 mouse mode");break;case 1006:this.bo("Xterm mode resetting: disable sgr mouse mode");break;case 1007:this.bo("Xterm mode resetting: disable alternate scroll mode");break;case 1010:this.bo("Xterm mode resetting: dont scroll to bottom on tty output (rxvt)");break;case 1011:this.bo("Xterm mode resetting: dont scroll to bottom on key press (rxvt)");break;case 1015:this.bo("Xterm mode resetting: disable urxvt mouse mode");break;case 1034:this.bo("Xterm mode resetting: dont interpret meta key");break;case 11:Vs.warn("Not implemented: decipoints instead of row/column");default:this.bo("Suspected Xterm mode resetting, b="+g)}else{if(0===d.length){this.bo("Mode resetting default case");break}for(C=0;C<d.length;C++)switch(g=d[C]){case 2:Vs.debug("Mode resetting: lock keyboard"),this.screen.Tl=!1,Vs.debug("Mode resetting warning: not supposed to unlock if locked by DC3");break;case 4:Vs.debug("Mode resetting: replace mode"),this.screen.Ml=2;break;case 12:Vs.debug("Mode setting: send/receive mode (SRM), local echo on"),this.screen.Pl=!0;break;case 20:Vs.debug("Resetting LNM false"),this.screen.xl=!1;default:this.bo("Mode resetting case="+g)}}break;case 109:for(Vs.debug("-- type=(SGR) set graphics rendition"),0==(d=this.co()).length&&(d=[0]),C=0;C<d.length;)switch(g=d[C]){case 0:i.te=0,i.ie=Mn.ee,i.$i=0,i.re=Mn.ee,i.he=0,C++;break;case 1:i.te|=16,i.te&=-33,C++;break;case 2:i.te&=-17,i.te|=32,C++;break;case 4:i.te|=4,C++;break;case 5:i.te|=8,C++;break;case 7:i.te|=2,C++;break;case 8:i.te|=64,C++;break;case 21:i.te&=-17;break;case 22:i.te&=-17,i.te&=-33,C++;break;case 24:i.te&=-5,C++;break;case 25:i.te&=-9,C++;break;case 27:i.te&=-3,C++;break;case 28:i.te&=-65,C++;break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:i.ie=Mn.se,i.$i=g-30,Vs.debug("Set color mode=STANDARD, value=0x"+Ji(i.$i)),C++;break;case 38:if(C+1<d.length&&5==d[C+1])C+2<d.length?(i.ie=Mn.ne,i.$i=d[C+2],Vs.debug("Set color mode=TABLE, value=0x"+Ji(i.$i)),C+=3):(Vs.warn("Could not set color mode, bad TABLE color parameter="+e),C++);else if(C+1<d.length&&2==d[C+1])if(C+4<d.length){var m=Math.max(0,Math.min(255,d[2])),v=Math.max(0,Math.min(255,d[3])),S=Math.max(0,Math.min(255,d[4]));i.ie=Mn.le,i.$i=m<<16|v<<8|S,Vs.debug("Set color mode=RGB, value=0x"+Ji(i.$i)),C+=5}else Vs.warn("Could not set color mode, bad RGB color parameter="+e),C++;else Vs.warn("Unexpected parameter for SGM="+e),C++;break;case 39:i.ie=Mn.ee,i.$i=0,i.te&=-17,i.te&=-33,Vs.debug("Set color mode=DEFAULT"),C++;break;case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:i.re=Mn.se,i.he=g-40,Vs.debug("Set bg color mode=STANDARD, value=0x"+Ji(i.$i)),C++;break;case 48:C+1<d.length&&5==d[C+1]?C+2<d.length?(i.re=Mn.ne,i.he=d[C+2],Vs.debug("Set bg color mode=TABLE, value=0x"+Ji(i.he)),C+=3):(Vs.warn("Could not set bg color mode, bad TABLE color parameter="+e),C++):C+1<d.length&&2==d[C+1]?C+4<d.length?(m=Math.max(0,Math.min(255,d[2])),v=Math.max(0,Math.min(255,d[3])),S=Math.max(0,Math.min(255,d[4])),i.re=Mn.le,i.he=m<<16|v<<8|S,Vs.debug("Set bg color mode=RGB, value=0x"+Ji(i.he)),C+=5):(Vs.warn("Could not set bg color mode, bad RGB color parameter="+e),C++):(Vs.warn("Unexpected parameter for bg SGM="+e),C++);break;case 49:i.re=Mn.ee,i.he=0,Vs.debug("Set bg color mode=DEFAULT"),C++;break;case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:i.ie=Mn.se,i.$i=g-90,i.te|=16,i.te&=-33,Vs.debug("Set color mode=STANDARD BOLD, value=0x"+Ji(i.$i)),C++;break;default:Vs.warn("Unexpected graphic rendering value="+d[C]+" in parameters="+e),C++}break;case 110:Vs.debug("-- type=(DSR) device status report");var g=this.co();let nt=this.ko("CSI");if(63===this.Gu&&s.length)switch(s[0]){case 6:Vs.debug("-- type=(DECXCPR) Extended Cursor Position"),nt.push(63,...this.ke(i),82),Vs.debug("Sending response for Device Status Report: "+nt),i.Pr(nt);break;case 15:Vs.debug("Printer Status"),nt.push(63,49,51,110),i.Pr(nt);break;case 25:Vs.debug("UDK Status"),nt.push(63,50,48,110),i.Pr(nt);break;case 26:Vs.debug("DSR Test; Keyboard Status"),nt.push(63,50,55,59,49,110),i.Pr(nt);break;case 53:Vs.debug("Test Locator Status"),i.Pr(nt);break;case 62:Vs.debug("DSR Test; Macro Space"),nt.push(48,42,123),i.Pr(nt);break;case 63:Vs.debug("-- type=(DECCKSR) Memory Checksum Report");const t=nl(),e=this.ko("DCS"),n=this.ko("ST"),l=s[1].toString().charCodeAt(0);Vs.debug("Sending response for Memory Checksum Report: "+nt),i.Pr([...e,l,33,126,...t,...n]);break;case 75:Vs.debug("Test Data Integrity"),nt.push(63,55,48,110),i.Pr(nt);break;case 85:Vs.debug("Test Multiple Session Status"),nt.push(63,56,55,110),i.Pr(nt);break;default:this.bo("DSR with ? mark")}else if(g&&void 0!==g[0])switch(g[0]){case 5:nt.push(48,110),Vs.debug("Sending response for Device Status Report: "+nt),i.Pr(nt);break;case 6:var E=String(i.gh()+1),y=String(i.me+1);for(C=0;C<E.length;C++)nt.push(E.charCodeAt(C));for(nt.push(59),C=0;C<E.length;C++)nt.push(y.charCodeAt(C));nt.push(82),Vs.debug("Sending response for Device Status Report: "+nt),i.Pr(nt);break;default:this.bo("Device Status Report (DSR) case"+g)}break;case 112:if(d=this.co(),this.qu&&34==this.qu[0]){if(Vs.debug("-- type=(STR) Soft terminal reset"),d.length>0){switch(d[0]){case 61:this.Jo=!0;break;case 62:if(d.length>1)switch(d[1]){case 0:this.Jo=!1;break;case 1:case 2:this.Jo=!1}else this.Jo=!1}i.cu(0)}}else if(this.qu&&33==this.qu[0])Vs.debug("-- type=(DECSTR) Soft terminal reset"),i.cu(0),i.ai.Vi(),i.Ml=2,i.or=!1,i.il=!1,this.bo("unhandled DECNRCM: National Replacement Character Set Mode."),i.Tl=!1,i.Br=!1,i.fl=0,i.yl=0,i.Dl=i.height-1,i.Eh(i.height-1),i.yh(0,0),i.wl=Mn.Al(),i.pl=0,i.bl=1,i.te=0,i.el=!1,i.sl=0,i.ho(),this.bo("unhandled DECAUPSS:\tSet selected in Set-Up."),i.jl=0,this.bo("unhandled DECKPM: Key Position Mode"),this.bo("unhandled DECRLM: Reset (Left-to-right), regardless of NVR setting"),this.bo("unhandled DECPCTERM: Enter/Exit PCTerm or Scancode Mode");else if(this.jo([parseInt("0x24",16)])&&1===s.length){Vs.debug("-- type=(DECRQM) Request Mode - Host To Terminal");const e=s[0];if(this.Gu)if(63===this.Gu){Vs.debug("Requesting DEC Modes: CSI ? Pd $ p");const t=this.So(e);Vs.debug(`Sending response for Requesting DEC Mode ${e}: ${t}`),i.Pr(t)}else this.Uo(t,s);else{Vs.debug("Requesting ANSI Modes: CSI Pa $ p");const t=this.vo(e);Vs.debug(`Sending response for Requesting ANSI Mode ${e}: ${t}`),i.Pr(t)}}else this.Uo(t,s);break;case 113:if(this.qu&&34==this.qu[0]){Vs.debug("-- type=(DECSCA) Select Character Protection Attribute"),i.el=!!s.length&&1===s[0],i.sl=s.length?s[0]:0;break}break;case 114:if(d=this.co(),this.qu&&36==this.qu[0])return Vs.debug("-- type=(DECCARA) change attributes of rect area"),void(d.length>4?this.Bo(d):Vs.warn("wrong params for change attributes of rect area "+d));if(Vs.debug("-- type=(STBM) set top and bottom margins"),i.wr())return;2!=(d=this.co()).length||d[0]>=d[1]?(i.yl=0,i.Dl=i.height-1):(i.yl=null,i.Dl=null,i.yl=d[0]>0?d[0]-1:0,i.Dl=d[1]>0?d[1]-1:0,i.Ch(),i.Eh(i.Dl)),i.yh(0,0);break;case 115:Vs.debug("-- type=(DECSLRM) set left & right margins (if enabled) ELSE (SCP) save cursor position"),i.Eo?0==(d=this.co()).length?i.yh(0,0):2==d.length&&d[0]<d[1]&&Vs.warn("set left and right margin is not supported yet."):(Vs.debug("-- type=(SCOSC) Save Current Cursor Position"),i.ho());break;case 116:if(d=this.co(),this.qu&&36==this.qu[0])return Vs.debug("-- type=(RARA) Reverse attributes in rectangle"),d.length>4?this.Bo(d,!0):Vs.warn("wrong params for change attributes of rect area "+d),void i.ai.Tt();if(this.qo()&&0===s.length||1===s.length){Vs.debug("-- type=(DECSLPP) Set Lines Per Page");const t=!s||s[0]<24?24:s[0]>144?144:s[0];if(i.kl)return void Vs.warn("DECSLPP shouldn't work in max screen size mode");t!==i.height&&(i.ll=t,i.Ah(),i.Sh(i._l,!0,t),i.Kh())}else this.Uo(t,s);break;case 117:if(this.qu&&1===this.qu.length&&36===this.qu[0]){if(Vs.debug("-- type=(DECRQTSR) Request Terminal State Report"),0===s.length||0===s[0])break;if(1===s[0]){const t=[...this.ko("DCS"),49,36,115,...this.mo(),...this.ko("ST")];Vs.debug("Sending response for Request Terminal State Report: "+t),i.Pr(t)}}else if(this.jo([parseInt("0x26",16)])&&0===s.length){Vs.debug("-- type=(DECRQUPSS) User-Preferred Supplemental Set");const t=[49,33,117,65],e=[...this.ko("DCS"),...t,...this.ko("ST")];Vs.debug("Sending response for User-Preferred Supplemental Set: "+e),i.Pr(e)}else this.qo()&&0===s.length?(Vs.debug("-- type=(SCORC) Restore Saved Cursor Position"),i.ro()):this.Uo(t,s);break;case 118:if(d=this.co(),this.qu&&34==this.qu[0]){Vs.debug("-- type=(DECRQDE) Request Displayed Extent");const t=[...this.ko("CSI"),...this.Co(i.height),59,...this.Co(i.width),59,49,59,...this.Co(i.Xr()),59,...this.Co(i._l),34,119];Vs.debug("Sending response for Request Displayed Extent: "+t),i.Pr(t);break}if(Vs.debug("-- type=(CRA) Copy rectangle"),void 0!==d[0]&&0!=d[0]||(d[0]=1),d[0]>i.height&&(d[0]=i.height),void 0!==d[1]&&0!=d[1]||(d[1]=1),d[1]>i.width&&(d[1]=i.width),void 0!==d[2]&&0!=d[2]||(d[2]=i.height),d[2]>i.height&&(d[2]=i.height),void 0!==d[3]&&0!=d[3]||(d[3]=i.width),d[3]>i.width&&(d[3]=i.width),d[1]>d[3])break;if(d[0]>d[2])break;void 0!==d[4]&&0!=d[4]||(d[4]=1),void 0!==d[5]&&0!=d[5]||(d[5]=1),d[5]>i.height&&(d[5]=i.height),void 0!==d[6]&&0!=d[6]||(d[6]=1),d[6]>i.width&&(d[6]=i.width),void 0!==d[7]&&0!=d[7]||(d[7]=1),i.Ah(),i.Dh(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7]),i._l==d[7]&&i.Sh(i._l,!0),i.ai.Tt();break;case 119:if(this.qu&&36===this.qu[0]&&s.length>0){Vs.debug("-- type=(DECRQPSR) Request Presentation State Report");const t=s[0],e=this.ko("DCS"),n=this.ko("ST");if(0===t)return void Vs.debug("Error Request ignored: ps = 0, DECRQPSR-Request Presentation State Report");if(1===t){Vs.debug("-- type=(DECCIR) Cursor information report");const t=this.ke(i),s=64,l=i.pl.toString().charCodeAt(0),h=i.bl.toString().charCodeAt(0),r=64+hl(i.te),u=i.el?1000001:1e6,o=i.wl,a=t=>t?"1":"0",c="01000"+a(i.al)+a(i.ol)+a(i.or),f=[...e,49,36,117,...t,59,r,59,u,59,parseInt(c,2),59,l,59,h,59,s,59,...o,...n];Vs.debug("Sending response for Cursor information report: "+f),i.Pr(f)}else if(2===t){Vs.debug("-- type=(DECRQPSR) Request Presentation State Report");const t=i.Vl.slice(0,i.width-1);let s=[...e,50,36,117];t.forEach((t,i)=>{1===t&&(s.push(...this.Co(i+1)),s.push(47))}),s.pop();const l=[...s,...n];Vs.debug("Sending response for Request Presentation State Report: "+l),i.Pr(l)}}Vs.debug("-- type=(EFR) Enable filter rectangle"),this.Go(t);break;case 120:if(d=this.co(),this.qu&&42==this.qu[0])Vs.debug("-- type=(DECSACE) Select Attribute Change Extent"),this.Qu=d.length?d[0]:0;else{if(Vs.debug("-- type=(REQTPARM) Request terminal parameters OR (FRA) Fill rectangular"),void 0!==d[1]&&0!=d[1]||d[1],void 0!==d[2]&&0!=d[2]||d[2],void 0!==d[3]&&0!=d[3]||(d[3]=i.height),void 0!==d[4]&&0!=d[4]||(d[4]=i.width),d[1]>i.height&&(d[1]=i.height),d[2]>i.width&&(d[2]=i.width),d[3]>i.height&&(d[3]=i.height),d[4]>i.width&&(d[4]=i.width),null==d[0]||d[0]<32||d[0]>126&&d[0]<160){Vs.warn("-- type=(DECFRA) Invalid fill character");break}if(numCol=d[4]-d[2]+1,numRow=d[3]-d[1]+1,numCol||(numCol=d[4]),numRow||(numRow=d[3]),i.zn<d[3])for(var D=0;D<d[3];D++)i.bh();if(numCol>0&&numRow>0){var R=i.Li;for(C=0;C<d[1]-1&&R;C++)R=R.next;for(C=0;C<numRow;C++)if(R){for(a=d[2]-1;a<d[4];a++){R.elements[a]?R.elements[a].ji=d[0]:R.elements[a]=new Sn(d[0]),R.elements[a].Zi=i.wl[i.pl],R.elements[a].Ji=i.wl[i.bl],R.elements[a].el=i.el;var T=i.te;T&=-129,T&=-257,T&=-513,R.elements[a].te&=896,R.elements[a].te|=T,R.elements[a].ie=i.ie,R.elements[a].$i=i.$i,R.elements[a].re=i.re,R.elements[a].he=i.he,R.elements[a].el=i.el}if(!R||!R.next)break;R=R.next}}else Vs.warn("wrong params of fill the rectangle area "+d);i.ai.Tt()}break;case 121:const lt=this.co();if(this.qu&&42==this.qu[0]){if(lt.length>0){Vs.debug("--type=(DECRQCRA) Request Checksum of Rectangular Area");const t=lt[0].toString().charCodeAt(0),e=nl(),s=[...this.ko("DCS"),t,33,126,...e,...this.ko("ST")];Vs.debug(`Sending response for Request Checksum of Rectangular Area: ${s} `),i.Pr(s);break}Vs.warn("wrong params of Request Checksum of Rectangular Area");break}Vs.debug("-- type=(SACE) Select attribute change extent"),this.Go(t);break;case 122:case 123:if(Vs.debug("-- type=(DECERA)  (ERA) Erase rectangular"),4==(d=this.co()).length){if(d[2]>i.height&&(d[2]=i.height),d[3]>i.width&&(d[3]=i.width),numCol=d[3]-d[1]+1,numRow=d[2]-d[0]+1,numCol||(numCol=d[3]),numRow||(numRow=d[2]),numCol>0&&numRow>0){for(R=i.Li,C=0;C<d[0]-1&&R;C++)R=R.next;for(C=0;C<numRow;C++)if(R){for(a=d[1]-1;a<d[3];a++)123==t?R.elements[a]&&R.elements[a].el||(R.elements[a].ji=32):R.elements[a]&&(R.elements[a].ji=32);if(!R||!R.next)break;R=R.next}}else Vs.warn("wrong params of erasing the rectangle area "+d);i.ai.Tt()}break;case 124:if(this.qu&&36===this.qu[0]){Vs.debug("-- type=(DECSCPP)  Select Columns per Page");const t=s.length>0?s[0]:80;[0,132,80].indexOf(t)>-1?(i.nl=t||80,i.resize(i.nl,i.height,!0),i.Nr(Math.min(i.me,i.nl))):Vs.debug("-- type=(DECSCPP) The value is error when select Columns per Page")}else if(this.qu&&42===this.qu[0]&&s.length>0){Vs.debug("-- type=(DECSNLS)  Set Lines Per Screen");let t=Math.max(24,Math.min(s[0],144));if(i.kl)return void Vs.warn("DECSNLS shouldn't work in max screen size mode");i.hl=t,i.Rt(t)}case 125:const ht=this.qu;if(ht&&1===ht.length&&39==ht[0])if(Vs.debug("-- type=(DECIC) Insert Column"),0===s.length||1===s.length){let t=0===s.length?1:s[0];i.du(Mn.Fn,i.me,i.Kn,i.zn,t)}else Vs.warn("wrong params of inserting columns(DECIC): "+s);else if(ht&&1===ht.length&&36==ht[0]){Vs.debug("-- type=(DECSASD) Select active status display");const t=1===s[0]&&2===i.ql?1:0;i.jl!==t&&(1===t?(i.Wt=!1,i.ai.Bi()):(i.Wt=!0,i.ai.Vi()),i.jl=t)}else this.Uo(t,s);break;case 126:if(this.qu&&1===this.qu.length&&39==this.qu[0])if(Vs.debug("-- type=(DECDC) Delete Column"),0===s.length||1===s.length){let t=0===s.length?1:s[0];i.du(Mn.xn,i.me,i.Kn,i.zn,t)}else Vs.warn("wrong params of deleting columns(DECDC): "+s);else if(this.qu&&1===this.qu.length&&36===this.qu[0]){Vs.debug("-- type=(DECSSDT) Select Status Display (Line) Type");let e=s.length?s[0]:0;i.nu(e)?i.cu(e):this.Uo(t,s)}else this.Uo(t,s);break;default:this.bo("unhandled CSI dispatch character:0x"+Ji(t))}},il.prototype.Xo=function(t){const i=this.screen.Ir();if(i&&i.elements){for(let e=0;e<i.elements.length;e++)i.elements[e]||(i.elements[e]=new Sn(32)),i.elements[e].te=t;i.updated=!0}},il.prototype.Yo=function(){var t=this.screen,i=this.to,e=Number(String.fromCharCode.apply(null,this.$u));switch(Vs.debug("OSC dispatch: type="+e+", params="+i),e){case 0:let s=String.fromCharCode.apply(null,i);t.callbacks.titleCallback&&t.callbacks.titleCallback(s);break;case 4:this.bo("OSC change color");break;case 5:this.bo("OSC change special color");break;case 10:this.bo("Change text color w/ OSC4 spec");break;case 11:this.bo("Change backkground color w/ OSC4 spec");break;case 15:this.bo("Change TEK text color w/ OSC4 spec");break;case 16:this.bo("Change TEK background color w/ OSC4 spec");break;case 52:this.bo("OSC clipboard access");break;case 104:this.bo("Reset color number");break;case 105:this.bo("Reset special color number");break;case 110:this.bo("Reset window text color");break;case 111:this.bo("Reset window background color");break;case 115:this.bo("Reset TEK window text color");break;case 116:this.bo("Reset TEK window background color");break;default:Vs.warn("Unknown OSC type "+e+" encountered with params="+i)}},il.prototype.$o=function(t){var i=this.screen;Vs.debug("Escape Dispatch Start:"),Vs.debug("-- b=0x"+Ji(t)),this._u[this.Ku++]=t,Xi(this._u,Vs,0,this.Ku);var e=255&this._u[1];switch(e){case 32:var s=255&this._u[2];if(i.Jo||i.qr)i.dl=!1;else switch(s){case 70:i.dl=!1;break;case 71:i.dl=!0}break;case 35:if(this._u.length<2)throw new fn("Encountered escape # without following byte to determine action");{s=255&this._u[2];let t=i.te;switch(s){case 51:t|=256,t&=-129,t&=-513,this.Xo(t);break;case 52:t|=512,t&=-257,t&=-129,this.Xo(t);break;case 53:t&=-129,t&=-257,t&=-513,this.Xo(t);break;case 54:t|=128,t&=-257,t&=-513,this.Xo(t);break;case 56:Vs.debug("-- type=(DECALN) Screen Alignment Pattern"),i.yl=0,i.Dl=i.height-1;var n=i.Kn;n||(i.bh(),n=i.Kn);for(var l=0;l<i.height;l++){for(var h=0;h<i.width;h++)n.elements[h]=new Sn(69);n.updated=!0,l!==i.height-1&&(n.next||i.bh(),n=n.next)}i.Ou(0,0);break;default:this.bo("escape dispatch byte 0x23, modifier "+s)}}break;case 37:if(this._u.length<2)this.ta("Escape % seen with no following char");else switch(s=255&this._u[2]){case 64:i.Yi=!1;break;case 71:i.Yi=!0;break;default:Vs.warn("Unhandled ESC % byte=0x"+Ji(s)+" assumed to be used for UTF8")}break;case 40:case 41:case 42:case 43:if(3==this.Ku){var r=255&this._u[2];Vs.debug("should set Gx x=0x"+Ji(e-40)+" to 0x"+r),i.wl[e-40]=t}else Vs.warn("unhandled set G0-G3 case");break;case 54:Vs.debug("-- type=(DECBI) Back Index"),i.Fr();break;case 55:i.ho();break;case 56:if(i.wr())break;i.ro();break;case 60:i.qr=!1;break;case 61:i.Br=!0;break;case 62:i.Br=!1;break;case 57:Vs.debug("-- type=(DECFI) - Forward Index"),i.Hr();break;case 65:Vs.debug("-- type=VT52 Cursor Up"),i.gu(-1,0);break;case 66:Vs.debug("-- type=VT52 Cursor Down"),i.gu(1,0);break;case 67:Vs.debug("-- type=VT52 Cursor Right"),i.gu(0,1);break;case 68:i.qr?(Vs.debug("-- type=VT52 Cursor Left"),i.gu(0,-1)):(Vs.debug("-- type=(IND) Index down"),this.do(i,!0));break;case 69:Vs.debug("-- type=(NEL) Next line"),this.do(i);break;case 72:if(i.qr){Vs.debug("-- type=Move cursor home");var u=i.gh();i.yh(u,0)}else Vs.debug("-- type=(HTS) Horizontal Tab set"),i.Vl[i.xr()]=1;break;case 73:break;case 77:if(i.wr())break;this.wo(i);break;case 78:i.ol=!0;break;case 79:i.al=!0;break;case 80:this.bo("P!");break;case 90:break;case 92:Vs.debug("escapeDispatch 0x5C string terminator ");break;case 95:Vs.debug("unimplemented escape code 0x5F");break;case 99:Vs.debug("-- type=(RIS) --Hard Terminal Reset"),Vs.warn("(RIS --Hard Terminal Reset) is not recommended. Please use (DECSTR -- Soft Terminal Reset) instead "),i.Pr([19]),i.cu(0),i.Kl=i.Wl(),i._l=1,i.te=0,i.wl=Mn.Al(),i.pl=0,i.bl=1,i.vr(),this.bo("DECUDK -- User defined keys"),this.bo("DECDLD -- Soft character set"),this.bo("DECDMAC -- Macro definitions"),i.Pr([17]);break;case 125:Vs.warn("need to set G2 ");break;default:this.bo("unhandled ESCAPE dispatch character=0x"+Ji(e))}this.Gu=0},il.prototype.ia=function(t){return t<=23||25==t||t>=28&&t<32},il.prototype.ea=function(t){return t<=23||25==t||t>=28&&t<32||127==t||132==t||133==t||136==t||141==t||142==t||143==t},il.prototype.sa=function(t){if(t<192)throw new fn("UTF8 cannot have first byte below C0");var i=255&~t;if(i>=32)this.na=1;else if(i>=16)this.na=2;else if(i>=8)this.na=3;else if(i>=4)this.na=4;else{if(!(i>=2))throw new fn("Unexpectedly high first byte value for UTF8");this.na=5}},il.prototype.Co=function(t){let i=[];t=(t||0).toString();for(var e=0;e<t.length;e++)i.push(t.charCodeAt(e));return i},il.prototype.ke=function(t){return[...this.Co(t.gh()+1),59,...this.Co(t.me+1),59,...this.Co(t._l)]},il.prototype.process=function(t){_s.debug("Parser Loop Top: b=0x"+Ji(t)+" state="+il.la[this.state]);var i=0;const e=this.screen.Pu;switch(this.state){case 1:e.Fu++,this.ea(t)?(this.Io(t),i=1):t<32||(255===t?i=12:!0===this.screen.Yi&&t>=192&&t<=253?(this.ha=[],this.ha.push(t),this.sa(t),i=17):t>127||this.xo(t)),12!=i&&(this.screen.je=!0);break;case 17:if(this.ha.push(t),this.na--,0===this.na){var s=il.io(this.ha);this.xo(s),i=1}break;case 12:switch(this.es=t,this.es){case 255:i=1,this.xo(t);break;case 250:i=14;break;case 251:case 252:case 253:case 254:i=13;break;case 247:this.Io(127);break;case 240:case 242:case 241:case 249:default:i=1}break;case 13:this.Mo(t),i=1;break;case 14:if(255===t){this.To(),i=12;break}this.ss.push(t),i=14;break;case 10:t>=32&&t<48?(this.collect(t),i=19):t>=48&&t<64||59==t?(this.No(t),i=20):t>=60&&t<64?(this.collect(t),i=20):58==t?i=22:t>=64&&t<127&&(this.zu=t,i=21);break;case 19:t>=32&&t<48?(this.collect(t),i=19):t>=48&&t<64?i=22:t>=64&&t<127&&(this.zu=t,i=21);break;case 20:t>=48&&t<64||59==t?(this.No(t),i=20):58==t||t>=60&&t<64?i=22:t>=32&&t<48?(this.collect(t),i=19):t>=64&&t<127&&(this.zu=t,i=21);break;case 22:this.ra?(92==t&&(i=1),this.ra=!1):156==t?i=1:27==t&&(this.ra=!0,i=22);break;case 21:this.ra?(92==t||156==t?this.Ao():Vs.warn("This is not a complete DCS-ST command, it should 1b5b/9c, but get 1b"+t),i=1,this.ra=!1):27==t?(this.ra=!0,i=21):(this.qu.push(t),Vs.debug("DCS Passthrough partially implemented"),i=21);break;case 7:if(this.ia(t))i=this.Io(t)?1:7;else{if(this.Ku=0,this._u[this.Ku++]=27,this._u[this.Ku++]=t,t<32)throw new ll("VT_ESCAPE_START sees b<0x20");if(t>=32&&t<48)i=8;else switch(_s.debug("escape dispatch main switch"),t){case 80:i=10;break;case 91:i=2;break;case 93:i=6;break;default:t<127?(this.$o(t),i=1):Vs.warn("VT_ESCAPE_START sees b>=0x7f")}}break;case 8:if(this.ia(t))i=this.Io(t)?1:8;else{if(t<32)throw new ll("unhandled byte=0x"+Ji(t)+" in VT_ESCAPE_INTERMEDIATE");t<48?(this.collect(t),i=8):t<127?(this.$o(t),i=1):127==t&&(i=8)}break;case 6:t>=32&&t<=127&&(this.$u.push(t),i=15);break;case 15:59===t?i=16:this.$u.push(t);break;case 16:7===t||156===t?(this.Yo(),i=1):this.to.push(t);break;case 2:this.ia(t)?i=this.Io(t)?1:2:t>=32&&t<48?(this.collect(t),i=3):t<58?(this.No(t),i=5):t<60?58==t?i=4:(i=5,this.No(t)):t<64?(this.collect(t),i=5):t<127?(this.Zo(t),i=1):t<2&&(i=2);break;case 5:if(this.ia(t))i=this.Io(t)?1:5;else if(t>=32&&t<48)this.collect(t),i=3;else if(t>=48&&t<58||59==t)this.No(t),i=5;else if(58==t||t>=60&&t<64)i=4;else{if(!(t<127))throw new ll("unhandled byte "+t+" in VT_CSI_PARAM");this.Zo(t),i=1}break;case 4:if(this.ia(t))i=this.Io(t)?1:4;else{if(t<32)throw new ll("unhandled byte "+t+" in VT_CSI_IGNORE");if(t<64||127==t)i=4;else{if(!(t<127))throw new ll("unhandled byte "+t+" in VT_CSI_IGNORE");i=1}}break;case 3:if(this.ia(t))i=this.Io(t)?1:3;else{if(t<32)throw new ll("unhandled byte "+t+" in VT_CSI_INTERMEDIATE");if(t<48)this.collect(t),i=3;else if(t<64)i=4;else if(t<127)this.Zo(t),i=1;else{if(127!=t)throw new ll("unhandled byte "+t+" in VT_CSI_INTERMEDIATE");i=3}}}if(0==i)switch(t){case 27:this.state=7;break;case 144:this.state=10;break;case 155:this.state=2,this.clear(),this.Ku=0,this._u[this.Ku++]=27,this._u[this.Ku++]=91;break;case 157:this.state=6}else{if(this.state!=i)switch(i){case 6:case 2:case 7:case 10:this.clear()}this.state=i}},il.la=["NO_STATE","VT_BASE","VT_CSI_START","VT_CSI_INTERMEDIATE","VT_CSI_IGNORE","VT_CSI_PARAM","VT_OSC_STRING","VT_ESCAPE_START","VT_ESCAPE_INTERMEDIATE","VT_SOS_PM_APC","VT_DCS_START","VTF","VT_TELNET_VERB","VT_TELNET_OPTION","VT_TELNET_SUB","VT_OSC_INTERMEDIATE","VT_OSC_PARAM","VT_UTF8","VT_CONTROL_CHAR","VT_DSC_INTERMEDIATE","VT_DCS_PARAM","VT_DCS_PASSTHROUGH","VT_DCS_IGNORE"];exports.startVT=startVT;return exports;}("undefined"==typeof org_zowe_terminal_vt?org_zowe_terminal_vt={}:org_zowe_terminal_vt);
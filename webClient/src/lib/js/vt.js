/*
 This program and the accompanying materials are
 made available under the terms of the Eclipse Public License v2.0 which accompanies
 this distribution, and is available at https://www.eclipse.org/legal/epl-v20.html

 SPDX-License-Identifier: EPL-2.0

 Copyright Contributors to the Zowe Project.
*/
! function(exports) {if(!window.COM_RS_COMMON_LOGGER){window.COM_RS_COMMON_LOGGER=function(){console.log("Fallback logger loaded because common logger not found.")};var t=function(t){arguments.length>1&&(t=arguments[1]),console.log(t)};window.COM_RS_COMMON_LOGGER.makeComponentLogger=function(){return{info:t,warn:t,log:t,debug:t,severe:t}}}var e=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore");const l=1011,n=1001,i=4999,s=4001,r="Lucida Console, Monaco, monospace",h=240,u=241,o=245,a=242,c=247,f=249,w=250,d=251,p=252,b=253,v=254,k=255,m=0,A=1,g=3,C=5,S=6,T=24,y=25,E=29,F=31,x=32,P=33,M=34,N=35,R=36,D=38,I=39,L=40,_=46,O=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~"],U=3,V=[11,1,0],H=2,B=[4,5],z=1,J=2,j=3,W=4,G=5,$=6,X=7,K=8,q=273,Y={Copy:273,Paste:273},Q=1,Z=0,tt=0,et=1,lt=2,nt=80,it=77,st=66,rt=65,ht=42,ut=112,ot=63,at=43,ct=9,ft=88,wt=[88,32,91,93],dt=1,pt=[88,32,60,45,111,45,62],bt=2,vt=94,kt=53,mt=[43,67,82],At=74,gt=47,Ct=1,St=2,Tt=4,yt=8,Et=16,Ft=32,xt=64,Pt=128,Mt=256,Nt=0,Rt=1,Dt=2,It=16,Lt=64,_t=1,Ot=0,Ut=1,Vt=2,Ht=3,Bt=0,zt=1,Jt=2,jt=3,Wt=[49],Gt=[50],$t=[54],Xt=[55],Kt=[56],qt=[57],Yt=[49,53],Qt=[49,56],Zt=[50,49],te=[27,91,63,54,99],ee=[27,91,63,54,50,59,Wt,59,Gt,59,$t,59,Xt,59,Kt,99],le=[27,91,63,54,51,59,Wt,59,Gt,59,$t,59,Xt,59,Kt,99],ne=[27,91,63,54,52,59,Wt,59,Gt,59,$t,59,Xt,59,Kt,99],ie=[27,91,62,49,59,50,48,59,48,99],se=[27,91,62,50,52,59,50,48,59,48,99],re=[27,91,62,52,49,59,50,48,59,48,99],he=[[27,91,91,65],[27,91,91,66],[27,91,91,67],[27,91,91,68],[27,91,91,69],[27,91,91,70],[27,91,49,56,126],[27,91,49,57,126],[27,91,50,48,126],[27,91,50,49,126],[27,91,50,51,126],[27,91,50,52,126],[27,91,50,53,126],[27,91,50,54,126],[27,91,50,56,126],[27,91,50,57,126],[27,91,51,49,126],[27,91,51,50,126],[27,91,51,51,126],[27,91,50,52,126]],ue=[[27,91,49,49,126],[27,91,49,50,126],[27,91,49,51,126],[27,91,49,52,126],[27,91,49,53,126],[27,91,49,55,126],[27,91,49,56,126],[27,91,49,57,126],[27,91,50,48,126],[27,91,50,49,126],[27,91,50,51,126],[27,91,50,52,126],[27,91,50,53,126],[27,91,50,54,126],[27,91,50,56,126],[27,91,50,57,126],[27,91,51,49,126],[27,91,51,50,126],[27,91,51,51,126],[27,91,50,52,126]],oe={"Cursor Up":[[27,91,65],[27,79,65],[27,65]],"Cursor Down":[[27,91,66],[27,79,66],[27,66]],"Cursor Right":[[27,91,67],[27,79,67],[27,67]],"Cursor Left":[[27,91,68],[27,79,68],[27,68]]},ae={0:[[48],[27,79,112]],1:[[49],[27,79,113]],2:[[50],[27,79,114]],3:[[51],[27,79,115]],4:[[52],[27,79,116]],5:[[53],[27,79,117]],6:[[54],[27,79,118]],7:[[55],[27,79,119]],8:[[56],[27,79,120]],9:[[57],[27,79,121]],".":[[46],[27,79,110]],"+":[[43],[27,79,108]],"-":[[45],[27,79,83]],"*":[[42],[27,79,82]],"/":[[47],[27,79,81]],Enter:[[13],[27,79,77]]},ce={"Alt+ ":[27,32],"Alt+!":[27,33],'Alt+"':[27,34],"Alt+#":[27,35],"Alt+$":[27,36],"Alt+%":[27,37],"Alt+&":[27,38],"Alt+'":[27,39],"Alt+(":[27,40],"Alt+)":[27,41],"Alt+*":[27,42],"Alt++":[27,43],"Alt+,":[27,44],"Alt+-":[27,45],"Alt+.":[27,46],"Alt+/":[27,47],"Alt+0":[27,48],"Alt+1":[27,49],"Alt+2":[27,50],"Alt+3":[27,51],"Alt+4":[27,52],"Alt+5":[27,53],"Alt+6":[27,54],"Alt+7":[27,55],"Alt+8":[27,56],"Alt+9":[27,57],"Alt+:":[27,58],"Alt+;":[27,59],"Alt+<":[27,60],"Alt+=":[27,61],"Alt+>":[27,62],"Alt+?":[27,63],"Alt+@":[27,64],"Alt+A":[27,65],"Alt+B":[27,66],"Alt+C":[27,67],"Alt+D":[27,68],"Alt+E":[27,69],"Alt+F":[27,70],"Alt+G":[27,71],"Alt+H":[27,72],"Alt+I":[27,73],"Alt+J":[27,74],"Alt+K":[27,75],"Alt+L":[27,76],"Alt+M":[27,77],"Alt+N":[27,78],"Alt+O":[27,79],"Alt+P":[27,80],"Alt+Q":[27,81],"Alt+R":[27,82],"Alt+S":[27,83],"Alt+T":[27,84],"Alt+U":[27,85],"Alt+V":[27,86],"Alt+W":[27,87],"Alt+X":[27,88],"Alt+Y":[27,89],"Alt+Z":[27,90],"Alt+`":[27,96],"Alt+a":[27,97],"Alt+b":[27,98],"Alt+c":[27,99],"Alt+d":[27,100],"Alt+e":[27,101],"Alt+f":[27,102],"Alt+g":[27,103],"Alt+h":[27,104],"Alt+i":[27,105],"Alt+j":[27,106],"Alt+k":[27,107],"Alt+l":[27,108],"Alt+m":[27,109],"Alt+n":[27,110],"Alt+o":[27,111],"Alt+p":[27,112],"Alt+q":[27,113],"Alt+r":[27,114],"Alt+s":[27,115],"Alt+t":[27,116],"Alt+u":[27,117],"Alt+v":[27,118],"Alt+w":[27,119],"Alt+x":[27,120],"Alt+y":[27,121],"Alt+z":[27,122],"Alt+{":[27,123],"Alt+|":[27,124],"Alt+}":[27,125],"Alt+~":[27,126],"Control+a":[1],"Control+b":[2],"Control+c":[3],"Control+d":[4],"Control+e":[5],"Control+f":[6],"Control+g":[7],"Control+h":[8],"Control+i":[9],"Control+j":[10],"Control+k":[11],"Control+l":[12],"Control+m":[13],"Control+n":[14],"Control+o":[15],"Control+p":[16],"Control+q":[17],"Control+r":[18],"Control+s":[19],"Control+t":[20],"Control+u":[21],"Control+v":[22],"Control+w":[23],"Control+x":[24],"Control+y":[25],"Control+z":[26],"Control+@":[0],"Control+3":[27],"Control+[":[27],"Control+\\":[28],"Control+]":[29],"Control+^":[30],"Control+_":[31],KP_PF01:[27,79,80],KP_PF02:[27,79,81],KP_PF03:[27,79,82],KP_PF04:[27,79,83],PF1:[27,79,80],F1:ue[0],PF01:ue[0],PF2:[27,79,81],F2:ue[1],PF02:ue[1],PF3:[27,79,82],F3:ue[2],PF03:ue[2],PF4:[27,79,83],F4:ue[3],PF04:ue[3],F5:ue[4],PF05:ue[4],F6:ue[5],PF06:ue[5],F7:ue[6],PF07:ue[6],F8:ue[7],PF08:ue[7],F9:ue[8],PF09:ue[8],F10:ue[9],PF10:ue[9],F11:ue[10],PF11:ue[10],F12:ue[11],PF12:ue[11],F13:ue[12],PF13:ue[12],F14:ue[13],PF14:ue[13],F15:ue[14],PF15:ue[14],F16:ue[15],PF16:ue[15],F17:ue[16],PF17:ue[16],F18:ue[17],PF18:ue[17],F19:ue[18],PF19:ue[18],F20:ue[19],PF20:ue[19],"Page Up":[21],"Page Down":[22],Backspace:[8],Tab:[9],Escape:[27],Enter:[13],"Cursor Next Line":[27,91,69],"Cursor Previous Line":[27,91,70],"Horizontal Pos Abs":[27,91,71],"Cursor Back Tab":[27,91,90],"Print Screen":[27,91,48,105],"Reset Mode":[27,91,108],Delete:[127],"Delete (Linux)":[27,91,51,126],Home:[1],End:[5],Insert:[27,91,50,126]},fe={"Alt+ ":[27,32],"Alt+!":[27,33],'Alt+"':[27,34],"Alt+#":[27,35],"Alt+$":[27,36],"Alt+%":[27,37],"Alt+&":[27,38],"Alt+'":[27,39],"Alt+(":[27,40],"Alt+)":[27,41],"Alt+*":[27,42],"Alt++":[27,43],"Alt+,":[27,44],"Alt+-":[27,45],"Alt+.":[27,46],"Alt+/":[27,47],"Alt+0":[27,48],"Alt+1":[27,49],"Alt+2":[27,50],"Alt+3":[27,51],"Alt+4":[27,52],"Alt+5":[27,53],"Alt+6":[27,54],"Alt+7":[27,55],"Alt+8":[27,56],"Alt+9":[27,57],"Alt+:":[27,58],"Alt+;":[27,59],"Alt+<":[27,60],"Alt+=":[27,61],"Alt+>":[27,62],"Alt+?":[27,63],"Alt+@":[27,64],"Alt+A":[27,65],"Alt+B":[27,66],"Alt+C":[27,67],"Alt+D":[27,68],"Alt+E":[27,69],"Alt+F":[27,70],"Alt+G":[27,71],"Alt+H":[27,72],"Alt+I":[27,73],"Alt+J":[27,74],"Alt+K":[27,75],"Alt+L":[27,76],"Alt+M":[27,77],"Alt+N":[27,78],"Alt+O":[27,79],"Alt+P":[27,80],"Alt+Q":[27,81],"Alt+R":[27,82],"Alt+S":[27,83],"Alt+T":[27,84],"Alt+U":[27,85],"Alt+V":[27,86],"Alt+W":[27,87],"Alt+X":[27,88],"Alt+Y":[27,89],"Alt+Z":[27,90],"Alt+`":[27,96],"Alt+a":[27,97],"Alt+b":[27,98],"Alt+c":[27,99],"Alt+d":[27,100],"Alt+e":[27,101],"Alt+f":[27,102],"Alt+g":[27,103],"Alt+h":[27,104],"Alt+i":[27,105],"Alt+j":[27,106],"Alt+k":[27,107],"Alt+l":[27,108],"Alt+m":[27,109],"Alt+n":[27,110],"Alt+o":[27,111],"Alt+p":[27,112],"Alt+q":[27,113],"Alt+r":[27,114],"Alt+s":[27,115],"Alt+t":[27,116],"Alt+u":[27,117],"Alt+v":[27,118],"Alt+w":[27,119],"Alt+x":[27,120],"Alt+y":[27,121],"Alt+z":[27,122],"Alt+{":[27,123],"Alt+|":[27,124],"Alt+}":[27,125],"Alt+~":[27,126],"Control+a":[1],"Control+b":[2],"Control+c":[3],"Control+d":[4],"Control+e":[5],"Control+f":[6],"Control+g":[7],"Control+h":[8],"Control+i":[9],"Control+j":[10],"Control+k":[11],"Control+l":[12],"Control+m":[13],"Control+n":[14],"Control+o":[15],"Control+p":[16],"Control+q":[17],"Control+r":[18],"Control+s":[19],"Control+t":[20],"Control+u":[21],"Control+v":[22],"Control+w":[23],"Control+x":[24],"Control+y":[25],"Control+z":[26],"Control+@":[0],"Control+3":[27],"Control+[":[27],"Control+\\":[28],"Control+]":[29],"Control+^":[30],"Control+_":[31],PF1:[27,79,80],F1:he[0],PF01:he[0],PF2:[27,79,81],F2:he[1],PF02:he[1],PF3:[27,79,82],F3:he[2],PF03:he[2],PF4:[27,79,83],F4:he[3],PF04:he[3],F05:he[4],PF05:he[4],F06:he[5],PF06:he[5],F07:he[6],PF07:he[6],F08:he[7],PF08:he[7],F09:he[8],PF09:he[8],F10:he[9],PF10:he[9],F11:he[10],PF11:he[10],F12:he[11],PF12:he[11],F13:he[12],PF13:he[12],F14:he[13],PF14:he[13],F15:he[14],PF15:he[14],F16:he[15],PF16:he[15],F17:he[16],PF17:he[16],F18:he[17],PF18:he[17],F19:he[18],PF19:he[18],F20:he[19],PF20:he[19],"Page Up":[27,91,53,126],"Page Down":[27,91,54,126],Backspace:[8],Tab:[9],Escape:[27],Enter:[13],"Cursor Next Line":[27,91,69],"Cursor Previous Line":[27,91,70],"Horizontal Pos Abs":[27,91,71],"Cursor Back Tab":[27,91,90],"Print Screen":[27,91,48,105],"Reset Mode":[27,91,108],Delete:[127],"Delete (Linux)":[27,91,51,126],Home:[27,91,49,126],End:[27,91,52,126],Insert:[27,91,50,126]},we={"Set Mode 7800":[27,91,49,113],"Set Mode 7700":[27,91,50,113],"Set Mode 7300":[27,91,51,113],"Set Mode 8300":[27,91,52,113],"Set Mode Ansi":[27,91,53,113],"Save Cursor":[27,91,115],"Restore Cursor":[27,91,117],"Device Status":[27,91,110],"Scrolling Region":[27,91,114],"Set Graphic Rendition":[27,91,109],"End Host Print":[27,91,52,105],"Start Host Print":[27,91,53,105],"Cursor Position":[27,91,72],"Erase Data":[27,91,74],"Erase Line":[27,91,75],"Insert Line":[27,91,76],"Delete Line":[27,91,77],"Erase Area":[27,91,79],"Scroll Up":[27,91,83],"Scroll Down":[27,91,84],"Insert Character":[27,91,64],"Device Attributes":[27,91,99],"Hor/Vertical Position":[27,91,102],"Tab Clear":[27,91,103],"Set Mode":[27,91,104]},de=0,pe=1,be=0,ve=1,ke=2,me=3,Ae=20,ge="innerScrolling",Ce="scrollingDiv",Se="Inner";var Te=function(t){return t||0===t?t.toString(16):"<FAIL: Not A Number>"},ye=function(t,l,n,i){var s,r=n||0,h=i||t.length,u="";for(s=0;s<h;s++)u+=Te(t[r+s])+" ",s%16==15&&(l&&l.debug?l.debug(u):e.debug(u),u="");u.length>0&&(l&&l.debug?l.debug(u):e.debug(u))},Ee=function(t,e,l){return t<<16|e<<8|l};const Fe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,0,0,63,52,53,54,55,56,57,58,59,60,61,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,0,0,0,0,0,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],xe=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];var Pe=function(t){for(var e=[],l=(t.length,t.length),n=Math.floor(l/3),i=l-3*n,s=0,r=0;r<n;r++){let l=255&t[s++],n=255&t[s++],i=255&t[s++];e.push(Ne[l>>2]),e.push(Ne[l<<4&63|n>>4]),e.push(Ne[n<<2&63|i>>6]),e.push(Ne[63&i])}if(0!=i){let l=255&t[s++];if(e.push(Ne[l>>2]),1==i)e.push(Ne[l<<4&63]),e.push(61),e.push(61);else{let n=255&t[s++];e.push(Ne[l<<4&63|n>>4]),e.push(Ne[n<<2&63]),e.push(61)}}return String.fromCharCode.apply(null,e)},Me=function(t){var l=t.length,n=l/4,i=0,s=n,r=0,h=0;if(4*n!=l)return e.warn("Base64 decode failed, encountered 4-mult"),null;0!=l&&"="==t[l-1]&&(i++,s--,"="==t[l-2]&&i++);var u=3*s;0!=i&&(1==i?u+=2:u++);var o=new Uint8Array(u);let a=4*s;for(;r<a;){let e=Fe[t.charCodeAt(r++)],l=Fe[t.charCodeAt(r++)],n=Fe[t.charCodeAt(r++)],i=Fe[t.charCodeAt(r++)];o[h++]=e<<2|l>>4,o[h++]=l<<4|n>>2,o[h++]=n<<6|i}if(0!=i){let e=Fe[t.charCodeAt(r++)],l=Fe[t.charCodeAt(r++)];if(o[h++]=e<<2|l>>4,1==i){let e=Fe[t.charCodeAt(r++)];o[h++]=l<<4|e>>2}}return o};const Ne=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47];var Re=function(t){},De=function(t,e){switch(192&t){case 0:return(63&t)<<8|e;case 64:case 192:return(63&t)<<6|63&e;default:return Zl.warn("Bad SBA position, b1=0x"+Te(t)+", b2=0x"+Te(e)),0}},Ie=function(t,e){var l=(255&t[e])<<8;return 255&t[e+1]|l},Le=function(t,e){var l=(255&t[e])<<16,n=(255&t[e+1])<<8;return 255&t[e+2]|n|l},_e=function(t,e){var l=(255&t[e])<<8|255&t[e+1];return l>=32768?l-65536:l},Oe=function(t,e){var l=(255&t[e])<<24|(255&t[e+1])<<16|(255&t[e+2])<<8|255&t[e+3];return l>=2147483648?l-4294967296:l},Ue=function(t,e,l,n,i){var s;for(s=0;s<l;s++)n[s]=_e(t,e),i[s]=_e(t,e+2),e+=4;return e},Ve=function(t,e,l,n,i){var s;for(s=0;s<l;s++)n[s]=t[e+0],i[s]=t[e+1],e+=2;return e},He=function(t,e,l,n,i){var s;for(s=0;s<i;s++)l[n+s]=t[e+s]},Be=function(t,e){var l;for(l=0;l<t.length;l++)if(t[l]==e)return!0;return!1},ze=function(t,e,l){function n(){}for(var i in n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.A=e,t.C=e.prototype,l)t[i]=l[i]},Je=function(){this.size=0,this.S=null,this.T=null};Je.prototype={clear:function(){let t=this.size,e=this.S;for(let l=0;l<t-1;l++){e.P.F=void 0;let t=e.P;e.P=void 0,e=t}this.S=null,this.T=null,this.size=0},M:function(){let t=[],e=this.size;if(0==e)return t;let l=this.S;for(let n=0;n<e&&(t.push(l.data),l.P);n++){l.P.F=void 0;let t=l.P;l.P=void 0,l=t}return this.S=null,this.T=null,this.size=0,t},N:function(){return this.S},R:function(){return this.T},D:function(){return this.size},I:function(t){let e=new je(t);0==this.size?this.S=e:(e.F=this.T,this.T.P=e),this.T=e,this.size++},L:function(t){let e=new je(t);0==this.size?this.T=e:(e.P=this.S,this.S.F=e),this.S=e,this.size++},O:function(){if(0==this.size)return null;if(1==this.size){let t=this.T;return this.S=null,this.T=null,this.size=0,t.F=void 0,t.P=void 0,t}{this.size--;let t=this.T;return t.F.P=null,this.T=t.F,t.F=void 0,t.P=void 0,t}},U:function(){if(0==this.size)return null;if(1==this.size){let t=this.S;return this.S=null,this.T=null,this.size=0,t.F=void 0,t.P=void 0,t}{this.size--;let t=this.S;return t.P.F=null,this.S=t.P,t.F=void 0,t.P=void 0,t}},add:function(t,e){if(t<0||t>this.size)return-1;if(t==this.size)this.I(e);else if(0==t)this.L(e);else{let l=new je(e),n=this.size-1,i=this.S;for(let e=1;e<n;e++){if(e==t)return l.F=i,l.P=i.P,i.P.F=l,i.P=l,++this.size;i=i.P}}},V:function(t){if(t<0||t>=this.size)return null;if(t==this.size-1)return this.O();if(0==t)return this.U();{let e=this.size-1,l=this.S;for(let n=1;n<e;n++){if(n==t)return l.P.F=l.F,l.F.P=l.P,this.size--,l.F=void 0,l.P=void 0,l;l=l.P}}},get:function(t){if(t>=this.size||t<0)return null;if(0==t)return this.N();if(t==this.size-1)return this.R();{let e=this.size-1,l=this.S;for(let n=1;n<e;n++){if(n==t)return l;l=l.P}}}};var je=function(t){this.data=t,this.F,this.P};const We={Esc:"Escape",Nonconvert:"NonConvert",Spacebar:" ",ArrowLeft:"Left",ArrowRight:"Right",ArrowDown:"Down",ArrowUp:"Up",Del:"Delete","U+001B":"Escape","U+007F":"Delete","U+0008":"Backspace","U+0009":"Tab",OS:"Win",Meta:"Win",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MediaTrackNext:"MediaNextTrack",MediaTrackPrevious:"MediaPreviousTrack",AudioVolumeMute:"VolumeMute",AudioVolumeDown:"VolumeDown",AudioVolumeUp:"VolumeUp",Caps:"CapsLock",Ctrl:"Control",Ins:"Insert",Space:" ",Ent:"Enter"},Ge=0,$e=1,Xe=2,Ke=4,qe=3,Ye=5,Qe=6,Ze=7,tl=1,el=2,ll=4,nl=8;function il(t,e){this.type=t,this.value=e}function sl(t,e,l,n,i,s,r,h){var u=[];return u[Ge]=t,u[$e]=e,u[Xe]=l,u[Ke]=n,u[Qe]=i,u[qe]=s,u[Ye]=r,u[Ze]=h,u}const rl={Accept:null,Again:null,AllCandidates:null,Alphanumeric:null,ContextMenu:null,Attn:null,BrowserBack:null,BrowserFavorites:null,BrowserForward:null,BrowserHome:null,BrowserRefresh:null,BrowserSearch:null,BrowserStop:null,CapsLock:null,Clear:null,CodeInput:null,Compose:null,Crsel:null,Convert:null,Copy:null,Cut:null,Down:new sl(new il(64,"Cursor Down"),null,null,null,null,null,null,null),End:new sl(new il(64,"End"),null,null,null,null,null,null,null),Enter:new sl(new il(64,"Enter"),null,null,null,null,null,null,null),EraseEof:null,Execute:null,Exsel:null,F1:new sl(new il(64,"F1"),new il(64,"F13"),null,null,null,null,null,null),F2:new sl(new il(64,"F2"),new il(64,"F14"),null,null,null,null,null,null),F3:new sl(new il(64,"F3"),new il(64,"F15"),null,null,null,null,null,null),F4:new sl(new il(64,"F4"),new il(64,"F16"),null,null,null,null,null,null),F5:new sl(new il(64,"F5"),new il(64,"F17"),null,null,null,null,null,null),F6:new sl(new il(64,"F6"),new il(64,"F18"),null,null,null,null,null,null),F7:new sl(new il(64,"F7"),new il(64,"F19"),null,null,null,null,null,null),F8:new sl(new il(64,"F8"),new il(64,"F20"),null,null,null,null,null,null),F9:new sl(new il(64,"F9"),new il(64,"F21"),null,null,null,null,null,null),F10:new sl(new il(64,"F10"),new il(64,"F22"),null,null,null,null,null,null),F11:new sl(new il(64,"F11"),new il(64,"F23"),null,null,null,null,null,null),F12:new sl(new il(64,"F12"),new il(64,"F24"),null,null,null,null,null,null),F13:new sl(new il(64,"F13"),null,null,null,null,null,null,null),F14:new sl(new il(64,"F14"),null,null,null,null,null,null,null),F15:new sl(new il(64,"F15"),null,null,null,null,null,null,null),F16:new sl(new il(64,"F16"),null,null,null,null,null,null,null),F17:new sl(new il(64,"F17"),null,null,null,null,null,null,null),F18:new sl(new il(64,"F18"),null,null,null,null,null,null,null),F19:new sl(new il(64,"F19"),null,null,null,null,null,null,null),F20:new sl(new il(64,"F20"),null,null,null,null,null,null,null),F21:new sl(new il(64,"F21"),null,null,null,null,null,null,null),F22:new sl(new il(64,"F22"),null,null,null,null,null,null,null),F23:new sl(new il(64,"F23"),null,null,null,null,null,null,null),F24:new sl(new il(64,"F24"),null,null,null,null,null,null,null),FinalMode:null,Find:null,FullWidth:null,HalfWidth:null,HangulMode:null,HanjaMode:null,Help:null,Hiragana:null,Home:new sl(new il(64,"Home"),null,null,null,null,null,null,null),Insert:new sl(new il(64,"Insert"),null,null,null,null,null,null,null),JapaneseHiragana:null,JapaneseKatakana:null,JapaneseRomaji:null,JunjaMode:null,KanaMode:null,KanjiMode:null,Katakana:null,LaunchApplication1:null,LaunchApplication2:null,LaunchMail:null,Left:new sl(new il(64,"Cursor Left"),null,null,null,null,null,null,null),MediaNextTrack:null,MediaPlayPause:null,MediaPreviousTrack:null,MediaStop:null,ModeChange:null,Nonconvert:null,NumLock:null,PageDown:new sl(new il(64,"Page Down"),null,null,null,null,null,null,null),PageUp:new sl(new il(64,"Page Up"),null,null,null,null,null,null,null),Paste:null,Pause:null,Play:null,PreviousCandidate:null,PrintScreen:null,Process:null,Props:null,Right:new sl(new il(64,"Cursor Right"),null,null,null,null,null,null,null),RomanCharacters:null,ScrollLock:null,Select:null,SelectMedia:null,Stop:null,Up:new sl(new il(64,"Cursor Up"),null,null,null,null,null,null,null),Undo:null,VolumeDown:null,VolumeMute:null,VolumeUp:null,Win:null,Zoom:null," ":new sl(new il(2," "),new il(2," "),new il(64,"Control+@"),null,null,null,null,null),"!":new sl(null,new il(2,"!"),null,null,null,null,null,null,null),'"':new sl(null,new il(2,'"'),null,null,null,null,null,null),"#":new sl(null,new il(2,"#"),null,null,null,null,null,null),$:new sl(null,new il(2,"$"),null,null,null,null,null,null),"%":new sl(null,new il(2,"%"),null,null,null,null,null,null),"&":new sl(null,new il(2,"&"),null,null,null,null,null,null),"'":new sl(new il(2,"'"),null,null,null,null,null,null,null),"(":new sl(null,new il(2,"("),null,null,null,null,null,null),")":new sl(null,new il(2,")"),null,null,null,null,null,null),"*":new sl(null,new il(2,"*"),null,null,null,null,null,null),"+":new sl(null,new il(2,"+"),null,null,null,null,null,null),",":new sl(new il(2,","),null,null,null,null,null,null,null),"-":new sl(new il(2,"-"),null,new il(64,"Control+_"),null,null,null,null,null),".":new sl(new il(2,"."),null,null,null,null,null,null,null),"/":new sl(new il(2,"/"),null,null,null,null,null,null,null),0:new sl(new il(2,"0"),null,null,null,null,null,null,null),1:new sl(new il(2,"1"),null,null,null,null,null,null,null),2:new sl(new il(2,"2"),null,new il(64,"Control+@"),null,null,null,null,null),3:new sl(new il(2,"3"),null,new il(64,"Control+3"),null,null,null,null,null),4:new sl(new il(2,"4"),null,null,null,null,null,null,null),5:new sl(new il(2,"5"),null,null,null,null,null,null,null),6:new sl(new il(2,"6"),null,new il(2,String.fromCharCode.apply(null,[172])),null,null,null,null,null),7:new sl(new il(2,"7"),null,null,null,null,null,null,null),8:new sl(new il(2,"8"),null,null,null,null,null,null,null),9:new sl(new il(2,"9"),null,null,null,null,null,null,null),Numpad0:new sl(new il(2,"0"),null,null,null,null,null,null,null),Numpad1:new sl(new il(2,"1"),null,null,null,null,null,null,null),Numpad2:new sl(new il(2,"2"),null,null,null,null,null,null,null),Numpad3:new sl(new il(2,"3"),null,null,null,null,null,null,null),Numpad4:new sl(new il(2,"4"),null,null,null,null,null,null,null),Numpad5:new sl(new il(2,"5"),null,null,null,null,null,null,null),Numpad6:new sl(new il(2,"6"),null,null,null,null,null,null,null),Numpad7:new sl(new il(2,"7"),null,null,null,null,null,null,null),Numpad8:new sl(new il(2,"8"),null,null,null,null,null,null,null),Numpad9:new sl(new il(2,"9"),null,null,null,null,null,null,null),"Numpad/":new sl(new il(2,"/"),null,null,null,null,null,null,null),"Numpad*":new sl(new il(2,"*"),null,null,null,null,null,null,null),"Numpad-":new sl(new il(2,"-"),null,null,null,null,null,null,null),"Numpad+":new sl(new il(2,"+"),null,null,null,null,null,null,null),NumpadEnter:new sl(new il(2,"Enter"),null,new il(64,"New Line"),null,null,null,null,null),"Numpad.":new sl(new il(2,"."),null,null,null,null,null,null,null),NumpadUp:new sl(new il(64,"Cursor Up"),null,null,null,null,null,null,null),NumpadDown:new sl(new il(64,"Cursor Down"),null,null,null,null,null,null,null),NumpadLeft:new sl(new il(64,"Cursor Left"),null,null,null,null,null,null,null),NumpadRight:new sl(new il(64,"Cursor Right"),null,null,null,null,null,null,null),NumpadHome:new sl(new il(64,"Home"),null,null,null,null,null,null,null),NumpadPageUp:new sl(new il(64,"PageUp"),null,null,null,null,null,null,null),NumpadPageDown:new sl(new il(64,"PageDown"),null,null,null,null,null,null,null),NumpadEnd:new sl(new il(64,"End"),null,null,null,null,null,null,null),NumpadInsert:new sl(new il(64,"Insert"),null,null,null,null,null,null,null),NumpadDelete:new sl(new il(64,"Delete"),null,null,null,null,null,null,null),":":new sl(null,new il(2,":"),null,null,null,null,null,null),";":new sl(new il(2,";"),null,null,null,null,null,null,null),"<":new sl(null,new il(2,"<"),null,null,null,null,null,null),"=":new sl(new il(2,"="),null,null,null,null,null,null,null),">":new sl(null,new il(2,">"),null,null,null,null,null,null),"?":new sl(null,new il(2,"?"),null,null,null,null,null,null),"@":new sl(null,new il(2,"@"),null,null,null,new il(64,"Control+@"),null,null),"[":new sl(new il(2,"["),null,new il(64,"Control+["),null,null,null,null,null),"\\":new sl(new il(2,"\\"),null,new il(64,"Control+\\"),null,null,null,null,null),"]":new sl(new il(2,"]"),null,new il(64,"Control+]"),null,null,null,null,null),"^":new sl(null,new il(2,"^"),null,new il(64,"Control+^"),null,new il(64,"Record Separator"),null,null),_:new sl(null,new il(2,"_"),null,new il(64,"Control+_"),null,new il(64,"Unit Separator"),null,null),"`":new sl(new il(2,"`"),null,null,null,null,null,null,null),a:new sl(new il(2,"a"),new il(2,"A"),new il(64,"Control+a"),null,null,null,null,null),b:new sl(new il(2,"b"),new il(2,"B"),new il(64,"Control+b"),null,null,null,null,null),c:new sl(new il(2,"c"),new il(2,"C"),new il(64,"Control+c"),null,null,null,null,null),d:new sl(new il(2,"d"),new il(2,"D"),new il(64,"Control+d"),null,null,null,null,null),e:new sl(new il(2,"e"),new il(2,"E"),new il(64,"Control+e"),null,null,null,null,null),f:new sl(new il(2,"f"),new il(2,"F"),new il(64,"Control+f"),null,null,null,null,null),g:new sl(new il(2,"g"),new il(2,"G"),new il(64,"Control+g"),null,null,null,null,null),h:new sl(new il(2,"h"),new il(2,"H"),new il(64,"Control+h"),null,null,null,null,null),i:new sl(new il(2,"i"),new il(2,"I"),new il(64,"Control+i"),null,null,null,null,null),j:new sl(new il(2,"j"),new il(2,"J"),new il(64,"Control+j"),null,null,null,null,null),k:new sl(new il(2,"k"),new il(2,"K"),new il(64,"Control+k"),null,null,null,null,null),l:new sl(new il(2,"l"),new il(2,"L"),new il(64,"Control+l"),null,null,null,null,null),m:new sl(new il(2,"m"),new il(2,"M"),new il(64,"Control+m"),null,null,null,null,null),n:new sl(new il(2,"n"),new il(2,"N"),new il(64,"Control+n"),null,null,null,null,null),o:new sl(new il(2,"o"),new il(2,"O"),new il(64,"Control+o"),null,null,null,null,null),p:new sl(new il(2,"p"),new il(2,"P"),new il(64,"Control+p"),null,null,null,null,null),q:new sl(new il(2,"q"),new il(2,"Q"),new il(64,"Control+q"),null,null,null,null,null),r:new sl(new il(2,"r"),new il(2,"R"),new il(64,"Control+r"),null,null,null,null,null),s:new sl(new il(2,"s"),new il(2,"S"),new il(64,"Control+s"),null,null,null,null,null),t:new sl(new il(2,"t"),new il(2,"T"),new il(64,"Control+t"),null,null,null,null,null),u:new sl(new il(2,"u"),new il(2,"U"),new il(64,"Control+u"),null,null,null,null,null),v:new sl(new il(2,"v"),new il(2,"V"),null,null,null,null,null,null),w:new sl(new il(2,"w"),new il(2,"W"),new il(64,"Control+w"),null,null,null,null,null),x:new sl(new il(2,"x"),new il(2,"X"),new il(64,"Control+x"),null,null,null,null,null),y:new sl(new il(2,"y"),new il(2,"Y"),new il(64,"Control+y"),null,null,null,null,null),z:new sl(new il(2,"z"),new il(2,"Z"),new il(64,"Control+z"),null,null,null,null,null),"{":new sl(null,new il(2,"{"),null,null,null,null,null,null),"|":new sl(null,new il(2,"|"),null,null,null,null,null,null),"}":new sl(null,new il(2,"}"),null,null,null,null,null,null),"~":new sl(null,new il(2,"~"),null,null,null,null,null,null),Backspace:new sl(new il(64,"Delete"),new il(64,"Erase Character"),new il(64,"Delete Character"),null,null,null,null,null),Tab:new sl(new il(64,"Tab"),null,null,null,null,null,null,null),"U+0018":null,Escape:new sl(new il(64,"Escape"),null,null,null,null,null,null,null),Delete:new sl(new il(64,"Delete"),null,null,null,null,null,null,null),"U+00A1":null,"U+0300":null,"U+0301":null,"U+0302":null,"U+0303":null,"U+0304":null,"U+0306":null,"U+0307":null,"U+0308":null,"U+030A":null,"U+030B":null,"U+030C":null,"U+0327":null,"U+0328":null,"U+0345":null,"U+20AC":null,"U+3099":null,"U+309A":null};var hl=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.render"),ul=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.scaling"),ol=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.color");const al=1,cl=2,fl=3,wl=100,dl=-1.5,pl=-.25,bl=5,vl=1,kl=2,ml=4,Al=8,gl=16,Cl=32,Sl=64,Tl=128,yl=256,El=512,Fl=4096,xl=16777215,Pl=2281766656,Ml=1,Nl=2;var Rl=0;const Dl=0,Il=4210752,Ll=61440,_l=16777215;var Ol=function(t){if(t.match(/^#([a-fA-F0-9]){6}/)){var e=parseInt(t.substring(1,7),16);return"rgb("+(e>>16)+","+(e>>8&255)+","+(255&e)+")"}if(t.match(/^rgb\((?:\d{1,3},){2}\d{1,3}\)/))return t;hl.warn("Webcolor: bad color value, "+t)},Ul=function(t,e,l,n,i){ol.log(ol.FINEST,"Setting fill color. Previous color="+t.fillStyle+". Args length="+arguments.length),5==arguments.length?t.fillStyle="rgba("+e+","+l+","+n+","+i+")":4==arguments.length?t.fillStyle="rgb("+e+","+l+","+n+")":2==arguments.length?t.fillStyle="rgb("+((16711680&e)>>16)+","+((65280&e)>>8)+","+(255&e)+")":t.fillStyle=Ol(e),ol.log(ol.FINEST,"Set fill color. New color="+t.fillStyle)},Vl=function(t,e,l,n,i){ol.log(ol.FINEST,"Setting stroke color. Previous color="+t.strokeStyle+". Args length="+arguments.length),5==arguments.length?t.strokeStyle="rgba("+e+","+l+","+n+","+i+")":4==arguments.length?t.strokeStyle="rgb("+e+","+l+","+n+")":2==arguments.length?t.strokeStyle="rgb("+((16711680&e)>>16)+","+((65280&e)>>8)+","+(255&e)+")":t.strokeStyle=Ol(e),ol.log(ol.FINEST,"Set stroke color. New color="+t.strokeStyle)},Hl=function(t,e){t.globalAlpha=e},Bl=function(t,e,l,n){t.beginPath(),t.arc(e,l,n,0,6.29,!1),t.closePath(),t.fill()},zl=function(t,e,l,n,i,s){t.beginPath(),t.moveTo(e,l),t.arc(e,l,n,i,s,!1),t.closePath(),t.fill()},Jl=function(t,e,l,n,i,s){for(var r=new Array(n),h=0;h<n;h++)r[h]=e[l+h];var u=String.fromCharCode.apply(null,r);hl.log(hl.FINEST,"Draw chars at canvas px("+i+","+s+") runLength="+n+" lineBuffer start="+l+" text="+u),t.fillText(u,i,s)};function jl(t,e,l,n,i){hl.debug("Draw line (2) from ("+e+","+l+") to ("+n+","+i+")"),t.beginPath();var s=t.fillStyle;t.fillStyle=t.strokeStyle;for(var r=Math.sqrt((n-e)*(n-e)+(i-l)*(i-l)),h=n-e,u=i-l,o=Math.atan(u/(0==h?.01:h))+(h<0?Math.PI:0),a=0;a<r;a++)t.fillRect(Math.round(e+Math.cos(o)*a),Math.round(l+Math.sin(o)*a),1,1);t.stroke(),t.fillStyle=s}var Wl=function(t,e,l,n,i){hl.debug("Draw line from ("+e+","+l+") to ("+n+","+i+")"),t.beginPath(),t.moveTo(e,l),t.lineTo(n,i),t.stroke()};function Gl(t,l){this.H=t.H,this.B=t,this.J=-1,this.W=-1,this.G=-1,this.X=-1,this.font=null,this.K=Number(Gl.K),this.Y=t.Q&&t.Q.Y?t.Q.Y:r,e.debug("virtualScreen = "+t),e.debug("cInfo="+t.Z),this.tt=!0,this.et=1,this.lt=1,this.nt=-1,this.it=-1,this.st=1,this.rt=1,this.ht=1,this.ut=0,this.ot=0,this.at=l,this.ct=0,this.ft=fl,this.wt=500,this.dt=!0,this.pt=t.bt(),this.vt=0,this.kt=Dl,this.mt=xl,this.At=_l,this.scaleMethod=1,this.gt=null,this.Ct=null,this.ft==fl&&this.wt>=wl&&0!=wl&&this.St()}function $l(t,l,n){this.B=t,t.Tt=this,this.J=-1,this.W=-1,this.G=-1,this.X=-1,this.font=null,this.K=Gl.K,this.Y=t.Q&&t.Q.Y?t.Q.Y:r,e.debug("virtualScreen = "+t),e.debug("cInfo="+t.Z),this.tt=!0,this.et=1,this.lt=1,this.nt=-1,this.it=-1,this.st=1,this.rt=1,this.ht=1,this.ut=0,this.ot=0,this.at=l,this.ct=0,this.ft=fl,this.yt=fl,this.wt=500,this.Et=500,this.pt=t.bt(),this.scaleMethod=n||1,this.Ft=16711680,this.xt=65280,this.Pt=Dl,this.Mt=16777215,this.Nt=65280,this.Rt=this.Nt,this.Dt=this.Nt,this.It=this.Pt,this.Lt=[0,12255232,47872,12303104,187,12255419,48059,12303291],this._t=[this.Lt[0],this.Lt[1],this.Lt[2],this.Lt[3],this.Lt[4],this.Lt[5],this.Lt[6],this.Lt[7],8421504,33023,65408,8454143,16744576,16744703,16777088,12632256],this.Ot=[5592405,16733525,5635925,16777045,5592575,16733695,5636095,16777215],this.Ut=[this.Ot[0],this.Ot[1],this.Ot[2],this.Ot[3],this.Ot[4],this.Ot[5],this.Ot[6],this.Ot[7],8421504,33023,65408,8454143,16744576,16744703,16777088,16777215],this.At=_l,this.mt=xl,this.Vt=!1,this.Ht=!0,this.gt=null,this.Ct=null,this.ft==fl&&this.wt>=wl&&0!=wl&&this.St(),this.Et>=wl&&0!=wl&&this.Bt(),this.zt()}Gl.Jt=2,Gl.jt="normal",Gl.Wt="normal",Gl.K=10,Gl.Y=r,Gl.prototype.Gt=function(t){if(t){if(hl.debug("Setting font properties="+JSON.stringify(t)),t.size&&null!==t.size){let e=Number(t.size);this.K=e,Gl.K=e}t.scaleMethod&&null!==t.scaleMethod&&(this.scaleMethod=t.scaleMethod,1==this.scaleMethod&&(Gl.K=10)),this.$t(),this.zt()}},Gl.prototype.Xt=function(t,e,l,n){t.font=Gl.Wt+" "+Gl.jt+" "+e+"px "+l;var i=t.measureText(n);this.ut=Rl,this.ht=.85*e,this.Kt=e-(this.ut+this.ht),this.ot=this.ht+this.ut;var s=e;return{width:i.width,height:s}},Gl.prototype.qt=function(){return this.B.oiaEnabled?this.B.height+Gl.Jt:this.B.height},Gl.prototype.Yt=function(t,e){var l,n=t.width,i=t.height,s=this.B;let r;if(this.tt=!0,this.it=0,this.nt=0,ul.debug("Calculate font for canvas w="+n+",h="+i),0==this.scaleMethod)for(ul.debug("Calculating for scaleMethod=ratio"),r=50;r>4;r--){var h=(l=this.Xt(e,r,this.Y,"M")).width*s.width,u=l.height*this.qt();if(ul.debug("At font size="+r+", need w="+h+",h="+u),h<=n&&u<=i){ul.debug("Found size match. Chose font size ="+r+" for canvas w="+n+",h="+i+" ascent="+this.ht+", descent="+this.Kt+" leading="+this.ut),this.tt=!1,this.st=l.width,this.rt=l.height,this.font=Gl.Wt+" "+Gl.jt+" "+r+"px "+this.Y,this.it=h,this.nt=u;break}}else if(1==this.scaleMethod){ul.debug("Calculating for scaleMethod=fit"),r=10,l=this.Xt(e,r,this.Y,"M"),this.tt=!1,this.st=l.width,this.rt=l.height,this.font=Gl.Wt+" "+Gl.jt+" "+r+"px "+this.Y;var o=t.width/(s.width*l.width),a=t.height/(this.qt()*l.height);o=(parseInt(10*o)/10).toFixed(1),a=(parseInt(10*a)/10).toFixed(1),this.et=1/o,this.lt=1/a,this.it=t.width*this.et,this.nt=t.height*this.lt,e.scale(o,a),this.Qt.setTransform(1,0,0,1,0,0),this.Qt.scale(o,a),ul.debug("Scaled for font size="+r+", canvas w="+n+",h="+i+" ascent="+this.ht+", descent="+this.Kt+" leading="+this.ut),ul.debug("Scale factors are: sfX="+this.et+", sfY="+this.lt+", aH="+this.nt+", aW="+this.it+", sW="+o+", sH="+a)}else ul.debug("Calculating for scaleMethod=no scale"),r=Gl.K,l=this.Xt(e,r,this.Y,"M"),this.tt=!1,this.st=l.width,this.rt=l.height,this.font=Gl.Wt+" "+Gl.jt+" "+r+"px "+this.Y,this.et=1,this.lt=1,this.it=t.width,this.nt=t.height,e.scale("1","1"),this.Qt.setTransform(1,0,0,1,0,0),this.Qt.scale("1","1"),ul.debug("Scaled for font size="+r+", canvas w="+n+",h="+i+" ascent="+this.ht+", descent="+this.Kt+" leading="+this.ut);if(this.Y!=this.Zt){ul.debug("Determining font size for DBCS="+this.Zt);var c=this.Xt(e,r,this.Zt,"M"),f=this.Xt(e,r,this.Zt,"䭺");ul.debug("SBCS box="+JSON.stringify(l)+" dbcsBox="+JSON.stringify(c)+" testSymbolBox="+JSON.stringify(f))}},Gl.prototype.te=function(t,e,l,n){var i;for(i=0;i<n;i++)t[i]=32,e[i]=0,l[i]=0},Gl.prototype.ee=function(t,e,l){for(var n=e;n<l;n++)if(t[n]>32)return n;return-1},Gl.prototype.le=function(t,e,l,n,i,s){for(var r=n+1,h=t[n],u=s?s[n]:null,o=e[n];r<i&&(h==Pl?t[r]==Pl:h==t[r])&&o==e[r]&&(!s||u==s[r]);)r++;return r-n},Gl.prototype.clear=function(){let t=this.B;var e=t.H.getContext("2d"),l=t.H.width,n=t.H.height;hl.debug("Renderer.clear pxWidth="+l+" pxHeight="+n+" inactive=4210752"),Ul(e,this.kt),e.fillRect(0,0,this.it,this.nt)},Gl.prototype.$t=function(){this.B.H.getContext("2d").setTransform(1,0,0,1,0,0),this.et=1,this.lt=1,this.J=-1},Gl.prototype.ne=function(t,e){return this.B.H,this.B,1==this.scaleMethod&&(t*=this.et,e*=this.lt),(t>=this.it||e>=this.nt)&&hl.debug("canvasX or canvasY is greater than activeWidth or activeHeight"),{ie:Math.floor(e/this.rt),se:Math.floor(t/this.st)}},Gl.prototype.re=function(){var t=this.B;let e=t.H;var l=this.Qt;l.font=this.font,Ul(l,255,255,255,0),l.clearRect(0,0,e.width,e.height),l.clearRect(0,0,this.it,this.nt),!0===this.pt&&(this.ft!=fl||0==this.wt||1==this.dt)&&this.ft>0&&this.he(l,t.ue),null!=t.oe&&null!=t.ae&&null!=t.ce&&null!=t.fe&&this.we(t.oe,t.ae,t.fe,t.ce),1==t.oiaEnabled&&this.de(l,t)},Gl.prototype.de=function(t,e){let l=e.H;var n=t.lineWidth;t.beginPath(),Vl(t,this.mt),t.lineWidth=5*this.lt;var i=l.height*this.lt+-1.5*this.rt;t.moveTo(0,i),t.lineTo(this.it,i);var s=e.pe();Ul(t,this.mt);var r=l.height*this.lt+-.25*this.rt;Jl(t,s,0,e.width,0,r),t.closePath(),t.stroke(),t.lineWidth=n},Gl.prototype.we=function(t,e,l,n){if(t!=l&&e!=n){var i=Math.min(t,l),s=Math.max(t,l),r=Math.min(e,n),h=Math.max(e,n),u=this.B,o=u.be.getContext("2d");o.beginPath(),this.ve(i,r,s,h,o,u.H.getContext("2d")),o.closePath()}},Gl.prototype.ke=function(){clearTimeout(this.gt),1!=this.dt&&(this.dt=!0,this.re()),this.ft==fl&&this.wt>=wl&&0!=wl&&this.St()},Gl.prototype.St=function(){var t=this;this.gt=setInterval(function(){t.dt=!t.dt,!0===t.pt&&t.re()},this.wt)},Gl.prototype.me=function(){clearTimeout(this.Ct),1!=this.Ae&&(this.Ae=!0,this.zt()),this.Et>=wl&&0!=wl&&this.Bt()},Gl.prototype.Bt=function(){var t=this;this.Ct=setInterval(function(){t.Ht&&(t.Ae=!t.Ae,t.zt())},this.Et)},Gl.prototype.he=function(t,l){if(-1!==l){var n=this.B,i=this.rt,s=this.st,r=this.B.ge?.2:1;if(0!=n.width){var h=Math.floor(l/n.width)+1,u=l%n.width;hl.debug("show cursor pos="+l+" at row="+h+" column="+u),t.beginPath(),Ul(t,this.At),1==this.ft?(Vl(t,this.At),t.moveTo(u*s,(h-r)*i),t.lineTo((1+u)*s,(h-r)*i),t.lineTo((1+u)*s,h*i),t.lineTo(u*s,h*i),t.lineTo(u*s,(h-r)*i),t.closePath(),t.stroke()):(this.ve(u,h-r,1+u,h,t,n.H.getContext("2d")),t.closePath())}else e.info("CANNOT SHOW CURSOR screen.width==0\n")}},Gl.prototype.ve=function(t,e,l,n,i,s){for(var r=this.rt,h=this.st,u=t*h,o=e*r,a=l*h,c=n*r,f=1==this.scaleMethod?u/this.et:u,w=1==this.scaleMethod?o/this.lt:o,d=1==this.scaleMethod?a/this.et:a,p=1==this.scaleMethod?c/this.lt:c,b=Math.abs(f-d),v=Math.abs(w-p),k=s.getImageData(f,w,b,v),m=0;m<k.data.length;m+=4)k.data[m]=255-k.data[m],k.data[m+1]=255-k.data[m+1],k.data[m+2]=255-k.data[m+2],k.data[m+3]=255;i.putImageData(k,f,w)},Gl.prototype.zt=function(){bn("fullPaint")},Gl.prototype.Ce=function(){e.debug("Renderer resize completed")},ze($l,Gl,[$l.zt]),$l.Se=32,$l.Te=32,$l.prototype.ye=function(t,e,l,n){var i=this.B,s=!1;hl.debug("Determining which rows to redraw. Include neighbors="+n);var r=i.Ee;if(null==r)hl.debug("Viewport top is null, not redrawing any rows"),e.fill(!0);else{for(let t=0;t<i.height;t++){if(!r){e.fill(!0,t);break}r.Fe&&(s=!0),l[t]==r.id&&!0!==r.xe||(e[t]=!0,n&&(t>0&&(e[t-1]=!0),t<i.height-1&&(e[t+1]=!0))),r.xe=!1,l[t]=r.id,r=r.P}r=i.Ee,hl.debug("Row redraw calculation result="+JSON.stringify(e))}this.Ht!=s&&(this.Ae=!0,this.Ht=s,e.fill(!0))},$l.prototype.Pe=function(){void 0!=this.Me&&null!=this.Me||(this.yt=this.ft),this.ft=0},$l.prototype.Ne=function(){this.ft=this.yt},$l.prototype.Re=function(){void 0!=this.Me&&null!=this.Me||(this.Me=this.wt),this.wt=0},$l.prototype.De=function(){this.wt=this.Me,this.Me=null},$l.prototype.Ie=function(t,e){var l=this.B.height,n=null;let i=this.rt,s=this.it;Ul(t,this.Pt),hl.debug("Clearing updated rows by drawing with color="+this.Pt);var r=e.entries();for(let e of r)!0===e[1]?null==n&&(n=e[0]):null!=n&&(t.fillRect(0,i*n,s,i*(e[0]-n)),n=null);null!=n&&t.fillRect(0,i*n,s,i*(l+1-n))},$l.Le=function(t,e,l){var n=t-l+33,i=t-l+161;switch(e){case oi._e:return n;case oi.Oe:switch(hl.log(hl.FINER,"Getting symbol in charset. code=0x"+Te(t)+", charset=0x"+e+", codeShift=0x"+l+". shifted=0x"+Te(n)+", iso8859-like=0x"+Te(i)),i){case 164:case 166:return $l.Se;case 168:return 164;case 172:case 173:case 174:case 175:return $l.Se;case 180:case 184:case 190:case 208:return $l.Se;case 215:return 338;case 221:return 376;case 222:case 240:return $l.Se;case 247:return 339;case 253:return 255;case 254:case 255:return $l.Se;default:return i}case oi.Ue:if(hl.log(hl.FINER,"Getting symbol in charset. code=0x"+Te(t)+", charset=0x"+e+", codeShift=0x"+l+". shifted=0x"+Te(n)+", iso8859-like=0x"+Te(i)),n<95)return n;switch(n){case 95:return" ";case 96:return 9670;case 97:return 9618;case 98:return 9225;case 99:return 9228;case 100:return 9229;case 101:return 9226;case 102:return 176;case 103:return 177;case 104:return 9252;case 105:return 9227;case 106:return 9496;case 107:return 9488;case 108:return 9484;case 109:return 9492;case 110:return 9532;case 111:case 112:return 8254;case 113:return 9472;case 114:case 115:return 95;case 116:return 9500;case 117:return 9508;case 118:return 9524;case 119:return 9516;case 120:return 9474;case 121:return 8804;case 122:return 8805;case 123:return 960;case 124:return 8800;case 125:return 163;case 126:return 183;default:return hl.warn("No DEC graphic char for shifted code=0x"+Te(n))," "}default:return hl.warn("No lookup for gl.charset=0x"+Te(e))," "}},$l.Ve=function(t,e){var l=t.He;return l<=32?32:l<127?$l.Le(l,t.Be,33):l<=161?32:l<255?$l.Le(l,t.ze,161):!0===e?l:(null!=l&&hl.warn("Failed to get glyph for code=0x"+Te(l)),32)};var Xl=new li(32);$l.prototype.Je=function(t,e,l,n,i,s,r,h){null==h&&(h=Xl,n[s]=this.Mt,i[s]=this.Pt),e[s]=$l.Ve(h,this.B.je);var u=h.We;if(0==(64&h.Ge)){switch(h.$e){case oi.Xe:0!=(16&h.Ge)?n[s]=this.Rt:n[s]=this.Mt;break;case oi.Ke:0!=(16&h.Ge)?n[s]=this.Ot[u]:n[s]=this.Lt[u];break;case oi.qe:0!=(16&h.Ge)?n[s]=this.Ut[u]:n[s]=this._t[u];break;case oi.Ye:n[s]=u}var o=h.Qe;switch(h.Ze){case oi.Xe:i[s]=this.Pt;break;case oi.Ke:i[s]=this.Lt[o];break;case oi.qe:i[s]=this._t[o];break;case oi.Ye:i[s]=o}}else ol.debug("Element is hidden, setting null color"),n[s]=null,i[s]=null;l[s]=h.Ge},$l.prototype.tl=function(){if(!this.el){this.el=!0;var t=this.Pt;this.Pt=this.Mt,this.Mt=t,this.zt()}},$l.prototype.ll=function(){if(this.el){this.el=!1;var t=this.Pt;this.Pt=this.Mt,this.Mt=t,this.zt()}},$l.prototype.zt=function(){hl.debug("Full paint called, will clear entire screen");let t=this.B.H;this.B.parentDiv;var e=t.getContext("2d");Ul(e,this.Pt),e.fillRect(0,0,t.width,t.height),this.B.nl.fill(null),this.il()};var Kl=!0,ql=!0;$l.prototype.il=function(t){let e=this.B.H;var l=e.width,n=e.height,i=e.getContext("2d",{alpha:!1});if(this.Qt=this.B.be.getContext("2d"),-1!=this.J&&this.J==l&&this.W==n||(this.Yt(e,i),this.Yt(this.B.be,this.Qt),this.J=l,this.W=n),this.tt)return;i.font=this.font,i.textBaseline="top",Ul(i,this.Mt);var s=this.B,r=Number(s.width),h=new Array(r),u=new Array(r),o=new Array(r),a=new Array(r);let c=0;var f=0,w=s.nl,d=new Array(Number(t>0?t:s.height));ql?this.ye(i,d,w,Kl):d.fill(!0),window.requestAnimationFrame(()=>{this.Ie(i,d);for(var t=s.Ee,l=0,n=e.height/s.height,w=0;w<s.height;w++)if(d[w]){var p;for(l++,null!==t&&void 0!==t&&"function"==typeof this.sl&&this.sl(t,w,n),w<3&&hl.debug("startLine, baseline = "+c+" screenOffset="+f+" size="+s.size),this.te(h,a,u,r),p=0;p<r;p++)this.Je(w,h,a,u,o,p,r,null!=t?t.rl[p]:null);var b=0;for(p=0;p<r;){var v=this.le(u,a,w,p,r,o);if(null!=u[p]){var k=a[p];if(Ul(i,u[p]),Vl(i,u[p]),i.lineWidth=1.5,hl.debug("Run starts at ("+p+","+w+"). Length="+v+", Attr=0x"+Te(k)+", FG="+u[p]+", BG="+o[p]),0!=(128&k)?(hl.debug("Transforming canvas for double width"),i.save(),i.hl(2,0,0,1,0,0)):0!=(256&k)&&(hl.debug("Transforming canvas for double height (top)"),i.save(),i.hl(2,0,0,2,0,-Math.round(this.nt/this.B.height)*w)),0==(512&k)){var m=0!=(2&k);if(m?(1==this.Vt&&(0!=(16&k)?(Ul(i,this.Dt),Vl(i,this.Dt)):(Ul(i,this.Ft),Vl(i,this.Ft))),i.fillRect(b,c,v*this.st,this.rt),1==this.Vt?Ul(i,0!=(16&k)?this.It:this.xt):Ul(i,o[p])):o[p]!=this.Pt&&(Ul(i,o[p]),i.fillRect(b,c,v*this.st,this.rt),Ul(i,u[p])),0!=(1&k)?this.ul(i,h,p,v,b,c,m):(0==(8&k)||this.Ae)&&Jl(i,h,p,v,b,c),0!=(4&k)){var A=c+(this.rt-1);jl(i,b,A,b+v*this.st,A)}m&&Ul(i,u[p])}0==(128&k)&&0==(256&k)&&0==(512&k)||i.restore()}else-1!=this.ee(h,p,v)&&hl.debug("Skipping render for null/invisible color at ("+p+","+w+")");p+=v,b+=v*this.st}f+=s.width,c+=this.rt,null!=t&&(t=t.P)}else{if(hl.debug("Skipping unmodified row="+w),f+=s.width,c+=this.rt,null==t)break;t=t.P}hl.debug("Drew "+l+" rows");let g=s.ol();s.ue=-1==g?g:s.width*g+s.al,this.re()})},$l.prototype.cl=function(t){let e=this.B;if(e.fl<1||e.wl===e.height)return;let l=this.rt,n=e.fl*l,i=(e.height,1==this.scaleMethod?n/this.lt:n),s=t.getImageData(0,i,this.it,this.nt-i);t.putImageData(s,0,0),e.fl=0},$l.prototype.dl=function(t){for(var e=0,l=0;l<t.length;l++)e=e<<4|parseInt(t[l],16);return e};var Yl=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.keyboard"),Ql=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.message"),Zl=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.protocol"),tn=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.telnet"),en=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.event"),ln=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.parse");const nn=0,sn=1,rn=2,hn=3,un=80,on=24,an={pl:0,bl:1},cn="Input",fn="Hotspots",wn="hotspotButton",dn=200,pn=200;function bn(t){alert(t+": You are in the superclass!")}function vn(){}var kn,mn=function(t){return new RegExp("[a-zA-Z]").test(t.charAt(0))};function An(t,e){this.vl=new Array(e||nt),this.vl.fill(32)}function gn(t,e){this.H=null,this.be=null,this.parentDiv=null,this.oiaEnabled=1,this.width=t,this.height=e,this.kl=an.pl,this.ml=new An(this),this.Al=new Array(this.height*this.width),this.Tt=null,this.gl=un,this.Cl=on,this.Sl=[],this.Tl=null,this.yl=0,this.ae=null,this.oe=null,this.ce=null,this.fe=null,this.El=!1,this.Fl=!1,this.xl="rgb(255,255,255)",this.Pl,this.Ml=null,this.Nl=null,this.Rl=new Array,this.Dl=!1,this.Il=!1,this.Ll=!1,this._l=Nt,this.Ol=0}function Cn(t,e){this.Ul,this.Vl=t,this.Hl,this.Bl,this.zl,this.Jl=e}function Sn(t){this.message=t,this.name="RuntimeException",e.warn("Encountered exception:"+this.name+", msg:"+t)}function Tn(t){this.message=t,this.name="Exception",e.warn("Encountered exception:"+this.name+", msg:"+t)}function yn(t){this.message=t,this.name="TerminalInputException",e.warn("Encountered exception:"+this.name+", msg:"+t)}function En(t){this.message=t,this.name="UnsupportedOperationException",e.warn("Encountered exception:"+this.name+", msg:"+t)}gn.jl=function(t,parentDiv,l,n,i){e.debug(`make canvas w/ id=${t}, parentDiv=${parentDiv}, w,h=${l},${n}`);var s=document.createElement("canvas");s.id=t,s.style.zIndex=i,s.style.position="absolute",s.style.left="0px",s.style.top="0px";var r=l,h=n;return s.width=r,s.height=h,s.innerHTML="If you see this message, rather than a real drawing canvas, please upgrade to FireFox 1.5, Safari, or some other modern browser",parentDiv.appendChild(s),s},gn.Wl=new Array(O.length),gn.Wl.fill(!1),gn.prototype.Gl=function(){let t=gn.Wl.length;for(var e=0;e<t;e++)if(!gn.Wl[e]){gn.Wl[e]=!0,this.$l=O[e];break}this.$l||(this.$l=" "),this.Xl=this.$l},gn.prototype.Kl=function(t){this.ql(4999,t.data,"Connection to host closed due to error.\nHost: "+this.Yl.host+"\nPort: "+this.Yl.port+"\nError:"+t.data)},gn.prototype.Ql=function(t){this.ql(t.code,t.reason,"Connection to host closed.\nHost: "+this.Yl.host+"\nPort: "+this.Yl.port+"\nCode: "+t.code+"\nReason: "+t.reason)},gn.prototype.ql=function(t,e,l){t!=this.Zl&&(en.warn(l),this.callbacks.wsErrorCallback?this.callbacks.wsErrorCallback(t,e,l):alert(l)),this.closeConnection(t,e),this.Tl=null,this.tn=!1},gn.prototype.isConnected=function(){return 2===this._l},gn.prototype.disconnect=function(){e.info("Disconnected terminal with ID="+this.id),this.tn=!0,this.Dl=!0,this.closeConnection(4e3,"Terminal Closed"),this.Tt.zt()},gn.prototype.closeConnection=function(t,e){this.Zl=t;var l=this.Tl;if(l)try{l.close(t,e)}catch(t){}if(this.clear(),!this.tn){var parentDiv=this.parentDiv?this.parentDiv:document.getElementById(this.H.id).parentNode;try{this.en(parentDiv);var n=parentDiv.id;this.callbacks&&this.callbacks.closeCallback&&this.callbacks.closeCallback(n)}catch(t){}this.$l&&" "!=this.$l&&(gn.Wl[this.$l.charCodeAt(0)-65]=!1,this.$l=null)}},gn.prototype.pe=function(){bn("getOIAArray")},gn.prototype.ln=function(){bn("initScreen")},gn.prototype.connect=function(t,e){bn("connect")},gn.prototype.nn=function(t){bn("paste")},gn.prototype.in=function(t){bn("copy")},gn.prototype.sn=function(t,e,l,n,i,s){bn("getScreenContents")},gn.prototype.rn=function(t){bn("setCursorPos")},gn.prototype.hn=function(t){bn("modifyCursorPos")},gn.prototype.un=function(t){bn("enterCharacterAtCursor")},gn.prototype.clear=function(){bn("clear")},gn.prototype.handleContainerResizeFromUI=function(parentDiv,t,e,l){null!==t&&void 0!==t&&(this.Pl=t.Pl,this.Rl=t.Rl),this.handleContainerResize(parentDiv,e,l)},gn.prototype.bt=function(){var t=document.activeElement;return document.getElementById(this.H.id)==t||document.getElementById(this.be.id)==t||document.getElementById(this.on.id)==t},gn.prototype.en=function(parentDiv){parentDiv.removeChild(this.on),parentDiv.removeChild(this.H),parentDiv.removeChild(this.be)},gn.an=function(t){let e=document.createElement("textarea");e.id=t+"Input";let l=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion),n=navigator.userAgent;return(l||-1!==n.indexOf("Android")||-1!==n.indexOf("iOS"))&&(e.readOnly=!0),e.style.position="relative",e.style.zIndex="3",e.style.bottom="0px",e.style.left="0px",e.style.opacity=0,e.style.width="100%",e.style.height="100%",e.style.cursor="default",e},gn.prototype.handleContainerResize=function(parentDiv,t,l){e.info("handling resize"),clearTimeout(kn);var n=t||parentDiv.clientWidth,i=l||parentDiv.clientHeight;parentDiv.id,this.parentDiv=parentDiv,0!==i&&null!==i&&void 0!==i||(i=this.Pl.height),this.en(parentDiv),this.Tt&&this.Tt.clear(),e.info("resize w="+n+" h="+i),this.cn(parentDiv,{width:n,height:i}),this.fn(),this.Tt&&(this.Tt.H=this.H,this.Tt.$t(),this.wn(this.Pl),this.Tt.zt(),this.Tt.Ce());var s=this;kn=setTimeout(function(){s.dn()},200)},gn.prototype.pn=function(t,l,n){this.width=t,this.height=l,this.size=t*this.height,this.ml.vl=new Array(t||nt),this.ml.vl.fill(32),e.info("Resized canvas grid to r="+this.height+", c="+this.width+", size="+this.size),n||this.clear(),this.Tt&&(this.Tt.$t(),null!==this.Pl&&void 0!==this.Pl&&this.wn(this.Pl),this.Tt.zt())},gn.prototype.bn=function(t){var e=t.keyCode,l=t.key?t.key:t.keyIdentifier;if(Yl.debug("keyup "+t+" target="+t.target+" keyName='"+l+"' keyCode=0x"+Te(e)),Yl.debug("keyup, modifier state starts at "+this.yl.toString(2)),"AltLeft"==l?this.yl^=1:"AltRight"==l&&(this.yl^=2),"Alt"==l)this.yl^=1;else if("ControlLeft"==l)this.yl^=4;else if("ControlRight"==l)this.yl^=8;else if("Control"==l)this.yl^=4;else if("OSLeft"==l||"Win"==l)this.yl^=16;else if("OSRight"==l)this.yl^=32;else if("ShiftLeft"==l)this.yl^=64;else if("ShiftRight"==l)this.yl^=128;else{if("Shift"!=l)return;this.yl^=64}t.stopPropagation(),t.preventDefault(),Yl.debug("keyup, modifier state is now "+this.yl.toString(2))},gn.prototype.vn=function(t,e){bn("handleKeyDown")},gn.prototype.kn=function(t){-1===navigator.appName.indexOf("Safari")&&t.getModifierState&&(t.getModifierState("CapsLock")?this.yl|=256:this.yl&=-257)},gn.prototype.mn=function(t,e){if(e.getModifierState)return this.yl=0,e.getModifierState("Control")&&(this.yl|=4),e.getModifierState("Alt")&&(this.yl|=1),e.getModifierState("Shift")&&(this.yl|=64),e.getModifierState("CapsLock")&&(this.yl|=256),(e.getModifierState("Meta")||e.getModifierState("OS")||e.getModifierState("Win"))&&(this.yl|=16),!0;if(2===t.type||8===t.type&&t.value.length>1){var l=t.value;if("CapsLock"==l)this.yl^=256;else if("AltLeft"==l)this.yl|=1;else if("AltRight"==l)this.yl|=2;else if("Alt"==l)this.yl|=1;else if("ControlLeft"==l)this.yl|=4;else if("ControlRight"==l)this.yl|=8;else if("Control"==l)this.yl|=4;else if("OSLeft"==l||"Win"==l)this.yl|=16;else if("OSRight"==l)this.yl|=32;else if("ShiftLeft"==l)this.yl|=64;else if("ShiftRight"==l)this.yl|=128;else{if("Shift"!=l)return!1;this.yl|=64}return!0}return!1},gn.prototype.An=function(t){this.kn(t);var e=t.keyCode,l=t.key?t.key:t.keyIdentifier;if(this.mn(new il(8,l),t),Yl.debug("keydown "+t+" target="+t.target+" keyName='"+l+"' keyCode=0x"+Te(e)),Yl.debug("keydown, modifier state starts at "+this.yl.toString(2)),l.startsWith("U+")&&6==l.length){if("U+0000"===l&&(this.Cn.gn||this.Cn.Sn))return;var n=parseInt(l.substring(2),16);n>=32&&n<127&&(l=String.fromCharCode(n))}var i=1==l.length&&mn(l);i&&(l=l.toLowerCase());var s=We[l];s&&(l=s),3!==t.location||"NumLock"==l||l.startsWith("Numpad")||(l="Numpad"+l);var r,h=this.Ml[l];if(h&&null!=h){var u=0;12&this.yl&&(u|=Xe),3&this.yl&&(u|=Ke),192&this.yl&&(u|=$e),256==this.yl&&i?u=$e:u==$e&&256&this.yl&&i&&(u=0),Yl.debug("keydown modifier="+u),0===u&&(u=Ge);var o=h[u];o&&(r=o)}r?4===r.type&&(r=new il(1,String.fromCharCode.apply(null,r.value))):r=new il(8,l),this.Il&&"Reset"!==r.value||(Yl.debug("keydown mapping result: type="+r.type+" value="+r.value),this.vn(r,t),Yl.debug("keydown, modifier state is now "+this.yl.toString(2)))},gn.prototype.Tn=function(t){if(t&&"string"==typeof t){var e=t.toLowerCase();document.execCommand(e)}},gn.prototype.yn=function(t){bn("handleKeyCode")},gn.prototype.En=function(t){t.keyCode,t.key?t.key:t.keyIdentifier;var e=t.charCode;this.Fn(e)},gn.prototype.xn=function(t){var e=t.charCodeAt(0);this.Fn(e)},gn.prototype.Fn=function(t){bn("handleCharCodeInput")},gn.prototype.Pn=function(t,e){bn("autoType")},gn.prototype.Mn=function(t){if(this.El){var e=this.Tt.ne(t.offsetX,t.offsetY);e.se+1<=this.width&&(this.fe=e.se+1),e.ie+1<=this.height&&(this.ce=e.ie+1),this.Tt.re()}},gn.prototype.Nn=function(t){this.El=!1},gn.prototype.Rn=function(t){if(!0===this.Fl)this.Fl=!1,clearTimeout(this.Dn);else{var e=this;if(this.Dn=setTimeout(function(){!0===e.El&&(e.Fl=!0)},200),(2==t.In||2==t.Ln)&&this._n)return;this.El=!0;var l=this.Tt.ne(t.offsetX,t.offsetY);this.oe=l.se,this.ae=l.ie}},gn.prototype.On=function(t,e,l,n){bn("handleClick")},gn.prototype.Un=function(t,e,l,n){bn("handleTripleClick")},gn.prototype.Vn=function(t){var e=t.offsetX,l=t.offsetY;if(en.debug("click "+t+", pos=("+e+","+l+")"),!1===this.Fl&&(this.oe=null,this.ae=null,this.fe=null,this.ce=null,this.Hn&&(this.Hn.style.display="none"),this.Tt)){var n=this.Tt.ne(e,l);if(en.debug("click row,col = "+JSON.stringify(n)),null!=n){var i=n.ie*this.width+n.se;if("dblclick"==t.type){var s,r=this.Ml.Bn;if(r&&null!=r){var h=0;12&this.yl&&(h|=Xe),3&this.yl&&(h|=Ke),192&this.yl&&(h|=$e),256==this.yl?h=$e:h==$e&&256&this.yl&&(h=0),Yl.debug("keydown modifier="+h),0===h&&(h=Ge);var u=r[h];u&&(s=u)}this.zn(e,l,n,i,s)}else 3==t.Jn?this.Un(e,l,n,i):this.On(e,l,n,i)}else en.warn("rejecting mouse event, type="+t.type+" because rowColumn == null")}},gn.prototype.zn=function(t){bn("handleDoubleClick"),en.debug("dblclick "+t)},gn.prototype.jn=function(t){e.debug("Received connected message from server"),this._l=2},gn.prototype.Wn=function(t){this.Tl.close(4001,"server sent close/error/exception message"),this.Il=!0},gn.prototype.dn=function(){bn("handleResizeComplete")},gn.prototype.Gn=function(t,e){return this.width*t+e},gn.prototype.fn=function(){var t=this.be,e=this.on,l=this.$n,n=this;t.Xn=0,t.Kn=!0;let i=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion),s=navigator.userAgent;var r=!1,h=!1;i&&(-1!==s.indexOf("Android")?r=!0:-1!==s.indexOf("iOS")&&(h=!0)),this.Cn={gn:r,Sn:h};var u,o=!1;n.Al.fill(null),document.addEventListener("copy",function(t){if((document.activeElement==e||document.activeElement==l)&&!n.Dl){en.debug("Copy, box region start=("+this.oe+","+this.ae+"), end=("+this.fe+","+this.ce+")"),t.stopPropagation();var i=n.in(!1,!0);null!=i&&t.clipboardData.setData("text/plain",i),t.preventDefault(),c()}}),document.addEventListener("paste",function(t){if((document.activeElement==e||document.activeElement==l)&&!n.Dl){en.debug("Paste, box region start=("+this.oe+","+this.ae+"), end=("+this.fe+","+this.ce+")"),t.stopPropagation(),en.debug("PASTE: Found types: "+JSON.stringify(t.clipboardData.types));let e=t.clipboardData.getData("text/plain");e&&1==n.nn(e)&&t.preventDefault(),c()}});var a=this;"Firefox"==navigator.appName&&parseInt(navigator.appVersion,10)<52?(e.addEventListener("blur",function(t){a.yl&=256,a.Tt&&(a.Tt.pt=!1,en.info("Terminal focus lost"),a.Tt.re())}),e.addEventListener("focus",function(t){a.Tt&&(a.Tt.pt=!0,en.info("Terminal gained focus"),a.Tt.re())})):(e.addEventListener("focusout",function(t){a.yl&=256,a.Tt&&(a.Tt.pt=!1,en.info("Terminal focus lost"),a.Tt.re())}),e.addEventListener("focusin",function(t){a.Tt&&(a.Tt.pt=!0,en.info("Terminal gained focus"),a.Tt.re())})),e.addEventListener("compositionstart",function(t){if(en.debug("Compositionstart: "+JSON.stringify(t)),o=!0,!n.Dl){c();var l=Math.floor(n.ue/this.width),i=Math.floor(n.ue%this.width);e.style.top=l*(n.Tt.rt/n.Tt.lt)+"px",e.style.left=i*(n.Tt.st/n.Tt.et)+"px"}}),e.addEventListener("compositionupdate",function(t){en.debug("Compositionupdate: data="+t.data),o=!0,n.Dl||(u=t.data,n.Al.fill(null),n.qn(u))}),e.addEventListener("compositionend",function(t){en.debug("Compositionend seen"),en.debug("Compositionend: "+JSON.stringify(t)+", data="+t.data),o=!1,n.Dl||(n.Al.fill(null),u&&(n.Pn(u),e.value="",e.style.top="0px",e.style.left="0px"))}),e.addEventListener("unload",function(t){n.closeConnection()});var c=function(){n.Fl=!1;let t=n.on;t.value="",t.selectionEnd=0,t.selectionStart=0,n.oe=null,n.ae=null,n.fe=null,n.ce=null,n.Tt&&n.Tt.re()};e.addEventListener("wheel",function(t){n.Dl?(en.debug("Script in progress: rejecting keydown"),t.stopPropagation(),t.preventDefault()):n.Yn(t)}),e.addEventListener("keydown",function(t){n.Dl?(en.debug("Script in progress: rejecting keydown"),t.stopPropagation(),t.preventDefault()):o||(e.value="",en.debug("Keydown: "+JSON.stringify(t)),n.An(t))}),e.addEventListener("keyup",function(t){n.Dl?(en.debug("Script in progress: rejecting keyup"),t.stopPropagation(),t.preventDefault()):n.Il?(en.debug("Screen locked by error occurrence"),t.stopPropagation(),t.preventDefault()):(c(),o||n.bn(t))}),e.addEventListener("keypress",function(t){n.Dl?(en.debug("Script in progress: rejecting keypress"),t.stopPropagation(),t.preventDefault()):n.Il?(en.debug("Screen locked by error occurrence"),t.stopPropagation(),t.preventDefault()):o||(e.value="",en.debug("Keypress: "+JSON.stringify(t)),n.An(t),t.stopPropagation(),t.preventDefault())}),(r||h)&&e.addEventListener("input",function(){if(en.debug("Input event seen. value="+e.value+", textContent="+e.textContent),n.Dl)en.debug("Script in progress: rejecting input");else if(n.Il)en.debug("Screen locked by error occurrence: rejecting input");else{c();var t=e.value;if(t){e.value="",en.debug("Input was "+t),en.debug("Textcontent is now "+e.value);for(var l=0;l<t.length;l++)n.xn(t.charAt(l))}en.debug("Empty input event ignored.")}}),e.addEventListener("mouseup",function(t){n.Dl?en.debug("Script in progress: rejecting mouseup"):(en.debug("mouse event "+t+" target="+t.target),t.target.focus(),n.Nn(t))}),e.addEventListener("mousedown",function(t){n.Dl?en.debug("Script in progress: rejecting mousedown"):(en.debug("mouse event "+t+" target="+t.target),t.target.focus(),n.Rn(t))}),e.addEventListener("mouseenter",function(t){en.log(en.FINER,"mouse event "+t+" target="+t.target);let e=n.on;!o&&e&&e.value.length>0&&(e.value="",e.selectionEnd=0,e.selectionStart=0)}),e.addEventListener("mousemove",function(t){n.Dl?en.log(en.FINER,"Script in progress: rejecting mousemove"):(en.log(en.FINER,"mouse event "+t+" target="+t.target),t.target.focus(),n.Mn(t))}),t.addEventListener("click",function(t){n.Dl?(en.debug("Script in progress: rejecting click"),t.stopPropagation()):(t.stopPropagation(),en.debug("click event "+t+" target="+t.target),t.target.focus(),n.Vn(t))}),e.addEventListener("click",function(t){n.Dl?(en.warn("Script in progress: rejecting click"),t.stopPropagation()):(t.stopPropagation(),en.debug("click event "+t+" target="+t.target),t.target.focus(),n.Vn(t))}),e.addEventListener("dblclick",function(t){n.Dl?(en.warn("Script in progress: rejecting dblclick"),t.stopPropagation()):n.Il?(en.warn("Screen locked by error occurrence: rejecting dblclick"),t.stopPropagation()):(t.stopPropagation(),en.debug("dblclick event "+t+" target="+t.target),!0===n.Fl&&(en.debug("dblclick set drag to false"),n.Fl=!1,clearTimeout(n.Dn)),t.target.focus(),n.Vn(t))}),e.addEventListener("contextmenu",function(t){if(n.Fl=!1,n.El=!1,n._n&&t.shiftKey||!n._n&&!t.shiftKey)n.Dl?(en.debug("Script in progress: rejecting contextmenu"),t.stopPropagation()):(t.stopPropagation(),en.debug("mouse event "+t+" target="+t.target),t.target.focus(),n.Qn(t));else if(null!=n.oe&&null!=n.fe){let t=n.on;t&&(0==t.value.length&&(t.value="c"),t.select())}})},gn.prototype.toString=function(){return"<VirtualScreen size="+this.size+">"},gn.prototype.Zn=function(t){bn("processMessage")},gn.prototype.ti=function(){bn("getPos")},gn.prototype.ei=function(){this.callbacks||(this.callbacks={}),this.callbacks.passwordPrompt||(this.callbacks.passwordPrompt=function(t){setTimeout(function(){let e=prompt("Script paused for password input. Enter password.");t(e)},100)})},gn.prototype.cn=function(parentDiv,t){this.parentDiv=parentDiv;let e=parentDiv.id;var l=e+"Canvas";this.H=gn.jl(l,parentDiv,t.width,t.height,1);var n=e+"SelectionCanvas";return this.be=gn.jl(n,parentDiv,t.width,t.height,2),this.be.innerHTMLMessageLength=this.be.innerHTML.length,this.on=gn.an(e),parentDiv.appendChild(this.on),{H:this.H,be:this.be,li:this.on}},Cn.prototype.ni=function(){if(this.Jl&&this.Hl.length>0){var t=Pe(this.Hl),e={t:this.Jl,data:t};Ql.debug("sending telnet options, dump follows"),ye(this.Hl,Ql),null!=this.Vl.Tl&&this.Vl.Tl.send(JSON.stringify(e)),this.Hl=[]}},ze(oi,gn,[oi.vn,oi.Fn,oi.yn,oi.On,oi.zn,oi.dn,oi.Pn,oi.pe,oi.ln,oi.ti,oi.connect,oi.in,oi.nn,oi.en,oi.handleContainerResize]);const Fn=/[`~!@#$%^&\*()+={}\[\];:\'<>?,]+/,xn=/[0-9a-zA-Z-_.\/]+/;var Pn=!1;const Mn=1,Nn=2,Rn=-1,Dn=0,In=1,Ln=2,_n=3,On=4,Un=5,Vn=6,Hn=7,Bn=8,zn=9,Jn=10,jn=11,Wn=12,Gn=13,$n=14,Xn=15,Kn=16,qn=17,Yn=18,Qn=19,Zn=20,ti=21,ei=22;function li(t){this.ii=65533,this.$e=oi.Xe,this.We=0,this.Ze=oi.Xe,this.Qe=0,this.Be=oi._e,this.ze=oi.Oe,this.He=t}function ni(parentDiv,t,e){this.scrollPos=0,this.si(parentDiv,t,e)}li.prototype.ri=function(){return 65533!=this.ii?65533:this.He},ni.prototype.si=function(parentDiv,t,e){this.hi=document.createElement("div"),this.hi.id=parentDiv.id+"scrollingDiv",this.hi.style.ui=`position: absolute; top: 0px; left: 0px; opacity: 0; cursor: default;\n                                   overflow-y: scroll;\n                                   width: ${t}; height: ${e};`,this.hi.style.zIndex=1,this.hi.style.width=t+"px",this.hi.style.height=e+"px",this.oi=e,this.ai=e,this.ci=document.createElement("div"),this.ci.id=this.hi.id+"Inner",this.ci.style.ui="position: absolute; top: 0px; left: 0px; opacity: 0; cursor: default;\n                                   width: 90%;",this.ci.style.height=e+"px",this.ci.style.zIndex=1,this.hi.appendChild(this.ci)},ni.prototype.fi=function(t){let e=this.hi.scrollHeight-this.hi.clientHeight;-1==t||t>e?(this.scrollPos=e,this.hi.scrollTop=e):(this.scrollPos=t,this.hi.scrollTop=t)},ni.prototype.wi=function(){return this.hi},ni.prototype.di=function(parentDiv){if(this.ci||this.hi)try{this.hi.removeChild(this.ci),parentDiv.removeChild(this.hi),this.ci=null,this.hi=null}catch(t){e.severe("Could not remove scrolling div from parent="+parentDiv)}},ni.prototype.pn=function(t,e){this.hi.style.width=t,this.hi.style.height=e,this.hi.style["overflow-y"]="scroll",this.ci.style.width="90%";let l=this.ai/this.oi*e;this.ci.style.height=l,this.oi=e,this.ai=l},ni.prototype.pi=function(){return this.scrollPos},ni.prototype.ti=function(){return this.hi.scrollTop},ni.prototype.bi=function(){this.scrollPos=this.hi.scrollTop},ni.prototype.vi=function(t){return t/this.ki},ni.prototype.mi=function(t,e){let l=t*e;this.ki=t,this.ci.style.height=l+"px",this.ai=l,this.bi()};var ii=0;function si(t,e){this.rl=new Array(t),this.xe=!0,void 0==e&&(this.id=ii++)}var ri=function(t,e){t||(t={fontProperties:{scaleMethod:2}});var l=t.fontProperties.size?t.fontProperties.size:Gl.K,n=t.fontProperties.Ai?t.fontProperties.Ai:Gl.jt,i=t.fontProperties.style?t.fontProperties.style:Gl.Wt,s=t.fontProperties.name?t.fontProperties.name:Gl.Y,r=e.getContext("2d");r.font=i+" "+n+" "+l+"px "+s;var h=l,u=r.measureText("M").width,o=Math.floor(e.width/u);return{ie:Math.floor(e.height/h),se:o}},hi=function(t){var l="--------------------------------------------------------------------------------";t&&t.debug?t.debug(l):e.debug(l)},ui=function(t,e){var l=e;return t.length>0&&(l=Number(t)),l<e&&(l=e),l};function oi(t,l,n,i){this._l=Nt,this.H=null,this.be=null,this.parentDiv=null,this.oiaEnabled=0,this.width=t,this.height=l,this.kl=an.pl,this.ml=new An(this,this.width),this.Al=new Array(this.height*t),this.Tt=null,this.gl=t,this.Cl=l,this.Sl=[],this.Tl=null,this.ci=i,this.yl=0,this.ae=null,this.oe=null,this.ce=null,this.fe=null,this.El=!1,this.Fl=!1,this.xl="rgb(255,255,255)",this.size=t*l,this.gi=new Array(this.size),this.clear(),this.ue=0,this.Ci=0,this.Z=oi.Q,e.debug("charsetInfo = "+this.Z),this.Si=n-l,this.wl=n,this.Ti=0,this.al=0,this.yi=[],this.Ee=null,this.Ei=null,this.Fi=null,this.xi=0,this.Pi=0,this.Mi=null,this.Ni=null,this.Ri=null,this.Di=!0,this.Ii=!1,this.Li=!1,this.Ml=rl,this.Ge=0,this.$e=oi.Xe,this.We=0,this.Ze=oi.Xe,this.Qe=0,this._i=!1,this.Oi=!1,this.Ui=0,this.Vi=0,this.Hi=!1,this.Bi=[oi._e,oi.Oe,oi.Ue,oi.zi],this.Ji=0,this.ji=1,this.Wi=0,this.termType=zt,this.Gi=!1,this.$i=null,this.Xi=null,this.Gl(),this.nl=new Array(this.height),this.fl=0,this.Ki=!1,this.qi=Nn,this.Yi=!1,this.Qi=!1,this.Zi=!1,this.ts=0,this.je=!0,this.es=Ot,this.ls=be,this.ns=0,this.ss=0,this.rs=oi.hs(),this.us=de,this.Il=!1,this.Ol=0,this.os=!1}oi.hs=function(){return[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]},oi.as=function(parentDiv,t,e){let l=document.createElement("div");return l.id=parentDiv.id+"innerScrolling",l.style.ui=`position: absolute; top: 0px; left: 0px; opacity: 255; cursor: default;\n                             width: ${t}; height: ${e};`,l.style.zIndex=2,l.style.width=t+"px",l.style.height=e+"px",l},oi.Xe=0,oi.Ke=1,oi.qe=2,oi.Ye=3,oi._e=66,oi.Oe=60,oi.Ue=48,oi.zi=65,oi.cs=function(t){if(t)return{t:"VT_INPUT",data:Pe(t)}},oi.fs=function(t,e,l){for(var n,i=t,s=e;s<l.rl.length;s++)n=l.rl[s],l.rl[s]=i,i=n},oi.ws=function(t){return t.push(27),t.push(91),t.push(56),t.push(109),t},oi.ds=function(t){return t.push(27),t.push(91),t.push(48),t.push(109),t},oi.ps=function(t){switch(t.termType){case zt:t.bs=fe;break;default:t.bs=ce}},oi.vs=function(t){switch(t.termType){case zt:t.termTypeString="linux";break;case 2:t.termTypeString="vt220";break;case 0:t.termTypeString="vt320";break;case 3:t.termTypeString="vt420"}},oi.ks=function(t,e,l,n){var i=t.fontProperties.size?t.fontProperties.size:Gl.K,s=t.fontProperties.Ai?t.fontProperties.Ai:Gl.jt,r=t.fontProperties.style?t.fontProperties.style:Gl.Wt,h=t.fontProperties.name?t.fontProperties.name:Gl.Y;let u=gn.jl(e.id+"tempSizeCalc",e,l,n,0);var o=u.getContext("2d");o.font=r+" "+s+" "+i+"px "+h;var a=i,c=o.measureText("M").width;let f=Math.floor(u.width/c),w=Math.floor(u.height/a);return e.removeChild(u),{width:f,height:w}},oi.prototype.en=function(parentDiv){this.ms?(this.ms.di(parentDiv),this.ci.removeChild(this.on),this.ci.removeChild(this.H),this.ci.removeChild(this.be),parentDiv.removeChild(this.ci)):(parentDiv.removeChild(this.on),parentDiv.removeChild(this.H),parentDiv.removeChild(this.be))},oi.prototype.As=function(){var t=0,l=!1;this.ms.wi().addEventListener("wheel",t=>{this.Yn(t)}),this.ms.wi().addEventListener("scroll",n=>{if(this.Tt)if(l)n.preventDefault();else{this.gs=-1,l=!0;try{let i=n.target,s=this.ms,r=i.scrollHeight,h=i.scrollTop,u=s.pi(),o=u-h;if(o>0&&this.Ee.id===this.Mi.id)return e.warn("Could not scroll; already at top."),void(i.scrollTop=u);let a=s.vi(o),c=a%1;t*c<0&&(t=0);let f=(t+=c)>0?Math.floor(t):Math.ceil(t),w=(a>0?Math.floor(a):Math.ceil(a))+f;t-=f,en.debug(`Scroll Info: scrollDivHeight=${r}, topOfScrollViewport=${h}, lastPos=${u}, rawDiff=${o}, lineDiff=${a}, remainder =${c}, scrollLeftover= ${t}, scrollRollover =${f}, scrollTotal= ${w}`),w&&(w>0?(h<s.ki&&(w=-1),this.Cs(w)):(r-i.clientHeight-h<2*s.ki&&(w=1),this.Ss(w)),s.bi())}catch(n){console.log(n.stack?n.stack:n.message)}finally{l=!1}}})},oi.prototype.handleContainerResize=function(parentDiv,t,l){e.info("handling resize"),clearTimeout(kn);var n=t||parentDiv.clientWidth,i=l||parentDiv.clientHeight;if(0!==i&&null!==i&&void 0!==i||(i=this.Pl.height),null==this.Ts&&(this.Ts=this.ms?this.ms.ti():0),this.en(parentDiv),this.Tt&&this.Tt.clear(),e.info("resize w="+n+" h="+i),this.ys){let t=this.ms;t.si(parentDiv,n,i),n-=20;let e=oi.as(parentDiv,n,i);this.ci=e,parentDiv.appendChild(t.wi()),parentDiv.appendChild(e),this.cn(e,{width:n,height:i}),this.parentDiv=parentDiv,e.style.position="absolute",this.As()}else this.cn(parentDiv,{width:n,height:i});this.fn(),this.Tt&&(this.Tt.H=this.H,this.Tt.$t(),this.wn(this.Pl),this.Tt.zt(),this.Tt.Ce()),this.ys&&(this.ms.wi().style.opacity="255"),this.ms&&(this.ms.mi(this.Es(),this.wl),this.ms.fi(this.Ts),this.Ts=null);var s=this;kn=setTimeout(function(){s.dn()},200)},oi.prototype.Qn=function(t){t.preventDefault()},oi.prototype.ol=function(){if(!this.Ee||!this.Fi)return-1;let t=this.height,e=this.Ee,l=this.Fi.id;for(let n=0;n<t;n++){if(!e)return-1;if(e.id===l)return n;e=e.P}return-1},oi.prototype.Fs=function(){return 1},oi.prototype.connect=function(t,e){if(this._l===Nt){this._l=1;let i=this;var l=new WebSocket(t);i.Tl=l,l.onopen=function(){if(e.host&&e.port){var t={t:"CONFIG",host:e.host,port:Number(e.port)};1===e.security?t.security={t:"ssh",termt:i.termTypeString,termr:i.height,termc:i.width,badCert:e.xs}:2===e.security?(Ql.warn("We dont support TLS yet. Try SSH!"),l.close()):0!=e.security&&(Ql.info("Unknown security type requested!"),l.close()),l.send(JSON.stringify(t)),Ql.debug("Sent "+JSON.stringify(t))}};var n=!1;l.onmessage=function(t){var e=JSON.parse(t.data);if(Ql.log(Ql.FINER,"ws.onMessage "+JSON.stringify(e)),null!=i.Tt){var l=9;i.ml.vl[l++]=88,i.ml.vl[l++]=wt[0],i.ml.vl[l++]=wt[1],i.ml.vl[l++]=wt[2],i.Tt.re()}i.Zn(e),n||(n=!0,i.callbacks&&i.callbacks.readyCallback&&i.callbacks.readyCallback.apply(this,null))},l.onerror=function(t){i.Kl(t),l=null},l.onclose=function(t){i.callbacks&&i.callbacks.unexpectedCloseConnectionHook?i.callbacks.unexpectedCloseConnectionHook(i,t):(i.Ql(t),l=null)}}},oi.prototype.pe=function(){var t,e=this.ml.vl,l=this.al+1,n=(this.Ps()+1).toString(),i=l.toString(),s=76;e[s--]=47;for(let l=2;l>-1;l--)n.length<l?e[s--]=32:(t=n.charAt(l))&&(e[s--]=t.charCodeAt(0));s=79;for(let l=2;l>-1;l--)i.length<l+1?e[s--]=32:(t=i.charAt(l))&&(e[s--]=t.charCodeAt(0));return this.kl==an.pl&&0!=this.Yl.security&&(e[3]=43),e},oi.prototype.Yn=function(t){if(t.deltaY&&this.ms){let l=this.ms,n=l.wi().scrollHeight,i=l.wi().scrollTop,s=l.pi(),r=-t.deltaY;if(r>0&&(this.Ee.id===this.Mi.id||0==i))return e.warn("Could not scroll; already at top."),void(l.wi().scrollTop=s);let h=l.vi(r);en.debug(`Wheel Info: scrollDivHeight=${n}, topOfScrollViewport=${i}, lastPos=${s}, rawDiff=${r}, lineDiff=${h}`),h&&(h>0?this.Cs(h):this.Ss(h)),l.fi(l.ti()-r)}},oi.prototype.Un=function(t,e,l,n){var i=l.ie,s=l.se;let r=this.Ee;if(i<0||i>this.height||s<0||s>this.width)en.Ms("clicking out of bound "+l);else{for(let t=0;t<i;t++){if(!r)return void en.Ms("clicking out of bound "+l);r=r.P}r&&(this.ae=i,this.ce=i+1,this.oe=0,this.fe=this.width,this.Tt&&this.Tt.re())}},oi.prototype.zn=function(t,e,l,n){var i=l.ie,s=l.se;let r=this.Ee;if(i<0||i>this.height||s<0||s>this.width)en.Ms("clicking out of bound "+l);else{for(let t=0;t<i;t++){if(!r)return void en.Ms("clicking out of bound "+l);r=r.P}if(r){this.ae=i,this.ce=i+1;var h=this.Ns(r),u=h.charAt(s),o=s,a=s;if(" "==u){for(;" "==h.charAt(o--););for(;" "==h.charAt(a++););}else if(null!=u.match(Fn)){for(;null!=h.charAt(o--).match(Fn););for(;null!=h.charAt(a++).match(Fn););}else if(null!=u.match(xn)){for(;null!=h.charAt(o--).match(xn););for(;null!=h.charAt(a++).match(xn););}o++,a--,this.oe=o+1,this.fe=a,this.Tt&&this.Tt.re()}}},oi.prototype.Rs=function(t){let e=t.Ds;e&&(e.P=t.P),t.P.Ds=e,t.id==this.Mi.id&&(this.Mi=this.Mi.P),t.id==this.Ei.id&&(this.Ei=this.Ei.P)},oi.prototype.Is=function(t,e,l,n,i){let s=null!=this.$i?this.Ls(this.$i):null;for(var r=t+l>this.height?this.height-1-l:t,h=this.Ls(n),u=0;u<r;u++){if(null!=h){var o=new si(this.width);h.P?h.P.Ds=o:h.id===this.Ni.id&&(this.Ni=o),o.Ds=h,o.P=h.P,h.P=o,h=o}var a;e.P?a=e.P:(a=new si(this.width),e.P=a,a.Ds=e,this._s(!0)),e.id!=this.Ei.id||s&&e.id==this.Ei.id&&s.id==this.Ei.id?this.Rs(e):e.id==this.Ei.id&&(this.wl<=this.height||this.Pi>=this.wl?this.Ei.id==this.Mi.id?this.Rs(this.Ei):(this.Rs(this.Mi),this.Ei=this.Ei.P):(this.Ei=this.Ei.P,this._s(!1))),e=a,i&&(this.Fi=e)}},oi.prototype.Os=function(t){this.Pi--,t&&this.xi--},oi.prototype._s=function(t){this.Pi++,t&&this.xi++},oi.prototype.Us=function(t,e,l,n,i){for(var s=t+l>this.height?this.height-1-l:t,r=this.Ls(n),h=0;h<s;h++){r.id===this.Ni.id&&(this.Ni=r.Ds),r.Ds.P=r.P,r=r.Ds;var u=new si(this.width);e.Ds?e.Ds.P=u:this.Mi=u,this.Ei.id==e.id&&(this.Ei=u,this.Ee=this.Ei),u.Ds=e.Ds,u.P=e,e.Ds=u,e=u,i&&(this.Fi=u)}},oi.prototype.sn=function(t,e,l,n,i,s,r,h){var u=[],o=this.Ee;let a=-1!==navigator.userAgent.indexOf("Windows");if(l>=0)for(var c=0;c<l;c++){if(!o)return"";o=o.P}else for(c=0;c>l;c--){if(!o)return"";o=o.Ds}for(var f=l;f<n;f++){r||f==l||(a&&u.push(13),u.push(10));var w=e,d=t;h&&f!=n-1&&(w=this.width),h&&f!=l&&(d=0);for(var p=d;p<w;p++)if(null!=o){var b=o.rl[p];if(b&&0!=(64&b.Ge))u.push(32);else if(b||!0!==s){var v=b.He;(!v||v<32)&&!0===s?u.push(32):u.push(v)}else u.push(32)}else u.push(32);o&&(o=o.P)}return String.fromCharCode.apply(null,u)},oi.prototype.in=function(t,e,l){if(null!=this.oe&&null!=this.fe){var n=Math.min(this.oe,this.fe),i=Math.max(this.oe,this.fe),s=Math.min(this.ae,this.ce),r=Math.max(this.ae,this.ce);return this.sn(n,i,s,r,t,e,l)}return null},oi.prototype.nn=function(t){if(this.Fi&&t){for(var e=[],l=0;l<t.length;l++)e.push(t.charCodeAt(l));return this.Vs(e),!0}return!1},oi.prototype.Hs=function(){var t=(65280&this.width)>>8,e=255&this.width,l=(65280&this.height)>>8,n=255&this.height;this.Bs(31,[t,e,l,n])},oi.prototype.zs=function(){var t={t:"SSH_CH_REQ",reqt:"window-change",reply:!1,data:[this.width,this.height,this.H.width,this.H.height]};1===this.Tl.readyState&&this.Tl.send(JSON.stringify(t))},oi.prototype.dn=function(){if(en.debug("Resize completed"),this.Gi){var t=ri(this.Pl,this.be),e=!1;t.ie<this.height&&(en.debug("Resizing, old height was "+this.height+", new height will be "+t.ie),e=!0),this.ys?this.wl=this.Si+t.ie:this.wl=t.ie,this.pn(t.se,t.ie,!0),this.Ei&&en.debug("After resize, scrolling viewport to bottom. Top ID="+this.Ei.id),this.Ss(1),this.Ee=this.Ei,this.Ei&&en.debug("Scroll complete. Top ID="+this.Ei.id),this.ys&&(this.ms.wi().scrollTop=this.ms.wi().scrollHeight,this.ms.scrollPos=this.ms.wi().scrollTop),1!=this.Yl.security?this.Hs():this.zs(),e&&this.Ee&&(en.debug("After resize, scrolling viewport to bottom. Top ID="+this.Ee.id),this.Ss(1),en.debug("Scroll complete. Top ID="+this.Ee.id))}},oi.prototype.On=function(t,e,l,n){en.debug("VT click encountered")},oi.prototype.wn=function(t){null!==t&&void 0!==t&&this.Tt.Gt(this.Pl.fontProperties),this.Tt.zt()},oi.prototype.Js=function(t){return!this.Mi||(null==t&&(t=this.Ps()),this.Fi.id==this.Ni.id||this.js&&t==this.Xi)},oi.prototype.Ws=function(){return!this.Mi||this.Fi.id==this.Mi.id},oi.prototype.Gs=function(t){Zl.log(Zl.FINEST,"Addline entry. IL ID="+(null==this.Fi?null:this.Fi.id)+", TT ID="+(null==this.Ei?null:this.Ei.id)+", Buff lines="+this.Pi);var e=new si(this.width);return null==this.Mi?(this.Mi=e,this.Ni=e,this.Ei=e,this.Ee=e,this.Fi=null,this.ts=0,this._s(!0)):(this.Pi>=this.wl&&!t&&this.xi>this.height?1===this.wl?(this.Mi=e,this.Ni=e,this.Ei=e,this.Ee=this.Ei):2===this.wl?(this.Mi=this.Mi.P,this.Mi.Ds=null,this.Mi.P=e,e.Ds=this.Mi,this.Ei=this.Mi,this.Ee=this.Ei,this.Ni=e):this.wl<=this.height?(this.Mi=this.Mi.P,this.Ei=this.Mi,this.Ee=this.Ei,this.Mi.Ds=null,this.Ni.P=e,e.Ds=this.Ni,this.Ni=e):(this.Mi=this.Mi.P,this.Mi.Ds=null,this.Ni.P=e,e.Ds=this.Ni,this.Ni=e,this.Ei=this.Ei.P,this.Ee=this.Ee.P):(e.Ds=this.Ni,this.Ni.P=e,this.Ni=e,this.xi>=this.height?(this.Ei=this.Ei.P,this.Ee=this.Ei,this._s(!1)):this._s(!0)),this.ts++,this.ts++),this.Fi=e,this.al=0,Zl.log(Zl.FINEST,"-- Addline exit. IL ID="+this.Fi.id+", TT ID="+this.Ei.id+", Buff lines="+this.Pi),e},oi.prototype.Ns=function(t){var e="";if(void 0!==t.rl)for(var l=0;l<t.rl.length;l++)if(null!==t.rl[l]&&void 0!==t.rl[l]){var n=String.fromCharCode(t.rl[l].He);e+=null===n||" "===n?" ":n}else e+=" ";return e},oi.prototype.ln=function(t){this.al=0,t?(this.Ei=null,this.Ee=null,this.Fi=null,this.xi=0,this.Pi=0,this.Mi=null,this.Ni=null,this.fl=0):(this.Gs(),this.Fi=this.Ni,this.Ei=this.Fi,this.Ee=this.Ei,this.xi=1)},oi.prototype.yn=function(t){en.debug("Handlekeycode hit")},oi.prototype.Fn=function(t){Yl.debug("keypress, charCode="+t),160==t&&(t=32),t>=32&&t<127?(Yl.debug("normal press code=0x"+Te(t)),this.Vs([t])):(Yl.debug("Unhandled key press 0x"+Te(t)),vn())},oi.prototype.clear=function(){this.ms?this.ln(!1):this.ln(!0),Zl.debug("Clear: should have cleared screen")},oi.prototype.Vs=function(t){if(this.Yi&&t){var e={t:"TELNET_DATA",B64:Pe(t)};Ql.debug("Sending local echo message"),this.Zn(e)}this.ls===be&&this.$s(t)},oi.prototype.Pn=function(t,l){var n=l?t.substring(0,l):t,i=[];for(let t=0;t<n.length;t++){var s=n.charCodeAt(t);if(!(s>=32&&s<127))return e.info("Invaid ASCII input="+n.charAt(t)),!1;i.push(s)}return i.length>0?(this.Vs(i),!0):(e.info("0 length bufer found for autotype"),!0)},oi.prototype.Xs=function(t){Yl.debug("keypress, name="+t);var e=ae[t][!0===this.os?1:0];e?this.Vs(e):(Yl.debug("Unhandled key press for "+t),vn())},oi.prototype.vn=function(t,e){if(this.Ki)Yl.warn("Keyboard Locked: Cannot accept input at this time");else{if(e.keyCode,8===t.type&&3&this.yl&&1===t.value.length){var l=t.value.charCodeAt(0);Yl.debug("Executing alt keypress for keycode="+l);var n=[27,l];this.Vs(n)}else if(2===t.type||8===t.type){let l=t.value;if(3===e.location)this.Xs(l);else{if(1!=l.length)return;this.Fn(l.charCodeAt(0))}}else{if(64!==t.type)return;this.Ks(t.value,e.location)}e.stopPropagation(),e.preventDefault()}},oi.prototype.qs=function(t){return{Ys:Math.floor(t/this.width),Qs:Math.floor(t%this.width)}},oi.prototype.Zs=function(t){Ql.debug("---------------TELNET_DATA hex dump----------------"),ye(t,Ql),Ql.debug("---------------TELNET_DATA ascii dump--------------"),Ql.debug(String.fromCharCode.apply(null,t)),Ql.debug("---------------TELNET_DATA dump end----------------"),this.Ri||(this.Ri=new ai(this,"VT_INPUT"));var e=this.Ri,l=t.entries();this.Ee&&this.Ei&&this.Ee.id!=this.Ei.id&&(this.ys&&(this.ms.wi().scrollTop=this.ms.wi().scrollHeight),this.Ss(1),this.Ee=this.Ei);for(let t of l){let l=t[1];e.tr(l)}e.ni();let n=Date.now(),i=0;this.er&&n-this.er<5&&(i=5,this.er&&this.er-n<3&&(i=3),clearTimeout(this.lr)),this.er=n,this.lr=setTimeout(()=>{this.nr()},i)},oi.prototype.Zn=function(t){Ql.debug("Processing websocket message. Type="+t.t);let l=this;switch(t.t){case"CONNECTED":this.jn(t);break;case"IP_RES":l.clientIP=t.data;break;case"TELNET_DATA":var n=Me(t.B64);this.Zs(n);break;case"CERT_PROMPT":this.callbacks&&this.callbacks.ir?this.callbacks.ir(this.Yl.host,t.fp,(t,l)=>{this.Tl.send(JSON.stringify({t:"CERT_RES",a:t})),t||e.info("Rejecting TLS certificate and closing connection. Reason="+l)}):this.Tl.send(JSON.stringify({t:"CERT_RES",a:!0}));break;case"SSH_USER_AUTH_INFO_REQ":this.ls=3,this.Qi=this.Yi,this.Yi=!0,this.sr=t.prompts,this.rr=0;var i=[];for(let e=0;e<t.name.length;e++)i.push(t.name.charCodeAt(e));i.push(13);for(let e=0;e<t.inst.length;e++)i.push(t.inst.charCodeAt(e));if(i.push(13),t.prompts.length>0){var s=t.prompts[0];s.e&&oi.ws(i);var r=s.s;for(let t=0;t<r.length;t++)i.push(r.charCodeAt(t));s.e&&oi.ds(i),this.rr=1,this.hr=[]}var h=Pe(i);this.Zn({t:"TELNET_DATA",B64:h});break;case"SSH_USER_AUTH_REQ":this.Fi||this.Gs(),this.al=0,this.Qi=this.Yi,this.Yi=!0,void 0===this.ur||null===this.ur?(this.ls=1,this.Pn("login as: "),this.ss=this.al):(this.Pn("Password rejected by host"),this.or());break;case"CERT_REJECT":this.Tl.close(4001,"server sent close/error/exception message");break;case"ERR":this.Wn(t);default:Ql.warn("Unhandled websocket message. Type="+t.t)}},oi.prototype.Bs=function(t,e){for(var l=[255,250,t],n=0;n<e.length;n++)l.push(e[n]);l.push(255),l.push(240);var i={t:"VT_INPUT",data:Pe(l)};Ql.debug("Sending telnet sub, dump follows"),ye(l,Ql),null!=this.Tl&&this.Tl.send(JSON.stringify(i))},oi.prototype.nr=function(){let t=!1;null==this.Tt&&(t=!0,e.debug("showScreen"),this.Tt=new $l(this,null,this.Gi?2:1),null!==this.Pl&&void 0!==this.Pl&&this.wn(this.Pl));for(var l=9;l<18;l++)this.ml.vl[l]=32;this.Tt.il(),t&&this.ms&&(this.ms.wi().style.opacity="255")},oi.prototype.ar=function(t,e){var l=this.Ps()+t,n=this.al+e;this.cr(l,n)},oi.prototype.fr=function(t){var e=this.qs(t);this.cr(e.Ys,e.Qs)},oi.prototype.wr=function(t){var e=Math.max(this.ss,Math.min(t,this.width));t!=e&&Zl.warn("Column for setcursor abnormal. column="+t+". Set to "+e),this.al=e,this.Tt&&this.Tt.gt&&this.Tt.ke()},oi.prototype.cr=function(t,e){this.js&&this.$i&&(t=this.$i+t);var l=null!=this.Xi&&this.js?this.Xi:this.height-1,n=Math.max(0,Math.min(t,l)),i=Math.max(this.ss,Math.min(e,this.width-1));t==n&&e==i||Zl.warn("Column and row given for setcursor abnormal. column="+e+", row="+t+". Set to column="+i+", row="+n),this.Fi=this.dr(n),this.ts=n,this.al=i,this.Tt&&this.Tt.gt&&this.Tt.ke()},oi.prototype.or=function(){if(this.ur){for(var t=this.ur+"@"+this.Yl.host+"'s password: ",e=[13,10],l=0;l<t.length;l++)e.push(t.charCodeAt(l));oi.ws(e);var n=Pe(e);this.ns=t.length,this.ss=t.length,this.ls=2,this.Zn({t:"TELNET_DATA",B64:n})}},oi.prototype.Ks=function(t,e){var l,n;if(("Delete"===t||"Backspace"===t)&&this.ls!=be)return this.pr(),this.Tt.il(),!0;if("Enter"===t){if(Zl.debug("Handling enter, input state=0x"+Te(this.ls)),1===this.ls){var i=[];for(let t=10;t<this.al;t++){let e=this.Fi.rl[t];if(!e||!e.He)break;i.push(e.He)}return this.ur=String.fromCharCode.apply(null,i),this.or(),!0}if(2===this.ls){var s=[];for(let t=this.ns;t<this.width;t++){let e=this.Fi.rl[t];if(!e||!e.He)break;s.push(e.He)}var r=String.fromCharCode.apply(null,s),h=Pe([13,10,27,91,48,109]);return this.Zn({t:"TELNET_DATA",B64:h}),this.Yi=this.Qi,this.ls=be,this.ss=0,this.Tl.send(JSON.stringify({t:"SSH_USER_AUTH_RES",m:"password",u:this.ur,p:r})),!0}if(3===this.ls){var u=this.sr[this.rr-1].length,o=[],a=this.Fi;let t;for(let e=u;e<this.width&&(t=a.rl[e])&&t.He;e++)o.push(t.He);if(this.hr.push(String.fromCharCode.apply(null,o)),this.rr>=this.sr.length)this.ls=be,this.Yi=this.Qi,this.Tl.send(JSON.stringify({t:"SSH_USER_AUTH_INFO_RES",res:this.hr}));else{var c=this.sr[this.rr++],f=[13];c.e&&oi.ws(f);var w=c.s;for(let t=0;t<w.length;t++)f.push(w.charCodeAt(t));c.e&&oi.ds(f)}return!0}if(this.ls===be)return this.os&&3==e?this.Vs([27,79,77]):this.Zi?this.Vs([13,10]):this.Vs([13]),!0}else{var d;if(l=oe[t])return!!(d=this.br?l[2]:this.Vi?l[1]:l[0])&&(this.Vs(d),!0);if(null!=(n=Y[t])&&16&n)return this.Tn(t),!0;if(this.bs){"Backspace"==t&&this.vr&&(t="Delete");var p=this.bs[t];if(null!=p)return this.Vs(p),!0}}return Yl.warn("Unhandled VT function="+t),!1},oi.prototype.Cs=function(t){if(this.Ee){let e,l=0;-1==t?(e=0,t=1):e=1;for(let n=0;n<t&&this.Ee.Ds;n+=e)this.Ee=this.Ee.Ds,l++;this.ae+=l,this.ce+=l,this.Tt.il(l)}},oi.prototype.Ss=function(t){let e,l=this.Ee;for(let t=0;t<this.height+1;t++){if(!l)return;l=l.P}1==t?(e=0,t=-1):e=1,t=0-t;let n=0;for(let i=0;i<t&&(this.Ee=this.Ee.P,n--,l&&l.P);i+=e)l=l.P;this.ae+=n,this.ce+=n,this.Tt.il(n)},oi.prototype.kr=function(){for(var t=this.Ee,e=0,l=0;l<this.height&&t.P;l++)t=t.P,e++;if(e<this.height-1)return this.xi=e,!0;for(;t;)this.Ee=this.Ee.P,t.xe=!0,this.Ni=t,t=t.P;return this.xi=this.height,!0},oi.prototype.mr=function(t){if(Zl.log(Zl.FINEST,"insertChar: "+t+" - posInLine="+this.al+"  width="+this.width+"glidx=0x"+Te(this.Ji)+" gridx=0x"+Te(this.ji)),null==this.Fi)this.ln(!0),this.Gs();else if(this.al>=this.width){if(!this.Li)return void Zl.debug("No implicit wrap, maybe overwrite if not in INSERT mode");if(this.Gs(),this.Zi)this.wr(0);else for(var e=0;e<this.al;e++)this.mr(32)}var l=new li(t);return this._i?(l.Be=this.Bi[2],this._i=!1):this.Oi?(l.Be=this.Bi[3],this.Oi=!1):(l.Be=this.Bi[this.Ji],l.ze=this.Bi[this.ji]),l.Ge=this.Ge,0!=(8&l.Ge)&&(this.Fi.Fe=!0),this.Ar&&(l.Ar=!0),l.$e=this.$e,l.We=this.We,l.Ze=this.Ze,l.Qe=this.Qe,this.qi===Nn?this.Fi.rl[this.al++]=l:oi.fs(l,this.al,this.Fi),this.Fi.xe=!0,l},oi.prototype.Ls=function(t){this.dr(t);for(var e=0,l=this.Ei;e!=t;)l=l.P,e++;return l},oi.prototype.ti=function(){return this.Gn(this.Ps(),this.al)},oi.prototype.Ps=function(){if(!0===Pn)return this.ts;{if(null==this.Fi||null==this.Ei)return 0;let l=this.Fi.id;for(var t=this.Ei,e=0;t.id!=l;)t=t.P,e++;return this.ts=e,e}},oi.prototype.dr=function(t){let e=this.Ei;var l=e;t>=this.height&&(Zl.warn("ensureLine requested to check row "+t+" greater than height:"+this.height),t=this.height-1);for(var n=0;n<t&&null!=l;)e=l,l=l.P,n++;if(Zl.log(Zl.FINER,"After ensureline loop, line="+l+", y="+n+", terminalLineNumber="+t),null==l||!l)for(var i=n;i<t+1;i++)l=this.Gs(!0);return l},oi.prototype.gr=function(t,e,l){Zl.debug("eraseInLine startColumn="+e+" endColumn="+l);for(var n=e;n<=l;n++)t.rl[n]=null;t.xe=!0},oi.prototype.Cr=function(t,e,l,n){if(null!=this.Fi&&null!=this.Ei){var i=this.al;-1==e&&(e=i),-1==n&&(n=i),t=Math.max(0,Math.min(t,this.height-1)),e=Math.max(0,Math.min(e,this.width-1)),l=Math.max(0,Math.min(l,this.height-1)),n=Math.max(0,Math.min(n,this.width-1));for(var s=this.Ei,r=0;r<t;){if(null==(s=s.P))return;r++}do{this.gr(s,r==t?e:0,r==l?n:this.width-1),s=s.P,r++}while(r<=l&&s)}},oi.prototype.Sr=function(){var t=this.Ps();Zl.debug("cursor row="+t+" cursor="+this.al)},oi.prototype.Tr=function(t,e){return 0},oi.prototype.yr=function(t,e){return 0},oi.prototype.Er=function(){this.ar(0,-1)},oi.prototype.pr=function(){var t=this.Fi;if(this.al>0){var e=this.al-1;this.Fr(1,t,e),this.wr(e)}},oi.prototype.Es=function(){this.H.height,this.height;let t=this.H.height%this.height;return(this.H.height-t)/this.height};var startVT=function(t,l,n,callbacks,i){let s=t.parentDiv;s.id;let r,h=t.height,u=t.width,o=!1,a=null,c=s;if(n&&n.screenBufferLines){let e=Number(n.screenBufferLines),i=Number(l.screenHeight);if("MAX"==l.screenWidth||"MAX"==l.screenHeight?i=oi.ks(n,c,u,h).height:(l.screenHeight=Number(l.screenHeight),l.screenWidth=Number(l.screenWidth)),e>i){r=e+i,o=!0;let l=h%i;(a=new ni(s,u,h)).mi((h-l)/i,r),u=t.width=u-20,c=oi.as(s,u,h),s.appendChild(a.wi()),a.fi(-1),s.appendChild(c)}}var f=!1;if("MAX"==l.screenWidth||"MAX"==l.screenHeight){f=!0;let t=oi.ks(n,c,u,h);l.screenHeight=t.height,l.screenWidth=t.width}else l.screenHeight=Number(l.screenHeight),l.screenWidth=Number(l.screenWidth);let w=l.screenWidth?l.screenWidth:un,d=l.screenHeight?l.screenHeight:on;o||(r=d);var p=0,b=1,v=new oi(w,d,r,c);if(v.callbacks=callbacks,i&&(v=Object.assign(v,i)),v.cn(c,t),v.parentDiv=s,v.ei(),v.ys=o,l&&(l.termTypeString&&"string"==typeof l.termTypeString&&(v.termTypeString=l.termTypeString),void 0!==l.termType&&"number"==typeof l.termType&&(v.termType=l.termType),void 0!==l.oiaEnabled&&"boolean"==typeof l.oiaEnabled&&(v.oiaEnabled=l.oiaEnabled?1:0),l.security&&"object"==typeof l.security&&(l.security.type&&"number"==typeof l.security.type&&(p=l.security.type),l.security.badCert&&"number"==typeof l.security.badCert&&(b=l.security.badCert)),l.answerback&&"string"==typeof l.answerback)){for(var k=[],m=0;m<l.answerback.length;m++)k.push(l.answerback.charCodeAt(m));v.answerback=k}return v.termTypeString||oi.vs(v),oi.ps(v),a&&(v.ms=a,v.As()),null!==n&&void 0!==n&&(v.Pl=n,null!==n.xr&&void 0!==n.xr&&(v.Ml=n.xr),v._n=n._n),v.Gi=f,v.ln(!0),e.debug("connect = "+l.connect),v.Yl={host:l.host,port:Number(l.port),security:p,xs:b},l.connect?v.connect(l.url,v.Yl):v.Dl=!0,v.fn(),v.H.focus(),v.callbacks&&"function"==typeof v.callbacks.onInit&&v.callbacks.onInit(),v};function ai(t,e){this.Jl=e,this.Vl=t,this.Ul=In,this.data=[],this.Pr=new Array(1e3),this.Mr=0,this.Nr=[],this.Rr=[],this.Bl=null,this.Hl=[],this.Dr=!0,this.Ir=!0,this.Lr=!0,this.zl=[],this._r=!1,this.Or=[],this.Ur=[]}function ci(t){this.message=t,this.name="VTParseException",ln.warn("Encountered exception:"+this.name+", msg:"+t)}ze(ai,Cn),ai.Vr=function(t){let e=t.length,l=0;switch(e){case 2:l=31&t[0];break;case 3:l=15&t[0];break;case 4:l=7&t[0];break;case 5:l=3&t[0];break;case 6:l=1&t[0];break;default:throw new Sn("Invalid length ("+e+") of UTF8 buffer")}for(var n=1;n<t.length;n++)l<<=6,l|=63&t[n];return l},oi.prototype.Fr=function(t,e,l){if(e&&e.rl){var n=0;for(let i=l+t;i<screen.width;i++)e.rl[l+n]=e.rl[i],n++;for(let t=l+n+1;t<screen.width;t++)e.rl[t]=void 0;e.xe=!0}},oi.prototype.$s=function(t){var e=oi.cs(t);e&&(Ql.debug("Sending VT message, dump follows"),ye(t,Ql),null!=this.Tl&&this.Tl.send(JSON.stringify(e)))},oi.prototype.Hr=function(){this.Ge=0;var t=null!=this.$i?this.$i:0,e=null!=this.Xi?this.Xi:this.height-1,l=this.Ps();if(this.Js(l)){if(this.Gs(),this.Zi)this.wr(0);else for(let t=0;t<this.al;t++)this.mr(32);this.ms&&this.ms.fi(-1)}else if(l==e&&null!=this.Xi){if(this.Is(1,this.Ls(t),t,e,!1),this.ar(1,0),!this.Zi)for(let t=0;t<this.al;t++)this.mr(32);this.Zi&&this.wr(0)}else this.ar(1,0),this.Zi&&this.wr(0)},ai.prototype.Br=function(){var t=this.Vl,e=this.zr();if(0==e.length)t.cr(0,0);else if(1==e.length)t.cr(e[0]-1,0);else{if(2!=e.length)throw new ci("wrong number of params to CSIxf/H -'"+this.Jr()+"'");t.cr(e[0]-1,e[1]-1)}},ai.prototype.jr=function(){let t,e=this.Vl;switch(e.termTypeString){case"vt102":t=te;break;case"vt220":t=ee;break;case"vt320":t=le;break;case"linux":case"xterm":case"vt420":t=ne;break;default:t=te,Zl.warn("Unknown term type specified:"+e.termTypeString+", sending VT102 string instead.")}e.$s(t)},ai.prototype.Wr=function(){let t,e=this.Vl;switch(e.termTypeString){case"vt220":t=ie;break;case"vt320":t=se;break;case"linux":case"xterm":case"vt420":t=re;break;default:t=ie,Zl.debug("Unknown term type="+e.termTypeString+", sending VT220 string")}t&&(Ql.debug("Sending VT identifier"),e.$s(t))},ai.prototype.Gr=function(t,e){this.Hl.push(255),this.Hl.push(t),this.Hl.push(e)},ai.prototype.$r=function(){var t=this.Vl,e=this.zl[0];switch(tn.debug("Handling telnet sub type b=0x"+Te(e)),e){case 31:tn.debug("-- Telnet Sub=WINDOW_SIZE"),t.Hs();break;case 24:tn.debug("-- Telnet Sub=TERMINAL_TYPE");let l=[0];for(let e=0;e<t.termTypeString.length;e++)l.push(t.termTypeString.charCodeAt(e));t.Bs(24,l);break;default:tn.warn("Request for telnet sub of type 0x"+Te(e)+", but is unhandled")}},ai.prototype.Xr=function(t){switch(tn.debug("Handling telnet option"),tn.debug("-- b=0x"+Te(t)),this.Bl){case 253:switch(tn.debug("-- Verb=DO"),t){case 0:this.Gr(252,0);break;case 1:e.info("Server requested telnet echo"),this.Vl.Yi=!0,this.Gr(251,1);break;case 5:this.Gr(254,5);break;case 31:this.Gr(251,31),this.Kr=!0,this.Vl.Hs();break;case 32:this.Gr(252,32);break;case 24:this.Gr(251,24);break;case 3:this.Gr(251,3),this.Ir=!0;break;default:tn.warn("Defaulted on DO, sending WONT for b=0x"+Te(t)),this.Gr(252,t)}break;case 254:switch(tn.debug("-- Verb=DONT"),t){case 1:this.Gr(252,1),this.Vl.Yi=!1,this.Dr=!0;break;case 31:break;default:this.Gr(252,t),tn.warn("Ignoring DONT for b=0x"+Te(t))}break;case 252:switch(tn.debug("-- Verb=WONT"),t){case 1:tn.warn("HOST WONT ECHO BUT WE DO NOT SUPPORT ECHO YET"),this.Vl.Yi=!0,this.Gr(251,1);break;default:tn.warn("Ignoring WONT for b=0x"+Te(t))}break;case 251:switch(tn.debug("-- Verb=WILL"),t){case 0:this.Gr(254,0);break;case 1:this.Lr&&this.Gr(253,1);break;case 5:this.Gr(254,5);break;case 38:this.Gr(254,38);break;default:tn.warn("Ignoring WILL for b=0x"+Te(t))}}!1===this._r&&(this.Gr(251,31),this._r=!0)},ai.prototype.clear=function(){this.Nr=[],this.Rr=[],this.qr=0,this.Yr=0,this.Or=[],this.Ur=[]},ai.prototype.Qr=function(t){this.Vl&&(this.Vl.mr(t),Zl.log(Zl.FINER,"Insert to Screen: b=0x"+Te(t)+", char="+String.fromCharCode(t)+", newRow="+this.Vl.Ps()+", newCol="+this.Vl.al))},ai.prototype.Zr=function(t){var e=this.Vl;Zl.debug("Execute b=0x"+Te(t));var l=!1;if(null!=e)switch(t){case 0:break;case 5:e.answerback&&Array.isArray(e.answerback)&&e.Vs(e.answerback);break;case 8:e.Er();break;case 9:var n=e.Fi.rl;for(let t=e.al+1;t<e.width;t++)if(n[t]||(n[t]=new li(32)),e.rs[t]){e.wr(t);break}break;case 10:case 11:case 12:e.Hr();break;case 13:e.wr(0);break;case 14:e.Ji=1;break;case 15:e.Ji=0;break;case 127:e.pr();break;case 24:case 26:l=!0;break;default:Zl.warn("Unhandled execute b=0x"+Te(t))}return l},ai.prototype.th=function(t){if(t<48)this.Rr.push(t);else{if(t<58)throw ln.warn("Collect given low value byte, b=0x"+Te(t)),new ci("collect should not get digits");t<64&&(this.qr=t)}},ai.prototype.eh=function(t){this.Nr.push(t)},ai.prototype.Jr=function(){try{var t=this.Nr;return 0===t.length?"":(ln.debug("Param string as hex="),ye(t,ln),String.fromCharCode.apply(null,t))}catch(t){return"<OOPS>"}},ai.prototype.lh=function(){try{var t=this.Rr;return ln.debug("Intermediate string as hex="),ye(t,ln),String.fromCharCode.apply(null,t)}catch(t){return"<OOPS>"}},ai.prototype.nh=function(t){Zl.warn("Unimplemented: "+t)},ai.prototype.zr=function(){var t,e=this.Nr,l=[],n=0,i=!1;for(t=0;t<e.length;t++){var s=e[t];if(59==s)l.push(n),i=!1,n=0;else{if(!(s>=48&&s<=57))throw new ci("unexpected numerical parms "+this.Jr());n=10*n+(s-48),i=!0}}i&&l.push(n);var r=new Array(l.length);for(t=0;t<r.length;t++)r[t]=l[t];return ln.debug("Numerical params="+JSON.stringify(r)),r},ai.prototype.ih=function(t){this.nh("unhandled CSI dispatch character:0x"+Te(t))},ai.prototype.sh=function(t){var e=this.Vl,l=this.Jr();switch(Zl.debug("CSI Dispatch Start:"),Zl.debug("-- b=0x"+Te(t)+", parms="+l+", intermediate="+this.lh()),t){case 64:Zl.debug("-- type=Insert characters"),Zl.debug("IC start, line elements="+JSON.stringify(e.Fi.rl));for(var n=ui(l,1),i=e.al+n,s=e.Fi,r=e.al;r<i;){for(var h=new li(32),u=s.rl[r],o=r+1;o<e.width-1;o++){var a=s.rl[o];s.rl[o]=u,u=a}s.rl[r++]=h}s.xe=!0,Zl.debug("IC end, line elements="+JSON.stringify(e.Fi.rl));break;case 65:{Zl.debug("-- type=(CUU) Cursor Up");let t=ui(l,1);e.ar(-t,0)}break;case 66:{Zl.debug("-- type=(CUD) Cursor Down");let t=ui(l,1);e.ar(t,0)}break;case 67:{Zl.debug("-- type=(CUF) Cursor Right");let t=ui(l,1);e.ar(0,t)}break;case 68:{Zl.debug("-- type=(CUB) Cursor Left");let t=ui(l,1);e.ar(0,-t)}break;case 69:Zl.debug("-- type=(CNL) Cursor Next Line"),this.ih(t);break;case 70:Zl.debug("-- type=(CPL) Cursor Previous Line"),this.ih(t);break;case 71:{Zl.debug("-- type=(CHA) Cursor Character Absolute");let t=this.zr(),l=e.Ps();0==t.length?e.cr(l,0):e.cr(l,t[0]-1)}break;case 72:Zl.debug("-- type=(CUP) Position Cursor"),this.Br();break;case 73:Zl.debug("-- type=(CHT) Cursor Forward Tab"),this.ih(t);break;case 74:if(Zl.debug("-- type=(ED) Erase in display"),e.Fi)if(63==this.qr)this.nh("should perform DECSED");else{if(e.ms&&""==l)return void e.ln(!1);if(""==l||"0"==l){Zl.debug("-- subtype=Erase to End of screen");var c=e.al;let t=e.Fi.rl;for(var f=c;f<e.width;f++)t[f]=null;let l=e.Fi.P;e.Fi.xe=!0;let n=e.Ps();if(n<e.height-1)for(let t=n+1;t<e.height&&l;t++)l.rl=new Array(e.width),l.xe=!0,l=l.P;e.Ge=0}else if("1"==l){Zl.debug("-- subtype=Erase from beginning");let t=e.Ei,l=e.Ps();for(let n=0;n<l;n++)t.xe=!0,t.rl=new Array(e.width),t=t.P;let n=e.Fi.rl;for(let t=0;t<e.al+1;t++)n[t]=null;e.Fi.xe=!0}else"2"==l?e.ms?e.ln(!1):e.ln(!0):"3"==l?(Zl.debug("-- subtype=Erase saved lines"),this.nh("Erase saved lines (xterm)")):Zl.warn("CSI J / ED / Erase display had unexpected param string="+l)}break;case 75:if(Zl.debug("-- type=(EL) Erase in line"),63==this.qr)this.nh("should perform DECSEL");else{let t=e.Ps();Zl.debug("before eraseRange insertionLine="+t),""==l||"0"==l?(Zl.debug("-- subtype=Erase right"),e.Cr(t,-1,t,e.width-1)):"1"==l?(Zl.debug("-- subtype=Erase left"),e.Cr(t,0,t,-1)):"2"==l?(Zl.debug("-- subtype=Erase all"),e.Cr(t,0,t,e.width-1)):Zl.warn("CSI L / EL / Erase line had unexpected param string="+l)}break;case 76:{Zl.debug("-- type=(IL) Insert lines");let t=e.Xi?e.Xi:e.height-1,n=e.$i?e.$i:0,i=ui(l,1);0===i&&(i=1);let s=e.Ps();if(s>t||s<n){Zl.warn("Insert line: requested but current row outside scrolling region, rejecting");break}e.Us(i,e.Fi,s,t,!0),e.wr(0)}break;case 77:{Zl.debug("-- type=(DL) Delete lines");let t=e.Xi?e.Xi:e.height-1,n=e.$i?e.$i:0,i=ui(l,1);0===i&&(i=1);let s=e.Ps();if(s>t||s<n){Zl.warn("Delete line: requested but current row outside scrolling region, rejecting");break}let r=e.Fi;e.Is(i,r,s,t,!0),e.wr(0)}break;case 80:Zl.debug("-- type=(DCH) Delete characters");var w=ui(l,1);0===w&&(w=1);var d=e.al,p=w+d<e.width?w:e.width-1-d,b=e.Fi;e.Fr(p,b,d);break;case 83:Zl.debug("-- type=(SU) Scroll up"),Zl.warn("PANIC: scroll up not implemented."),e.termType===zt?this.nh("Scroll up # lines"):this.nh("0x53, unknown");break;case 84:Zl.debug("-- type=(SD) Scroll down"),Zl.warn("PANIC: scroll down not implemented."),e.termType===zt?this.nh("Scroll down # lines"):this.nh("0x54, unknown");break;case 88:{Zl.debug("-- type=(ECH) Erase characters"),Zl.debug("Erase characters: WARNING, concern about if allowed to erase characters with erase lock attribute");let t=ui(l,1);0===t&&(t=1);let n=e.al,i=t+n<e.width?t:e.width-1-n,s=e.Fi;var v=i+n;for(let t=n;t<v;t++)s.rl[t]=null;s.xe=!0}break;case 89:Zl.debug("-- type=(CVT) Character vertical tab"),this.ih(t);break;case 90:{Zl.debug("-- type=(CBT) Character backward tab"),ui(l,1);let t=e.al;if(0!=t)for(let l=t-1;l=0;l--)if(e.rs[l],1===l){e.wr(l);break}}break;case 96:Zl.debug("-- type=(HPA) Horizontal position absolute"),e.us!=de?(Zl.warn("Cannot handle HPA in decipoint mode"),this.ih(t)):e.wr(ui(l,1)-1);break;case 97:Zl.debug("-- type=(HPR) Horizontal position relative"),this.ih(t);break;case 98:{let n;if(Zl.debug("-- type=(REP) Repeat previous character"),0==e.al){let t=e.Fi.Ds;t&&(n=t.rl[t.rl.length-1])}else n=e.Fi.rl[e.al-1];if(n&&n.He){let e=n.He;var k=ui(l,1);Zl.warn("Should print char=0x"+Te(e)+", "+k+" times"),this.ih(t)}else{var m=e.Ps();let t=e.rh;var A=m*e.width+t;Zl.warn("No previous element found for REP, currentpos: r="+m+", c="+t+", pos="+A)}}break;case 99:Zl.debug("-- type=(DA) Device attributes"),63==this.qr?this.nh("Send Device Attributes Secondary DA"):this.qr&&0!=this.qr?62==this.qr?""==l||"0"==l?this.Wr():Zl.warn("Unhandled device attribute command, privateChar = >, paramString="+l):this.nh("0x63 with privateChar="+Te(this.qr)):this.jr();break;case 100:if(Zl.debug("-- type=(VPA) Line position absolute"),e.us!=de)this.nh("VPA with decipoint");else{var g=ui(l,1);e.dr(g-1),e.cr(g-1,this.Vl.al)}break;case 101:Zl.debug("-- type=(VPR) Line position relative"),this.ih(t);break;case 102:Zl.debug("-- type=(HVP) Horizontal vertical position"),this.Br();break;case 103:if(Zl.debug("-- type=(TBC) Tab clear"),""==l||"0"==l)e.rs[e.al]=0;else if("1"==l)Zl.warn("Not implemented: Tab clear of vertical tab stop");else if("2"==l)e.rs=oi.hs();else{if("3"!=l)throw new ci("Unexpected parameter for tab clear -'"+l+"'");e.rs=oi.hs()}break;case 104:Zl.debug("-- type=(SET) mode set");var C=this.zr();if(63==this.qr)for(let t=0;t<C.length;t++){let l=C[t];switch(l){case 1:e.Vi=1;break;case 2:e.br=!1;break;case 3:e.wr(0),e.pn(132,24);break;case 5:e.Tt.tl();break;case 6:e.js=!0,e.cr(0,0);break;case 7:e.Li=!0;break;case 12:e.Tt.De();break;case 25:e.Tt.Ne();break;case 11:Zl.warn("Not implemented: decipoints instead of row/column");case 64:break;case 67:e.vr=!1;break;case 69:e.hh=!1;break;default:this.nh("mode setting case=?"+l)}}else{if(0===C.length){this.nh("Mode setting default case");break}for(let t=0;t<C.length;t++){let e=C[t];switch(e){case 2:Zl.debug("Mode setting: lock keyboard"),this.Vl.Ki=!0;break;case 4:Zl.debug("Mode setting: insert mode"),this.Vl.qi=1;break;case 12:Zl.debug("Mode setting: send/receive mode (SRM), local echo off"),this.Vl.Yi=!1;break;case 20:Zl.debug("Setting LNM true"),this.Vl.Zi=!0;default:this.nh("Mode setting case="+e)}}}break;case 105:Zl.debug("-- type=(MC) media copy"),this.nh("various printing options");break;case 108:{Zl.debug("-- type=(RM) mode reset");let t=this.zr();if(63==this.qr)for(let l=0;l<t.length;l++){let n=t[l];switch(n){case 1:e.Vi=0;break;case 2:e.br=!0;break;case 3:e.wr(0),e.pn(80,24);break;case 5:e.Tt.ll();break;case 6:e.js=!1,e.cr(0,0);break;case 7:e.Li=!1;break;case 12:e.Tt.Re();break;case 25:e.Tt.Pe();break;case 34:case 64:break;case 67:e.vr=!0;break;case 69:e.hh=!1;break;case 1e3:this.nh("Xterm mode resetting: dont send mouse x&y on button press & release");break;case 1001:this.nh("Xterm mode resetting: dont use hilite mouse tracking");break;case 1002:this.nh("Xterm mode resetting: dont use cell motion mouse tracking");break;case 1003:this.nh("Xterm mode resetting: dont use all motion mouse tracking");break;case 1004:this.nh("Xterm mode resetting: dont send focusin/focusout events");break;case 1005:this.nh("Xterm mode resetting: disable utf-8 mouse mode");break;case 1006:this.nh("Xterm mode resetting: disable sgr mouse mode");break;case 1007:this.nh("Xterm mode resetting: disable alternate scroll mode");break;case 1010:this.nh("Xterm mode resetting: dont scroll to bottom on tty output (rxvt)");break;case 1011:this.nh("Xterm mode resetting: dont scroll to bottom on key press (rxvt)");break;case 1015:this.nh("Xterm mode resetting: disable urxvt mouse mode");break;case 1034:this.nh("Xterm mode resetting: dont interpret meta key");break;case 11:Zl.warn("Not implemented: decipoints instead of row/column");default:this.nh("Suspected Xterm mode resetting, b="+n)}}else{if(0===t.length){this.nh("Mode resetting default case");break}for(let e=0;e<t.length;e++){let l=t[e];switch(l){case 2:Zl.debug("Mode resetting: lock keyboard"),this.Vl.Ki=!1,Zl.debug("Mode resetting warning: not supposed to unlock if locked by DC3");break;case 4:Zl.debug("Mode resetting: replace mode"),this.Vl.qi=Nn;break;case 12:Zl.debug("Mode setting: send/receive mode (SRM), local echo on"),this.Vl.Yi=!0;break;case 20:Zl.debug("Resetting LNM false"),this.Vl.Zi=!1;default:this.nh("Mode resetting case="+l)}}}}break;case 109:{Zl.debug("-- type=(SGR) set graphics rendition");let t=this.zr();0==t.length&&(t=[0]);let n=0;for(;n<t.length;){let i=t[n];switch(i){case 0:e.Ge=0,e.$e=oi.Xe,e.We=0,e.Ze=oi.Xe,e.Qe=0,n++;break;case 1:e.Ge|=16,e.Ge&=-33,n++;break;case 2:e.Ge&=-17,e.Ge|=32,n++;break;case 4:e.Ge|=4,n++;break;case 5:e.Ge|=8,n++;break;case 7:e.Ge|=2,n++;break;case 8:e.Ge|=64,n++;break;case 21:e.Ge&=-17;break;case 22:e.Ge&=-17,e.Ge&=-33,n++;break;case 24:e.Ge&=-5,n++;break;case 25:e.Ge&=-9,n++;break;case 27:e.Ge&=-3,n++;break;case 28:e.Ge&=-65,n++;break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:e.$e=oi.Ke,e.We=i-30,Zl.debug("Set color mode=STANDARD, value=0x"+Te(e.We)),n++;break;case 38:if(n+1<t.length&&5==t[n+1])n+2<t.length?(e.$e=oi.qe,e.We=t[n+2],Zl.debug("Set color mode=TABLE, value=0x"+Te(e.We)),n+=2):(Zl.warn("Could not set color mode, bad TABLE color parameter="+l),n++);else if(n+1<t.length&&2==t[n+1])if(n+4<t.length){let l=Math.max(0,Math.min(255,t[2])),i=Math.max(0,Math.min(255,t[3])),s=Math.max(0,Math.min(255,t[4]));e.$e=oi.Ye,e.We=l<<16|i<<8|s,Zl.debug("Set color mode=RGB, value=0x"+Te(e.We)),n+=4}else Zl.warn("Could not set color mode, bad RGB color parameter="+l),n++;else Zl.warn("Unexpected parameter for SGM="+l),n++;break;case 39:e.$e=oi.Xe,e.We=0,e.Ge&=-17,e.Ge&=-33,Zl.debug("Set color mode=DEFAULT"),n++;break;case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:e.Ze=oi.Ke,e.Qe=i-40,Zl.debug("Set bg color mode=STANDARD, value=0x"+Te(e.We)),n++;break;case 48:if(n+1<t.length&&5==t[n+1])n+2<t.length?(e.Ze=oi.qe,e.Qe=t[n+2],Zl.debug("Set bg color mode=TABLE, value=0x"+Te(e.Qe)),n+=2):(Zl.warn("Could not set bg color mode, bad TABLE color parameter="+l),n++);else if(n+1<t.length&&2==t[n+1])if(n+4<t.length){let l=Math.max(0,Math.min(255,t[2])),i=Math.max(0,Math.min(255,t[3])),s=Math.max(0,Math.min(255,t[4]));e.Ze=oi.Ye,e.Qe=l<<16|i<<8|s,Zl.debug("Set bg color mode=RGB, value=0x"+Te(e.Qe)),n+=4}else Zl.warn("Could not set bg color mode, bad RGB color parameter="+l),n++;else Zl.warn("Unexpected parameter for bg SGM="+l),n++;break;case 49:e.Ze=oi.Xe,e.Qe=0,Zl.debug("Set bg color mode=DEFAULT"),n++;break;case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:e.$e=oi.Ke,e.We=i-90,e.Ge|=16,e.Ge&=-33,Zl.debug("Set color mode=STANDARD BOLD, value=0x"+Te(e.We)),n++;break;default:Zl.warn("Unexpected graphic rendering value="+t[n]+" in parameters="+l),n++}}}break;case 110:{Zl.debug("-- type=(DSR) device status report");let t=this.zr();if(63==this.qr)this.nh("DSR with ? mark");else if(t&&void 0!==t[0])switch(t[0]){case 5:{let t=[27,91,48,110];e.$s(t)}break;case 6:{var S=String(e.Ps()+1),T=String(e.al+1);let t=[27,91];for(let e=0;e<S.length;e++)t.push(S.charCodeAt(e));t.push(59);for(let e=0;e<S.length;e++)t.push(T.charCodeAt(e));t.push(82),e.$s(t)}break;default:this.nh("Device Status Report (DSR) case"+t)}}break;case 112:{let t=this.zr();if(this.Rr&&34==this.Rr[0]&&(Zl.debug("-- type=(STR) Soft terminal reset"),t.length>0))switch(t[0]){case 61:this.uh=!0;break;case 62:if(t.length>1)switch(t[1]){case 0:this.uh=!1;break;case 1:case 2:this.uh=!1}else this.uh=!1}}break;case 113:Zl.debug("-- type=(SCA) set character protection attributes"),1==(C=this.zr()).length&&(1==C[0]?e.Ar=!0:0!=C[0]&&2!=C[0]||(e.Ar=!1));break;case 114:if(C=this.zr(),this.Rr&&36==this.Rr[0]){if(Zl.debug("-- type=(DECCARA) change attributes of rect area"),C.length>4){var y=C[0],E=C[1],F=C[2],x=C[3];(y>=e.height||F>=e.height||E>=e.width||x>=e.width)&&(y=1,E=1,F=e.height,x=e.width);var P=e.Ee;for(f=0;f<y-1&&P;f++)P=P.P;for(let t=y;t<F;t++){for(let t=E;t<x;t++)if(P&&P.rl[t])for(let e=4;e<C.length;e++)switch(C[e]){case 0:P.rl[t].Ge=0;break;case 1:P.rl[t].Ge|=16;break;case 4:P.rl[t].Ge|=4;break;case 5:P.rl[t].Ge|=8;break;case 7:P.rl[t].Ge|=2;break;case 22:P.rl[t].Ge&=-17;break;case 24:P.rl[t].Ge&=-5;break;case 25:P.rl[t].Ge&=-9;break;case 27:P.rl[t].Ge&=-3}P=P.P}}else Zl.warn("wrong params for change attributes of rect area "+C);return}Zl.debug("-- type=(STBM) set top and bottom margins"),2!=(C=this.zr()).length?(e.$i=0,e.Xi=e.height-1):(e.$i=null,e.Xi=null,e.dr(C[1]-1),e.$i=C[0]-1,e.Xi=C[1]-1),e.cr(0,0);break;case 115:Zl.debug("-- type=(DECSLRM) set left & right margins (if enabled) ELSE (SCP) save cursor position"),e.hh&&(0==(C=this.zr()).length?e.cr(0,0):2==C.length&&(E=C[0])<(x=C[1])&&Zl.warn("set left and right margin is not supported yet."));break;case 116:if(Zl.debug("-- type=(RARA) Reverse attributes in rectangle"),C=this.zr(),this.Rr&&36==this.Rr[0]){if(C.length>4){for(y=C[0],E=C[1],F=C[2],x=C[3],(y>=e.height||F>=e.height||E>=e.width||x>=e.width)&&(y=1,E=1,F=e.height,x=e.width),P=e.Ee,f=0;f<y-1&&P;f++)P=P.P;for(let t=y;t<F;t++)if(P){for(let t=E;t<x;t++)if(P.rl[t])for(let e=4;e<C.length;e++)switch(C[e]){case 0:P.rl[t].Ge&=~P.rl[t].Ge;break;case 1:16&P.rl[t].Ge?P.rl[t].Ge&=-17:P.rl[t].Ge|=16;break;case 4:4&P.rl[t].Ge?P.rl[t].Ge&=-5:P.rl[t].Ge|=4;break;case 5:8&P.rl[t].Ge?P.rl[t].Ge&=-9:P.rl[t].Ge|=8;break;case 7:2&P.rl[t].Ge?P.rl[t].Ge&=-3:P.rl[t].Ge|=2}P=P.P}}else Zl.warn("wrong params for change attributes of rect area "+C);return void e.Tt.zt()}break;case 118:if(Zl.debug("-- type=(CRA) Copy rectangle"),8==(C=this.zr()).length){if(0==C[2]&&(C[2]=e.height),0==C[3]&&(C[3]=e.width),C[1]>C[3])break;if(C[0]>C[2])break;var M=C[7]-C[4],N=C[6]-C[1],R=C[2]-C[0];for(P=e.Ee,f=0;f<C[0]-1&&P;f++)P=P.P;if(M>0)for(let t=0;t<M*e.height;t++)e.Gs();var D=e.Ee;if(M>=0)for(f=0;f<C[5]-1&&D;f++)D=D.P;else Zl.warn("copy to previous page, not handled");var I=D,L=new si(e.width,!0);L.id=D.id;var _=L;for(f=R;R>=0;R--){for(var O=0;O<e.width;O++)D.rl[O]&&(L.rl[O]=D.rl[O]);if(!P)break;let t=0;if(N>0)for(t=C[1]-1;t<C[3];t++)P&&P.rl[t]&&t+N<P.rl.length&&(L.rl[t+N]=P.rl[t]);else for(t=-N,t=C[1]-1;t<C[3];t++)P&&P.rl[t+N]&&t<P.rl.length&&(L.rl[t]=P.rl[t+N]);if(L.P||(L.P=new si(e.width,!0),L.P.id=L.id+1),L.P.Ds=L,!D.P||!P.P)break;L=L.P,D=D.P,P=P.P}for(f=R=C[2]-C[0];R>=0;R--){for(o=0;o<e.width;o++)_.rl[o]&&(I.rl[o]=_.rl[o]);if(!I.P||!_.P)break;I=I.P,_=_.P}e.Tt.zt()}break;case 119:Zl.debug("-- type=(EFR) Enable filter rectangle"),this.ih(t);break;case 120:if(Zl.debug("-- type=(REQTPARM) Request terminal parameters OR (FRA) Fill rectangular"),5==(C=this.zr()).length){if(C[3]>e.height&&(C[3]=e.height),C[4]>e.width&&(C[4]=e.width),numCol=C[4]-C[2],R=C[3]-C[1],numCol||(numCol=C[4]),R||(R=C[3]),e.xi<C[3])for(var U=0;U<C[3];U++)e.Gs();if(numCol>0&&R>0){for(P=e.Ee,f=0;f<C[1]-1&&P;f++)P=P.P;for(f=0;f<R;f++)if(P){for(o=C[2]-1;o<C[4];o++)P.rl[o]?P.rl[o].He=C[0]:P.rl[o]=new li(C[0]),e.Ar?P.rl[o].Ar=!0:P.rl[o].Ar=!1;if(!P||!P.P)break;P=P.P}}else Zl.warn("wrong params of fill the rectangle area "+C);e.Tt.zt()}break;case 121:Zl.debug("-- type=(SACE) Select attribute change extent"),this.ih(t);break;case 122:case 123:if(Zl.debug("-- type=(DECERA)  (ERA) Erase rectangular"),4==(C=this.zr()).length){if(C[2]>e.height&&(C[2]=e.height),C[3]>e.width&&(C[3]=e.width),numCol=C[3]-C[1],R=C[2]-C[0],numCol||(numCol=C[3]),R||(R=C[2]),numCol>0&&R>0){for(P=e.Ee,f=0;f<C[0]-1&&P;f++)P=P.P;for(f=0;f<R;f++)if(P){for(o=C[1]-1;o<C[3];o++)123==t?P.rl[o]&&P.rl[o].Ar||(P.rl[o].He=32):P.rl[o]&&(P.rl[o].He=32);if(!P||!P.P)break;P=P.P}}else Zl.warn("wrong params of erasing the rectangle area "+C);e.Tt.zt()}break;default:this.nh("unhandled CSI dispatch character:0x"+Te(t))}},ai.prototype.oh=function(){let t=this.Vl,e=this.Ur,l=Number(String.fromCharCode.apply(null,this.Or));switch(Zl.debug("OSC dispatch: type="+l+", params="+e),l){case 0:let n=String.fromCharCode.apply(null,e);t.callbacks.titleCallback&&t.callbacks.titleCallback(n);break;case 4:this.nh("OSC change color");break;case 5:this.nh("OSC change special color");break;case 10:this.nh("Change text color w/ OSC4 spec");break;case 11:this.nh("Change backkground color w/ OSC4 spec");break;case 15:this.nh("Change TEK text color w/ OSC4 spec");break;case 16:this.nh("Change TEK background color w/ OSC4 spec");break;case 52:this.nh("OSC clipboard access");break;case 104:this.nh("Reset color number");break;case 105:this.nh("Reset special color number");break;case 110:this.nh("Reset window text color");break;case 111:this.nh("Reset window background color");break;case 115:this.nh("Reset TEK window text color");break;case 116:this.nh("Reset TEK window background color");break;default:Zl.warn("Unknown OSC type "+l+" encountered with params="+e)}},ai.prototype.ah=function(t){let e=this.Vl;Zl.debug("Escape Dispatch Start:"),Zl.debug("-- b=0x"+Te(t)),this.Pr[this.Mr++]=t,ye(this.Pr,Zl,0,this.Mr);var l=255&this.Pr[1];switch(l){case 32:var n=255&this.Pr[2];if(e.uh||e.br)e.Hi=!1;else switch(n){case 70:e.Hi=!1;break;case 71:e.Hi=!0}break;case 35:if(this.Pr.length<2)throw new Sn("Encountered escape # without following byte to determine action");{let t=255&this.Pr[2];switch(t){case 51:if(e.Ge|=256,e.Ge&=-129,e.Ge&=-513,e.Fi&&e.Fi.rl)for(let t=0;t<e.Fi.rl.length;t++)e.Fi.rl[t]&&(e.Fi.rl[t].Ge=e.Ge);break;case 52:if(e.Ge|=512,e.Ge&=-257,e.Ge&=-129,e.Fi&&e.Fi.rl)for(let t=0;t<e.Fi.rl.length;t++)e.Fi.rl[t]&&(e.Fi.rl[t].Ge=e.Ge);break;case 53:if(e.Ge&=-129,e.Ge&=-257,e.Ge&=-513,e.Fi&&e.Fi.rl)for(let t=0;t<e.Fi.rl.length;t++)e.Fi.rl[t]&&(e.Fi.rl[t].Ge=e.Ge);break;case 54:if(e.Ge|=128,e.Ge&=-257,e.Ge&=-513,e.Fi&&e.Fi.rl)for(let t=0;t<e.Fi.rl.length;t++)e.Fi.rl[t]&&(e.Fi.rl[t].Ge=e.Ge);break;case 56:var i=e.Ei;i||(e.Gs(),i=e.Ei);for(var s=0;s<e.height;s++){for(var r=0;r<e.width;r++)i.rl[r]?i.rl[r].ii=69:i.rl[r]=new li(69);i.P||e.Gs(),i=i.P}break;default:this.nh("escape dispatch byte 0x23, modifier "+t)}}break;case 37:if(this.Pr.length<2)this.ch("Escape % seen with no following char");else{let t=255&this.Pr[2];switch(t){case 64:e.je=!1;break;case 71:e.je=!0;break;default:Zl.warn("Unhandled ESC % byte=0x"+Te(t)+" assumed to be used for UTF8")}}break;case 40:case 41:case 42:case 43:if(3==this.Mr){var h=255&this.Pr[2];Zl.debug("should set Gx x=0x"+Te(l-40)+" to 0x"+h),e.Bi[l-40]=t}else Zl.warn("unhandled set G0-G3 case");break;case 55:e.fh={Fi:e.Fi,ts:e.ts,al:e.al,Ge:e.Ge,$e:e.$e,We:e.We,Bi:e.Bi};break;case 56:e.fh?(e.Fi=e.fh.Fi,e.ts=e.fh.ts,e.al=e.fh.al,e.Ge=e.fh.Ge,e.$e=e.fh.$e,e.We=e.fh.We,e.Bi=e.fh.Bi):Zl.warn("Dont have saved attributes to restore from for escape 0x38");break;case 60:e.br=!1;break;case 61:e.os=!0;break;case 62:e.os=!1;break;case 65:Zl.debug("-- type=VT52 Cursor Up"),e.ar(-1,0);break;case 66:Zl.debug("-- type=VT52 Cursor Down"),e.ar(1,0);break;case 67:Zl.debug("-- type=VT52 Cursor Right"),e.ar(0,1);break;case 68:if(e.br)Zl.debug("-- type=VT52 Cursor Left"),e.ar(0,-1);else{Zl.debug("-- type=(IND) Index down");var u=null!=e.$i?e.$i:0,o=null!=e.Xi?e.Xi:e.height-1;e.Ps()==o&&e.Is(1,e.Ls(u),u,o,!1),e.ar(1,0)}break;case 69:e.ar(1,0),e.wr(0);break;case 72:if(e.br){Zl.debug("-- type=Move cursor home");var a=e.Ps();e.cr(a,0)}else Zl.debug("-- type=(HTS) Horizontal Tab set"),e.rs[e.al]=1;break;case 73:break;case 77:{Zl.debug("-- type=(RI) Reverse Index");let t=null!=e.$i?e.$i:0,l=null!=e.Xi?e.Xi:e.height-1;e.Ps()==t&&e.Us(1,e.Ls(t),t,l,!1),e.ar(-1,0)}break;case 78:e._i=!0;break;case 79:e.Oi=!0;break;case 80:this.nh("P!");break;case 90:break;case 92:Zl.debug("escapeDispatch 0x5C string terminator ");break;case 95:Zl.debug("unimplemented escape code 0x5F");break;case 99:this.nh("Hard Terminal Reset");break;case 125:Zl.warn("need to set G2 ");break;default:this.nh("unhandled ESCAPE dispatch character=0x"+Te(l))}this.qr=0},ai.prototype.wh=function(t){return t<=23||25==t||t>=28&&t<32},ai.prototype.dh=function(t){return t<=23||25==t||t>=28&&t<32||127==t},ai.prototype.ph=function(t){if(t<192)throw new Sn("UTF8 cannot have first byte below C0");var e=255&~t;if(e>=32)this.bh=1;else if(e>=16)this.bh=2;else if(e>=8)this.bh=3;else if(e>=4)this.bh=4;else{if(!(e>=2))throw new Sn("Unexpectedly high first byte value for UTF8");this.bh=5}},ai.prototype.tr=function(t){ln.debug("Parser Loop Top: b=0x"+Te(t)+" state="+ai.vh[this.Ul]);var e=0;switch(this.Ul){case In:this.dh(t)?(this.Zr(t),e=In):t<32||(255===t?e=12:!0===this.Vl.je&&t>=192&&t<=253?(this.kh=[],this.kh.push(t),this.ph(t),e=17):94==t?e=18:t>127||this.Qr(t)),12!=e&&(this.Vl.Ll=!0);break;case 18:if(this.dh(t))this.Qr(94),this.Zr(t),e=In;else if(t<32)this.Qr(94),this.Ul=In;else if(255===t)this.Qr(94),e=12;else if(t>=192&&t<=253)this.Qr(94),this.kh=[],this.kh.push(t),this.ph(t),e=17;else{switch(t){case 72:case 63:2===this.Vl.es?this.Vl.pr():1===this.Vl.es?this.Vl.Er():this.Vl.es!=Ot&&(this.Qr(94),this.Qr(t));break;default:this.Qr(94),this.Qr(t)}e=In}break;case 17:if(this.kh.push(t),this.bh--,0===this.bh){var l=ai.Vr(this.kh);this.Qr(l),e=In}break;case 12:switch(this.Bl=t,this.Bl){case 255:e=In,this.Qr(t);break;case 250:e=14;break;case 251:case 252:case 253:case 254:e=13;break;case 247:this.Zr(127);break;case 240:case 242:case 241:case 249:default:e=In}break;case 13:this.Xr(t),e=In;break;case 14:if(255===t){this.$r(),e=12;break}this.zl.push(t),e=14;break;case 10:t>=32&&t<48?(this.th(t),e=19):t>=48&&t<64||59==t?(this.eh(t),e=20):t>=60&&t<64?(this.th(t),e=20):58==t?e=22:t>=64&&t<127&&(e=21);break;case 19:t>=32&&t<48?(this.th(t),e=19):t>=48&&t<64?e=22:t>=64&&t<127&&(e=21);break;case 20:t>=48&&t<64||59==t?(this.eh(t),e=20):58==t||t>=60&&t<64?e=22:t>=32&&t<48?(this.th(t),e=19):t>=64&&t<127&&(e=21);break;case 22:this.mh?(92==t&&(e=In),this.mh=!1):156==t?e=In:27==t&&(this.mh=!0,e=22);break;case 21:this.mh?(92==t&&(e=In),this.mh=!1):27==t?(this.mh=!0,e=21):(Zl.warn("DCS Passthrough unimplemented"),e=21);break;case 7:if(this.wh(t))e=this.Zr(t)?In:7;else{if(this.Mr=0,this.Pr[this.Mr++]=27,this.Pr[this.Mr++]=t,t<32)throw new ci("VT_ESCAPE_START sees b<0x20");if(t>=32&&t<48)e=8;else switch(ln.debug("escape dispatch main switch"),t){case 80:e=10;break;case 91:e=2;break;case 93:e=6;break;default:if(!(t<127))throw new ci("VT_ESCAPE_START sees b>=0x7f");this.ah(t),e=In}}break;case 8:if(this.wh(t))e=this.Zr(t)?In:8;else{if(t<32)throw new ci("unhandled byte=0x"+Te(t)+" in VT_ESCAPE_INTERMEDIATE");t<48?(this.th(t),e=8):t<127?(this.ah(t),e=In):127==t&&(e=8)}break;case 6:t>=32&&t<=127&&(this.Or.push(t),e=15);break;case 15:59===t?e=16:this.Or.push(t);break;case 16:7===t||156===t?(this.oh(),e=In):this.Ur.push(t);break;case 2:this.wh(t)?e=this.Zr(t)?In:2:t>=32&&t<48?(this.th(t),e=3):t<58?(this.eh(t),e=5):t<60?58==t?e=4:(e=5,this.eh(t)):t<64?(this.th(t),e=5):t<127?(this.sh(t),e=In):t<2&&(e=2);break;case 5:if(this.wh(t))e=this.Zr(t)?In:5;else if(t>=32&&t<48)this.th(t),e=3;else if(t>=48&&t<58||59==t)this.eh(t),e=5;else if(58==t||t>=60&&t<64)e=4;else{if(!(t<127))throw new ci("unhandled byte "+t+" in VT_CSI_PARAM");this.sh(t),e=In}break;case 4:if(this.wh(t))e=this.Zr(t)?In:4;else{if(t<32)throw new ci("unhandled byte "+t+" in VT_CSI_IGNORE");if(t<64||127==t)e=4;else{if(!(t<127))throw new ci("unhandled byte "+t+" in VT_CSI_IGNORE");e=In}}break;case 3:if(this.wh(t))e=this.Zr(t)?In:3;else{if(t<32)throw new ci("unhandled byte "+t+" in VT_CSI_INTERMEDIATE");if(t<48)this.th(t),e=3;else if(t<64)e=4;else if(t<127)this.sh(t),e=In;else{if(127!=t)throw new ci("unhandled byte "+t+" in VT_CSI_INTERMEDIATE");e=3}}}if(12!==e&&14!==e&&13!==e&&(this.Vl._l=2),0==e)switch(t){case 27:this.Ul=7;break;case 155:this.Ul=2,this.clear(),this.Mr=0,this.Pr[this.Mr++]=27,this.Pr[this.Mr++]=91;break;case 157:this.Ul=6}else{if(this.Ul!=e)switch(e){case 6:case 2:case 7:case 10:this.clear()}this.Ul=e}},ai.vh=["NO_STATE","VT_BASE","VT_CSI_START","VT_CSI_INTERMEDIATE","VT_CSI_IGNORE","VT_CSI_PARAM","VT_OSC_STRING","VT_ESCAPE_START","VT_ESCAPE_INTERMEDIATE","VT_SOS_PM_APC","VT_DCS_START","VTF","VT_TELNET_VERB","VT_TELNET_OPTION","VT_TELNET_SUB","VT_OSC_INTERMEDIATE","VT_OSC_PARAM","VT_UTF8","VT_CONTROL_CHAR","VT_DSC_INTERMEDIATE","VT_DCS_PARAM","VT_DCS_PASSTHROUGH","VT_DCS_IGNORE"];exports.startVT=startVT;return exports;}("undefined"==typeof org_zowe_terminal_vt?org_zowe_terminal_vt={}:org_zowe_terminal_vt);
